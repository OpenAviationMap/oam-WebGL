/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2013 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
/**
 * @license
 * almond 0.2.3 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
@license
sprintf.js from the php.js project - https://github.com/kvz/phpjs
Directly from https://github.com/kvz/phpjs/blob/master/functions/strings/sprintf.js

php.js is copyright 2012 Kevin van Zonneveld.

Portions copyright Brett Zamir (http://brett-zamir.me), Kevin van Zonneveld
(http://kevin.vanzonneveld.net), Onno Marsman, Theriault, Michael White
(http://getsprink.com), Waldo Malqui Silva, Paulo Freitas, Jack, Jonas
Raoni Soares Silva (http://www.jsfromhell.com), Philip Peterson, Legaev
Andrey, Ates Goral (http://magnetiq.com), Alex, Ratheous, Martijn Wieringa,
Rafa? Kukawski (http://blog.kukawski.pl), lmeyrick
(https://sourceforge.net/projects/bcmath-js/), Nate, Philippe Baumann,
Enrique Gonzalez, Webtoolkit.info (http://www.webtoolkit.info/), Carlos R.
L. Rodrigues (http://www.jsfromhell.com), Ash Searle
(http://hexmen.com/blog/), Jani Hartikainen, travc, Ole Vrijenhoek,
Erkekjetter, Michael Grier, Rafa? Kukawski (http://kukawski.pl), Johnny
Mast (http://www.phpvrouwen.nl), T.Wild, d3x,
http://stackoverflow.com/questions/57803/how-to-convert-decimal-to-hex-in-javascript,
Rafa? Kukawski (http://blog.kukawski.pl/), stag019, pilus, WebDevHobo
(http://webdevhobo.blogspot.com/), marrtins, GeekFG
(http://geekfg.blogspot.com), Andrea Giammarchi
(http://webreflection.blogspot.com), Arpad Ray (mailto:arpad@php.net),
gorthaur, Paul Smith, Tim de Koning (http://www.kingsquare.nl), Joris, Oleg
Eremeev, Steve Hilder, majak, gettimeofday, KELAN, Josh Fraser
(http://onlineaspect.com/2007/06/08/auto-detect-a-time-zone-with-javascript/),
Marc Palau, Martin
(http://www.erlenwiese.de/), Breaking Par Consulting Inc
(http://www.breakingpar.com/bkp/home.nsf/0/87256B280015193F87256CFB006C45F7),
Chris, Mirek Slugen, saulius, Alfonso Jimenez
(http://www.alfonsojimenez.com), Diplom@t (http://difane.com/), felix,
Mailfaker (http://www.weedem.fr/), Tyler Akins (http://rumkin.com), Caio
Ariede (http://caioariede.com), Robin, Kankrelune
(http://www.webfaktory.info/), Karol Kowalski, Imgen Tata
(http://www.myipdf.com/), mdsjack (http://www.mdsjack.bo.it), Dreamer,
Felix Geisendoerfer (http://www.debuggable.com/felix), Lars Fischer, AJ,
David, Aman Gupta, Michael White, Public Domain
(http://www.json.org/json2.js), Steven Levithan
(http://blog.stevenlevithan.com), Sakimori, Pellentesque Malesuada,
Thunder.m, Dj (http://phpjs.org/functions/htmlentities:425#comment_134018),
Steve Clay, David James, Francois, class_exists, nobbler, T. Wild, Itsacon
(http://www.itsacon.net/), date, Ole Vrijenhoek (http://www.nervous.nl/),
Fox, Raphael (Ao RUDLER), Marco, noname, Mateusz "loonquawl" Zalega, Frank
Forte, Arno, ger, mktime, john (http://www.jd-tech.net), Nick Kolosov
(http://sammy.ru), marc andreu, Scott Cariss, Douglas Crockford
(http://javascript.crockford.com), madipta, Slawomir Kaniecki,
ReverseSyntax, Nathan, Alex Wilson, kenneth, Bayron Guevara, Adam Wallner
(http://web2.bitbaro.hu/), paulo kuong, jmweb, Lincoln Ramsay, djmix,
Pyerre, Jon Hohle, Thiago Mata (http://thiagomata.blog.com), lmeyrick
(https://sourceforge.net/projects/bcmath-js/this.), Linuxworld, duncan,
Gilbert, Sanjoy Roy, Shingo, sankai, Oskar Larsson H?gfeldt
(http://oskar-lh.name/), Denny Wardhana, 0m3r, Everlasto, Subhasis Deb,
josh, jd, Pier Paolo Ramon (http://www.mastersoup.com/), P, merabi, Soren
Hansen, Eugene Bulkin (http://doubleaw.com/), Der Simon
(http://innerdom.sourceforge.net/), echo is bad, Ozh, XoraX
(http://www.xorax.info), EdorFaus, JB, J A R, Marc Jansen, Francesco, LH,
Stoyan Kyosev (http://www.svest.org/), nord_ua, omid
(http://phpjs.org/functions/380:380#comment_137122), Brad Touesnard, MeEtc
(http://yass.meetcweb.com), Peter-Paul Koch
(http://www.quirksmode.org/js/beat.html), Olivier Louvignes
(http://mg-crea.com/), T0bsn, Tim Wiel, Bryan Elliott, Jalal Berrami,
Martin, JT, David Randall, Thomas Beaucourt (http://www.webapp.fr), taith,
vlado houba, Pierre-Luc Paour, Kristof Coomans (SCK-CEN Belgian Nucleair
Research Centre), Martin Pool, Kirk Strobeck, Rick Waldron, Brant Messenger
(http://www.brantmessenger.com/), Devan Penner-Woelk, Saulo Vallory, Wagner
B. Soares, Artur Tchernychev, Valentina De Rosa, Jason Wong
(http://carrot.org/), Christoph, Daniel Esteban, strftime, Mick@el, rezna,
Simon Willison (http://simonwillison.net), Anton Ongson, Gabriel Paderni,
Marco van Oort, penutbutterjelly, Philipp Lenssen, Bjorn Roesbeke
(http://www.bjornroesbeke.be/), Bug?, Eric Nagel, Tomasz Wesolowski,
Evertjan Garretsen, Bobby Drake, Blues (http://tech.bluesmoon.info/), Luke
Godfrey, Pul, uestla, Alan C, Ulrich, Rafal Kukawski, Yves Sucaet,
sowberry, Norman "zEh" Fuchs, hitwork, Zahlii, johnrembo, Nick Callen,
Steven Levithan (stevenlevithan.com), ejsanders, Scott Baker, Brian Tafoya
(http://www.premasolutions.com/), Philippe Jausions
(http://pear.php.net/user/jausions), Aidan Lister
(http://aidanlister.com/), Rob, e-mike, HKM, ChaosNo1, metjay, strcasecmp,
strcmp, Taras Bogach, jpfle, Alexander Ermolaev
(http://snippets.dzone.com/user/AlexanderErmolaev), DxGx, kilops, Orlando,
dptr1988, Le Torbi, James (http://www.james-bell.co.uk/), Pedro Tainha
(http://www.pedrotainha.com), James, Arnout Kazemier
(http://www.3rd-Eden.com), Chris McMacken, gabriel paderni, Yannoo,
FGFEmperor, baris ozdil, Tod Gentille, Greg Frazier, jakes, 3D-GRAF, Allan
Jensen (http://www.winternet.no), Howard Yeend, Benjamin Lupton, davook,
daniel airton wermann (http://wermann.com.br), Atli T¨®r, Maximusya, Ryan
W Tenney (http://ryan.10e.us), Alexander M Beedie, fearphage
(http://http/my.opera.com/fearphage/), Nathan Sepulveda, Victor, Matteo,
Billy, stensi, Cord, Manish, T.J. Leahy, Riddler
(http://www.frontierwebdev.com/), Rafa? Kukawski, FremyCompany, Matt
Bradley, Tim de Koning, Luis Salazar (http://www.freaky-media.com/), Diogo
Resende, Rival, Andrej Pavlovic, Garagoth, Le Torbi
(http://www.letorbi.de/), Dino, Josep Sanz (http://www.ws3.es/), rem,
Russell Walker (http://www.nbill.co.uk/), Jamie Beck
(http://www.terabit.ca/), setcookie, Michael, YUI Library:
http://developer.yahoo.com/yui/docs/YAHOO.util.DateLocale.html, Blues at
http://hacks.bluesmoon.info/strftime/strftime.js, Ben
(http://benblume.co.uk/), DtTvB
(http://dt.in.th/2008-09-16.string-length-in-bytes.html), Andreas, William,
meo, incidence, Cagri Ekin, Amirouche, Amir Habibi
(http://www.residence-mixte.com/), Luke Smith (http://lucassmith.name),
Kheang Hok Chin (http://www.distantia.ca/), Jay Klehr, Lorenzo Pisani,
Tony, Yen-Wei Liu, Greenseed, mk.keck, Leslie Hoare, dude, booeyOH, Ben
Bryan

Licensed under the MIT (MIT-LICENSE.txt) license.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL KEVIN VAN ZONNEVELD BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
*/

/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */

/**
 * @fileOverview
 * @license
 *
 * Grauw URI utilities
 *
 * See: http://hg.grauw.nl/grauw-lib/file/tip/src/uri.js
 *
 * @author Laurens Holst (http://www.grauw.nl/)
 *
 *   Copyright 2012 Laurens Holst
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 *
 */

/**
  @license
  fontmetrics.js - https://github.com/Pomax/fontmetrics.js

  This library rewrites the Canvas2D "measureText" function
  so that it returns a more complete metrics object.
  This library is licensed under the MIT (Expat) license,
  the text for which is included below.

** -----------------------------------------------------------------------------

  CHANGELOG:

    2012-01-21 - Whitespace handling added by Joe Turner
                 (https://github.com/oampo)

** -----------------------------------------------------------------------------

  Copyright (C) 2011 by Mike "Pomax" Kamermans

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.
**/

/**
 * @license
 * Description : Array and textureless GLSL 2D/3D/4D simplex 
 *               noise functions.
 *      Author : Ian McEwan, Ashima Arts.
 *  Maintainer : ijm
 *     Lastmod : 20110822 (ijm)
 *     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
 *               Distributed under the MIT License. See LICENSE file.
 *               https://github.com/ashima/webgl-noise
 */

/**
 * @license
 * Cellular noise ("Worley noise") in 2D in GLSL.
 * Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.
 * This code is released under the conditions of the MIT license.
 * See LICENSE file for details.
 */

/**
@license
tween.js - https://github.com/sole/tween.js

Copyright (c) 2010-2012 Tween.js authors.

Easing equations Copyright (c) 2001 Robert Penner http://robertpenner.com/easing/

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

// Create the copyright message.

/**
 * @license
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Analytical Graphics, Inc.
 */

/**
@license
Knockout JavaScript library v2.2.1
(c) Steven Sanderson - http://knockoutjs.com/
License: MIT (http://www.opensource.org/licenses/mit-license.php)
*/

(function(){var e,t,i;(function(r){function n(e,t){return w.call(e,t)}function o(e,t){var i,r,n,o,a,s,l,u,c,h,d=t&&t.split("/"),m=_.map,p=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=d.concat(e.split("/")),u=0;e.length>u;u+=1)if(h=e[u],"."===h)e.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||p)&&m){for(i=e.split("/"),u=i.length;u>0;u-=1){if(r=i.slice(0,u).join("/"),d)for(c=d.length;c>0;c-=1)if(n=m[d.slice(0,c).join("/")],n&&(n=n[r])){o=n,a=u;break}if(o)break;!s&&p&&p[r]&&(s=p[r],l=u)}!o&&s&&(o=s,a=l),o&&(i.splice(0,a,o),e=i.join("/"))}return e}function a(e,t){return function(){return m.apply(r,C.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return o(t,e)}}function l(e){return function(t){v[e]=t}}function u(e){if(n(g,e)){var t=g[e];delete g[e],y[e]=!0,d.apply(r,t)}if(!n(v,e)&&!n(y,e))throw Error("No "+e);return v[e]}function c(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function h(e){return function(){return _&&_.config&&_.config[e]||{}}}var d,m,p,f,v={},g={},_={},y={},w=Object.prototype.hasOwnProperty,C=[].slice;p=function(e,t){var i,r=c(e),n=r[0];return e=r[1],n&&(n=o(n,t),i=u(n)),n?e=i&&i.normalize?i.normalize(e,s(t)):o(e,t):(e=o(e,t),r=c(e),n=r[0],e=r[1],n&&(i=u(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:i}},f={require:function(e){return a(e)},exports:function(e){var t=v[e];return t!==void 0?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:h(e)}}},d=function(e,t,i,o){var s,c,h,d,m,_,w=[];if(o=o||e,"function"==typeof i){for(t=!t.length&&i.length?["require","exports","module"]:t,m=0;t.length>m;m+=1)if(d=p(t[m],o),c=d.f,"require"===c)w[m]=f.require(e);else if("exports"===c)w[m]=f.exports(e),_=!0;else if("module"===c)s=w[m]=f.module(e);else if(n(v,c)||n(g,c)||n(y,c))w[m]=u(c);else{if(!d.p)throw Error(e+" missing "+c);d.p.load(d.n,a(o,!0),l(c),{}),w[m]=v[c]}h=i.apply(v[e],w),e&&(s&&s.exports!==r&&s.exports!==v[e]?v[e]=s.exports:h===r&&_||(v[e]=h))}else e&&(v[e]=i)},e=t=m=function(e,t,i,n,o){return"string"==typeof e?f[e]?f[e](t):u(p(e,t).f):(e.splice||(_=e,t.splice?(e=t,t=i,i=null):e=r),t=t||function(){},"function"==typeof i&&(i=n,n=o),n?d(r,e,t,i):setTimeout(function(){d(r,e,t,i)},15),m)},m.config=function(e){return _=e,m},i=function(e,t,i){t.splice||(i=t,t=[]),n(v,e)||n(g,e)||(g[e]=[e,t,i])},i.amd={jQuery:!0}})(),i("..ThirdPartyalmond-0.2.3almond.js",function(){}),i("Core/freezeObject",[],function(){var e=Object.freeze;return e===void 0&&(e=function(e){return e}),e}),i("Core/defaultValue",["./freezeObject"],function(e){var t=function(e,t){return e!==void 0?e:t};return t.EMPTY_OBJECT=e({}),t}),i("Core/DeveloperError",[],function(){var e=function(e){this.name="DeveloperError",this.message=e,this.error=Error()};return e.prototype.toString=function(){var e=this.name+": "+this.message;return this.error!==void 0&&(e+=this.error.stack!==void 0?"\n"+(""+this.error.stack):"\n"+(""+this.error)),e},e}),i("Core/Cartesian3",["./defaultValue","./DeveloperError","./freezeObject"],function(e,t,i){var r=function(t,i,r){this.x=e(t,0),this.y=e(i,0),this.z=e(r,0)};r.fromSpherical=function(i,n){if(i===void 0)throw new t("spherical is required");n===void 0&&(n=new r);var o=i.clock,a=i.cone,s=e(i.magnitude,1),l=s*Math.sin(a);return n.x=l*Math.cos(o),n.y=l*Math.sin(o),n.z=s*Math.cos(a),n},r.fromArray=function(i,n,o){if(i===void 0)throw new t("values is required.");if(n+3>i.length)throw new t("offset + 3 is greater than the length of the array.");return n=e(n,0),o===void 0&&(o=new r),o.x=i[n+0],o.y=i[n+1],o.z=i[n+2],o},r.clone=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(e.x,e.y,e.z):(i.x=e.x,i.y=e.y,i.z=e.z,i)},r.fromCartesian4=r.clone,r.getMaximumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.max(e.x,e.y,e.z)},r.getMinimumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.min(e.x,e.y,e.z)},r.magnitudeSquared=function(e){if(e===void 0)throw new t("cartesian is required");return e.x*e.x+e.y*e.y+e.z*e.z},r.magnitude=function(e){return Math.sqrt(r.magnitudeSquared(e))};var n=new r;r.distance=function(e,i){if(e===void 0||i===void 0)throw new t("left and right are required.");return r.subtract(e,i,n),r.magnitude(n)},r.normalize=function(e,i){if(e===void 0)throw new t("cartesian is required");var n=r.magnitude(e);return i===void 0?new r(e.x/n,e.y/n,e.z/n):(i.x=e.x/n,i.y=e.y/n,i.z=e.z/n,i)},r.dot=function(e,i){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return e.x*i.x+e.y*i.y+e.z*i.z},r.multiplyComponents=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x*i.x,e.y*i.y,e.z*i.z):(n.x=e.x*i.x,n.y=e.y*i.y,n.z=e.z*i.z,n)},r.add=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x+i.x,e.y+i.y,e.z+i.z):(n.x=e.x+i.x,n.y=e.y+i.y,n.z=e.z+i.z,n)},r.subtract=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x-i.x,e.y-i.y,e.z-i.z):(n.x=e.x-i.x,n.y=e.y-i.y,n.z=e.z-i.z,n)},r.multiplyByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x*i,e.y*i,e.z*i):(n.x=e.x*i,n.y=e.y*i,n.z=e.z*i,n)},r.divideByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x/i,e.y/i,e.z/i):(n.x=e.x/i,n.y=e.y/i,n.z=e.z/i,n)},r.negate=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(-e.x,-e.y,-e.z):(i.x=-e.x,i.y=-e.y,i.z=-e.z,i)},r.abs=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)):(i.x=Math.abs(e.x),i.y=Math.abs(e.y),i.z=Math.abs(e.z),i)};var o=new r;r.lerp=function(e,i,n,a){if(e===void 0)throw new t("start is required.");if(i===void 0)throw new t("end is required.");if("number"!=typeof n)throw new t("t is required and must be a number.");return r.multiplyByScalar(i,n,o),a=r.multiplyByScalar(e,1-n,a),r.add(o,a,a)};var a=new r,s=new r;r.angleBetween=function(e,i){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");r.normalize(e,a),r.normalize(i,s);var n=r.dot(a,s),o=r.cross(a,s,a).magnitude();return Math.atan2(o,n)};var l=new r;return r.mostOrthogonalAxis=function(e,i){if(e===void 0)throw new t("cartesian is required.");var n=r.normalize(e,l);return r.abs(n,n),i=n.y>=n.x?n.z>=n.x?r.clone(r.UNIT_X,i):r.clone(r.UNIT_Z,i):n.z>=n.y?r.clone(r.UNIT_Y,i):r.clone(r.UNIT_Z,i)},r.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.x===t.x&&e.y===t.y&&e.z===t.z},r.equalsEpsilon=function(e,i,r){if("number"!=typeof r)throw new t("epsilon is required and must be a number.");return e===i||e!==void 0&&i!==void 0&&r>=Math.abs(e.x-i.x)&&r>=Math.abs(e.y-i.y)&&r>=Math.abs(e.z-i.z)},r.cross=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");var o=e.x,a=e.y,s=e.z,l=i.x,u=i.y,c=i.z,h=a*c-s*u,d=s*l-o*c,m=o*u-a*l;return n===void 0?new r(h,d,m):(n.x=h,n.y=d,n.z=m,n)},r.ZERO=i(new r(0,0,0)),r.UNIT_X=i(new r(1,0,0)),r.UNIT_Y=i(new r(0,1,0)),r.UNIT_Z=i(new r(0,0,1)),r.prototype.getMaximumComponent=function(){return r.getMaximumComponent(this)},r.prototype.getMinimumComponent=function(){return r.getMinimumComponent(this)},r.prototype.clone=function(e){return r.clone(this,e)},r.prototype.magnitudeSquared=function(){return r.magnitudeSquared(this)},r.prototype.magnitude=function(){return r.magnitude(this)},r.prototype.normalize=function(e){return r.normalize(this,e)},r.prototype.dot=function(e){return r.dot(this,e)},r.prototype.multiplyComponents=function(e,t){return r.multiplyComponents(this,e,t)},r.prototype.add=function(e,t){return r.add(this,e,t)},r.prototype.subtract=function(e,t){return r.subtract(this,e,t)},r.prototype.multiplyByScalar=function(e,t){return r.multiplyByScalar(this,e,t)},r.prototype.divideByScalar=function(e,t){return r.divideByScalar(this,e,t)},r.prototype.negate=function(e){return r.negate(this,e)},r.prototype.abs=function(e){return r.abs(this,e)},r.prototype.lerp=function(e,t,i){return r.lerp(this,e,t,i)},r.prototype.angleBetween=function(e){return r.angleBetween(this,e)},r.prototype.mostOrthogonalAxis=function(e){return r.mostOrthogonalAxis(this,e)},r.prototype.equals=function(e){return r.equals(this,e)},r.prototype.equalsEpsilon=function(e,t){return r.equalsEpsilon(this,e,t)},r.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},r.prototype.cross=function(e,t){return r.cross(this,e,t)},r}),i("Core/Enumeration",[],function(){var e=function(e,t,i){if(this.value=e,this.name=t,i!==void 0)for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r])};return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.name},e}),i("Core/Intersect",["./Enumeration"],function(e){var t={OUTSIDE:new e(-1,"OUTSIDE"),INTERSECTING:new e(0,"INTERSECTING"),INSIDE:new e(1,"INSIDE")};return t}),i("Core/AxisAlignedBoundingBox",["./defaultValue","./DeveloperError","./Cartesian3","./Intersect"],function(e,t,i,r){var n=function(t,r,n){this.minimum=i.clone(e(t,i.ZERO)),this.maximum=i.clone(e(r,i.ZERO)),n===void 0?(n=i.add(this.minimum,this.maximum),i.multiplyByScalar(n,.5,n)):n=i.clone(n),this.center=n};n.fromPoints=function(e,t){if(t===void 0&&(t=new n),e===void 0||0===e.length)return t.minimum=i.clone(i.ZERO,t.minimum),t.maximum=i.clone(i.ZERO,t.maximum),t.center=i.clone(i.ZERO,t.center),t;for(var r=e[0].x,o=e[0].y,a=e[0].z,s=e[0].x,l=e[0].y,u=e[0].z,c=e.length,h=1;c>h;h++){var d=e[h],m=d.x,p=d.y,f=d.z;r=Math.min(m,r),s=Math.max(m,s),o=Math.min(p,o),l=Math.max(p,l),a=Math.min(f,a),u=Math.max(f,u)}var v=t.minimum;v.x=r,v.y=o,v.z=a;var g=t.maximum;g.x=s,g.y=l,g.z=u;var _=i.add(v,g,t.center);return i.multiplyByScalar(_,.5,_),t},n.clone=function(e,r){if(e===void 0)throw new t("box is required");return r===void 0?new n(e.minimum,e.maximum):(r.minimum=i.clone(e.minimum,r.minimum),r.maximum=i.clone(e.maximum,r.maximum),r.center=i.clone(e.center,r.center),r)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&i.equals(e.center,t.center)&&i.equals(e.minimum,t.minimum)&&i.equals(e.maximum,t.maximum)};var o=new i;return n.intersect=function(e,n){if(e===void 0)throw new t("box is required.");if(n===void 0)throw new t("plane is required.");o=i.subtract(e.maximum,e.minimum,o);var a=i.multiplyByScalar(o,.5,o),s=a.x*Math.abs(n.x)+a.y*Math.abs(n.y)+a.z*Math.abs(n.z),l=i.dot(e.center,n)+n.w;return l-s>0?r.INSIDE:0>l+s?r.OUTSIDE:r.INTERSECTING},n.prototype.clone=function(e){return n.clone(this,e)},n.prototype.intersect=function(e){return n.intersect(this,e)},n.prototype.equals=function(e){return n.equals(this,e)},n}),i("Core/Math",["./defaultValue","./DeveloperError"],function(e,t){var i={};i.EPSILON1=.1,i.EPSILON2=.01,i.EPSILON3=.001,i.EPSILON4=1e-4,i.EPSILON5=1e-5,i.EPSILON6=1e-6,i.EPSILON7=1e-7,i.EPSILON8=1e-8,i.EPSILON9=1e-9,i.EPSILON10=1e-10,i.EPSILON11=1e-11,i.EPSILON12=1e-12,i.EPSILON13=1e-13,i.EPSILON14=1e-14,i.EPSILON15=1e-15,i.EPSILON16=1e-16,i.EPSILON17=1e-17,i.EPSILON18=1e-18,i.EPSILON19=1e-19,i.EPSILON20=1e-20,i.GRAVITATIONALPARAMETER=3986004418e5,i.sign=function(e){return e>0?1:0>e?-1:0},i.sinh=function(e){var t=Math.pow(Math.E,e),i=Math.pow(Math.E,-1*e);return.5*(t-i)},i.cosh=function(e){var t=Math.pow(Math.E,e),i=Math.pow(Math.E,-1*e);return.5*(t+i)},i.lerp=function(e,t,i){return(1-i)*e+i*t},i.PI=Math.PI,i.ONE_OVER_PI=1/Math.PI,i.PI_OVER_TWO=.5*Math.PI,i.PI_OVER_THREE=Math.PI/3,i.PI_OVER_FOUR=Math.PI/4,i.PI_OVER_SIX=Math.PI/6,i.THREE_PI_OVER_TWO=.5*3*Math.PI,i.TWO_PI=2*Math.PI,i.ONE_OVER_TWO_PI=1/(2*Math.PI),i.RADIANS_PER_DEGREE=Math.PI/180,i.DEGREES_PER_RADIAN=180/Math.PI,i.RADIANS_PER_ARCSECOND=i.RADIANS_PER_DEGREE/3600,i.toRadians=function(e){return e*i.RADIANS_PER_DEGREE},i.toDegrees=function(e){return e*i.DEGREES_PER_RADIAN},i.convertLongitudeRange=function(e){var t=i.TWO_PI,r=e-Math.floor(e/t)*t;return-Math.PI>r?r+t:r>=Math.PI?r-t:r},i.negativePiToPi=function(e){for(var t=i.EPSILON10,r=i.PI,n=i.TWO_PI;-(r+t)>e;)e+=n;if(-r>e)return-r;for(;e>r+t;)e-=n;return e>r?r:e},i.zeroToTwoPi=function(e){var t=e%i.TWO_PI;return 0>t?(t+i.TWO_PI)%i.TWO_PI:t},i.equalsEpsilon=function(t,i,r){return r=e(r,0),r>=Math.abs(t-i)};var r=[1];return i.factorial=function(e){if("number"!=typeof e||0>e)throw new t("A number greater than or equal to 0 is required.");var i=r.length;if(e>=i)for(var n=r[i-1],o=i;e>=o;o++)r.push(n*o);return r[e]},i.incrementWrap=function(i,r,n){if(n=e(n,0),n>=r)throw new t("Maximum value must be greater than minimum value.");return++i,i>r&&(i=n),i},i.isPowerOfTwo=function(i){if("number"!=typeof i||0>i)throw new t("A number greater than or equal to 0 is required.");var r=e(i,0);return 0!==r&&0===(r&r-1)},i.clamp=function(e,t,i){return t>e?t:e>i?i:e},i}),i("Core/Cartographic",["./defaultValue","./DeveloperError","./freezeObject","./Math"],function(e,t,i,r){var n=function(t,i,r){this.longitude=e(t,0),this.latitude=e(i,0),this.height=e(r,0)};return n.fromDegrees=function(t,i,o,a){return t=r.toRadians(e(t,0)),i=r.toRadians(e(i,0)),o=e(o,0),a===void 0?new n(t,i,o):(a.longitude=t,a.latitude=i,a.height=o,a)},n.clone=function(e,i){if(e===void 0)throw new t("cartographic is required");return i===void 0?new n(e.longitude,e.latitude,e.height):(i.longitude=e.longitude,i.latitude=e.latitude,i.height=e.height,i)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height},n.equalsEpsilon=function(e,i,r){if("number"!=typeof r)throw new t("epsilon is required and must be a number.");return e===i||e!==void 0&&i!==void 0&&r>=Math.abs(e.longitude-i.longitude)&&r>=Math.abs(e.latitude-i.latitude)&&r>=Math.abs(e.height-i.height)},n.toString=function(e){if(e===void 0)throw new t("cartographic is required");return"("+e.longitude+", "+e.latitude+", "+e.height+")"},n.ZERO=i(new n(0,0,0)),n.prototype.clone=function(e){return n.clone(this,e)},n.prototype.equals=function(e){return n.equals(this,e)},n.prototype.equalsEpsilon=function(e,t){return n.equalsEpsilon(this,e,t)},n.prototype.toString=function(){return n.toString(this)},n}),i("Core/Ellipsoid",["./freezeObject","./defaultValue","./DeveloperError","./Math","./Cartesian3","./Cartographic"],function(e,t,i,r,n,o){var a=function(e,o,a){if(e=t(e,0),o=t(o,0),a=t(a,0),0>e||0>o||0>a)throw new i("All radii components must be greater than or equal to zero.");this._radii=new n(e,o,a),this._radiiSquared=new n(e*e,o*o,a*a),this._radiiToTheFourth=new n(e*e*e*e,o*o*o*o,a*a*a*a),this._oneOverRadii=new n(0===e?0:1/e,0===o?0:1/o,0===a?0:1/a),this._oneOverRadiiSquared=new n(0===e?0:1/(e*e),0===o?0:1/(o*o),0===a?0:1/(a*a)),this._minimumRadius=Math.min(e,o,a),this._maximumRadius=Math.max(e,o,a),this._centerToleranceSquared=r.EPSILON1};a.clone=function(e,t){var i=e._radii;return t===void 0?new a(i.x,i.y,i.z):(n.clone(i,t._radii),n.clone(e._radiiSquared,t._radiiSquared),n.clone(e._radiiToTheFourth,t._radiiToTheFourth),n.clone(e._oneOverRadii,t._oneOverRadii),n.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t)},a.fromCartesian3=function(e){return e===void 0?new a:new a(e.x,e.y,e.z)},a.WGS84=e(new a(6378137,6378137,6356752.314245179)),a.UNIT_SPHERE=e(new a(1,1,1)),a.prototype.getRadii=function(){return this._radii},a.prototype.getRadiiSquared=function(){return this._radiiSquared},a.prototype.getRadiiToTheFourth=function(){return this._radiiToTheFourth},a.prototype.getOneOverRadii=function(){return this._oneOverRadii},a.prototype.getOneOverRadiiSquared=function(){return this._oneOverRadiiSquared},a.prototype.getMinimumRadius=function(){return this._minimumRadius},a.prototype.getMaximumRadius=function(){return this._maximumRadius},a.prototype.geocentricSurfaceNormal=n.normalize,a.prototype.geodeticSurfaceNormalCartographic=function(e,t){if(e===void 0)throw new i("cartographic is required.");var r=e.longitude,o=e.latitude,a=Math.cos(o),s=a*Math.cos(r),l=a*Math.sin(r),u=Math.sin(o);return t===void 0&&(t=new n),t.x=s,t.y=l,t.z=u,n.normalize(t,t)},a.prototype.geodeticSurfaceNormal=function(e,t){return t=n.multiplyComponents(e,this._oneOverRadiiSquared,t),n.normalize(t,t)};var s=new n,l=new n;a.prototype.cartographicToCartesian=function(e,t){var i=s,r=l;this.geodeticSurfaceNormalCartographic(e,i),n.multiplyComponents(this._radiiSquared,i,r);var o=Math.sqrt(n.dot(i,r));return n.divideByScalar(r,o,r),n.multiplyByScalar(i,e.height,i),n.add(r,i,t)},a.prototype.cartographicArrayToCartesianArray=function(e,t){if(e===void 0)throw new i("cartographics is required.");var r=e.length;t===void 0?t=Array(r):t.length=r;for(var n=0;r>n;n++)t[n]=this.cartographicToCartesian(e[n],t[n]);return t};var u=new n,c=new n,h=new n;a.prototype.cartesianToCartographic=function(e,t){var i=this.scaleToGeodeticSurface(e,c);if(i===void 0)return void 0;var a=this.geodeticSurfaceNormal(i,u),s=n.subtract(e,i,h),l=Math.atan2(a.y,a.x),d=Math.asin(a.z),m=r.sign(n.dot(s,e))*n.magnitude(s);return t===void 0?new o(l,d,m):(t.longitude=l,t.latitude=d,t.height=m,t)},a.prototype.cartesianArrayToCartographicArray=function(e,t){if(e===void 0)throw new i("cartesians is required.");var r=e.length;t===void 0?t=Array(r):t.length=r;for(var n=0;r>n;++n)t[n]=this.cartesianToCartographic(e[n],t[n]);return t};var d,m=new n;return a.prototype.scaleToGeodeticSurface=function(e,t){if(e===void 0)throw new i("cartesian is required.");var o=e.x,a=e.y,s=e.z,l=this._oneOverRadii,u=l.x,c=l.y,h=l.z,p=o*o*u*u,f=a*a*c*c,v=s*s*h*h,g=p+f+v,_=Math.sqrt(1/g),y=n.multiplyByScalar(e,_,d);if(this._centerToleranceSquared>g)return isFinite(_)?n.clone(y,t):void 0;var w=this._oneOverRadiiSquared,C=w.x,x=w.y,T=w.z,S=m;S.x=2*y.x*C,S.y=2*y.y*x,S.z=2*y.z*T;var E,b,M,I,D,A,P,R,O,z,L,N=(1-_)*n.magnitude(e)/(.5*n.magnitude(S)),V=0;do{N-=V,M=1/(1+N*C),I=1/(1+N*x),D=1/(1+N*T),A=M*M,P=I*I,R=D*D,O=A*M,z=P*I,L=R*D,E=p*A+f*P+v*R-1,b=p*O*C+f*z*x+v*L*T;var B=-2*b;V=E/B}while(Math.abs(E)>r.EPSILON12);return t===void 0?new n(o*M,a*I,s*D):(t.x=o*M,t.y=a*I,t.z=s*D,t)},a.prototype.scaleToGeocentricSurface=function(e,t){if(e===void 0)throw new i("cartesian is required.");var r=e.x,o=e.y,a=e.z,s=this._oneOverRadiiSquared,l=1/Math.sqrt(r*r*s.x+o*o*s.y+a*a*s.z);return n.multiplyByScalar(e,l,t)},a.prototype.transformPositionToScaledSpace=function(e,t){return n.multiplyComponents(e,this._oneOverRadii,t)},a.prototype.equals=function(e){return this===e||e!==void 0&&n.equals(this._radii,e._radii)},a.prototype.toString=function(){return""+this._radii},a}),i("Core/GeographicProjection",["./defaultValue","./Cartesian3","./Cartographic","./Ellipsoid"],function(e,t,i,r){var n=function(t){this._ellipsoid=e(t,r.WGS84),this._semimajorAxis=this._ellipsoid.getMaximumRadius(),this._oneOverSemimajorAxis=1/this._semimajorAxis};return n.prototype.getEllipsoid=function(){return this._ellipsoid},n.prototype.project=function(e,i){var r=this._semimajorAxis,n=e.longitude*r,o=e.latitude*r,a=e.height;return i===void 0?new t(n,o,a):(i.x=n,i.y=o,i.z=a,i)},n.prototype.unproject=function(e,t){var r=this._oneOverSemimajorAxis,n=e.x*r,o=e.y*r,a=e.z;return t===void 0?new i(n,o,a):(t.longitude=n,t.latitude=o,t.height=a,t)},n}),i("Core/BoundingRectangle",["./defaultValue","./DeveloperError","./Cartographic","./GeographicProjection","./Intersect"],function(e,t,i,r,n){var o=function(t,i,r,n){this.x=e(t,0),this.y=e(i,0),this.width=e(r,0),this.height=e(n,0)};o.fromPoints=function(e,t){if(t===void 0&&(t=new o),e===void 0||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;for(var i=e.length,r=e[0].x,n=e[0].y,a=e[0].x,s=e[0].y,l=1;i>l;l++){var u=e[l],c=u.x,h=u.y;r=Math.min(c,r),a=Math.max(c,a),n=Math.min(h,n),s=Math.max(h,s)}return t.x=r,t.y=n,t.width=a-r,t.height=s-n,t};var a=new r,s=new i,l=new i;return o.fromExtent=function(t,i,r){if(r===void 0&&(r=new o),t===void 0)return r.x=0,r.y=0,r.width=0,r.height=0,r;i=e(i,a);var n=i.project(t.getSouthwest(s)),u=i.project(t.getNortheast(l));return u.subtract(n,u),r.x=n.x,r.y=n.y,r.width=u.x,r.height=u.y,r},o.clone=function(e,i){if(e===void 0)throw new t("rectangle is required");return i===void 0?new o(e.x,e.y,e.width,e.height):(i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height,i)},o.union=function(e,i,r){if(e===void 0)throw new t("left is required.");if(i===void 0)throw new t("right is required.");r===void 0&&(r=new o);var n=Math.min(e.x,i.x),a=Math.min(e.y,i.y),s=Math.max(e.x+e.width,i.x+i.width),l=Math.max(e.y+e.height,i.y+i.height);return r.x=n,r.y=a,r.width=s-n,r.height=l-a,r},o.expand=function(e,i,r){if(e===void 0)throw new t("rectangle is required.");if(i===void 0)throw new t("point is required.");r=o.clone(e,r);var n=i.x-r.x,a=i.y-r.y;return n>r.width?r.width=n:0>n&&(r.width-=n,r.x=i.x),a>r.height?r.height=a:0>a&&(r.height-=a,r.y=i.y),r},o.intersect=function(e,i){if(e===void 0)throw new t("left is required.");if(i===void 0)throw new t("right is required.");var r=e.x,o=e.y,a=i.x,s=i.y;return r>a+i.width||a>r+e.width||s>o+e.height||o>s+i.height?n.OUTSIDE:n.INTERSECTING},o.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},o.prototype.clone=function(e){return o.clone(this,e)},o.prototype.union=function(e,t){return o.union(this,e,t)},o.prototype.expand=function(e,t){return o.expand(this,e,t)},o.prototype.intersect=function(e){return o.intersect(this,e)},o.prototype.equals=function(e){return o.equals(this,e)},o}),i("Core/Cartesian2",["./defaultValue","./DeveloperError","./freezeObject"],function(e,t,i){var r=function(t,i){this.x=e(t,0),this.y=e(i,0)};r.fromArray=function(i,n,o){if(i===void 0)throw new t("values is required.");if(n+2>i.length)throw new t("offset + 2 is greater than the length of the array.");return n=e(n,0),o===void 0&&(o=new r),o.x=i[n+0],o.y=i[n+1],o},r.clone=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(e.x,e.y):(i.x=e.x,i.y=e.y,i)},r.fromCartesian3=r.clone,r.fromCartesian4=r.clone,r.getMaximumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.max(e.x,e.y)},r.getMinimumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.min(e.x,e.y)},r.magnitudeSquared=function(e){if(e===void 0)throw new t("cartesian is required");return e.x*e.x+e.y*e.y},r.magnitude=function(e){return Math.sqrt(r.magnitudeSquared(e))};var n=new r;r.distance=function(e,i){if(e===void 0||i===void 0)throw new t("left and right are required.");return r.subtract(e,i,n),r.magnitude(n)},r.normalize=function(e,i){if(e===void 0)throw new t("cartesian is required");var n=r.magnitude(e);return i===void 0?new r(e.x/n,e.y/n):(i.x=e.x/n,i.y=e.y/n,i)},r.dot=function(e,i){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return e.x*i.x+e.y*i.y},r.multiplyComponents=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x*i.x,e.y*i.y):(n.x=e.x*i.x,n.y=e.y*i.y,n)},r.add=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x+i.x,e.y+i.y):(n.x=e.x+i.x,n.y=e.y+i.y,n)},r.subtract=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x-i.x,e.y-i.y):(n.x=e.x-i.x,n.y=e.y-i.y,n)},r.multiplyByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x*i,e.y*i):(n.x=e.x*i,n.y=e.y*i,n)},r.divideByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x/i,e.y/i):(n.x=e.x/i,n.y=e.y/i,n)},r.negate=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(-e.x,-e.y):(i.x=-e.x,i.y=-e.y,i)},r.abs=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(Math.abs(e.x),Math.abs(e.y)):(i.x=Math.abs(e.x),i.y=Math.abs(e.y),i)};var o=new r;r.lerp=function(e,i,n,a){if(e===void 0)throw new t("start is required.");if(i===void 0)throw new t("end is required.");if("number"!=typeof n)throw new t("t is required and must be a number.");return r.multiplyByScalar(i,n,o),a=r.multiplyByScalar(e,1-n,a),r.add(o,a,a)};var a=new r,s=new r;r.angleBetween=function(e,i){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return r.normalize(e,a),r.normalize(i,s),Math.acos(r.dot(a,s))};var l=new r;return r.mostOrthogonalAxis=function(e,i){if(e===void 0)throw new t("cartesian is required.");var n=r.normalize(e,l);return r.abs(n,n),i=n.y>=n.x?r.clone(r.UNIT_X,i):r.clone(r.UNIT_Y,i)},r.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.x===t.x&&e.y===t.y},r.equalsEpsilon=function(e,i,r){if("number"!=typeof r)throw new t("epsilon is required and must be a number.");return e===i||e!==void 0&&i!==void 0&&r>=Math.abs(e.x-i.x)&&r>=Math.abs(e.y-i.y)},r.ZERO=i(new r(0,0)),r.UNIT_X=i(new r(1,0)),r.UNIT_Y=i(new r(0,1)),r.prototype.getMaximumComponent=function(){return r.getMaximumComponent(this)},r.prototype.getMinimumComponent=function(){return r.getMinimumComponent(this)},r.prototype.clone=function(e){return r.clone(this,e)},r.prototype.magnitudeSquared=function(){return r.magnitudeSquared(this)},r.prototype.magnitude=function(){return r.magnitude(this)},r.prototype.normalize=function(e){return r.normalize(this,e)},r.prototype.dot=function(e){return r.dot(this,e)},r.prototype.multiplyComponents=function(e,t){return r.multiplyComponents(this,e,t)},r.prototype.add=function(e,t){return r.add(this,e,t)},r.prototype.subtract=function(e,t){return r.subtract(this,e,t)},r.prototype.multiplyByScalar=function(e,t){return r.multiplyByScalar(this,e,t)},r.prototype.divideByScalar=function(e,t){return r.divideByScalar(this,e,t)},r.prototype.negate=function(e){return r.negate(this,e)},r.prototype.abs=function(e){return r.abs(this,e)},r.prototype.lerp=function(e,t,i){return r.lerp(this,e,t,i)},r.prototype.angleBetween=function(e){return r.angleBetween(this,e)},r.prototype.mostOrthogonalAxis=function(e){return r.mostOrthogonalAxis(this,e)},r.prototype.equals=function(e){return r.equals(this,e)},r.prototype.equalsEpsilon=function(e,t){return r.equalsEpsilon(this,e,t)},r.prototype.toString=function(){return"("+this.x+", "+this.y+")"},r}),i("Core/Cartesian4",["./defaultValue","./DeveloperError","./freezeObject"],function(e,t,i){var r=function(t,i,r,n){this.x=e(t,0),this.y=e(i,0),this.z=e(r,0),this.w=e(n,0)};r.fromArray=function(i,n,o){if(i===void 0)throw new t("values is required.");if(n+4>i.length)throw new t("offset + 4 is greater than the length of the array.");return n=e(n,0),o===void 0&&(o=new r),o.x=i[n+0],o.y=i[n+1],o.z=i[n+2],o.w=i[n+3],o},r.clone=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(e.x,e.y,e.z,e.w):(i.x=e.x,i.y=e.y,i.z=e.z,i.w=e.w,i)},r.getMaximumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.max(e.x,e.y,e.z,e.w)},r.getMinimumComponent=function(e){if(e===void 0)throw new t("cartesian is required");return Math.min(e.x,e.y,e.z,e.w)},r.magnitudeSquared=function(e){if(e===void 0)throw new t("cartesian is required");return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},r.magnitude=function(e){return Math.sqrt(r.magnitudeSquared(e))};var n=new r;r.distance=function(e,i){if(e===void 0||i===void 0)throw new t("left and right are required.");return r.subtract(e,i,n),r.magnitude(n)},r.normalize=function(e,i){if(e===void 0)throw new t("cartesian is required");var n=r.magnitude(e);return i===void 0?new r(e.x/n,e.y/n,e.z/n,e.w/n):(i.x=e.x/n,i.y=e.y/n,i.z=e.z/n,i.w=e.w/n,i)},r.dot=function(e,i){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w},r.multiplyComponents=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x*i.x,e.y*i.y,e.z*i.z,e.w*i.w):(n.x=e.x*i.x,n.y=e.y*i.y,n.z=e.z*i.z,n.w=e.w*i.w,n)},r.add=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x+i.x,e.y+i.y,e.z+i.z,e.w+i.w):(n.x=e.x+i.x,n.y=e.y+i.y,n.z=e.z+i.z,n.w=e.w+i.w,n)},r.subtract=function(e,i,n){if(e===void 0)throw new t("left is required");if(i===void 0)throw new t("right is required");return n===void 0?new r(e.x-i.x,e.y-i.y,e.z-i.z,e.w-i.w):(n.x=e.x-i.x,n.y=e.y-i.y,n.z=e.z-i.z,n.w=e.w-i.w,n)},r.multiplyByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x*i,e.y*i,e.z*i,e.w*i):(n.x=e.x*i,n.y=e.y*i,n.z=e.z*i,n.w=e.w*i,n)},r.divideByScalar=function(e,i,n){if(e===void 0)throw new t("cartesian is required");if("number"!=typeof i)throw new t("scalar is required and must be a number.");return n===void 0?new r(e.x/i,e.y/i,e.z/i,e.w/i):(n.x=e.x/i,n.y=e.y/i,n.z=e.z/i,n.w=e.w/i,n)},r.negate=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(-e.x,-e.y,-e.z,-e.w):(i.x=-e.x,i.y=-e.y,i.z=-e.z,i.w=-e.w,i)},r.abs=function(e,i){if(e===void 0)throw new t("cartesian is required");return i===void 0?new r(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z),Math.abs(e.w)):(i.x=Math.abs(e.x),i.y=Math.abs(e.y),i.z=Math.abs(e.z),i.w=Math.abs(e.w),i)};var o=new r;r.lerp=function(e,i,n,a){if(e===void 0)throw new t("start is required.");if(i===void 0)throw new t("end is required.");if("number"!=typeof n)throw new t("t is required and must be a number.");return r.multiplyByScalar(i,n,o),a=r.multiplyByScalar(e,1-n,a),r.add(o,a,a)};var a=new r;return r.mostOrthogonalAxis=function(e,i){if(e===void 0)throw new t("cartesian is required.");var n=r.normalize(e,a);return r.abs(n,n),i=n.y>=n.x?n.z>=n.x?n.w>=n.x?r.clone(r.UNIT_X,i):r.clone(r.UNIT_W,i):n.w>=n.z?r.clone(r.UNIT_Z,i):r.clone(r.UNIT_W,i):n.z>=n.y?n.w>=n.y?r.clone(r.UNIT_Y,i):r.clone(r.UNIT_W,i):n.w>=n.z?r.clone(r.UNIT_Z,i):r.clone(r.UNIT_W,i)},r.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},r.equalsEpsilon=function(e,i,r){if("number"!=typeof r)throw new t("epsilon is required and must be a number.");return e===i||e!==void 0&&i!==void 0&&r>=Math.abs(e.x-i.x)&&r>=Math.abs(e.y-i.y)&&r>=Math.abs(e.z-i.z)&&r>=Math.abs(e.w-i.w)},r.ZERO=i(new r(0,0,0,0)),r.UNIT_X=i(new r(1,0,0,0)),r.UNIT_Y=i(new r(0,1,0,0)),r.UNIT_Z=i(new r(0,0,1,0)),r.UNIT_W=i(new r(0,0,0,1)),r.prototype.getMaximumComponent=function(){return r.getMaximumComponent(this)},r.prototype.getMinimumComponent=function(){return r.getMinimumComponent(this)},r.prototype.clone=function(e){return r.clone(this,e)},r.prototype.magnitudeSquared=function(){return r.magnitudeSquared(this)},r.prototype.magnitude=function(){return r.magnitude(this)},r.prototype.normalize=function(e){return r.normalize(this,e)},r.prototype.dot=function(e){return r.dot(this,e)},r.prototype.multiplyComponents=function(e,t){return r.multiplyComponents(this,e,t)},r.prototype.add=function(e,t){return r.add(this,e,t)},r.prototype.subtract=function(e,t){return r.subtract(this,e,t)},r.prototype.multiplyByScalar=function(e,t){return r.multiplyByScalar(this,e,t)},r.prototype.divideByScalar=function(e,t){return r.divideByScalar(this,e,t)
},r.prototype.negate=function(e){return r.negate(this,e)},r.prototype.abs=function(e){return r.abs(this,e)},r.prototype.lerp=function(e,t,i){return r.lerp(this,e,t,i)},r.prototype.mostOrthogonalAxis=function(e){return r.mostOrthogonalAxis(this,e)},r.prototype.equals=function(e){return r.equals(this,e)},r.prototype.equalsEpsilon=function(e,t){return r.equalsEpsilon(this,e,t)},r.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},r}),i("Core/Extent",["./freezeObject","./defaultValue","./Ellipsoid","./Cartographic","./DeveloperError","./Math"],function(e,t,i,r,n,o){var a=function(e,i,r,n){this.west=t(e,0),this.south=t(i,0),this.east=t(r,0),this.north=t(n,0)};a.fromCartographicArray=function(e,t){if(e===void 0)throw new n("cartographics is required.");for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,l=0,u=e.length;u>l;l++){var c=e[l];i=Math.min(i,c.longitude),r=Math.max(r,c.longitude),o=Math.min(o,c.latitude),s=Math.max(s,c.latitude)}return t===void 0?new a(i,o,r,s):(t.west=i,t.south=o,t.east=r,t.north=s,t)},a.clone=function(e,t){return t===void 0?new a(e.west,e.south,e.east,e.north):(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t)},a.prototype.clone=function(e){return a.clone(this,e)},a.prototype.equals=function(e){return e!==void 0&&this.west===e.west&&this.south===e.south&&this.east===e.east&&this.north===e.north},a.prototype.equalsEpsilon=function(e,t){if("number"!=typeof t)throw new n("epsilon is required and must be a number.");return e!==void 0&&t>=Math.abs(this.west-e.west)&&t>=Math.abs(this.south-e.south)&&t>=Math.abs(this.east-e.east)&&t>=Math.abs(this.north-e.north)},a.prototype.validate=function(){var e=this.north;if("number"!=typeof e)throw new n("north is required to be a number.");if(-o.PI_OVER_TWO>e||e>o.PI_OVER_TWO)throw new n("north must be in the interval [-Pi/2, Pi/2].");var t=this.south;if("number"!=typeof t)throw new n("south is required to be a number.");if(-o.PI_OVER_TWO>t||t>o.PI_OVER_TWO)throw new n("south must be in the interval [-Pi/2, Pi/2].");var i=this.west;if("number"!=typeof i)throw new n("west is required to be a number.");if(-Math.PI>i||i>Math.PI)throw new n("west must be in the interval [-Pi, Pi].");var r=this.east;if("number"!=typeof r)throw new n("east is required to be a number.");if(-Math.PI>r||r>Math.PI)throw new n("east must be in the interval [-Pi, Pi].")},a.prototype.getSouthwest=function(e){return e===void 0?new r(this.west,this.south):(e.longitude=this.west,e.latitude=this.south,e.height=0,e)},a.prototype.getNorthwest=function(e){return e===void 0?new r(this.west,this.north):(e.longitude=this.west,e.latitude=this.north,e.height=0,e)},a.prototype.getNortheast=function(e){return e===void 0?new r(this.east,this.north):(e.longitude=this.east,e.latitude=this.north,e.height=0,e)},a.prototype.getSoutheast=function(e){return e===void 0?new r(this.east,this.south):(e.longitude=this.east,e.latitude=this.south,e.height=0,e)},a.prototype.getCenter=function(e){return e===void 0?new r(.5*(this.west+this.east),.5*(this.south+this.north)):(e.longitude=.5*(this.west+this.east),e.latitude=.5*(this.south+this.north),e.height=0,e)},a.prototype.intersectWith=function(e,t){if(e===void 0)throw new n("otherExtent is required.");var i=Math.max(this.west,e.west),r=Math.max(this.south,e.south),o=Math.min(this.east,e.east),s=Math.min(this.north,e.north);return t===void 0?new a(i,r,o,s):(t.west=i,t.south=r,t.east=o,t.north=s,t)},a.prototype.contains=function(e){if(e===void 0)throw new n("cartographic is required.");return e.longitude>=this.west&&this.east>=e.longitude&&e.latitude>=this.south&&this.north>=e.latitude},a.prototype.isEmpty=function(){return this.west>=this.east||this.south>=this.north};var s=new r;return a.prototype.subsample=function(e,r){e=t(e,i.WGS84),r===void 0&&(r=[]);var n=0,a=this.north,l=this.south,u=this.east,c=this.west,h=s;h.longitude=c,h.latitude=a,r[n]=e.cartographicToCartesian(h,r[n]),n++,h.longitude=u,r[n]=e.cartographicToCartesian(h,r[n]),n++,h.latitude=l,r[n]=e.cartographicToCartesian(h,r[n]),n++,h.longitude=c,r[n]=e.cartographicToCartesian(h,r[n]),n++,h.latitude=0>a?a:l>0?l:0;for(var d=1;8>d;++d){var m=-Math.PI+d*o.PI_OVER_TWO;m>c&&u>m&&(h.longitude=m,r[n]=e.cartographicToCartesian(h,r[n]),n++)}return 0===h.latitude&&(h.longitude=c,r[n]=e.cartographicToCartesian(h,r[n]),n++,h.longitude=u,r[n]=e.cartographicToCartesian(h,r[n]),n++),r.length=n,r},a.MAX_VALUE=e(new a(-Math.PI,-o.PI_OVER_TWO,Math.PI,o.PI_OVER_TWO)),a}),i("Core/Interval",["./defaultValue"],function(e){var t=function(t,i){this.start=e(t,0),this.stop=e(i,0)};return t}),i("Core/Matrix3",["./Cartesian3","./defaultValue","./DeveloperError","./freezeObject"],function(e,t,i,r){var n=function(e,i,r,n,o,a,s,l,u){this[0]=t(e,0),this[1]=t(n,0),this[2]=t(s,0),this[3]=t(i,0),this[4]=t(o,0),this[5]=t(l,0),this[6]=t(r,0),this[7]=t(a,0),this[8]=t(u,0)};return n.clone=function(e,t){if(e===void 0)throw new i("values is required");return t===void 0?new n(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t)},n.fromColumnMajorArray=n.clone,n.fromRowMajorArray=function(e,t){if(e===void 0)throw new i("values is required.");return t===void 0?new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]):(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t)},n.fromQuaternion=function(e,t){if(e===void 0)throw new i("quaternion is required");var r=e.x*e.x,o=e.x*e.y,a=e.x*e.z,s=e.x*e.w,l=e.y*e.y,u=e.y*e.z,c=e.y*e.w,h=e.z*e.z,d=e.z*e.w,m=e.w*e.w,p=r-l-h+m,f=2*(o+d),v=2*(a-c),g=2*(o-d),_=-r+l-h+m,y=2*(u+s),w=2*(a+c),C=2*(u-s),x=-r-l+h+m;return t===void 0?new n(p,f,v,g,_,y,w,C,x):(t[0]=p,t[1]=g,t[2]=w,t[3]=f,t[4]=_,t[5]=C,t[6]=v,t[7]=y,t[8]=x,t)},n.fromScale=function(e,t){if(e===void 0)throw new i("scale is required.");return t===void 0?new n(e.x,0,0,0,e.y,0,0,0,e.z):(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t)},n.fromUniformScale=function(e,t){if("number"!=typeof e)throw new i("scale is required.");return t===void 0?new n(e,0,0,0,e,0,0,0,e):(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t)},n.fromRotationX=function(e,t){if(e===void 0)throw new i("angle is required.");var r=Math.cos(e),o=Math.sin(e);return t===void 0?new n(1,0,0,0,r,-o,0,o,r):(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=r,t[5]=o,t[6]=0,t[7]=-o,t[8]=r,t)},n.fromRotationY=function(e,t){if(e===void 0)throw new i("angle is required.");var r=Math.cos(e),o=Math.sin(e);return t===void 0?new n(r,0,o,0,1,0,-o,0,r):(t[0]=r,t[1]=0,t[2]=-o,t[3]=0,t[4]=1,t[5]=0,t[6]=o,t[7]=0,t[8]=r,t)},n.fromRotationZ=function(e,t){if(e===void 0)throw new i("angle is required.");var r=Math.cos(e),o=Math.sin(e);return t===void 0?new n(r,-o,0,o,r,0,0,0,1):(t[0]=r,t[1]=o,t[2]=0,t[3]=-o,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t)},n.toArray=function(e,t){if(e===void 0)throw new i("matrix is required");return t===void 0?[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]:(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t)},n.getElementIndex=function(e,t){if("number"!=typeof t||0>t||t>2)throw new i("row is required and must be 0, 1, or 2.");if("number"!=typeof e||0>e||e>2)throw new i("column is required and must be 0, 1, or 2.");return 3*e+t},n.getColumn=function(t,r,n){if(t===void 0)throw new i("matrix is required.");if("number"!=typeof r||0>r||r>2)throw new i("index is required and must be 0, 1, or 2.");var o=3*r,a=t[o],s=t[o+1],l=t[o+2];return n===void 0?new e(a,s,l):(n.x=a,n.y=s,n.z=l,n)},n.setColumn=function(e,t,r,o){if(e===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");if("number"!=typeof t||0>t||t>2)throw new i("index is required and must be 0, 1, or 2.");o=n.clone(e,o);var a=3*t;return o[a]=r.x,o[a+1]=r.y,o[a+2]=r.z,o},n.getRow=function(t,r,n){if(t===void 0)throw new i("matrix is required.");if("number"!=typeof r||0>r||r>2)throw new i("index is required and must be 0, 1, or 2.");var o=t[r],a=t[r+3],s=t[r+6];return n===void 0?new e(o,a,s):(n.x=o,n.y=a,n.z=s,n)},n.setRow=function(e,t,r,o){if(e===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");if("number"!=typeof t||0>t||t>2)throw new i("index is required and must be 0, 1, or 2.");return o=n.clone(e,o),o[t]=r.x,o[t+3]=r.y,o[t+6]=r.z,o},n.multiply=function(e,t,r){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");var o=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],a=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],s=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],l=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],u=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],c=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],h=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],d=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],m=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return r===void 0?new n(o,l,h,a,u,d,s,c,m):(r[0]=o,r[1]=a,r[2]=s,r[3]=l,r[4]=u,r[5]=c,r[6]=h,r[7]=d,r[8]=m,r)},n.multiplyByVector=function(t,r,n){if(t===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");var o=r.x,a=r.y,s=r.z,l=t[0]*o+t[3]*a+t[6]*s,u=t[1]*o+t[4]*a+t[7]*s,c=t[2]*o+t[5]*a+t[8]*s;return n===void 0?new e(l,u,c):(n.x=l,n.y=u,n.z=c,n)},n.multiplyByScalar=function(e,t,r){if(e===void 0)throw new i("matrix is required");if("number"!=typeof t)throw new i("scalar is required and must be a number");return r===void 0?new n(e[0]*t,e[3]*t,e[6]*t,e[1]*t,e[4]*t,e[7]*t,e[2]*t,e[5]*t,e[8]*t):(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r)},n.negate=function(e,t){if(e===void 0)throw new i("matrix is required");return t===void 0?new n(-e[0],-e[3],-e[6],-e[1],-e[4],-e[7],-e[2],-e[5],-e[8]):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t)},n.transpose=function(e,t){if(e===void 0)throw new i("matrix is required");var r=e[0],o=e[3],a=e[6],s=e[1],l=e[4],u=e[7],c=e[2],h=e[5],d=e[8];return t===void 0?new n(r,s,c,o,l,h,a,u,d):(t[0]=r,t[1]=o,t[2]=a,t[3]=s,t[4]=l,t[5]=u,t[6]=c,t[7]=h,t[8]=d,t)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},n.equalsEpsilon=function(e,t,r){if("number"!=typeof r)throw new i("epsilon is required and must be a number");return e===t||e!==void 0&&t!==void 0&&r>=Math.abs(e[0]-t[0])&&r>=Math.abs(e[1]-t[1])&&r>=Math.abs(e[2]-t[2])&&r>=Math.abs(e[3]-t[3])&&r>=Math.abs(e[4]-t[4])&&r>=Math.abs(e[5]-t[5])&&r>=Math.abs(e[6]-t[6])&&r>=Math.abs(e[7]-t[7])&&r>=Math.abs(e[8]-t[8])},n.IDENTITY=r(new n(1,0,0,0,1,0,0,0,1)),n.COLUMN0ROW0=0,n.COLUMN0ROW1=1,n.COLUMN0ROW2=2,n.COLUMN1ROW0=3,n.COLUMN1ROW1=4,n.COLUMN1ROW2=5,n.COLUMN2ROW0=6,n.COLUMN2ROW1=7,n.COLUMN2ROW2=8,n.prototype.clone=function(e){return n.clone(this,e)},n.prototype.toArray=function(e){return n.toArray(this,e)},n.prototype.getColumn=function(e,t){return n.getColumn(this,e,t)},n.prototype.setColumn=function(e,t,i){return n.setColumn(this,e,t,i)},n.prototype.getRow=function(e,t){return n.getRow(this,e,t)},n.prototype.setRow=function(e,t,i){return n.setRow(this,e,t,i)},n.prototype.multiply=function(e,t){return n.multiply(this,e,t)},n.prototype.multiplyByVector=function(e,t){return n.multiplyByVector(this,e,t)},n.prototype.multiplyByScalar=function(e,t){return n.multiplyByScalar(this,e,t)},n.prototype.negate=function(e){return n.negate(this,e)},n.prototype.transpose=function(e){return n.transpose(this,e)},n.prototype.equals=function(e){return n.equals(this,e)},n.prototype.equalsEpsilon=function(e,t){return n.equalsEpsilon(this,e,t)},n.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n"+"("+this[1]+", "+this[4]+", "+this[7]+")\n"+"("+this[2]+", "+this[5]+", "+this[8]+")"},n}),i("Core/RuntimeError",[],function(){var e=function(e){this.name="RuntimeError",this.message=e,this.error=Error()};return e.prototype.toString=function(){var e=this.name+": "+this.message;return this.error!==void 0&&(e+=this.error.stack!==void 0?"\n"+(""+this.error.stack):"\n"+(""+this.error)),e},e}),i("Core/Matrix4",["./Cartesian3","./Cartesian4","./defaultValue","./DeveloperError","./freezeObject","./Math","./Matrix3","./RuntimeError"],function(e,t,i,r,n,o,a,s){var l=function(e,t,r,n,o,a,s,l,u,c,h,d,m,p,f,v){this[0]=i(e,0),this[1]=i(o,0),this[2]=i(u,0),this[3]=i(m,0),this[4]=i(t,0),this[5]=i(a,0),this[6]=i(c,0),this[7]=i(p,0),this[8]=i(r,0),this[9]=i(s,0),this[10]=i(h,0),this[11]=i(f,0),this[12]=i(n,0),this[13]=i(l,0),this[14]=i(d,0),this[15]=i(v,0)};l.clone=function(e,t){if(e===void 0)throw new r("values is required");return t===void 0?new l(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t)},l.fromColumnMajorArray=l.clone,l.fromRowMajorArray=function(e,t){if(e===void 0)throw new r("values is required.");return t===void 0?new l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]):(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t)},l.fromRotationTranslation=function(e,t,i){if(e===void 0)throw new r("rotation is required.");if(t===void 0)throw new r("translation is required.");return i===void 0?new l(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1):(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i)},l.fromTranslation=function(e,t){return l.fromRotationTranslation(a.IDENTITY,e,t)},l.fromScale=function(e,t){if(e===void 0)throw new r("scale is required.");return t===void 0?new l(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1):(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},l.fromUniformScale=function(e,t){if("number"!=typeof e)throw new r("scale is required.");return t===void 0?new l(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1):(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)};var u=new e,c=new e,h=new e;l.fromCamera=function(t,i){if(t===void 0)throw new r("camera is required.");var n=t.eye,o=t.target,a=t.up;if(n===void 0)throw new r("camera.eye is required.");if(o===void 0)throw new r("camera.target is required.");if(a===void 0)throw new r("camera.up is required.");e.subtract(o,n,u).normalize(u),e.cross(u,a,c).normalize(c),e.cross(c,u,h).normalize(h);var s=c.x,d=c.y,m=c.z,p=u.x,f=u.y,v=u.z,g=h.x,_=h.y,y=h.z,w=n.x,C=n.y,x=n.z,T=s*-w+d*-C+m*-x,S=g*-w+_*-C+y*-x,E=p*w+f*C+v*x;return i===void 0?new l(s,d,m,T,g,_,y,S,-p,-f,-v,E,0,0,0,1):(i[0]=s,i[1]=g,i[2]=-p,i[3]=0,i[4]=d,i[5]=_,i[6]=-f,i[7]=0,i[8]=m,i[9]=y,i[10]=-v,i[11]=0,i[12]=T,i[13]=S,i[14]=E,i[15]=1,i)},l.computePerspectiveFieldOfView=function(e,t,i,n,o){if(0>=e||e>Math.PI)throw new r("fovY must be in [0, PI).");if(0>=t)throw new r("aspectRatio must be greater than zero.");if(0>=i)throw new r("near must be greater than zero.");if(0>=n)throw new r("far must be greater than zero.");var a=Math.tan(.5*e),s=1/a,u=s/t,c=(n+i)/(i-n),h=2*n*i/(i-n);return o===void 0?new l(u,0,0,0,0,s,0,0,0,0,c,h,0,0,-1,0):(o[0]=u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=c,o[11]=-1,o[12]=0,o[13]=0,o[14]=h,o[15]=0,o)},l.computeOrthographicOffCenter=function(e,t,i,n,o,a,s){if(e===void 0)throw new r("left is required.");if(t===void 0)throw new r("right is required.");if(i===void 0)throw new r("bottom is required.");if(n===void 0)throw new r("top is required.");if(o===void 0)throw new r("near is required.");if(a===void 0)throw new r("far is required.");var u=1/(t-e),c=1/(n-i),h=1/(a-o),d=-(t+e)*u,m=-(n+i)*c,p=-(a+o)*h;return u*=2,c*=2,h*=-2,s===void 0?new l(u,0,0,d,0,c,0,m,0,0,h,p,0,0,0,1):(s[0]=u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=h,s[11]=0,s[12]=d,s[13]=m,s[14]=p,s[15]=1,s)},l.computePerspectiveOffCenter=function(e,t,i,n,o,a,s){if(e===void 0)throw new r("left is required.");if(t===void 0)throw new r("right is required.");if(i===void 0)throw new r("bottom is required.");if(n===void 0)throw new r("top is required.");if(o===void 0)throw new r("near is required.");if(a===void 0)throw new r("far is required.");var u=2*o/(t-e),c=2*o/(n-i),h=(t+e)/(t-e),d=(n+i)/(n-i),m=-(a+o)/(a-o),p=-1,f=-2*a*o/(a-o);return s===void 0?new l(u,0,h,0,0,c,d,0,0,0,m,f,0,0,p,0):(s[0]=u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=0,s[7]=0,s[8]=h,s[9]=d,s[10]=m,s[11]=p,s[12]=0,s[13]=0,s[14]=f,s[15]=0,s)},l.computeInfinitePerspectiveOffCenter=function(e,t,i,n,o,a){if(e===void 0)throw new r("left is required.");if(t===void 0)throw new r("right is required.");if(i===void 0)throw new r("bottom is required.");if(n===void 0)throw new r("top is required.");if(o===void 0)throw new r("near is required.");var s=2*o/(t-e),u=2*o/(n-i),c=(t+e)/(t-e),h=(n+i)/(n-i),d=-1,m=-1,p=-2*o;return a===void 0?new l(s,0,c,0,0,u,h,0,0,0,d,p,0,0,m,0):(a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=0,a[7]=0,a[8]=c,a[9]=h,a[10]=d,a[11]=m,a[12]=0,a[13]=0,a[14]=p,a[15]=0,a)},l.computeViewportTransformation=function(e,t,r,n){e=i(e,i.EMPTY_OBJECT);var o=i(e.x,0),a=i(e.y,0),s=i(e.width,0),u=i(e.height,0);t=i(t,0),r=i(r,1);var c=.5*s,h=.5*u,d=.5*(r-t),m=c,p=h,f=d,v=o+c,g=a+h,_=t+d,y=1;return n===void 0?new l(m,0,0,v,0,p,0,g,0,0,f,_,0,0,0,y):(n[0]=m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=f,n[11]=0,n[12]=v,n[13]=g,n[14]=_,n[15]=y,n)},l.toArray=function(e,t){if(e===void 0)throw new r("matrix is required");return t===void 0?[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]:(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t)},l.getElementIndex=function(e,t){if("number"!=typeof t||0>t||t>3)throw new r("row is required and must be 0, 1, 2, or 3.");if("number"!=typeof e||0>e||e>3)throw new r("column is required and must be 0, 1, 2, or 3.");return 4*e+t},l.getColumn=function(e,i,n){if(e===void 0)throw new r("matrix is required.");if("number"!=typeof i||0>i||i>3)throw new r("index is required and must be 0, 1, 2, or 3.");var o=4*i,a=e[o],s=e[o+1],l=e[o+2],u=e[o+3];return n===void 0?new t(a,s,l,u):(n.x=a,n.y=s,n.z=l,n.w=u,n)},l.setColumn=function(e,t,i,n){if(e===void 0)throw new r("matrix is required");if(i===void 0)throw new r("cartesian is required");if("number"!=typeof t||0>t||t>3)throw new r("index is required and must be 0, 1, 2, or 3.");n=l.clone(e,n);var o=4*t;return n[o]=i.x,n[o+1]=i.y,n[o+2]=i.z,n[o+3]=i.w,n},l.getRow=function(e,i,n){if(e===void 0)throw new r("matrix is required.");if("number"!=typeof i||0>i||i>3)throw new r("index is required and must be 0, 1, 2, or 3.");var o=e[i],a=e[i+4],s=e[i+8],l=e[i+12];return n===void 0?new t(o,a,s,l):(n.x=o,n.y=a,n.z=s,n.w=l,n)},l.setRow=function(e,t,i,n){if(e===void 0)throw new r("matrix is required");if(i===void 0)throw new r("cartesian is required");if("number"!=typeof t||0>t||t>3)throw new r("index is required and must be 0, 1, 2, or 3.");return n=l.clone(e,n),n[t]=i.x,n[t+4]=i.y,n[t+8]=i.z,n[t+12]=i.w,n},l.multiply=function(e,t,i){if(e===void 0)throw new r("left is required");if(t===void 0)throw new r("right is required");var n=e[0],o=e[1],a=e[2],s=e[3],u=e[4],c=e[5],h=e[6],d=e[7],m=e[8],p=e[9],f=e[10],v=e[11],g=e[12],_=e[13],y=e[14],w=e[15],C=t[0],x=t[1],T=t[2],S=t[3],E=t[4],b=t[5],M=t[6],I=t[7],D=t[8],A=t[9],P=t[10],R=t[11],O=t[12],z=t[13],L=t[14],N=t[15],V=n*C+u*x+m*T+g*S,B=o*C+c*x+p*T+_*S,F=a*C+h*x+f*T+y*S,q=s*C+d*x+v*T+w*S,U=n*E+u*b+m*M+g*I,k=o*E+c*b+p*M+_*I,W=a*E+h*b+f*M+y*I,H=s*E+d*b+v*M+w*I,j=n*D+u*A+m*P+g*R,G=o*D+c*A+p*P+_*R,Y=a*D+h*A+f*P+y*R,X=s*D+d*A+v*P+w*R,Z=n*O+u*z+m*L+g*N,K=o*O+c*z+p*L+_*N,J=a*O+h*z+f*L+y*N,Q=s*O+d*z+v*L+w*N;return i===void 0?new l(V,U,j,Z,B,k,G,K,F,W,Y,J,q,H,X,Q):(i[0]=V,i[1]=B,i[2]=F,i[3]=q,i[4]=U,i[5]=k,i[6]=W,i[7]=H,i[8]=j,i[9]=G,i[10]=Y,i[11]=X,i[12]=Z,i[13]=K,i[14]=J,i[15]=Q,i)},l.multiplyByTranslation=function(e,t,i){if(e===void 0)throw new r("matrix is required");if(t===void 0)throw new r("translation is required");var n=t.x,o=t.y,a=t.z,s=n*e[0]+o*e[4]+a*e[8]+e[12],u=n*e[1]+o*e[5]+a*e[9]+e[13],c=n*e[2]+o*e[6]+a*e[10]+e[14];return i===void 0?new l(e[0],e[4],e[8],s,e[1],e[5],e[9],u,e[2],e[6],e[10],c,e[3],e[7],e[11],e[15]):(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=s,i[13]=u,i[14]=c,i[15]=e[15],i)},l.multiplyByUniformScale=function(e,t,i){if(e===void 0)throw new r("matrix is required");if("number"!=typeof t)throw new r("scale is required");return 1===t?l.clone(e,i):i===void 0?new l(t*e[0],t*e[4],t*e[8],e[12],t*e[1],t*e[5],t*e[9],e[13],t*e[2],t*e[6],t*e[10],e[14],0,0,0,1):(i[0]=t*e[0],i[1]=t*e[1],i[2]=t*e[2],i[3]=0,i[4]=t*e[4],i[5]=t*e[5],i[6]=t*e[6],i[7]=0,i[8]=t*e[8],i[9]=t*e[9],i[10]=t*e[10],i[11]=0,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=1,i)},l.multiplyByVector=function(e,i,n){if(e===void 0)throw new r("matrix is required");if(i===void 0)throw new r("cartesian is required");var o=i.x,a=i.y,s=i.z,l=i.w,u=e[0]*o+e[4]*a+e[8]*s+e[12]*l,c=e[1]*o+e[5]*a+e[9]*s+e[13]*l,h=e[2]*o+e[6]*a+e[10]*s+e[14]*l,d=e[3]*o+e[7]*a+e[11]*s+e[15]*l;return n===void 0?new t(u,c,h,d):(n.x=u,n.y=c,n.z=h,n.w=d,n)};var d=new t(0,0,0,1);return l.multiplyByPoint=function(e,t,i){if(t===void 0)throw new r("cartesian is required");return d.x=t.x,d.y=t.y,d.z=t.z,l.multiplyByVector(e,d,i)},l.multiplyByScalar=function(e,t,i){if(e===void 0)throw new r("matrix is required");if("number"!=typeof t)throw new r("scalar is required and must be a number");return i===void 0?new l(e[0]*t,e[4]*t,e[8]*t,e[12]*t,e[1]*t,e[5]*t,e[9]*t,e[13]*t,e[2]*t,e[6]*t,e[10]*t,e[14]*t,e[3]*t,e[7]*t,e[11]*t,e[15]*t):(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i)},l.negate=function(e,t){if(e===void 0)throw new r("matrix is required");return t===void 0?new l(-e[0],-e[4],-e[8],-e[12],-e[1],-e[5],-e[9],-e[13],-e[2],-e[6],-e[10],-e[14],-e[3],-e[7],-e[11],-e[15]):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t)},l.transpose=function(e,t){if(e===void 0)throw new r("matrix is required");if(t===void 0)return new l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]);var i=e[1],n=e[2],o=e[3],a=e[6],s=e[7],u=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[10]=e[10],t[11]=e[14],t[12]=o,t[13]=s,t[14]=u,t[15]=e[15],t},l.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},l.equalsEpsilon=function(e,t,i){if("number"!=typeof i)throw new r("epsilon is required and must be a number");return e===t||e!==void 0&&t!==void 0&&i>=Math.abs(e[0]-t[0])&&i>=Math.abs(e[1]-t[1])&&i>=Math.abs(e[2]-t[2])&&i>=Math.abs(e[3]-t[3])&&i>=Math.abs(e[4]-t[4])&&i>=Math.abs(e[5]-t[5])&&i>=Math.abs(e[6]-t[6])&&i>=Math.abs(e[7]-t[7])&&i>=Math.abs(e[8]-t[8])&&i>=Math.abs(e[9]-t[9])&&i>=Math.abs(e[10]-t[10])&&i>=Math.abs(e[11]-t[11])&&i>=Math.abs(e[12]-t[12])&&i>=Math.abs(e[13]-t[13])&&i>=Math.abs(e[14]-t[14])&&i>=Math.abs(e[15]-t[15])},l.getTranslation=function(t,i){if(t===void 0)throw new r("matrix is required");return i===void 0?new e(t[12],t[13],t[14]):(i.x=t[12],i.y=t[13],i.z=t[14],i)},l.getRotation=function(e,t){if(e===void 0)throw new r("matrix is required");return t===void 0?new a(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t)},l.inverse=function(e,t){if(e===void 0)throw new r("matrix is required");var i=e[0],n=e[4],a=e[8],u=e[12],c=e[1],h=e[5],d=e[9],m=e[13],p=e[2],f=e[6],v=e[10],g=e[14],_=e[3],y=e[7],w=e[11],C=e[15],x=v*C,T=g*w,S=f*C,E=g*y,b=f*w,M=v*y,I=p*C,D=g*_,A=p*w,P=v*_,R=p*y,O=f*_,z=x*h+E*d+b*m-(T*h+S*d+M*m),L=T*c+I*d+P*m-(x*c+D*d+A*m),N=S*c+D*h+R*m-(E*c+I*h+O*m),V=M*c+A*h+O*d-(b*c+P*h+R*d),B=T*n+S*a+M*u-(x*n+E*a+b*u),F=x*i+D*a+A*u-(T*i+I*a+P*u),q=E*i+I*n+O*u-(S*i+D*n+R*u),U=b*i+P*n+R*a-(M*i+A*n+O*a);x=a*m,T=u*d,S=n*m,E=u*h,b=n*d,M=a*h,I=i*m,D=u*c,A=i*d,P=a*c,R=i*h,O=n*c;var k=x*y+E*w+b*C-(T*y+S*w+M*C),W=T*_+I*w+P*C-(x*_+D*w+A*C),H=S*_+D*y+R*C-(E*_+I*y+O*C),j=M*_+A*y+O*w-(b*_+P*y+R*w),G=S*v+M*g+T*f-(b*g+x*f+E*v),Y=A*g+x*p+D*v-(I*v+P*g+T*p),X=I*f+O*g+E*p-(R*g+S*p+D*f),Z=R*v+b*p+P*f-(A*f+O*v+M*p),K=i*z+n*L+a*N+u*V;if(o.EPSILON20>Math.abs(K))throw new s("matrix is not invertible because its determinate is zero.");return K=1/K,t===void 0?new l(z*K,B*K,k*K,G*K,L*K,F*K,W*K,Y*K,N*K,q*K,H*K,X*K,V*K,U*K,j*K,Z*K):(t[0]=z*K,t[1]=L*K,t[2]=N*K,t[3]=V*K,t[4]=B*K,t[5]=F*K,t[6]=q*K,t[7]=U*K,t[8]=k*K,t[9]=W*K,t[10]=H*K,t[11]=j*K,t[12]=G*K,t[13]=Y*K,t[14]=X*K,t[15]=Z*K,t)},l.inverseTransformation=function(e,t){if(e===void 0)throw new r("matrix is required");var i=e[0],n=e[1],o=e[2],a=e[4],s=e[5],u=e[6],c=e[8],h=e[9],d=e[10],m=e[12],p=e[13],f=e[14],v=-i*m-n*p-o*f,g=-a*m-s*p-u*f,_=-c*m-h*p-d*f;return t===void 0?new l(i,n,o,v,a,s,u,g,c,h,d,_,0,0,0,1):(t[0]=i,t[1]=a,t[2]=c,t[3]=0,t[4]=n,t[5]=s,t[6]=h,t[7]=0,t[8]=o,t[9]=u,t[10]=d,t[11]=0,t[12]=v,t[13]=g,t[14]=_,t[15]=1,t)},l.IDENTITY=n(new l(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),l.COLUMN0ROW0=0,l.COLUMN0ROW1=1,l.COLUMN0ROW2=2,l.COLUMN0ROW3=3,l.COLUMN1ROW0=4,l.COLUMN1ROW1=5,l.COLUMN1ROW2=6,l.COLUMN1ROW3=7,l.COLUMN2ROW0=8,l.COLUMN2ROW1=9,l.COLUMN2ROW2=10,l.COLUMN2ROW3=11,l.COLUMN3ROW0=12,l.COLUMN3ROW1=13,l.COLUMN3ROW2=14,l.COLUMN3ROW3=15,l.prototype.clone=function(e){return l.clone(this,e)},l.prototype.toArray=function(e){return l.toArray(this,e)},l.prototype.getColumn=function(e,t){return l.getColumn(this,e,t)},l.prototype.setColumn=function(e,t,i){return l.setColumn(this,e,t,i)},l.prototype.getRow=function(e,t){return l.getRow(this,e,t)},l.prototype.setRow=function(e,t,i){return l.setRow(this,e,t,i)},l.prototype.multiply=function(e,t){return l.multiply(this,e,t)},l.prototype.multiplyByTranslation=function(e,t){return l.multiplyByTranslation(this,e,t)},l.prototype.multiplyByUniformScale=function(e,t){return l.multiplyByUniformScale(this,e,t)},l.prototype.multiplyByVector=function(e,t){return l.multiplyByVector(this,e,t)},l.prototype.multiplyByPoint=function(e,t){return l.multiplyByPoint(this,e,t)},l.prototype.multiplyByScalar=function(e,t){return l.multiplyByScalar(this,e,t)},l.prototype.negate=function(e){return l.negate(this,e)},l.prototype.transpose=function(e){return l.transpose(this,e)},l.prototype.equals=function(e){return l.equals(this,e)},l.prototype.equalsEpsilon=function(e,t){return l.equalsEpsilon(this,e,t)},l.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n"+"("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n"+"("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n"+"("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},l.prototype.getTranslation=function(e){return l.getTranslation(this,e)},l.prototype.getRotation=function(e){return l.getRotation(this,e)},l.prototype.inverse=function(e){return l.inverse(this,e)},l.prototype.inverseTransformation=function(e){return l.inverseTransformation(this,e)},l}),i("Core/BoundingSphere",["./defaultValue","./DeveloperError","./Cartesian2","./Cartesian3","./Cartesian4","./Cartographic","./Ellipsoid","./GeographicProjection","./Extent","./Intersect","./Interval","./Matrix4"],function(e,t,i,r,n,o,a,s,l,u,c,h){var d=function(t,i){this.center=r.clone(e(t,r.ZERO)),this.radius=e(i,0)},m=new r,p=new r,f=new r,v=new r,g=new r,_=new r,y=new r,w=new r,C=new r,x=new r,T=new r,S=new r;d.fromPoints=function(e,t){if(t===void 0&&(t=new d),e===void 0||0===e.length)return t.center=r.ZERO.clone(t.center),t.radius=0,t;for(var i=r.clone(e[0],y),n=r.clone(i,m),o=r.clone(i,p),a=r.clone(i,f),s=r.clone(i,v),l=r.clone(i,g),u=r.clone(i,_),c=e.length,h=1;c>h;h++){r.clone(e[h],i);var E=i.x,b=i.y,M=i.z;n.x>E&&r.clone(i,n),E>s.x&&r.clone(i,s),o.y>b&&r.clone(i,o),b>l.y&&r.clone(i,l),a.z>M&&r.clone(i,a),M>u.z&&r.clone(i,u)}var I=r.magnitudeSquared(r.subtract(s,n,w)),D=r.magnitudeSquared(r.subtract(l,o,w)),A=r.magnitudeSquared(r.subtract(u,a,w)),P=n,R=s,O=I;D>O&&(O=D,P=o,R=l),A>O&&(O=A,P=a,R=u);var z=C;z.x=.5*(P.x+R.x),z.y=.5*(P.y+R.y),z.z=.5*(P.z+R.z);var L=r.magnitudeSquared(r.subtract(R,z,w)),N=Math.sqrt(L),V=x;V.x=n.x,V.y=o.y,V.z=a.z;var B=T;B.x=s.x,B.y=l.y,B.z=u.z;var F=r.multiplyByScalar(r.add(V,B,w),.5,S),q=0;for(h=0;c>h;h++){r.clone(e[h],i);var U=r.magnitude(r.subtract(i,F,w));U>q&&(q=U);var k=r.magnitudeSquared(r.subtract(i,z,w));if(k>L){var W=Math.sqrt(k);N=.5*(N+W),L=N*N;var H=W-N;z.x=(N*z.x+H*i.x)/W,z.y=(N*z.y+H*i.y)/W,z.z=(N*z.z+H*i.z)/W}}return q>N?(r.clone(z,t.center),t.radius=N):(r.clone(F,t.center),t.radius=q),t};var E=new s,b=new r,M=new r,I=new o,D=new o;d.fromExtent2D=function(e,t,i){return d.fromExtentWithHeights2D(e,t,0,0,i)},d.fromExtentWithHeights2D=function(t,i,n,o,a){if(a===void 0&&(a=new d),t===void 0)return a.center=r.ZERO.clone(a.center),a.radius=0,a;i=e(i,E),t.getSouthwest(I),I.height=n,t.getNortheast(D),D.height=o;var s=i.project(I,b),l=i.project(D,M),u=l.x-s.x,c=l.y-s.y,h=l.z-s.z;a.radius=.5*Math.sqrt(u*u+c*c+h*h);var m=a.center;return m.x=s.x+.5*u,m.y=s.y+.5*c,m.z=s.z+.5*h,a};var A=[];d.fromExtent3D=function(t,i,r){i=e(i,a.WGS84);var n;return t!==void 0&&(n=t.subsample(i,A)),d.fromPoints(n,r)},d.fromVertices=function(e,i,n,o){if(o===void 0&&(o=new d),e===void 0||0===e.length)return o.center=r.ZERO.clone(o.center),o.radius=0,o;if(i===void 0&&(i=r.ZERO),n===void 0&&(n=3),3>n)throw new t("stride must be 3 or greater.");var a=y;a.x=e[0]+i.x,a.y=e[1]+i.y,a.z=e[2]+i.z;for(var s=r.clone(a,m),l=r.clone(a,p),u=r.clone(a,f),c=r.clone(a,v),h=r.clone(a,g),E=r.clone(a,_),b=e.length,M=0;b>M;M+=n){var I=e[M]+i.x,D=e[M+1]+i.y,A=e[M+2]+i.z;a.x=I,a.y=D,a.z=A,s.x>I&&r.clone(a,s),I>c.x&&r.clone(a,c),l.y>D&&r.clone(a,l),D>h.y&&r.clone(a,h),u.z>A&&r.clone(a,u),A>E.z&&r.clone(a,E)}var P=r.magnitudeSquared(r.subtract(c,s,w)),R=r.magnitudeSquared(r.subtract(h,l,w)),O=r.magnitudeSquared(r.subtract(E,u,w)),z=s,L=c,N=P;R>N&&(N=R,z=l,L=h),O>N&&(N=O,z=u,L=E);var V=C;V.x=.5*(z.x+L.x),V.y=.5*(z.y+L.y),V.z=.5*(z.z+L.z);var B=r.magnitudeSquared(r.subtract(L,V,w)),F=Math.sqrt(B),q=x;q.x=s.x,q.y=l.y,q.z=u.z;var U=T;U.x=c.x,U.y=h.y,U.z=E.z;var k=r.multiplyByScalar(r.add(q,U,w),.5,S),W=0;for(M=0;b>M;M+=n){a.x=e[M]+i.x,a.y=e[M+1]+i.y,a.z=e[M+2]+i.z;var H=r.magnitude(r.subtract(a,k,w));H>W&&(W=H);var j=r.magnitudeSquared(r.subtract(a,V,w));if(j>B){var G=Math.sqrt(j);F=.5*(F+G),B=F*F;var Y=G-F;V.x=(F*V.x+Y*a.x)/G,V.y=(F*V.y+Y*a.y)/G,V.z=(F*V.z+Y*a.z)/G}}return W>F?(r.clone(V,o.center),o.radius=F):(r.clone(k,o.center),o.radius=W),o},d.fromCornerPoints=function(e,i,n){if(e===void 0||i===void 0)throw new t("corner and oppositeCorner are required.");n===void 0&&(n=new d);var o=n.center;return r.add(e,i,o),r.multiplyByScalar(o,.5,o),n.radius=r.distance(o,i),n},d.clone=function(e,i){if(e===void 0)throw new t("sphere is required");return i===void 0?new d(e.center,e.radius):(i.center=r.clone(e.center,i.center),i.radius=e.radius,i)};var P=new r,R=new r;d.union=function(e,i,n){if(e===void 0)throw new t("left is required.");if(i===void 0)throw new t("right is required.");n===void 0&&(n=new d);var o=e.center,a=i.center;r.add(o,a,R);var s=r.multiplyByScalar(R,.5,R),l=r.subtract(o,s,P).magnitude()+e.radius,u=r.subtract(a,s,P).magnitude()+i.radius;
return n.radius=Math.max(l,u),r.clone(s,n.center),n};var O=new r;d.expand=function(e,i,n){if(e===void 0)throw new t("sphere is required.");if(i===void 0)throw new t("point is required.");n=d.clone(e,n);var o=r.subtract(i,n.center,O).magnitude();return o>n.radius&&(n.radius=o),n},d.intersect=function(e,i){if(e===void 0)throw new t("sphere is required.");if(i===void 0)throw new t("plane is required.");var n=e.center,o=e.radius,a=r.dot(i,n)+i.w;return-o>a?u.OUTSIDE:o>a?u.INTERSECTING:u.INSIDE};var z=n.UNIT_W.clone();d.transform=function(e,i,n){if(e===void 0)throw new t("sphere is required.");if(i===void 0)throw new t("transform is required.");return n===void 0&&(n=new d),h.multiplyByPoint(i,e.center,z),r.clone(z,n.center),n.radius=e.radius,n};var L=new r;return d.getPlaneDistances=function(e,i,n,o){if(e===void 0)throw new t("sphere is required.");if(i===void 0)throw new t("position is required.");if(n===void 0)throw new t("direction is required.");o===void 0&&(o=new c);var a=r.subtract(e.center,i,L),s=r.multiplyByScalar(n,n.dot(a),L),l=s.magnitude();return o.start=l-e.radius,o.stop=l+e.radius,o},d.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&r.equals(e.center,t.center)&&e.radius===t.radius},d.prototype.clone=function(e){return d.clone(this,e)},d.prototype.union=function(e,t){return d.union(this,e,t)},d.prototype.expand=function(e,t){return d.expand(this,e,t)},d.prototype.intersect=function(e){return d.intersect(this,e)},d.prototype.transform=function(e,t){return d.transform(this,e,t)},d.prototype.getPlaneDistances=function(e,t,i){return d.getPlaneDistances(this,e,t,i)},d.prototype.equals=function(e){return d.equals(this,e)},d}),i("Core/ComponentDatatype",["./Enumeration"],function(e){if("undefined"==typeof Int8Array)return{};var t={};return t.BYTE=new e(5120,"BYTE"),t.BYTE.sizeInBytes=Int8Array.BYTES_PER_ELEMENT,t.BYTE.toTypedArray=function(e){return new Int8Array(e)},t.BYTE.createArrayBufferView=function(e,t){return new Int8Array(e,t)},t.UNSIGNED_BYTE=new e(5121,"UNSIGNED_BYTE"),t.UNSIGNED_BYTE.sizeInBytes=Uint8Array.BYTES_PER_ELEMENT,t.UNSIGNED_BYTE.toTypedArray=function(e){return new Uint8Array(e)},t.UNSIGNED_BYTE.createArrayBufferView=function(e,t){return new Uint8Array(e,t)},t.SHORT=new e(5122,"SHORT"),t.SHORT.sizeInBytes=Int16Array.BYTES_PER_ELEMENT,t.SHORT.toTypedArray=function(e){return new Int16Array(e)},t.SHORT.createArrayBufferView=function(e,t){return new Int16Array(e,t)},t.UNSIGNED_SHORT=new e(5123,"UNSIGNED_SHORT"),t.UNSIGNED_SHORT.sizeInBytes=Uint16Array.BYTES_PER_ELEMENT,t.UNSIGNED_SHORT.toTypedArray=function(e){return new Uint16Array(e)},t.UNSIGNED_SHORT.createArrayBufferView=function(e,t){return new Uint16Array(e,t)},t.FLOAT=new e(5126,"FLOAT"),t.FLOAT.sizeInBytes=Float32Array.BYTES_PER_ELEMENT,t.FLOAT.toTypedArray=function(e){return new Float32Array(e)},t.FLOAT.createArrayBufferView=function(e,t){return new Float32Array(e,t)},t.validate=function(e){return e===t.BYTE||e===t.UNSIGNED_BYTE||e===t.SHORT||e===t.UNSIGNED_SHORT||e===t.FLOAT},t}),i("Core/PrimitiveType",["./Enumeration"],function(e){var t={POINTS:new e(0,"POINTS"),LINES:new e(1,"LINES"),LINE_LOOP:new e(2,"LINE_LOOP"),LINE_STRIP:new e(3,"LINE_STRIP"),TRIANGLES:new e(4,"TRIANGLES"),TRIANGLE_STRIP:new e(5,"TRIANGLE_STRIP"),TRIANGLE_FAN:new e(6,"TRIANGLE_FAN"),validate:function(e){return e===t.POINTS||e===t.LINES||e===t.LINE_LOOP||e===t.LINE_STRIP||e===t.TRIANGLES||e===t.TRIANGLE_STRIP||e===t.TRIANGLE_FAN}};return t}),i("Core/BoxTessellator",["./DeveloperError","./Cartesian3","./ComponentDatatype","./PrimitiveType","./defaultValue"],function(e,t,i,r,n){var o={compute:function(o){o=n(o,n.EMPTY_OBJECT);var a,s;if(o.minimumCorner!==void 0&&o.maximumCorner!==void 0)a=o.minimumCorner,s=o.maximumCorner;else{var l=o.dimensions!==void 0?o.dimensions:new t(1,1,1);if(0>l.x||0>l.y||0>l.z)throw new e("All dimensions components must be greater than or equal to zero.");var u=l.multiplyByScalar(.5);a=u.negate(),s=u}var c={};return c.attributes={},c.indexLists=[],c.attributes.position={componentDatatype:i.FLOAT,componentsPerAttribute:3,values:[a.x,a.y,a.z,s.x,a.y,a.z,s.x,s.y,a.z,a.x,s.y,a.z,a.x,a.y,s.z,s.x,a.y,s.z,s.x,s.y,s.z,a.x,s.y,s.z]},c.indexLists.push({primitiveType:r.TRIANGLES,values:[4,5,6,4,6,7,1,0,3,1,3,2,1,6,5,1,2,6,2,3,7,2,7,6,3,0,4,3,4,7,0,1,5,0,5,4]}),c}};return o}),i("Core/TridiagonalSystemSolver",["./DeveloperError"],function(e){var t={};return t.solve=function(t,i,r,n){if(t===void 0||!(t instanceof Array))throw new e("The array lower is required.");if(i===void 0||!(i instanceof Array))throw new e("The array diagonal is required.");if(r===void 0||!(r instanceof Array))throw new e("The array upper is required.");if(n===void 0||!(n instanceof Array))throw new e("The array right is required.");if(i.length!==n.length)throw new e("diagonal and right must have the same lengths.");if(t.length!==r.length)throw new e("lower and upper must have the same lengths.");if(t.length!==i.length-1)throw new e("lower and upper must be one less than the length of diagonal.");var o=[],a=[],s=[];o.length=r.length,a.length=s.length=n.length,o[0]=r[0]/i[0],a[0]=n[0].multiplyByScalar(1/i[0]);for(var l,u=1;o.length>u;++u)l=1/(i[u]-o[u-1]*t[u-1]),o[u]=r[u]*l,a[u]=n[u].subtract(a[u-1].multiplyByScalar(t[u-1])),a[u]=a[u].multiplyByScalar(l);for(l=1/(i[u]-o[u-1]*t[u-1]),a[u]=n[u].subtract(a[u-1].multiplyByScalar(t[u-1])),a[u]=a[u].multiplyByScalar(l),s[s.length-1]=a[a.length-1],u=s.length-2;u>=0;--u)s[u]=a[u].subtract(s[u+1].multiplyByScalar(o[u]));return s},t}),i("Core/HermiteSpline",["./defaultValue","./DeveloperError","./Matrix4","./Cartesian4","./TridiagonalSystemSolver"],function(e,t,i,r,n){var o=function(e){if(e===void 0||!(e instanceof Array)||3>e.length)throw new t("controlPoints is required. It must be an array with at least a length of 3.");this._points=e,this._lastTimeIndex=0,this._points[0].tangent===void 0||this._points[this._points.length-1].tangent===void 0?this._generateNatural():this._points[0].tangent!==void 0&&this._points[1].tangent===void 0&&this._points[this._points.length-1].tangent!==void 0&&this._points[this._points.length-2].tangent===void 0&&this._generateClamped()};return o.hermiteCoefficientMatrix=new i(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0),o.prototype._findIndex=function(t){var i=e(this._lastTimeIndex,0);if(t>=this._points[i].time){if(this._points.length>i+1&&this._points[i+1].time>t)return i;if(this._points.length>i+2&&this._points[i+2].time>t)return this._lastTimeIndex=i+1,this._lastTimeIndex}else if(i-1>=0&&t>=this._points[i-1].time)return this._lastTimeIndex=i-1,this._lastTimeIndex;for(i=0;this._points.length-1>i&&!(t>=this._points[i].time&&this._points[i+1].time>t);++i);return i===this._points.length-1&&(i=this._points.length-2),this._lastTimeIndex=i,this._lastTimeIndex},o.prototype._generateClamped=function(){var e=[],t=[],i=[],r=[];e.length=i.length=this._points.length-1,t.length=r.length=this._points.length;var o;for(e[0]=t[0]=1,i[0]=0,r[0]=this._points[0].tangent,o=1;e.length-1>o;++o)e[o]=i[o]=1,t[o]=4,r[o]=this._points[o+1].point.subtract(this._points[o-1].point).multiplyByScalar(3);e[o]=0,i[o]=1,t[o]=4,r[o]=this._points[o+1].point.subtract(this._points[o-1].point).multiplyByScalar(3),t[o+1]=1,r[o+1]=this._points[o+1].tangent;var a=n.solve(e,t,i,r);for(o=0;this._points.length>o;++o)this._points[o].tangent=a[o]},o.prototype._generateNatural=function(){var e=[],t=[],i=[],r=[];e.length=i.length=this._points.length-1,t.length=r.length=this._points.length;var o;for(e[0]=i[0]=1,t[0]=2,r[0]=this._points[1].point.subtract(this._points[0].point).multiplyByScalar(3),o=1;e.length>o;++o)e[o]=i[o]=1,t[o]=4,r[o]=this._points[o+1].point.subtract(this._points[o-1].point).multiplyByScalar(3);t[o]=2,r[o]=this._points[o].point.subtract(this._points[o-1].point).multiplyByScalar(3);var a=n.solve(e,t,i,r);for(o=0;this._points.length>o;++o)this._points[o].tangent=a[o]},o.prototype.getControlPoints=function(){return this._points},o.prototype.evaluate=function(e){if(e===void 0)throw new t("time is required.");if(this._points[0].time>e||e>this._points[this._points.length-1].time)throw new t("time is out of range.");var i=this._findIndex(e),n=(e-this._points[i].time)/(this._points[i+1].time-this._points[i].time),a=new r(0,n*n,n);a.x=a.y*n;var s=o.hermiteCoefficientMatrix.multiplyByPoint(a),l=this._points[i].point.multiplyByScalar(s.x),u=this._points[i+1].point.multiplyByScalar(s.y),c=this._points[i].tangent.multiplyByScalar(s.z),h=this._points[i+1].tangent.multiplyByScalar(s.w);return l.add(u.add(c.add(h)))},o}),i("Core/CatmullRomSpline",["./defaultValue","./DeveloperError","./Matrix4","./Cartesian3","./Cartesian4","./HermiteSpline"],function(e,t,i,r,n,o){var a=function(e,i,n){if(e===void 0||!(e instanceof Array)||3>e.length)throw new t("controlPoints is required and must be an array of objects with point and time properties, with a length of at least 3.");if(this._points=e,this._lastTimeIndex=0,i!==void 0)this._ti=r.clone(i);else{var o=r.clone(e[0].point),a=r.clone(e[1].point),s=r.clone(e[2].point);this._ti=a.multiplyByScalar(2).subtract(s).subtract(o).multiplyByScalar(.5)}if(n!==void 0)this._to=r.clone(n);else{var l=e.length-1,u=r.clone(e[l].point),c=r.clone(e[l-1].point),h=r.clone(e[l-2].point);this._to=u.subtract(c.multiplyByScalar(2)).add(h).multiplyByScalar(.5)}};return a.catmullRomCoefficientMatrix=new i(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),a.prototype.getControlPoints=function(){return this._points},a.prototype.getStartTangent=function(){return this._ti},a.prototype.getEndTangent=function(){return this._to},a.prototype._findIndex=function(t){var i=e(this._lastTimeIndex,0);if(t>=this._points[i].time){if(this._points.length>i+1&&this._points[i+1].time>t)return i;if(this._points.length>i+2&&this._points[i+2].time>t)return this._lastTimeIndex=i+1,this._lastTimeIndex}else if(i-1>=0&&t>=this._points[i-1].time)return this._lastTimeIndex=i-1,this._lastTimeIndex;for(i=0;this._points.length-1>i&&!(t>=this._points[i].time&&this._points[i+1].time>t);++i);return i===this._points.length-1&&(i=this._points.length-2),this._lastTimeIndex=i,this._lastTimeIndex},a.prototype.evaluate=function(e){if(e===void 0)throw new t("time is required.");if(this._points[0].time>e||e>this._points[this._points.length-1].time)throw new t("time is out of range.");var i=this._findIndex(e),n=(e-this._points[i].time)/(this._points[i+1].time-this._points[i].time),s=new r(0,n*n,n);s.x=s.y*n;var l,u,c,h,d;return 0===i?(l=this._points[0].point,u=this._points[1].point,c=this._ti,h=this._points[2].point.subtract(l).multiplyByScalar(.5),d=o.hermiteCoefficientMatrix.multiplyByPoint(s)):i===this._points.length-2?(l=this._points[i].point,u=this._points[i+1].point,c=u.subtract(this._points[i-1].point).multiplyByScalar(.5),h=this._to,d=o.hermiteCoefficientMatrix.multiplyByPoint(s)):(l=this._points[i-1].point,u=this._points[i].point,c=this._points[i+1].point,h=this._points[i+2].point,d=a.catmullRomCoefficientMatrix.multiplyByPoint(s)),l=l.multiplyByScalar(d.x),u=u.multiplyByScalar(d.y),c=c.multiplyByScalar(d.z),h=h.multiplyByScalar(d.w),l.add(u.add(c.add(h)))},a}),i("Core/binarySearch",["./DeveloperError"],function(e){var t=function(t,i,r){if(t===void 0)throw new e("array is required.");if(i===void 0)throw new e("itemToFind is required.");if(r===void 0)throw new e("comparator is required.");for(var n,o,a=0,s=t.length-1;s>=a;)if(n=~~((a+s)/2),o=r(t[n],i),0>o)a=n+1;else{if(!(o>0))return n;s=n-1}return~(s+1)};return t}),i("Core/TimeConstants",[],function(){var e={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5};return e}),i("Core/LeapSecond",["./DeveloperError"],function(e){var t=function(t,i){if(t===void 0)throw new e("date is required.");if(null===i||isNaN(i))throw new e("offset is required and must be a number.");this.julianDate=t,this.offset=i};return t.setLeapSeconds=function(i){if(!Array.isArray(i))throw new e("leapSeconds is required and must be an array.");t._leapSeconds=i,t._leapSeconds.sort(t.compareLeapSecondDate)},t.getLeapSeconds=function(){return t._leapSeconds},t.prototype.equals=function(e){return this.julianDate.equals(e.julianDate)&&this.offset===e.offset},t.compareLeapSecondDate=function(e,t){return e.julianDate.compareTo(t.julianDate)},t._leapSeconds=[],t}),i("Core/TimeStandard",[],function(){var e={UTC:0,TAI:1};return e}),i("Core/isLeapYear",["./DeveloperError"],function(e){function t(t){if(null===t||isNaN(t))throw new e("year is required and must be a number.");return 0===t%4&&0!==t%100||0===t%400}return t}),i("ThirdParty/sprintf",[],function(){function e(){var e=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,t=arguments,i=0,r=t[i++],n=function(e,t,i,r){i||(i=" ");var n=e.length>=t?"":Array(1+t-e.length>>>0).join(i);return r?e+n:n+e},o=function(e,t,i,r,o,a){var s=r-e.length;return s>0&&(e=i||!o?n(e,r,a,i):e.slice(0,t.length)+n("",s,"0",!0)+e.slice(t.length)),e},a=function(e,t,i,r,a,s,l){var u=e>>>0;return i=i&&u&&{2:"0b",8:"0",16:"0x"}[t]||"",e=i+n(u.toString(t),s||0,"0",!1),o(e,i,r,a,l)},s=function(e,t,i,r,n,a){return null!=r&&(e=e.slice(0,r)),o(e,"",t,i,n,a)},l=function(e,r,l,u,c,h,d){var m,p,f,v,g;if("%%"==e)return"%";for(var _=!1,y="",w=!1,C=!1,x=" ",T=l.length,S=0;l&&T>S;S++)switch(l.charAt(S)){case" ":y=" ";break;case"+":y="+";break;case"-":_=!0;break;case"'":x=l.charAt(S+1);break;case"0":w=!0;break;case"#":C=!0}if(u=u?"*"==u?+t[i++]:"*"==u.charAt(0)?+t[u.slice(1,-1)]:+u:0,0>u&&(u=-u,_=!0),!isFinite(u))throw Error("sprintf: (minimum-)width must be finite");switch(h=h?"*"==h?+t[i++]:"*"==h.charAt(0)?+t[h.slice(1,-1)]:+h:"fFeE".indexOf(d)>-1?6:"d"==d?0:void 0,g=r?t[r.slice(0,-1)]:t[i++],d){case"s":return s(g+"",_,u,h,w,x);case"c":return s(String.fromCharCode(+g),_,u,h,w);case"b":return a(g,2,C,_,u,h,w);case"o":return a(g,8,C,_,u,h,w);case"x":return a(g,16,C,_,u,h,w);case"X":return a(g,16,C,_,u,h,w).toUpperCase();case"u":return a(g,10,C,_,u,h,w);case"i":case"d":return m=+g||0,m=Math.round(m-m%1),p=0>m?"-":y,g=p+n(Math.abs(m)+"",h,"0",!1),o(g,p,_,u,w);case"e":case"E":case"f":case"F":case"g":case"G":return m=+g,p=0>m?"-":y,f=["toExponential","toFixed","toPrecision"]["efg".indexOf(d.toLowerCase())],v=["toString","toUpperCase"]["eEfFgG".indexOf(d)%2],g=p+Math.abs(m)[f](h),o(g,p,_,u,w)[v]();default:return e}};return r.replace(e,l)}return e}),i("Core/JulianDate",["./DeveloperError","./binarySearch","./TimeConstants","./LeapSecond","./TimeStandard","./isLeapYear","../ThirdParty/sprintf"],function(e,t,i,r,n,o,a){function s(e){f.julianDate=e;var i=r.getLeapSeconds(),n=t(i,f,r.compareLeapSecondDate);0>n&&(n=~n),n>=i.length&&(n=i.length-1);var o=i[n].offset;if(n>0){var a=e.getSecondsDifference(i[n].julianDate);a>o&&(n--,o=i[n].offset)}e.addSeconds(o,e)}function l(e,i){f.julianDate=e;var n=r.getLeapSeconds(),o=t(n,f,r.compareLeapSecondDate);if(0>o&&(o=~o),0===o)return e.addSeconds(-n[0].offset,i);if(o>=n.length)return e.addSeconds(-n[o-1].offset,i);var a=e.getSecondsDifference(n[o].julianDate);return 0===a?e.addSeconds(-n[o].offset,i):1>=a?void 0:e.addSeconds(-n[--o].offset,i)}function u(e,t,r){var o=0|t/i.SECONDS_PER_DAY;return e+=o,t-=i.SECONDS_PER_DAY*o,0>t&&(e--,t+=i.SECONDS_PER_DAY),r===void 0?new b(e,t,n.TAI):(r._julianDayNumber=e,r._secondsOfDay=t,r)}function c(e,t,r,n,o,a,s){var l=0|(t-14)/12,u=e+4800+l,c=(0|1461*u/4)+(0|367*(t-2-12*l)/12)-(0|3*((u+100)/100)/4)+r-32075;n-=12,0>n&&(n+=24);var h=a+(n*i.SECONDS_PER_HOUR+o*i.SECONDS_PER_MINUTE+s*i.SECONDS_PER_MILLISECOND);return h>=43200&&(c-=1),[c,h]}function h(e){return c(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())}var d=function(e,t,i,r,n,o,a,s){this.year=e,this.month=t,this.day=i,this.hour=r,this.minute=n,this.second=o,this.millisecond=a,this.isLeapSecond=s},m=[31,28,31,30,31,30,31,31,30,31,30,31],p=29,f={julianDate:void 0},v=/^(\d{4})$/,g=/^(\d{4})-(\d{2})$/,_=/^(\d{4})-?(\d{3})$/,y=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,w=/^(\d{4})-?(\d{2})-?(\d{2})$/,C=/([Z+\-])?(\d{2})?:?(\d{2})?$/,x=/^(\d{2})(\.\d+)?/.source+C.source,T=/^(\d{2}):?(\d{2})(\.\d+)?/.source+C.source,S=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+C.source,E="Valid ISO 8601 date string required.",b=function(t,r,o){this._julianDayNumber=void 0,this._secondsOfDay=void 0;var a,l;if(t!==void 0||r!==void 0||o!==void 0){if(o===void 0)o=n.UTC;else if(o!==n.UTC&&o!==n.TAI)throw new e("timeStandard is not a known TimeStandard.");if(null===t||isNaN(t))throw new e("julianDayNumber is required.");if(null===r||isNaN(r))throw new e("julianSecondsOfDay is required.");a=0|t,l=r+(t-a)*i.SECONDS_PER_DAY}else{var c=new Date,d=h(c);a=d[0],l=d[1],o=n.UTC}u(a,l,this),o===n.UTC&&s(this)};b.clone=function(t,i){if(t===void 0)throw new e("date is required.");return i===void 0?new b(t._julianDayNumber,t._secondsOfDay,n.TAI):(i._julianDayNumber=t._julianDayNumber,i._secondsOfDay=t._secondsOfDay,i)},b.fromDate=function(t,i){if(t===void 0||null===t||isNaN(t.getTime()))throw new e("date must be a valid JavaScript Date.");var r=h(t);return new b(r[0],r[1],i)},b.fromIso8601=function(t){if("string"!=typeof t)throw new e(E);t=t.replace(",",".");var i,r,a,s=t.split("T"),l=1,u=1,h=0,d=0,f=0,C=0,M=s[0],I=s[1];if(M===void 0)throw new e(E);var D;if(s=M.match(w),null!==s){if(D=M.split("-").length-1,D>0&&2!==D)throw new e(E);i=+s[1],l=+s[2],u=+s[3]}else if(s=M.match(g),null!==s)i=+s[1],l=+s[2];else if(s=M.match(v),null!==s)i=+s[1];else{var A;if(s=M.match(_),null!==s){if(i=+s[1],A=+s[2],a=o(i),1>A||a&&A>366||!a&&A>365)throw new e(E)}else{if(s=M.match(y),null===s)throw new e(E);i=+s[1];var P=+s[2],R=+s[3]||0;if(D=M.split("-").length-1,D>0&&(s[3]===void 0&&1!==D||s[3]!==void 0&&2!==D))throw new e(E);var O=new Date(Date.UTC(i,0,4));A=7*P+R-O.getUTCDay()-3}r=new Date(Date.UTC(i,0,1)),r.setUTCDate(A),l=r.getUTCMonth()+1,u=r.getUTCDate()}if(a=o(i),1>l||l>12||1>u||(2!==l||!a)&&u>m[l-1]||a&&2===l&&u>p)throw new e(E);var z;if(I!==void 0){if(s=I.match(S),null!==s){if(D=I.split(":").length-1,D>0&&2!==D)throw new e(E);h=+s[1],d=+s[2],f=+s[3],C=1e3*+(s[4]||0),z=5}else if(s=I.match(T),null!==s){if(D=I.split(":").length-1,D>0&&1!==D)throw new e(E);h=+s[1],d=+s[2],f=60*+(s[3]||0),z=4}else{if(s=I.match(x),null===s)throw new e(E);h=+s[1],d=60*+(s[2]||0),z=3}if(d>=60||f>=61||h>24||24===h&&(d>0||f>0||C>0))throw new e(E);var L=s[z],N=+s[z+1],V=+(s[z+2]||0);switch(L){case"+":h-=N,d-=V;break;case"-":h+=N,d+=V;break;case"Z":break;default:d+=new Date(Date.UTC(i,l-1,u,h,d)).getTimezoneOffset()}}else d+=new Date(Date.UTC(i,l-1,u)).getTimezoneOffset();var B=60===f;for(B&&f--;d>=60;)d-=60,h++;for(;h>=24;)h-=24,u++;for(r=a&&2===l?p:m[l-1];u>r;)u-=r,l++,l>12&&(l-=12,i++),r=a&&2===l?p:m[l-1];for(;0>d;)d+=60,h--;for(;0>h;)h+=24,u--;for(;1>u;)l--,1>l&&(l+=12,i--),r=a&&2===l?p:m[l-1],u+=r;var F=c(i,l,u,h,d,f,C),q=new b(F[0],F[1],n.UTC);return B&&q.addSeconds(1,q),q},b.fromTotalDays=function(t,i){if(null===t||isNaN(t))throw new e("totalDays is required.");return new b(t,0,i)},b.compare=function(e,t){var i=e._julianDayNumber-t._julianDayNumber;return 0!==i?i:e._secondsOfDay-t._secondsOfDay},b.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e._julianDayNumber===t._julianDayNumber&&e._secondsOfDay===t._secondsOfDay},b.prototype.clone=function(e){return b.clone(this,e)},b.prototype.getTotalDays=function(){return this._julianDayNumber+this._secondsOfDay/i.SECONDS_PER_DAY},b.prototype.getJulianDayNumber=function(){return this._julianDayNumber},b.prototype.getJulianTimeFraction=function(){return this._secondsOfDay/i.SECONDS_PER_DAY},b.prototype.getSecondsOfDay=function(){return this._secondsOfDay};var M=new b(0,0,n.TAI);return b.prototype.toGregorianDate=function(){var e=!1,t=l(this,M);t===void 0&&(this.addSeconds(-1,M),t=l(M,M),e=!0);var r=t._julianDayNumber,n=t._secondsOfDay;n>=43200&&(r+=1);var o=0|r+68569,a=0|4*o/146097;o=0|o-(0|(146097*a+3)/4);var s=0|4e3*(o+1)/1461001;o=0|o-(0|1461*s/4)+31;var u=0|80*o/2447,c=0|o-(0|2447*u/80);o=0|u/11;var h=0|u+2-12*o,m=0|100*(a-49)+s+o,p=0|n/i.SECONDS_PER_HOUR,f=n-p*i.SECONDS_PER_HOUR,v=0|f/i.SECONDS_PER_MINUTE;f-=v*i.SECONDS_PER_MINUTE;var g=0|f,_=(f-g)/i.SECONDS_PER_MILLISECOND;return p+=12,p>23&&(p-=24),e&&(g+=1),new d(m,h,c,p,v,g,_,e)},b.prototype.toDate=function(){var e=this.toGregorianDate(),t=e.second;return e.isLeapSecond&&(t-=1),new Date(Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,t,e.millisecond))},b.prototype.toIso8601=function(e){var t,i=this.toGregorianDate();return e===void 0&&0!==i.millisecond?(t=(""+.01*i.millisecond).replace(".",""),a("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",i.year,i.month,i.day,i.hour,i.minute,i.second,t)):e===void 0||0===e?a("%04d-%02d-%02dT%02d:%02d:%02dZ",i.year,i.month,i.day,i.hour,i.minute,i.second):(t=(.01*i.millisecond).toFixed(e).replace(".","").slice(0,e),a("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",i.year,i.month,i.day,i.hour,i.minute,i.second,t))},b.prototype.getSecondsDifference=function(e){var t=this,r=e,n=(r._julianDayNumber-t._julianDayNumber)*i.SECONDS_PER_DAY;return n+(r._secondsOfDay-t._secondsOfDay)},b.prototype.getMinutesDifference=function(e){return this.getSecondsDifference(e)/i.SECONDS_PER_MINUTE},b.prototype.getDaysDifference=function(e){var t=this,r=e,n=r._julianDayNumber-t._julianDayNumber,o=(r._secondsOfDay-t._secondsOfDay)/i.SECONDS_PER_DAY;return n+o},b.prototype.getTaiMinusUtc=function(){f.julianDate=this;var e=r.getLeapSeconds(),i=t(e,f,r.compareLeapSecondDate);return 0>i&&(i=~i,--i,0>i&&(i=0)),e[i].offset},b.prototype.addSeconds=function(t,i){if(null===t||isNaN(t))throw new e("seconds is required and must be a number.");return u(this._julianDayNumber,this._secondsOfDay+t,i)},b.prototype.addMinutes=function(t){if(null===t||isNaN(t))throw new e("duration is required and must be a number.");var r=this._secondsOfDay+t*i.SECONDS_PER_MINUTE;return new b(this._julianDayNumber,r,n.TAI)},b.prototype.addHours=function(t){if(null===t||isNaN(t))throw new e("duration is required and must be a number.");var r=this._secondsOfDay+t*i.SECONDS_PER_HOUR;return new b(this._julianDayNumber,r,n.TAI)},b.prototype.addDays=function(t){if(null===t||isNaN(t))throw new e("duration is required and must be a number.");var i=this._julianDayNumber+t;return new b(i,this._secondsOfDay,n.TAI)},b.prototype.lessThan=function(e){return 0>b.compare(this,e)},b.prototype.lessThanOrEquals=function(e){return 0>=b.compare(this,e)},b.prototype.greaterThan=function(e){return b.compare(this,e)>0},b.prototype.greaterThanOrEquals=function(e){return b.compare(this,e)>=0},b.prototype.compareTo=function(e){return b.compare(this,e)},b.prototype.equals=function(e){return b.equals(this,e)},b.prototype.equalsEpsilon=function(t,i){if(null===i||isNaN(i))throw new e("epsilon is required and must be number.");return i>=Math.abs(this.getSecondsDifference(t))},0===r._leapSeconds.length&&(r._leapSeconds=[new r(new b(2441317,43210,n.TAI),10),new r(new b(2441499,43211,n.TAI),11),new r(new b(2441683,43212,n.TAI),12),new r(new b(2442048,43213,n.TAI),13),new r(new b(2442413,43214,n.TAI),14),new r(new b(2442778,43215,n.TAI),15),new r(new b(2443144,43216,n.TAI),16),new r(new b(2443509,43217,n.TAI),17),new r(new b(2443874,43218,n.TAI),18),new r(new b(2444239,43219,n.TAI),19),new r(new b(2444786,43220,n.TAI),20),new r(new b(2445151,43221,n.TAI),21),new r(new b(2445516,43222,n.TAI),22),new r(new b(2446247,43223,n.TAI),23),new r(new b(2447161,43224,n.TAI),24),new r(new b(2447892,43225,n.TAI),25),new r(new b(2448257,43226,n.TAI),26),new r(new b(2448804,43227,n.TAI),27),new r(new b(2449169,43228,n.TAI),28),new r(new b(2449534,43229,n.TAI),29),new r(new b(2450083,43230,n.TAI),30),new r(new b(2450630,43231,n.TAI),31),new r(new b(2451179,43232,n.TAI),32),new r(new b(2453736,43233,n.TAI),33),new r(new b(2454832,43234,n.TAI),34),new r(new b(2456109,43235,n.TAI),35)]),b}),i("Core/ClockStep",["./Enumeration"],function(e){var t={TICK_DEPENDENT:new e(0,"TICK_DEPENDENT"),SYSTEM_CLOCK_MULTIPLIER:new e(1,"SYSTEM_CLOCK_MULTIPLIER"),SYSTEM_CLOCK:new e(2,"SYSTEM_CLOCK")};return t}),i("Core/ClockRange",["./Enumeration"],function(e){var t={UNBOUNDED:new e(0,"UNBOUNDED"),CLAMPED:new e(1,"CLAMPED"),LOOP_STOP:new e(2,"LOOP_STOP")};return t}),i("Core/Event",["./DeveloperError"],function(e){var t=function(){this._listeners=[],this._scopes=[]};return t.prototype.getNumberOfListeners=function(){return this._listeners.length},t.prototype.addEventListener=function(t,i){if("function"!=typeof t)throw new e("listener is required and must be a function.");this._listeners.push(t),this._scopes.push(i)},t.prototype.removeEventListener=function(t,i){if("function"!=typeof t)throw new e("listener is required and must be a function.");for(var r=this._listeners,n=this._scopes,o=-1,a=0;r.length>a;a++)if(r[a]===t&&n[a]===i){o=a;break}if(-1===o)throw new e("listener is not subscribed.");r.splice(o,1),this._scopes.splice(o,1)},t.prototype.raiseEvent=function(){for(var e=this._listeners,t=this._scopes,i=e.length-1;i>-1;i--)e[i].apply(t[i],arguments)},t}),i("Core/Clock",["./DeveloperError","./JulianDate","./ClockStep","./ClockRange","./Event","./defaultValue"],function(e,t,i,r,n,o){var a=function(a){a=o(a,o.EMPTY_OBJECT);var s=a.startTime,l=s===void 0,u=a.stopTime,c=u===void 0,h=a.currentTime,d=h===void 0;if(l&&c&&d?(h=new t,s=h.clone(),u=h.addDays(1)):l&&c?(s=h.clone(),u=h.addDays(1)):l&&d?(s=u.addDays(-1),h=s.clone()):d&&c?(h=s.clone(),u=s.addDays(1)):d?h=s.clone():c?u=h.addDays(1):l&&(s=h.clone()),s.greaterThan(u))throw new e("startTime must come before stopTime.");this.startTime=s,this.stopTime=u,this.currentTime=h,this.multiplier=o(a.multiplier,1),this.clockStep=o(a.clockStep,i.SYSTEM_CLOCK_MULTIPLIER),this.clockRange=o(a.clockRange,r.UNBOUNDED),this.shouldAnimate=o(a.shouldAnimate,!0),this.onTick=new n,this._lastSystemTime=Date.now()};return a.prototype.tick=function(e){var n,o=Date.now();if(this.clockStep===i.SYSTEM_CLOCK)n=new t;else{var a=this.startTime,s=this.stopTime,l=this.multiplier,u=this.shouldAnimate;if(n=this.currentTime,e!==void 0)n=n.addSeconds(e);else if(u)if(this.clockStep===i.TICK_DEPENDENT)n=n.addSeconds(l);else{var c=o-this._lastSystemTime;n=n.addSeconds(l*(c/1e3))}if(this.clockRange===r.CLAMPED)n.lessThan(a)?n=a:n.greaterThan(s)&&(n=s);else if(this.clockRange===r.LOOP_STOP)for(n.lessThan(a)&&(n=a.clone());n.greaterThan(s);)n=a.addSeconds(s.getSecondsDifference(n))}return this.currentTime=n,this._lastSystemTime=o,this.onTick.raiseEvent(this),n},a}),i("Core/Color",["./defaultValue","./freezeObject","./DeveloperError"],function(e,t,i){function r(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var n=function(t,i,r,n){this.red=e(t,1),this.green=e(i,1),this.blue=e(r,1),this.alpha=e(n,1)};n.fromBytes=function(t,i,r,o){return t=n.byteToFloat(e(t,255)),i=n.byteToFloat(e(i,255)),r=n.byteToFloat(e(r,255)),o=n.byteToFloat(e(o,255)),new n(t,i,r,o)};var o,a,s;"undefined"!=typeof ArrayBuffer&&(o=new ArrayBuffer(4),a=new Uint32Array(o),s=new Uint8Array(o)),n.fromRgba=function(e){return a[0]=e,n.fromBytes(s[0],s[1],s[2],s[3])},n.fromHsl=function(t,i,o,a){t=e(t,0)%1,i=e(i,0),o=e(o,0),a=e(a,1);var s=o,l=o,u=o;if(0!==i){var c;c=.5>o?o*(1+i):o+i-o*i;var h=2*o-c;s=r(h,c,t+1/3),l=r(h,c,t),u=r(h,c,t-1/3)}return new n(s,l,u,a)};var l=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,u=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,c=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,h=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;return n.fromCssColorString=function(t){if(t===void 0)throw new i("color is required");var r=n[t.toUpperCase()];if(r!==void 0)return r.clone();var o=l.exec(t);return null!==o?new n(parseInt(o[1],16)/15,parseInt(o[2],16)/15,parseInt(o[3],16)/15):(o=u.exec(t),null!==o?new n(parseInt(o[1],16)/255,parseInt(o[2],16)/255,parseInt(o[3],16)/255):(o=c.exec(t),null!==o?new n(parseFloat(o[1])/("%"===o[1].substr(-1)?100:255),parseFloat(o[2])/("%"===o[2].substr(-1)?100:255),parseFloat(o[3])/("%"===o[3].substr(-1)?100:255),parseFloat(e(o[4],"1.0"))):(o=h.exec(t),null!==o?n.fromHsl(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,parseFloat(e(o[4],"1.0"))):void 0)))},n.byteToFloat=function(e){return e/255},n.floatToByte=function(e){return 1===e?255:0|256*e},n.clone=function(e,t){return t===void 0?new n(e.red,e.green,e.blue,e.alpha):(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},n.prototype.clone=function(e){return n.clone(this,e)},n.prototype.equals=function(e){return n.equals(this,e)},n.prototype.equalsEpsilon=function(e,t){return this===e||e!==void 0&&t>=Math.abs(this.red-e.red)&&t>=Math.abs(this.green-e.green)&&t>=Math.abs(this.blue-e.blue)&&t>=Math.abs(this.alpha-e.alpha)},n.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},n.prototype.toCssColorString=function(){var e=n.floatToByte(this.red),t=n.floatToByte(this.green),i=n.floatToByte(this.blue);return 1===this.alpha?"rgb("+e+","+t+","+i+")":"rgba("+e+","+t+","+i+","+this.alpha+")"},n.prototype.toBytes=function(){var e=n.floatToByte(this.red),t=n.floatToByte(this.green),i=n.floatToByte(this.blue),r=n.floatToByte(this.alpha);return[e,t,i,r]},n.prototype.toRgba=function(){return s[0]=n.floatToByte(this.red),s[1]=n.floatToByte(this.green),s[2]=n.floatToByte(this.blue),s[3]=n.floatToByte(this.alpha),a[0]},n.ALICEBLUE=t(n.fromCssColorString("#F0F8FF")),n.ANTIQUEWHITE=t(n.fromCssColorString("#FAEBD7")),n.AQUA=t(n.fromCssColorString("#00FFFF")),n.AQUAMARINE=t(n.fromCssColorString("#7FFFD4")),n.AZURE=t(n.fromCssColorString("#F0FFFF")),n.BEIGE=t(n.fromCssColorString("#F5F5DC")),n.BISQUE=t(n.fromCssColorString("#FFE4C4")),n.BLACK=t(n.fromCssColorString("#000000")),n.BLANCHEDALMOND=t(n.fromCssColorString("#FFEBCD")),n.BLUE=t(n.fromCssColorString("#0000FF")),n.BLUEVIOLET=t(n.fromCssColorString("#8A2BE2")),n.BROWN=t(n.fromCssColorString("#A52A2A")),n.BURLYWOOD=t(n.fromCssColorString("#DEB887")),n.CADETBLUE=t(n.fromCssColorString("#5F9EA0")),n.CHARTREUSE=t(n.fromCssColorString("#7FFF00")),n.CHOCOLATE=t(n.fromCssColorString("#D2691E")),n.CORAL=t(n.fromCssColorString("#FF7F50")),n.CORNFLOWERBLUE=t(n.fromCssColorString("#6495ED")),n.CORNSILK=t(n.fromCssColorString("#FFF8DC")),n.CRIMSON=t(n.fromCssColorString("#DC143C")),n.CYAN=t(n.fromCssColorString("#00FFFF")),n.DARKBLUE=t(n.fromCssColorString("#00008B")),n.DARKCYAN=t(n.fromCssColorString("#008B8B")),n.DARKGOLDENROD=t(n.fromCssColorString("#B8860B")),n.DARKGRAY=t(n.fromCssColorString("#A9A9A9")),n.DARKGREEN=t(n.fromCssColorString("#006400")),n.DARKGREY=n.DARKGRAY,n.DARKKHAKI=t(n.fromCssColorString("#BDB76B")),n.DARKMAGENTA=t(n.fromCssColorString("#8B008B")),n.DARKOLIVEGREEN=t(n.fromCssColorString("#556B2F")),n.DARKORANGE=t(n.fromCssColorString("#FF8C00")),n.DARKORCHID=t(n.fromCssColorString("#9932CC")),n.DARKRED=t(n.fromCssColorString("#8B0000")),n.DARKSALMON=t(n.fromCssColorString("#E9967A")),n.DARKSEAGREEN=t(n.fromCssColorString("#8FBC8F")),n.DARKSLATEBLUE=t(n.fromCssColorString("#483D8B")),n.DARKSLATEGRAY=t(n.fromCssColorString("#2F4F4F")),n.DARKSLATEGREY=n.DARKSLATEGRAY,n.DARKTURQUOISE=t(n.fromCssColorString("#00CED1")),n.DARKVIOLET=t(n.fromCssColorString("#9400D3")),n.DEEPPINK=t(n.fromCssColorString("#FF1493")),n.DEEPSKYBLUE=t(n.fromCssColorString("#00BFFF")),n.DIMGRAY=t(n.fromCssColorString("#696969")),n.DIMGREY=n.DIMGRAY,n.DODGERBLUE=t(n.fromCssColorString("#1E90FF")),n.FIREBRICK=t(n.fromCssColorString("#B22222")),n.FLORALWHITE=t(n.fromCssColorString("#FFFAF0")),n.FORESTGREEN=t(n.fromCssColorString("#228B22")),n.FUSCHIA=t(n.fromCssColorString("#FF00FF")),n.GAINSBORO=t(n.fromCssColorString("#DCDCDC")),n.GHOSTWHITE=t(n.fromCssColorString("#F8F8FF")),n.GOLD=t(n.fromCssColorString("#FFD700")),n.GOLDENROD=t(n.fromCssColorString("#DAA520")),n.GRAY=t(n.fromCssColorString("#808080")),n.GREEN=t(n.fromCssColorString("#008000")),n.GREENYELLOW=t(n.fromCssColorString("#ADFF2F")),n.GREY=n.GRAY,n.HONEYDEW=t(n.fromCssColorString("#F0FFF0")),n.HOTPINK=t(n.fromCssColorString("#FF69B4")),n.INDIANRED=t(n.fromCssColorString("#CD5C5C")),n.INDIGO=t(n.fromCssColorString("#4B0082")),n.IVORY=t(n.fromCssColorString("#FFFFF0")),n.KHAKI=t(n.fromCssColorString("#F0E68C")),n.LAVENDER=t(n.fromCssColorString("#E6E6FA")),n.LAVENDAR_BLUSH=t(n.fromCssColorString("#FFF0F5")),n.LAWNGREEN=t(n.fromCssColorString("#7CFC00")),n.LEMONCHIFFON=t(n.fromCssColorString("#FFFACD")),n.LIGHTBLUE=t(n.fromCssColorString("#ADD8E6")),n.LIGHTCORAL=t(n.fromCssColorString("#F08080")),n.LIGHTCYAN=t(n.fromCssColorString("#E0FFFF")),n.LIGHTGOLDENRODYELLOW=t(n.fromCssColorString("#FAFAD2")),n.LIGHTGRAY=t(n.fromCssColorString("#D3D3D3")),n.LIGHTGREEN=t(n.fromCssColorString("#90EE90")),n.LIGHTGREY=n.LIGHTGRAY,n.LIGHTPINK=t(n.fromCssColorString("#FFB6C1")),n.LIGHTSEAGREEN=t(n.fromCssColorString("#20B2AA")),n.LIGHTSKYBLUE=t(n.fromCssColorString("#87CEFA")),n.LIGHTSLATEGRAY=t(n.fromCssColorString("#778899")),n.LIGHTSLATEGREY=n.LIGHTSLATEGRAY,n.LIGHTSTEELBLUE=t(n.fromCssColorString("#B0C4DE")),n.LIGHTYELLOW=t(n.fromCssColorString("#FFFFE0")),n.LIME=t(n.fromCssColorString("#00FF00")),n.LIMEGREEN=t(n.fromCssColorString("#32CD32")),n.LINEN=t(n.fromCssColorString("#FAF0E6")),n.MAGENTA=t(n.fromCssColorString("#FF00FF")),n.MAROON=t(n.fromCssColorString("#800000")),n.MEDIUMAQUAMARINE=t(n.fromCssColorString("#66CDAA")),n.MEDIUMBLUE=t(n.fromCssColorString("#0000CD")),n.MEDIUMORCHID=t(n.fromCssColorString("#BA55D3")),n.MEDIUMPURPLE=t(n.fromCssColorString("#9370DB")),n.MEDIUMSEAGREEN=t(n.fromCssColorString("#3CB371")),n.MEDIUMSLATEBLUE=t(n.fromCssColorString("#7B68EE")),n.MEDIUMSPRINGGREEN=t(n.fromCssColorString("#00FA9A")),n.MEDIUMTURQUOISE=t(n.fromCssColorString("#48D1CC")),n.MEDIUMVIOLETRED=t(n.fromCssColorString("#C71585")),n.MIDNIGHTBLUE=t(n.fromCssColorString("#191970")),n.MINTCREAM=t(n.fromCssColorString("#F5FFFA")),n.MISTYROSE=t(n.fromCssColorString("#FFE4E1")),n.MOCCASIN=t(n.fromCssColorString("#FFE4B5")),n.NAVAJOWHITE=t(n.fromCssColorString("#FFDEAD")),n.NAVY=t(n.fromCssColorString("#000080")),n.OLDLACE=t(n.fromCssColorString("#FDF5E6")),n.OLIVE=t(n.fromCssColorString("#808000")),n.OLIVEDRAB=t(n.fromCssColorString("#6B8E23")),n.ORANGE=t(n.fromCssColorString("#FFA500")),n.ORANGERED=t(n.fromCssColorString("#FF4500")),n.ORCHID=t(n.fromCssColorString("#DA70D6")),n.PALEGOLDENROD=t(n.fromCssColorString("#EEE8AA")),n.PALEGREEN=t(n.fromCssColorString("#98FB98")),n.PALETURQUOISE=t(n.fromCssColorString("#AFEEEE")),n.PALEVIOLETRED=t(n.fromCssColorString("#DB7093")),n.PAPAYAWHIP=t(n.fromCssColorString("#FFEFD5")),n.PEACHPUFF=t(n.fromCssColorString("#FFDAB9")),n.PERU=t(n.fromCssColorString("#CD853F")),n.PINK=t(n.fromCssColorString("#FFC0CB")),n.PLUM=t(n.fromCssColorString("#DDA0DD")),n.POWDERBLUE=t(n.fromCssColorString("#B0E0E6")),n.PURPLE=t(n.fromCssColorString("#800080")),n.RED=t(n.fromCssColorString("#FF0000")),n.ROSYBROWN=t(n.fromCssColorString("#BC8F8F")),n.ROYALBLUE=t(n.fromCssColorString("#4169E1")),n.SADDLEBROWN=t(n.fromCssColorString("#8B4513")),n.SALMON=t(n.fromCssColorString("#FA8072")),n.SANDYBROWN=t(n.fromCssColorString("#F4A460")),n.SEAGREEN=t(n.fromCssColorString("#2E8B57")),n.SEASHELL=t(n.fromCssColorString("#FFF5EE")),n.SIENNA=t(n.fromCssColorString("#A0522D")),n.SILVER=t(n.fromCssColorString("#C0C0C0")),n.SKYBLUE=t(n.fromCssColorString("#87CEEB")),n.SLATEBLUE=t(n.fromCssColorString("#6A5ACD")),n.SLATEGRAY=t(n.fromCssColorString("#708090")),n.SLATEGREY=n.SLATEGRAY,n.SNOW=t(n.fromCssColorString("#FFFAFA")),n.SPRINGGREEN=t(n.fromCssColorString("#00FF7F")),n.STEELBLUE=t(n.fromCssColorString("#4682B4")),n.TAN=t(n.fromCssColorString("#D2B48C")),n.TEAL=t(n.fromCssColorString("#008080")),n.THISTLE=t(n.fromCssColorString("#D8BFD8")),n.TOMATO=t(n.fromCssColorString("#FF6347")),n.TURQUOISE=t(n.fromCssColorString("#40E0D0")),n.VIOLET=t(n.fromCssColorString("#EE82EE")),n.WHEAT=t(n.fromCssColorString("#F5DEB3")),n.WHITE=t(n.fromCssColorString("#FFFFFF")),n.WHITESMOKE=t(n.fromCssColorString("#F5F5F5")),n.YELLOW=t(n.fromCssColorString("#FFFF00")),n.YELLOWGREEN=t(n.fromCssColorString("#9ACD32")),n
}),i("Core/CubeMapEllipsoidTessellator",["./defaultValue","./DeveloperError","./Cartesian3","./ComponentDatatype","./PrimitiveType"],function(e,t,i,r,n){var o={};return o.compute=function(o,a,s){function l(e,t){var i=[];i[0]=e,i[2+(a-1)-1]=t;for(var r=c[e],n=c[t].subtract(c[e]),o=1;a>o;++o){var s=o/a;i[o]=c.length,c.push(r.add(n.multiplyByScalar(s)))}return i}function u(e,t,i,r){for(var n=c[t[0]],o=c[t[t.length-1]].subtract(n),s=c[r[0]].subtract(n),l=[],u=[],d=t,m=u,p=1;a>=p;++p){if(p!==a){1!==p&&(l=u.slice(0),d=l),u[0]=e[p],u[a]=i[p];for(var f=p/a,v=s.multiplyByScalar(f),g=1;a>g;++g){var _=g/a,y=o.multiplyByScalar(_);u[g]=c.length,c.push(n.add(y).add(v))}}else 1!==p&&(d=u),m=r;for(var w=0;a>w;++w)h.push(d[w]),h.push(d[w+1]),h.push(m[w+1]),h.push(d[w]),h.push(m[w+1]),h.push(m[w])}}if(0>=a)throw new t("numberOfPartitions must be greater than zero.");s=e(s,"position");var c=[],h=[];c.push(new i(-1,0,-1)),c.push(new i(0,-1,-1)),c.push(new i(1,0,-1)),c.push(new i(0,1,-1)),c.push(new i(-1,0,1)),c.push(new i(0,-1,1)),c.push(new i(1,0,1)),c.push(new i(0,1,1));var d=l(0,1),m=l(1,2),p=l(2,3),f=l(3,0),v=l(4,5),g=l(5,6),_=l(6,7),y=l(7,4),w=l(0,4),C=l(1,5),x=l(2,6),T=l(3,7);u(w,d,C,v),u(C,m,x,g),u(x,p,T,_),u(T,f,w,y),u(y.slice(0).reverse(),v,g,_.slice(0).reverse()),u(m,d.slice(0).reverse(),f.slice(0).reverse(),p);for(var S=o.getRadii(),E=c.length,b=0,M=Array(3*E),I=0;E>I;++I){var D=c[I];i.normalize(D,D),i.multiplyComponents(D,S,D),M[b++]=D.x,M[b++]=D.y,M[b++]=D.z}var A={};return A.attributes={},A.indexLists=[],A.attributes[s]={componentDatatype:r.FLOAT,componentsPerAttribute:3,values:M},A.indexLists.push({primitiveType:n.TRIANGLES,values:h}),A},o}),i("Core/QuadraticRealPolynomial",["./DeveloperError","./Math"],function(e,t){function i(e,i,r){var n=e+i;return t.sign(e)!==t.sign(i)&&r>Math.abs(n/Math.max(Math.abs(e),Math.abs(i)))?0:n}var r={};return r.discriminant=function(t,i,r){if("number"!=typeof t)throw new e("a is a required number.");if("number"!=typeof i)throw new e("b is a required number.");if("number"!=typeof r)throw new e("c is a required number.");var n=i*i-4*t*r;return n},r.realRoots=function(r,n,o){if("number"!=typeof r)throw new e("a is a required number.");if("number"!=typeof n)throw new e("b is a required number.");if("number"!=typeof o)throw new e("c is a required number.");var a;if(0===r)return 0===n?[]:[-o/n];if(0===n){if(0===o)return[0,0];var s=Math.abs(o),l=Math.abs(r);if(l>s&&t.EPSILON14>s/l)return[0,0];if(s>l&&t.EPSILON14>l/s)return[];if(a=-o/r,0>a)return[];var u=Math.sqrt(a);return[-u,u]}if(0===o)return a=-n/r,0>a?[a,0]:[0,a];var c=n*n,h=4*r*o,d=i(c,-h,t.EPSILON14);if(0>d)return[];var m=-.5*i(n,t.sign(n)*Math.sqrt(d),t.EPSILON14);return n>0?[m/r,o/m]:[o/m,m/r]},r}),i("Core/CubicRealPolynomial",["./DeveloperError","./Math","./QuadraticRealPolynomial"],function(e,t,i){function r(e,t,i,r){var n,o,a=e,s=t/3,l=i/3,u=r,c=a*l,h=s*u,d=s*s,m=l*l,p=a*l-d,f=a*u-s*l,v=s*u-m,g=4*p*v-f*f;if(0>g){var _,y,w;d*h>=c*m?(_=a,y=p,w=-2*s*p+a*f):(_=u,y=v,w=-u*f+2*l*v);var C=0>w?-1:1,x=-C*Math.abs(_)*Math.sqrt(-g);o=-w+x;var T=o/2,S=0>T?-Math.pow(-T,1/3):Math.pow(T,1/3),E=o===x?-S:-y/S;return n=0>=y?S+E:-w/(S*S+E*E+y),d*h>=c*m?[(n-s)/a]:[-u/(n+l)]}var b=p,M=-2*s*p+a*f,I=v,D=-u*f+2*l*v,A=Math.sqrt(g),P=Math.sqrt(3)/2,R=Math.abs(Math.atan2(a*A,-M)/3);n=2*Math.sqrt(-b);var O=Math.cos(R);o=n*O;var z=n*(-O/2-P*Math.sin(R)),L=o+z>2*s?o-s:z-s,N=a,V=L/N;R=Math.abs(Math.atan2(u*A,-D)/3),n=2*Math.sqrt(-I),O=Math.cos(R),o=n*O,z=n*(-O/2-P*Math.sin(R));var B=-u,F=2*l>o+z?o+l:z+l,q=B/F,U=N*F,k=-L*F-N*B,W=L*B,H=(l*k-s*W)/(-s*k+l*U);return H>=V?q>=V?q>=H?[V,H,q]:[V,q,H]:[q,V,H]:q>=V?[H,V,q]:q>=H?[H,q,V]:[q,H,V]}var n={};return n.discriminant=function(t,i,r,n){if("number"!=typeof t)throw new e("a is a required number.");if("number"!=typeof i)throw new e("b is a required number.");if("number"!=typeof r)throw new e("c is a required number.");if("number"!=typeof n)throw new e("d is a required number.");var o=t*t,a=i*i,s=r*r,l=n*n,u=18*t*i*r*n+a*s-27*o*l-4*(t*s*r+a*i*n);return u},n.realRoots=function(t,n,o,a){if("number"!=typeof t)throw new e("a is a required number.");if("number"!=typeof n)throw new e("b is a required number.");if("number"!=typeof o)throw new e("c is a required number.");if("number"!=typeof a)throw new e("d is a required number.");var s,l;if(0===t)return i.realRoots(n,o,a);if(0===n){if(0===o){if(0===a)return[0,0,0];l=-a/t;var u=0>l?-Math.pow(-l,1/3):Math.pow(l,1/3);return[u,u,u]}return 0===a?(s=i.realRoots(t,0,o),0===s.Length?[0]:[s[0],0,s[1]]):r(t,0,o,a)}return 0===o?0===a?(l=-n/t,0>l?[l,0,0]:[0,0,l]):r(t,n,0,a):0===a?(s=i.realRoots(t,n,o),0===s.length?[0]:0>=s[1]?[s[0],s[1],0]:s[0]>=0?[0,s[0],s[1]]:[s[0],0,s[1]]):r(t,n,o,a)},n}),i("Core/DefaultProxy",[],function(){var e=function(e){this.proxy=e};return e.prototype.getURL=function(e){return this.proxy+"?"+encodeURIComponent(e)},e}),i("Core/clone",["./defaultValue"],function(e){var t=function(i,r){if(null===i||"object"!=typeof i)return i;r=e(r,!1);var n=new i.constructor;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];r&&(a=t(a,r)),n[o]=a}return n};return t}),i("Core/RequestErrorEvent",[],function(){var e=function e(e,t){this.statusCode=e,this.response=t};return e}),function(e){e("ThirdParty/when",[],function(){function e(e,i,r,n){return t(e).then(i,r,n)}function t(e){var t,i;return e instanceof r?t=e:s(e)?(i=a(),e.then(function(e){i.resolve(e)},function(e){i.reject(e)},function(e){i.progress(e)}),t=i.promise):t=n(e),t}function i(t){return e(t,o)}function r(e){this.then=e}function n(e){var i=new r(function(i){try{return t(i?i(e):e)}catch(r){return o(r)}});return i}function o(e){var i=new r(function(i,r){try{return r?t(r(e)):o(e)}catch(n){return o(n)}});return i}function a(){function e(e,t,i){return d(e,t,i)}function i(e){return p(e)}function n(e){return p(o(e))}function s(e){return m(e)}var l,u,c,h,d,m,p;return u=new r(e),l={then:e,resolve:i,reject:n,progress:s,promise:u,resolver:{resolve:i,reject:n,progress:s}},c=[],h=[],d=function(e,t,i){var r,n;return r=a(),n="function"==typeof i?function(e){try{r.progress(i(e))}catch(t){r.progress(t)}}:function(e){r.progress(e)},c.push(function(i){i.then(e,t).then(r.resolve,r.reject,n)}),h.push(n),r.promise},m=function(e){return f(h,e),e},p=function(e){return e=t(e),d=e.then,p=t,m=g,f(c,e),h=c=C,e},l}function s(e){return e&&"function"==typeof e.then}function l(t,i,r,n,o){return v(2,arguments),e(t,function(t){function s(e){f(e)}function l(e){p(e)}var u,c,h,d,m,p,f,v,_,y;if(_=t.length>>>0,u=Math.max(0,Math.min(i,_)),h=[],c=_-u+1,d=[],m=a(),u)for(v=m.progress,f=function(e){d.push(e),--c||(p=f=g,m.reject(d))},p=function(e){h.push(e),--u||(p=f=g,m.resolve(h))},y=0;_>y;++y)y in t&&e(t[y],l,s,v);else m.resolve(h);return m.then(r,n,o)})}function u(e,t,i,r){function n(e){return t?t(e[0]):e[0]}return l(e,1,n,i,r)}function c(e,t,i,r){return v(1,arguments),d(e,_).then(t,i,r)}function h(){return d(arguments,_)}function d(t,i){return e(t,function(t){var r,n,o,s,l,u;if(o=n=t.length>>>0,r=[],u=a(),o)for(s=function(t,n){e(t,i).then(function(e){r[n]=e,--o||u.resolve(r)},u.reject)},l=0;n>l;l++)l in t?s(t[l],l):--o;else u.resolve(r);return u.promise})}function m(t,i){var r=w.call(arguments,1);return e(t,function(t){var n;return n=t.length,r[0]=function(t,r,o){return e(t,function(t){return e(r,function(e){return i(t,e,o,n)})})},y.apply(t,r)})}function p(t,i,r){var n=arguments.length>2;return e(t,function(e){return e=n?r:e,i.resolve(e),e},function(e){return i.reject(e),o(e)},i.progress)}function f(e,t){for(var i,r=0;i=e[r++];)i(t)}function v(e,t){for(var i,r=t.length;r>e;)if(i=t[--r],null!=i&&"function"!=typeof i)throw Error("arg "+r+" must be a function")}function g(){}function _(e){return e}var y,w,C;return e.defer=a,e.resolve=t,e.reject=i,e.join=h,e.all=c,e.map=d,e.reduce=m,e.any=u,e.some=l,e.chain=p,e.isPromise=s,r.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(C,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return c(t,function(t){return e.apply(C,t)})})}},w=[].slice,y=[].reduce||function(e){var t,i,r,n,o;if(o=0,t=Object(this),n=t.length>>>0,i=arguments,1>=i.length)for(;;){if(o in t){r=t[o++];break}if(++o>=n)throw new TypeError}else r=i[1];for(;n>o;++o)o in t&&(r=e(r,t[o],o,t));return r},e})}("function"==typeof i&&i.amd?i:function(e){"object"==typeof exports?module.exports=e():this.when=e()}),i("Core/loadText",["./DeveloperError","./RequestErrorEvent","../ThirdParty/when"],function(e,t,i){var r=function(r,n){if(r===void 0)throw new e("url is required.");return i(r,function(e){var r=new XMLHttpRequest;if(r.open("GET",e,!0),n!==void 0)for(var o in n)n.hasOwnProperty(o)&&r.setRequestHeader(o,n[o]);var a=i.defer();return r.onload=function(){200===r.status?a.resolve(r.response):a.reject(new t(r.status,r.response))},r.onerror=function(){a.reject(new t)},r.send(),a.promise})};return r}),i("Core/loadJson",["./clone","./defaultValue","./loadText","./DeveloperError"],function(e,t,i,r){var n=function n(n,o){if(n===void 0)throw new r("url is required.");return o=e(t(o,t.EMPTY_OBJECT)),o.Accept="application/json",i(n,o).then(function(e){return JSON.parse(e)})};return n}),i("Core/EarthOrientationParametersSample",[],function(){var e=function e(e,t,i,r,n){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=i,this.yPoleOffset=r,this.ut1MinusUtc=n};return e}),i("Core/EarthOrientationParameters",["./binarySearch","./defaultValue","./freezeObject","./loadJson","./EarthOrientationParametersSample","./JulianDate","./LeapSecond","./RuntimeError","./TimeConstants","./TimeStandard","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c){function h(e,t){return o.compare(e.julianDate,t)}function d(t,i){if(i.columnNames===void 0)return t._dataError="Error in loaded EOP data: The columnNames property is required.",void 0;if(i.samples===void 0)return t._dataError="Error in loaded EOP data: The samples property is required.",void 0;var r=i.columnNames.indexOf("modifiedJulianDateUtc"),n=i.columnNames.indexOf("xPoleWanderRadians"),s=i.columnNames.indexOf("yPoleWanderRadians"),c=i.columnNames.indexOf("ut1MinusUtcSeconds"),d=i.columnNames.indexOf("xCelestialPoleOffsetRadians"),m=i.columnNames.indexOf("yCelestialPoleOffsetRadians"),p=i.columnNames.indexOf("taiMinusUtcSeconds");if(0>r||0>n||0>s||0>c||0>d||0>m||0>p)return t._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns",void 0;var f=t._samples=i.samples,v=t._dates=[];t._dateColumn=r,t._xPoleWanderRadiansColumn=n,t._yPoleWanderRadiansColumn=s,t._ut1MinusUtcSecondsColumn=c,t._xCelestialPoleOffsetRadiansColumn=d,t._yCelestialPoleOffsetRadiansColumn=m,t._taiMinusUtcSecondsColumn=p,t._columnCount=i.columnNames.length,t._lastIndex=void 0;for(var g,_=t._addNewLeapSeconds,y=0,w=f.length;w>y;y+=t._columnCount){var C=f[y+r],x=f[y+p],T=C+l.MODIFIED_JULIAN_DATE_DIFFERENCE,S=new o(T,x,u.TAI);if(v.push(S),_){if(x!==g&&g!==void 0){var E=a.getLeapSeconds(),b=e(E,S,h);if(0>b){var M=new a(S,x);E.splice(~b,0,M)}}g=x}}}function m(e,t,i,r,n){var o=i*r;n.xPoleWander=t[o+e._xPoleWanderRadiansColumn],n.yPoleWander=t[o+e._yPoleWanderRadiansColumn],n.xPoleOffset=t[o+e._xCelestialPoleOffsetRadiansColumn],n.yPoleOffset=t[o+e._yCelestialPoleOffsetRadiansColumn],n.ut1MinusUtc=t[o+e._ut1MinusUtcSecondsColumn]}function p(e,t,i){return t+e*(i-t)}function f(e,t,i,r,n,o,a){var s=e._columnCount;if(o>t.length-1)return a.xPoleWander=0,a.yPoleWander=0,a.xPoleOffset=0,a.yPoleOffset=0,a.ut1MinusUtc=0,a;var l=t[n],u=t[o];if(l.equals(u)||r.equals(l))return m(e,i,n,s,a),a;if(r.equals(u))return m(e,i,o,s,a),a;var c=l.getSecondsDifference(r)/l.getSecondsDifference(u),h=n*s,d=o*s,f=i[h+e._ut1MinusUtcSecondsColumn],v=i[d+e._ut1MinusUtcSecondsColumn],g=v-f;if(g>.5||-.5>g){var _=i[h+e._taiMinusUtcSecondsColumn],y=i[d+e._taiMinusUtcSecondsColumn];_!==y&&(u.equals(r)?f=v:v-=y-_)}return a.xPoleWander=p(c,i[h+e._xPoleWanderRadiansColumn],i[d+e._xPoleWanderRadiansColumn]),a.yPoleWander=p(c,i[h+e._yPoleWanderRadiansColumn],i[d+e._yPoleWanderRadiansColumn]),a.xPoleOffset=p(c,i[h+e._xCelestialPoleOffsetRadiansColumn],i[d+e._xCelestialPoleOffsetRadiansColumn]),a.yPoleOffset=p(c,i[h+e._yCelestialPoleOffsetRadiansColumn],i[d+e._yCelestialPoleOffsetRadiansColumn]),a.ut1MinusUtc=p(c,f,v),a}var v=function v(e){if(e=t(e,t.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=t(e.addNewLeapSeconds,!0),e.data!==void 0)d(this,e.data);else if(e.url!==void 0){var i=this;this._downloadPromise=c(r(e.url),function(e){d(i,e)},function(){i._dataError="An error occurred while retrieving the EOP data from the URL "+e.url+"."})}else d(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})};return v.NONE=i({getPromiseToLoad:function(){return c()},compute:function(e,t){return t===void 0?t=new n(0,0,0,0,0):(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0),t}}),v.prototype.getPromiseToLoad=function(){return c(this._downloadPromise)},v.prototype.compute=function(t,i){if(this._samples===void 0){if(this._dataError!==void 0)throw new s(this._dataError);return void 0}if(i===void 0&&(i=new n(0,0,0,0,0)),0===this._samples.length)return i.xPoleWander=0,i.yPoleWander=0,i.xPoleOffset=0,i.yPoleOffset=0,i.ut1MinusUtc=0,i;var r=this._dates,a=this._lastIndex,l=0,u=0;if(a!==void 0){var c=r[a],h=r[a+1],d=c.lessThanOrEquals(t),m=h===void 0,p=m||h.greaterThanOrEquals(t);if(d&&p)return l=a,!m&&h.equals(t)&&++l,u=l+1,f(this,r,this._samples,t,l,u,i),i}var v=e(r,t,o.compare,this._dateColumn);return v>=0?(r.length-1>v&&r[v+1].equals(t)&&++v,l=v,u=v):(u=~v,l=u-1,0>l&&(l=0)),this._lastIndex=l,f(this,r,this._samples,t,l,u,i),i},v}),i("Core/buildModuleUrl",["require","./DeveloperError"],function(e,t){function i(){if(o!==void 0)return o;if("undefined"!=typeof CESIUM_BASE_URL)o=CESIUM_BASE_URL;else for(var e=/(.*?)Cesium\w*\.js(?:\W|$)/i,i=document.getElementsByTagName("script"),r=0,n=i.length;n>r;++r){var a=i[r].getAttribute("src"),s=e.exec(a);if(null!==s){o=s[1];break}}if(o===void 0)throw new t("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");return/\/$/.test(o)||(o+="/"),o}function r(t){return e.toUrl("../"+t)}function n(e){return i()+e}var o,a,s=function(t){return a!==void 0?a(t):(a=e.toUrl!==void 0?r:n,a(t))};return s}),i("Core/Iau2006XysSample",[],function(){var e=function e(e,t,i){this.x=e,this.y=t,this.s=i};return e}),i("Core/Iau2006XysData",["./buildModuleUrl","./defaultValue","./Iau2006XysSample","./JulianDate","./loadJson","./TimeStandard","../ThirdParty/when"],function(e,t,i,r,n,o,a){function s(e,t,i){var r=c;return r._julianDayNumber=t,r._secondsOfDay=i,e._sampleZeroDateTT.getDaysDifference(r)}function l(e,t){if(e._chunkDownloadsInProgress[t])return e._chunkDownloadsInProgress[t];var i=a.defer();e._chunkDownloadsInProgress[t]=i;var r=e._xysFileUrlTemplate.replace("{0}",t);return a(n(r),function(r){e._chunkDownloadsInProgress[t]=!1;for(var n=e._samples,o=r.samples,a=3*t*e._samplesPerXysFile,s=0,l=o.length;l>s;++s)n[a+s]=o[s];i.resolve()}),i.promise}var u=function u(i){i=t(i,t.EMPTY_OBJECT),this._xysFileUrlTemplate=t(i.xysFileUrlTemplate,e("Assets/IAU2006_XYS/IAU2006_XYS_{0}.json")),this._interpolationOrder=t(i.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=t(i.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new r(this._sampleZeroJulianEphemerisDate,0,o.TAI),this._stepSizeDays=t(i.stepSizeDays,1),this._samplesPerXysFile=t(i.samplesPerXysFile,1e3),this._totalSamples=t(i.totalSamples,27426),this._samples=Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];for(var n=this._interpolationOrder,a=this._denominators=Array(n+1),s=this._xTable=Array(n+1),l=Math.pow(this._stepSizeDays,n),u=0;n>=u;++u){a[u]=l,s[u]=u*this._stepSizeDays;for(var c=0;n>=c;++c)c!==u&&(a[u]*=u-c);a[u]=1/a[u]}this._work=Array(n+1),this._coef=Array(n+1)},c=new r(0,0,o.TAI);return u.prototype.preload=function(e,t,i,r){var n=s(this,e,t),o=s(this,i,r),u=0|n/this._stepSizeDays-this._interpolationOrder/2;0>u&&(u=0);var c=o/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;c>=this._totalSamples&&(c=this._totalSamples-1);for(var h=0|u/this._samplesPerXysFile,d=0|c/this._samplesPerXysFile,m=[],p=h;d>=p;++p)m.push(l(this,p));return a.all(m)},u.prototype.computeXysRadians=function(e,t,r){var n=s(this,e,t);if(0>n)return void 0;var o=0|n/this._stepSizeDays;if(o>=this._totalSamples)return void 0;var a=this._interpolationOrder,u=o-(0|a/2);0>u&&(u=0);var c=u+a;c>=this._totalSamples&&(c=this._totalSamples-1,u=c-a,0>u&&(u=0));var h=!1,d=this._samples;if(d[3*u]===void 0&&(l(this,0|u/this._samplesPerXysFile),h=!0),d[3*c]===void 0&&(l(this,0|c/this._samplesPerXysFile),h=!0),h)return void 0;r===void 0?r=new i(0,0,0):(r.x=0,r.y=0,r.s=0);var m,p,f=n-u*this._stepSizeDays,v=this._work,g=this._denominators,_=this._coef,y=this._xTable;for(m=0;a>=m;++m)v[m]=f-y[m];for(m=0;a>=m;++m){for(_[m]=1,p=0;a>=p;++p)p!==m&&(_[m]*=v[p]);_[m]*=g[m];var w=3*(u+m);r.x+=_[m]*d[w++],r.y+=_[m]*d[w++],r.s+=_[m]*d[w]}return r},u}),i("Core/Transforms",["./defaultValue","./DeveloperError","./Iau2006XysData","./Iau2006XysSample","./Math","./Matrix3","./Matrix4","./Cartesian2","./Cartesian3","./Cartesian4","./TimeConstants","./Ellipsoid","./JulianDate","./EarthOrientationParameters","./EarthOrientationParametersSample","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f){var v={},g=new l,_=new l,y=new l;v.eastNorthUpToFixedFrame=function(i,r,o){if(i===void 0)throw new t("origin is required.");if(n.equalsEpsilon(i.x,0,n.EPSILON14)&&n.equalsEpsilon(i.y,0,n.EPSILON14)){var s=n.sign(i.z);return o===void 0?new a(0,-s,0,i.x,1,0,0,i.y,0,0,s,i.z,0,0,0,1):(o[0]=0,o[1]=1,o[2]=0,o[3]=0,o[4]=-s,o[5]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=s,o[11]=0,o[12]=i.x,o[13]=i.y,o[14]=i.z,o[15]=1,o)}var u=g,c=_,d=y;return r=e(r,h.WGS84),r.geodeticSurfaceNormal(i,u),c.x=-i.y,c.y=i.x,c.z=0,l.normalize(c,c),u.cross(c,d),o===void 0?new a(c.x,d.x,u.x,i.x,c.y,d.y,u.y,i.y,c.z,d.z,u.z,i.z,0,0,0,1):(o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=d.x,o[5]=d.y,o[6]=d.z,o[7]=0,o[8]=u.x,o[9]=u.y,o[10]=u.z,o[11]=0,o[12]=i.x,o[13]=i.y,o[14]=i.z,o[15]=1,o)};var w=new l,C=new l,x=new l;v.northEastDownToFixedFrame=function(i,r,o){if(i===void 0)throw new t("origin is required.");if(n.equalsEpsilon(i.x,0,n.EPSILON14)&&n.equalsEpsilon(i.y,0,n.EPSILON14)){var s=n.sign(i.z);return o===void 0?new a(-s,0,0,i.x,0,1,0,i.y,0,0,-s,i.z,0,0,0,1):(o[0]=-s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-s,o[11]=0,o[12]=i.x,o[13]=i.y,o[14]=i.z,o[15]=1,o)}var u=w,c=C,d=x;return r=e(r,h.WGS84),r.geodeticSurfaceNormal(i,u),c.x=-i.y,c.y=i.x,c.z=0,l.normalize(c,c),u.cross(c,d),o===void 0?new a(d.x,c.x,-u.x,i.x,d.y,c.y,-u.y,i.y,d.z,c.z,-u.z,i.z,0,0,0,1):(o[0]=d.x,o[1]=d.y,o[2]=d.z,o[3]=0,o[4]=c.x,o[5]=c.y,o[6]=c.z,o[7]=0,o[8]=-u.x,o[9]=-u.y,o[10]=-u.z,o[11]=0,o[12]=i.x,o[13]=i.y,o[14]=i.z,o[15]=1,o)};var T=24110.54841,S=8640184.812866,E=.093104,b=-62e-7,M=1.1772758384668e-19,I=72921158553e-15,D=n.TWO_PI/86400;v.computeTemeToPseudoFixedMatrix=function(e,i){if(e===void 0)throw new t("date is required.");var r,a=e.addSeconds(-e.getTaiMinusUtc()),s=a.getJulianDayNumber(),l=a.getSecondsOfDay(),u=s-2451545;r=l>=43200?(u+.5)/c.DAYS_PER_JULIAN_CENTURY:(u-.5)/c.DAYS_PER_JULIAN_CENTURY;var h=T+r*(S+r*(E+r*b)),d=h*D%n.TWO_PI,m=I+M*(s-2451545.5),p=(l+.5*c.SECONDS_PER_DAY)%c.SECONDS_PER_DAY,f=d+m*p,v=Math.cos(f),g=Math.sin(f);return i===void 0?new o(v,g,0,-g,v,0,0,0,1):(i[0]=v,i[1]=-g,i[2]=0,i[3]=g,i[4]=v,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i)},v.iau2006XysData=new i,v.earthOrientationParameters=m.NONE;var A=32.184,P=2451545;v.preloadIcrfFixed=function(e){var t=e.start.getJulianDayNumber(),i=e.start.getSecondsOfDay()+A,r=e.stop.getJulianDayNumber(),n=e.stop.getSecondsOfDay()+A,o=v.iau2006XysData.preload(t,i,r,n),a=v.earthOrientationParameters.getPromiseToLoad();return f.all([o,a])},v.computeIcrfToFixedMatrix=function(e,i){if(e===void 0)throw new t("date is required.");var r=v.computeFixedToIcrfMatrix(e,i);return r===void 0?void 0:r.transpose(i)};var R=new r(0,0,0),O=new p(0,0,0,0,0,0),z=new o,L=new o;v.computeFixedToIcrfMatrix=function(e,i){if(e===void 0)throw new t("date is required.");var r=v.earthOrientationParameters.compute(e,O);if(r===void 0)return void 0;var a=e.getJulianDayNumber(),s=e.getSecondsOfDay()+A,l=v.iau2006XysData.computeXysRadians(a,s,R);if(l===void 0)return void 0;var u=l.x+r.xPoleOffset,h=l.y+r.yPoleOffset,d=1/(1+Math.sqrt(1-u*u-h*h)),m=z;m[0]=1-d*u*u,m[3]=-d*u*h,m[6]=u,m[1]=-d*u*h,m[4]=1-d*h*h,m[7]=h,m[2]=-u,m[5]=-h,m[8]=1-d*(u*u+h*h);var p=o.fromRotationZ(-l.s,L),f=m.multiply(p,z),g=e.getJulianDayNumber(),_=e.getSecondsOfDay()-e.getTaiMinusUtc()+r.ut1MinusUtc,y=g-2451545,w=_/c.SECONDS_PER_DAY,C=.779057273264+w+.00273781191135448*(y+w);C=C%1*n.TWO_PI;var x=o.fromRotationZ(C,L),T=f.multiply(x,z),S=Math.cos(r.xPoleWander),E=Math.cos(r.yPoleWander),b=Math.sin(r.xPoleWander),M=Math.sin(r.yPoleWander),I=a-P+s/c.SECONDS_PER_DAY;I/=36525;var D=-47e-6*I*n.RADIANS_PER_DEGREE/3600,N=Math.cos(D),V=Math.sin(D),B=L;return B[0]=S*N,B[1]=S*V,B[2]=b,B[3]=-E*V+M*b*N,B[4]=E*N+M*b*V,B[5]=-M*S,B[6]=-M*V-E*b*N,B[7]=M*N-E*b*V,B[8]=E*S,T.multiply(B,i)};var N=new u;return v.pointToWindowCoordinates=function(e,i,r,n){if(e===void 0)throw new t("modelViewProjectionMatrix is required.");if(i===void 0)throw new t("viewportTransformation is required.");if(r===void 0)throw new t("point is required.");var o=N;return a.multiplyByPoint(e,r,o),u.multiplyByScalar(o,1/o.w,o),a.multiplyByVector(i,o,o),s.fromCartesian4(o,n)},v}),i("Core/Plane",["./Cartesian3","./DeveloperError"],function(e,t){var i=function(i,r){if(i===void 0)throw new t("normal is required.");if(r===void 0)throw new t("distance is required.");this.normal=e.clone(i),this.distance=r};return i.fromPointNormal=function(r,n,o){if(r===void 0)throw new t("point is required.");if(n===void 0)throw new t("normal is required.");var a=-e.dot(n,r);return o===void 0?new i(n,a):(e.clone(n,o.normal),o.distance=a,o)},i.getPointDistance=function(i,r){if(i===void 0)throw new t("plane is required.");if(r===void 0)throw new t("point is required.");return e.dot(i.normal,r)+i.distance},i.prototype.getPointDistance=function(e){return i.getPointDistance(this,e)},i}),i("Core/QuarticRealPolynomial",["./DeveloperError","./Math","./CubicRealPolynomial","./QuadraticRealPolynomial"],function(e,t,i,r){function n(e,n,o,a){var s=e*e,l=n-3*s/8,u=o-n*e/2+s*e/8,c=a-o*e/4+n*s/16-3*s*s/256,h=i.realRoots(1,2*l,l*l-4*c,-u*u);if(h.length>0){var d=-e/4,m=h[h.length-1];if(t.EPSILON14>Math.abs(m)){var p=r.realRoots(1,l,c);if(2===p.length){var f,v=p[0],g=p[1];if(v>=0&&g>=0){var _=Math.sqrt(v),y=Math.sqrt(g);return[d-y,d-_,d+_,d+y]}if(v>=0&&0>g)return f=Math.sqrt(v),[d-f,d+f];if(0>v&&g>=0)return f=Math.sqrt(g),[d-f,d+f]}return[]}if(m>0){var w=Math.sqrt(m),C=(l+m-u/w)/2,x=(l+m+u/w)/2,T=r.realRoots(1,w,C),S=r.realRoots(1,-w,x);return 0!==T.length?(T[0]+=d,T[1]+=d,0!==S.length?(S[0]+=d,S[1]+=d,S[0]>=T[1]?[T[0],T[1],S[0],S[1]]:T[0]>=S[1]?[S[0],S[1],T[0],T[1]]:T[0]>=S[0]&&S[1]>=T[1]?[S[0],T[0],T[1],S[1]]:S[0]>=T[0]&&T[1]>=S[1]?[T[0],S[0],S[1],T[1]]:T[0]>S[0]&&S[1]>T[0]?[S[0],T[0],S[1],T[1]]:[T[0],S[0],T[1],S[1]]):T):0!==S.length?(S[0]+=d,S[1]+=d,S):[]}}return[]}function o(e,n,o,a){var s=o*o,l=n*n,u=e*e,c=-2*n,h=o*e+l-4*a,d=u*a-o*n*e+s,m=i.realRoots(1,c,h,d);if(m.length>0){var p,f,v=m[0],g=n-v,_=g*g,y=e/2,w=g/2,C=_-4*a,x=_+4*Math.abs(a),T=u-4*v,S=u+4*Math.abs(v);if(0>v||T*x>C*S){var E=Math.sqrt(T);p=E/2,f=0===E?0:(e*w-o)/E}else{var b=Math.sqrt(C);p=0===b?0:(e*w-o)/b,f=b/2}var M,I;0===y&&0===p?(M=0,I=0):t.sign(y)===t.sign(p)?(M=y+p,I=v/M):(I=y-p,M=v/I);var D,A;0===w&&0===f?(D=0,A=0):t.sign(w)===t.sign(f)?(D=w+f,A=a/D):(A=w-f,D=a/A);var P=r.realRoots(1,M,D),R=r.realRoots(1,I,A);if(0!==P.length)return 0!==R.length?R[0]>=P[1]?[P[0],P[1],R[0],R[1]]:P[0]>=R[1]?[R[0],R[1],P[0],P[1]]:P[0]>=R[0]&&R[1]>=P[1]?[R[0],P[0],P[1],R[1]]:R[0]>=P[0]&&P[1]>=R[1]?[P[0],R[0],R[1],P[1]]:P[0]>R[0]&&R[1]>P[0]?[R[0],P[0],R[1],P[1]]:[P[0],R[0],P[1],R[1]]:P;if(0!==R.length)return R}return[]}var a={};return a.discriminant=function(t,i,r,n,o){if("number"!=typeof t)throw new e("a is a required number.");if("number"!=typeof i)throw new e("b is a required number.");if("number"!=typeof r)throw new e("c is a required number.");if("number"!=typeof n)throw new e("d is a required number.");if("number"!=typeof o)throw new e("e is a required number.");var a=t*t,s=a*t,l=i*i,u=l*i,c=r*r,h=c*r,d=n*n,m=d*n,p=o*o,f=p*o,v=l*c*d-4*u*m-4*t*h*d+18*t*i*r*m-27*a*d*d+256*s*f+o*(18*u*r*n-4*l*h+16*t*c*c-80*t*i*c*n-6*t*l*d+144*a*r*d)+p*(144*t*l*r-27*l*l-128*a*c-192*a*i*n);return v},a.realRoots=function(r,a,s,l,u){if("number"!=typeof r)throw new e("a is a required number.");if("number"!=typeof a)throw new e("b is a required number.");if("number"!=typeof s)throw new e("c is a required number.");if("number"!=typeof l)throw new e("d is a required number.");if("number"!=typeof u)throw new e("e is a required number.");if(t.EPSILON15>Math.abs(r))return i.realRoots(a,s,l,u);var c=a/r,h=s/r,d=l/r,m=u/r,p=0>c?1:0;switch(p+=0>h?p+1:p,p+=0>d?p+1:p,p+=0>m?p+1:p){case 0:return n(c,h,d,m);case 1:return o(c,h,d,m);case 2:return o(c,h,d,m);case 3:return n(c,h,d,m);case 4:return n(c,h,d,m);case 5:return o(c,h,d,m);case 6:return n(c,h,d,m);case 7:return n(c,h,d,m);case 8:return o(c,h,d,m);case 9:return n(c,h,d,m);case 10:return n(c,h,d,m);case 11:return o(c,h,d,m);case 12:return n(c,h,d,m);case 13:return n(c,h,d,m);case 14:return n(c,h,d,m);case 15:return n(c,h,d,m);default:return void 0}},a}),i("Core/IntersectionTests",["./DeveloperError","./Math","./Cartesian3","./Cartographic","./Matrix3","./Plane","./QuadraticRealPolynomial","./QuarticRealPolynomial"],function(e,t,i,r,n,o,a,s){function l(e,i,r){var n=e+i;return t.sign(e)!==t.sign(i)&&r>Math.abs(n/Math.max(Math.abs(e),Math.abs(i)))?0:n}function u(e,r,o,u,c){var h,d=u*u,m=c*c,p=(e[n.COLUMN1ROW1]-e[n.COLUMN2ROW2])*m,f=c*(u*l(e[n.COLUMN1ROW0],e[n.COLUMN0ROW1],t.EPSILON15)+r.y),v=e[n.COLUMN0ROW0]*d+e[n.COLUMN2ROW2]*m+u*r.x+o,g=m*l(e[n.COLUMN2ROW1],e[n.COLUMN1ROW2],t.EPSILON15),_=c*(u*l(e[n.COLUMN2ROW0],e[n.COLUMN0ROW2])+r.z),y=[];if(0===_&&0===g){if(h=a.realRoots(p,f,v),0===h.length)return y;var w=h[0],C=Math.sqrt(Math.max(1-w*w,0));if(y.push(new i(u,c*w,c*-C)),y.push(new i(u,c*w,c*C)),2===h.length){var x=h[1],T=Math.sqrt(Math.max(1-x*x,0));y.push(new i(u,c*x,c*-T)),y.push(new i(u,c*x,c*T))}return y}var S=_*_,E=g*g,b=p*p,M=_*g,I=b+E,D=2*(f*p+M),A=2*v*p+f*f-E+S,P=2*(v*f-M),R=v*v-S;if(0===I&&0===D&&0===A&&0===P)return y;h=s.realRoots(I,D,A,P,R);var O=h.length;if(0===O)return y;for(var z=0;O>z;++z){var L,N=h[z],V=N*N,B=Math.max(1-V,0),F=Math.sqrt(B);L=t.sign(p)===t.sign(v)?l(p*V+v,f*N,t.EPSILON12):t.sign(v)===t.sign(f*N)?l(p*V,f*N+v,t.EPSILON12):l(p*V+f*N,v,t.EPSILON12);var q=l(g*N,_,t.EPSILON15),U=L*q;0>U?y.push(new i(u,c*N,c*F)):U>0?y.push(new i(u,c*N,c*-F)):0!==F?(y.push(new i(u,c*N,c*-F)),y.push(new i(u,c*N,c*F)),++z):y.push(new i(u,c*N,c*F))}return y}var c={};c.rayPlane=function(r,n,o){if(r===void 0)throw new e("ray is required.");if(n===void 0)throw new e("plane is required.");var a=r.origin,s=r.direction,l=n.normal,u=i.dot(l,s);if(t.EPSILON15>Math.abs(u))return void 0;var c=(-n.distance-i.dot(l,a))/u;return 0>c?void 0:(o=s.multiplyByScalar(c,o),i.add(a,o))},c.rayEllipsoid=function(t,i){if(t===void 0)throw new e("ray is required.");if(i===void 0)throw new e("ellipsoid is required.");var r,n,o,a,s,l=i.getOneOverRadii(),u=l.multiplyComponents(t.origin),c=l.multiplyComponents(t.direction),h=u.magnitudeSquared(),d=u.dot(c);if(h>1){if(d>=0)return void 0;var m=d*d;if(r=h-1,n=c.magnitudeSquared(),o=n*r,o>m)return void 0;if(m>o){a=d*d-o,s=-d+Math.sqrt(a);var p=s/n,f=r/s;return f>p?{start:p,stop:f}:{start:f,stop:p}}var v=Math.sqrt(r/n);return{start:v,stop:v}}return 1>h?(r=h-1,n=c.magnitudeSquared(),o=n*r,a=d*d-o,s=-d+Math.sqrt(a),{start:0,stop:s/n}):0>d?(n=c.magnitudeSquared(),{start:0,stop:-d/n}):void 0},c.grazingAltitudeLocation=function(o,a){if(o===void 0)throw new e("ray is required.");if(a===void 0)throw new e("ellipsoid is required.");var s=o.origin,l=o.direction,c=a.geodeticSurfaceNormal(s);if(i.dot(l,c)>=0)return s;var h,d,m=this.rayEllipsoid(o,a)!==void 0,p=a.transformPositionToScaledSpace(l),f=p.normalize(),v=p.mostOrthogonalAxis(),g=v.cross(f).normalize(),_=f.cross(g).normalize(),y=new n(f.x,g.x,_.x,f.y,g.y,_.y,f.z,g.z,_.z),w=y.transpose(),C=n.fromScale(a.getRadii()),x=n.fromScale(a.getOneOverRadii()),T=new n(0,l.z,-l.y,-l.z,0,l.x,l.y,-l.x,0),S=w.multiply(x).multiply(T),E=S.multiply(C).multiply(y),b=S.multiplyByVector(s),M=u(E,b.negate(),0,0,1),I=M.length;if(I>0){for(var D=i.ZERO,A=Number.NEGATIVE_INFINITY,P=0;I>P;++P){h=C.multiplyByVector(y.multiplyByVector(M[P]));var R=h.subtract(s).normalize(),O=R.dot(l);O>A&&(A=O,D=h)}var z=a.cartesianToCartographic(D);return A=t.clamp(A,0,1),d=D.subtract(s).magnitude()*Math.sqrt(1-A*A),d=m?-d:d,a.cartographicToCartesian(new r(z.longitude,z.latitude,d))}return void 0};var h=new i;return c.lineSegmentPlane=function(r,n,o,a){if(r===void 0)throw new e("endPoint0 is required.");if(n===void 0)throw new e("endPoint1 is required.");if(o===void 0)throw new e("plane is required.");var s=i.subtract(n,r,h),l=o.normal,u=i.dot(l,s);if(t.EPSILON6>Math.abs(u))return void 0;var c=i.dot(l,r),d=-(o.distance+c)/u;return 0>d||d>1?void 0:(a===void 0&&(a=new i),i.multiplyByScalar(s,d,a),i.add(r,a,a),a)},c}),i("Core/Ray",["./DeveloperError","./defaultValue","./Cartesian3"],function(e,t,i){var r=function(e,r){r=i.clone(t(r,i.ZERO)),r.equals(i.ZERO)||i.normalize(r,r),this.origin=i.clone(t(e,i.ZERO)),this.direction=r};return r.prototype.getPoint=function(t,r){if("number"!=typeof t)throw new e("t is a required number");return r=i.multiplyByScalar(this.direction,t,r),i.add(this.origin,r,r)},r}),i("Core/EllipsoidTangentPlane",["./defaultValue","./DeveloperError","./Transforms","./AxisAlignedBoundingBox","./IntersectionTests","./Cartesian2","./Cartesian3","./Ellipsoid","./Ray","./Plane"],function(e,t,i,r,n,o,a,s,l,u){var c=function(r,n){if(r===void 0)throw new t("origin is required.");if(n=e(n,s.WGS84),r=n.scaleToGeodeticSurface(r),r===void 0)throw new t("origin must not be at the center of the ellipsoid.");var o=i.eastNorthUpToFixedFrame(r,n);this._ellipsoid=n,this._origin=a.clone(r),this._xAxis=a.fromCartesian4(o.getColumn(0)),this._yAxis=a.fromCartesian4(o.getColumn(1));var l=a.fromCartesian4(o.getColumn(2)),c=-a.dot(r,r);this._plane=new u(l,c)},h=new r;c.fromPoints=function(e,i){if(e===void 0)throw new t("cartesians is required.");var n=r.fromPoints(e,h);return new c(n.center,i)},c.prototype.getEllipsoid=function(){return this._ellipsoid},c.prototype.getOrigin=function(){return this._origin};var d=new l,m=new a;c.prototype.projectPointOntoPlane=function(e,i){if(e===void 0)throw new t("cartesian is required.");var r=d;r.origin=e,a.normalize(e,r.direction);var s=n.rayPlane(r,this._plane,m);if(s!==void 0){var l=s.subtract(this._origin,s),u=this._xAxis.dot(l),c=this._yAxis.dot(l);return i===void 0?new o(u,c):(i.x=u,i.y=c,i)}return void 0},c.prototype.projectPointsOntoPlane=function(e,i){if(e===void 0)throw new t("cartesians is required.");i===void 0&&(i=[]);for(var r=0,n=e.length,o=0;n>o;o++){var a=this.projectPointOntoPlane(e[o],i[r]);a!==void 0&&(i[r]=a,r++)}return i.length=r,i
};var p=new a;return c.prototype.projectPointsOntoEllipsoid=function(e,i){if(e===void 0)throw new t("cartesians is required.");var r=e.length;i===void 0?i=Array(r):i.length=r;for(var n=this._ellipsoid,o=this._origin,s=this._xAxis,l=this._yAxis,u=p,c=0;r>c;++c){var h=e[c];s.multiplyByScalar(h.x,u);var d=i[c]=a.add(o,u,i[c]);l.multiplyByScalar(h.y,u),a.add(d,u,d),n.scaleToGeocentricSurface(d,d)}return i},c}),i("Core/Visibility",["./Enumeration"],function(e){var t={NONE:new e(-1,"NONE"),PARTIAL:new e(0,"PARTIAL"),FULL:new e(1,"FULL")};return t}),i("Core/EllipsoidalOccluder",["./defaultValue","./DeveloperError","./Math","./Cartesian3","./Visibility","./Ellipsoid","./BoundingSphere"],function(e,t,i,r){var n=function(e,i){if(e===void 0)throw new t("ellipsoid is required.");this._ellipsoid=e,this._cameraPosition=new r,this._cameraPositionInScaledSpace=new r,this._distanceToLimbInScaledSpaceSquared=0,i!==void 0&&this.setCameraPosition(i)};n.prototype.getEllipsoid=function(){return this._ellipsoid},n.prototype.setCameraPosition=function(e){var t=this._ellipsoid,i=t.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),n=r.magnitudeSquared(i)-1;r.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=i,this._distanceToLimbInScaledSpaceSquared=n},n.prototype.getCameraPosition=function(){return this._cameraPosition};var o=new r;return n.prototype.isPointVisible=function(e){var t=this._ellipsoid,i=t.transformPositionToScaledSpace(e,o);return this.isScaledSpacePointVisible(i)},n.prototype.isScaledSpacePointVisible=function(e){var t=this._cameraPositionInScaledSpace,i=this._distanceToLimbInScaledSpaceSquared,n=r.subtract(e,t,o),a=-n.dot(t),s=a>i&&a*a/n.magnitudeSquared()>i;return!s},n}),i("Core/EncodedCartesian3",["./Cartesian3","./DeveloperError"],function(e,t){var i=function(){this.high=e.ZERO.clone(),this.low=e.ZERO.clone()};i.encode=function(e,i){if(e===void 0)throw new t("value is required");i===void 0&&(i={high:0,low:0});var r;return e>=0?(r=65536*Math.floor(e/65536),i.high=r,i.low=e-r):(r=65536*Math.floor(-e/65536),i.high=-r,i.low=e+r),i};var r={high:0,low:0};i.fromCartesian=function(e,n){if(e===void 0)throw new t("cartesian is required");n===void 0&&(n=new i);var o=n.high,a=n.low;return i.encode(e.x,r),o.x=r.high,a.x=r.low,i.encode(e.y,r),o.y=r.high,a.y=r.low,i.encode(e.z,r),o.z=r.high,a.z=r.low,n};var n=new i;return i.writeElements=function(e,r,o){if(e===void 0)throw new t("cartesian is required");if(r===void 0)throw new t("cartesianArray is required");if("number"!=typeof o||0>o)throw new t("index must be a number greater than or equal to 0.");i.fromCartesian(e,n);var a=n.high,s=n.low;r[o]=a.x,r[o+1]=a.y,r[o+2]=a.z,r[o+3]=s.x,r[o+4]=s.y,r[o+5]=s.z},i}),i("Core/ExtentTessellator",["./clone","./defaultValue","./DeveloperError","./Math","./Ellipsoid","./Extent","./Cartesian3","./ComponentDatatype","./PrimitiveType"],function(e,t,i,r,n,o,a,s,l){var u={};return u.computeVertices=function(e){e=t(e,t.EMPTY_OBJECT);for(var i=e.extent,r=e.surfaceHeight,n=e.width,o=e.height,a=(i.east-i.west)/(n-1),s=(i.north-i.south)/(o-1),l=e.generateTextureCoordinates,u=e.interleaveTextureCoordinates,c=e.relativeToCenter,h=e.vertices,d=e.textureCoordinates,m=e.indices,p=e.radiiSquared,f=p.x,v=p.y,g=p.z,_=Math.cos,y=Math.sin,w=Math.sqrt,C=1/(i.east-i.west),x=1/(i.north-i.south),T=0,S=0,E=0;o>E;++E)for(var b=i.north-s*E,M=_(b),I=y(b),D=g*I,A=(b-i.south)*x,P=A,R=0;n>R;++R){var O=i.west+a*R,z=M*_(O),L=M*y(O),N=f*z,V=v*L,B=w(N*z+V*L+D*I),F=N/B,q=V/B,U=D/B;if(h[T++]=F+z*r-c.x,h[T++]=q+L*r-c.y,h[T++]=U+I*r-c.z,l){var k=(O-i.west)*C,W=k;u?(h[T++]=W,h[T++]=P):(d[S++]=W,d[S++]=P)}}if(m!==void 0)for(var H=0,j=0,G=0;o-1>G;++G){for(var Y=0;n-1>Y;++Y){var X=H,Z=X+n,K=Z+1,J=X+1;m[j++]=X,m[j++]=Z,m[j++]=J,m[j++]=J,m[j++]=Z,m[j++]=K,++H}++H}},u.compute=function(i){i=t(i,t.EMPTY_OBJECT);var r=e(i),o=i.extent;o.validate();var c=t(i.ellipsoid,n.WGS84);r.radiiSquared=c.getRadiiSquared(),r.relativeToCenter=t(i.relativeToCenter,a.ZERO);var h=t(i.granularity,.1);r.surfaceHeight=t(i.surfaceHeight,0),r.width=Math.ceil((o.east-o.west)/h)+1,r.height=Math.ceil((o.north-o.south)/h)+1;var d=[],m=[],p=[];r.generateTextureCoordinates=t(r.generateTextureCoordinates,!1),r.interleaveTextureCoordinates=!1,r.vertices=d,r.textureCoordinates=p,r.indices=m,u.computeVertices(r);var f={attributes:{},indexLists:[{primitiveType:l.TRIANGLES,values:m}]},v=t(i.positionName,"position");if(f.attributes[v]={componentDatatype:s.FLOAT,componentsPerAttribute:3,values:d},i.generateTextureCoordinates){var g=t(i.textureCoordinatesName,"textureCoordinates");f.attributes[g]={componentDatatype:s.FLOAT,componentsPerAttribute:2,values:p}}return f},u.computeBuffers=function(i){i=t(i,t.EMPTY_OBJECT);var r=e(i),o=i.extent;o.validate();var s=t(i.ellipsoid,n.WGS84);r.radiiSquared=s.getRadiiSquared(),r.relativeToCenter=t(i.relativeToCenter,a.ZERO);var l=t(i.granularity,.1);r.surfaceHeight=t(i.surfaceHeight,0),r.width=Math.ceil((o.east-o.west)/l)+1,r.height=Math.ceil((o.north-o.south)/l)+1;var c=[],h=[],d=[];r.generateTextureCoordinates=t(i.generateTextureCoordinates,!1),r.interleaveTextureCoordinates=t(i.interleaveTextureCoordinates,!1),r.vertices=c,r.textureCoordinates=d,r.indices=h,u.computeVertices(r);var m={indices:h};return i.interleaveTextureCoordinates?m.vertices=c:(m.positions=c,i.generateTextureCoordinates&&(m.textureCoordinates=d)),m},u}),i("Core/FAR",[],function(){var e=5906376272e3;return e}),i("Core/Fullscreen",["./DeveloperError"],function(){var e,t={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},i={};return i.supportsFullscreen=function(){if(e!==void 0)return e;e=!1;var i=document.body;if("function"==typeof i.requestFullscreen)return t.requestFullscreen="requestFullscreen",t.exitFullscreen="exitFullscreen",t.fullscreenEnabled="fullscreenEnabled",t.fullscreenElement="fullscreenElement",t.fullscreenchange="fullscreenchange",t.fullscreenerror="fullscreenerror",e=!0;for(var r,n=["webkit","moz","o","ms","khtml"],o=0,a=n.length;a>o;++o){var s=n[o];r=s+"RequestFullscreen","function"==typeof i[r]?(t.requestFullscreen=r,e=!0):(r=s+"RequestFullScreen","function"==typeof i[r]&&(t.requestFullscreen=r,e=!0)),r=s+"ExitFullscreen","function"==typeof document[r]?t.exitFullscreen=r:(r=s+"CancelFullScreen","function"==typeof document[r]&&(t.exitFullscreen=r)),r=s+"FullscreenEnabled",document[r]!==void 0?t.fullscreenEnabled=r:(r=s+"FullScreenEnabled",document[r]!==void 0&&(t.fullscreenEnabled=r)),r=s+"FullscreenElement",document[r]!==void 0?t.fullscreenElement=r:(r=s+"FullScreenElement",document[r]!==void 0&&(t.fullscreenElement=r)),r=s+"fullscreenchange",document["on"+r]!==void 0&&(t.fullscreenchange=r),r=s+"fullscreenerror",document["on"+r]!==void 0&&(t.fullscreenerror=r)}return e},i.requestFullscreen=function(e){i.supportsFullscreen()&&e[t.requestFullscreen]()},i.exitFullscreen=function(){i.supportsFullscreen()&&document[t.exitFullscreen]()},i.isFullscreenEnabled=function(){return i.supportsFullscreen()?document[t.fullscreenEnabled]:void 0},i.getFullscreenElement=function(){return i.supportsFullscreen()?document[t.fullscreenElement]:void 0},i.isFullscreen=function(){return i.supportsFullscreen()?null!==i.getFullscreenElement():void 0},i.getFullscreenChangeEventName=function(){return i.supportsFullscreen()?t.fullscreenchange:void 0},i.getFullscreenErrorEventName=function(){return i.supportsFullscreen()?t.fullscreenerror:void 0},i}),i("Core/FeatureDetection",["./Fullscreen"],function(e){function t(e){return e.split(".").map(function(e){return parseInt(e,10)})}function i(){if(a===void 0){var e=/ Chrome\/([\.0-9]+)/.exec(navigator.userAgent);null===e?a=!1:(a=!0,s=t(e[1]))}return a}function r(){if(l===void 0)if(i()||!/ Safari\/[\.0-9]+/.test(navigator.userAgent))l=!1;else{var e=/ Version\/([\.0-9]+)/.exec(navigator.userAgent);null===e?l=!1:(l=!0,u=t(e[1]))}return l}function n(){if(c===void 0){var e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(navigator.userAgent);null===e?c=!1:(c=!0,h=t(e[1]),h.isNightly=!!e[2])}return c}function o(){return n()&&h}var a,s,l,u,c,h,d,m={};return m.supportsCrossOriginImagery=function(){return d===void 0&&(d=r()&&536>o()[0]?!1:"withCredentials"in new XMLHttpRequest),d},m.supportsFullscreen=function(){return e.supportsFullscreen()},m}),i("Core/getImagePixels",[],function(){var e={},t=function(t,i,r){i===void 0&&(i=t.width),r===void 0&&(r=t.height);var n=e[i];n===void 0&&(n={},e[i]=n);var o=n[r];if(o===void 0){var a=document.createElement("canvas");a.width=i,a.height=r,o=a.getContext("2d"),o.globalCompositeOperation="copy",n[r]=o}return o.drawImage(t,0,0,i,r),o.getImageData(0,0,i,r).data};return t}),i("Core/HeightmapTessellator",["./defaultValue","./freezeObject","./getImagePixels","./DeveloperError","./Cartesian3","./ComponentDatatype","./Ellipsoid","./Extent","./Math","./PrimitiveType"],function(e,t,i,r,n,o,a,s,l){var u={};return u.DEFAULT_STRUCTURE=t({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1}),u.computeVertices=function(t){if(t===void 0||t.heightmap===void 0)throw new r("description.heightmap is required.");if(t.width===void 0||t.height===void 0)throw new r("description.width and description.height are required.");if(t.vertices===void 0)throw new r("description.vertices is required.");if(t.nativeExtent===void 0)throw new r("description.nativeExtent is required.");if(t.skirtHeight===void 0)throw new r("description.skirtHeight is required.");var i,o,s,c,h=Math.cos,d=Math.sin,m=Math.sqrt,p=Math.atan,f=Math.exp,v=l.PI_OVER_TWO,g=l.toRadians,_=t.vertices,y=t.heightmap,w=t.width,C=t.height,x=t.skirtHeight,T=e(t.isGeographic,!0),S=e(t.ellipsoid,a.WGS84),E=1/S.getMaximumRadius(),b=t.nativeExtent,M=t.extent;M===void 0?T?(i=g(b.west),o=g(b.south),s=g(b.east),c=g(b.north)):(i=b.west*E,o=v-2*p(f(-b.south*E)),s=b.east*E,c=v-2*p(f(-b.north*E))):(i=M.west,o=M.south,s=M.east,c=M.north);var I=e(t.relativeToCenter,n.ZERO),D=e(t.structure,u.DEFAULT_STRUCTURE),A=e(D.heightScale,u.DEFAULT_STRUCTURE.heightScale),P=e(D.heightOffset,u.DEFAULT_STRUCTURE.heightOffset),R=e(D.elementsPerHeight,u.DEFAULT_STRUCTURE.elementsPerHeight),O=e(D.stride,u.DEFAULT_STRUCTURE.stride),z=e(D.elementMultiplier,u.DEFAULT_STRUCTURE.elementMultiplier),L=e(D.isBigEndian,u.DEFAULT_STRUCTURE.isBigEndian),N=(b.east-b.west)/(w-1),V=(b.north-b.south)/(C-1),B=S.getRadiiSquared(),F=B.x,q=B.y,U=B.z,k=0,W=65536,H=-65536,j=0,G=C,Y=0,X=w;x>0&&(--j,++G,--Y,++X);for(var Z=j;G>Z;++Z){var K=Z;0>K&&(K=0),K>=C&&(K=C-1);var J=b.north-V*K;J=T?g(J):v-2*p(f(-J*E));for(var Q=h(J),$=d(J),et=U*$,tt=(J-o)/(c-o),it=Y;X>it;++it){var rt=it;0>rt&&(rt=0),rt>=w&&(rt=w-1);var nt=b.west+N*rt;T?nt=g(nt):nt*=E;var ot,at=K*w*O+rt*O;if(1===R)ot=y[at];else{ot=0;var st;if(L)for(st=0;R>st;++st)ot=ot*z+y[at+st];else for(st=R-1;st>=0;--st)ot=ot*z+y[at+st]}ot=ot*A+P,H=Math.max(H,ot),W=Math.min(W,ot),(it!==rt||Z!==K)&&(ot-=x);var lt=Q*h(nt),ut=Q*d(nt),ct=F*lt,ht=q*ut,dt=m(ct*lt+ht*ut+et*$),mt=1/dt,pt=ct*mt,ft=ht*mt,vt=et*mt;_[k++]=pt+lt*ot-I.x,_[k++]=ft+ut*ot-I.y,_[k++]=vt+$*ot-I.z,_[k++]=ot;var gt=(nt-i)/(s-i);_[k++]=gt,_[k++]=tt}}return{maximumHeight:H,minimumHeight:W}},u}),i("Core/HermitePolynomialApproximation",["./Math"],function(e){function t(e,i,r,n,o,a){var s,l,u,c=0;if(n>0){for(l=0;o>l;l++){for(s=!1,u=0;a.length>u&&!s;u++)l===a[u]&&(s=!0);s||(a.push(l),c+=t(e,i,r,n-1,o,a),a.splice(a.length-1,1))}return c}for(c=1,l=0;o>l;l++){for(s=!1,u=0;a.length>u&&!s;u++)l===a[u]&&(s=!0);s||(c*=e-r[i[l]])}return c}var i=e.factorial,r={type:"Hermite"};return r.getRequiredDataPoints=function(e){return Math.max(e+1,2)},r.interpolateOrderZero=function(e,r,n,o,a){a===void 0&&(a=Array(o));var s,l,u,c,h,d,m=r.length,p=Array(o);for(s=0;o>s;s++){a[s]=0;var f=Array(m);for(p[s]=f,l=0;m>l;l++)f[l]=[]}var v=m,g=Array(v);for(s=0;v>s;s++)g[s]=s;var _=m-1;for(c=0;o>c;c++){for(l=0;v>l;l++)d=g[l]*o+c,p[c][0].push(n[d]);for(s=1;v>s;s++){var y=!1;for(l=0;v-s>l;l++){var w,C=r[g[l]],x=r[g[l+s]];0>=x-C?(d=g[l]*o+o*s+c,w=n[d],p[c][s].push(w/i(s))):(w=p[c][s-1][l+1]-p[c][s-1][l],p[c][s].push(w/(x-C))),y=y||0!==w}y||(_=s-1)}}for(u=0,h=0;h>=u;u++)for(s=u;_>=s;s++){var T=t(e,g,r,u,s,[]);for(c=0;o>c;c++){var S=p[c][s][0];a[c+u*o]+=S*T}}return a},r}),i("Core/IndexDatatype",["./Enumeration"],function(e){var t={UNSIGNED_BYTE:new e(5121,"UNSIGNED_BYTE"),UNSIGNED_SHORT:new e(5123,"UNSIGNED_SHORT")};return t}),i("Core/TimeInterval",["./DeveloperError","./freezeObject","./JulianDate","./TimeStandard"],function(e,t,i,r){var n=function(t,r,n,o,a){if(t===void 0)throw new e("start must be specified.");if(r===void 0)throw new e("stop must be specified.");n===void 0&&(n=!0),o===void 0&&(o=!0);var s=i.compare(r,t);this.start=t,this.stop=r,this.data=a,this.isStartIncluded=n,this.isStopIncluded=o,this.isEmpty=0>s||0===s&&(!n||!o)};return n.fromIso8601=function(e,t,r,o){var a=e.split("/"),s=i.fromIso8601(a[0]),l=i.fromIso8601(a[1]);return new n(s,l,t,r,o)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&e.start.equals(t.start)&&e.stop.equals(t.stop))},n.equalsEpsilon=function(t,i,r){if("number"!=typeof r)throw new e("epsilon is required and must be a number.");return t===i||t!==void 0&&i!==void 0&&(t.isEmpty&&i.isEmpty||t.isStartIncluded===i.isStartIncluded&&t.isStopIncluded===i.isStopIncluded&&t.start.equalsEpsilon(i.start,r)&&t.stop.equalsEpsilon(i.stop,r))},n.prototype.clone=function(){return new n(this.start,this.stop,this.isStartIncluded,this.isStopIncluded,this.data)},n.EMPTY=t(new n(new i(0,0,r.TAI),new i(0,0,r.TAI),!1,!1)),n.prototype.intersect=function(e,t){if(e===void 0)return n.EMPTY;var i,r,o,a=e.start,s=e.stop,l=e.isStartIncluded,u=e.isStopIncluded,c=this.start,h=this.stop,d=this.isStartIncluded,m=this.isStopIncluded;return a.greaterThanOrEquals(c)&&h.greaterThanOrEquals(a)?(r=!a.equals(c)&&l||d&&l,o=m&&u,i=t!==void 0?t(this.data,e.data):this.data,h.greaterThanOrEquals(s)?(o=o||!s.equals(h)&&u,new n(a,s,r,o,i)):(o=o||m,new n(a,h,r,o,i))):a.lessThanOrEquals(c)&&c.lessThanOrEquals(s)?(r=a.equals(c)===!1&&d||d&&l,o=m&&u,i=t!==void 0?t(this.data,e.data):this.data,h.greaterThanOrEquals(s)?(o=o||s.equals(h)===!1&&u,new n(c,s,r,o,i)):(o=o||m,new n(c,h,r,o,i))):n.EMPTY},n.prototype.contains=function(e){if(this.isEmpty)return!1;var t=i.compare(this.start,e);if(0===t)return this.isStartIncluded;var r=i.compare(e,this.stop);return 0===r?this.isStopIncluded:0>t&&0>r},n.prototype.equals=function(e){return n.equals(this,e)},n.prototype.equalsEpsilon=function(e,t){return n.equalsEpsilon(this,e,t)},n}),i("Core/Iso8601",["./freezeObject","./JulianDate","./TimeInterval"],function(e,t,i){var r=e(t.fromIso8601("0000-01-01T00:00:00Z")),n=e(t.fromIso8601("9999-12-31T24:00:00Z")),o=e(new i(r,n,!0,!0)),a={MINIMUM_VALUE:r,MAXIMUM_VALUE:n,MAXIMUM_INTERVAL:o};return a}),i("Core/KeyboardEventModifier",["./Enumeration"],function(e){var t={SHIFT:new e(0,"SHIFT"),CTRL:new e(1,"CTRL"),ALT:new e(2,"ALT")};return t}),i("Core/LagrangePolynomialApproximation",[],function(){var e={type:"Lagrange"};return e.getRequiredDataPoints=function(e){return Math.max(e+1,2)},e.interpolateOrderZero=function(e,t,i,r,n){n===void 0&&(n=Array(r));var o,a,s=t.length;for(o=0;r>o;o++)n[o]=0;for(o=0;s>o;o++){var l=1;for(a=0;s>a;a++)if(a!==o){var u=t[o]-t[a];l*=(e-t[a])/u}for(a=0;r>a;a++)n[a]+=l*i[o*r+a]}return n},e}),i("Core/LinearApproximation",["./DeveloperError"],function(e){var t={type:"Linear"};return t.getRequiredDataPoints=function(t){if(1!==t)throw new e("Linear interpolation can only generate a first degree polynomial.");return 2},t.interpolateOrderZero=function(t,i,r,n,o){if(2!==i.length)throw new e("The xTable provided to the linear interpolator must have exactly two elements.");if(0>=n)throw new e("There must be at least 1 dependent variable for each independent variable.");o===void 0&&(o=Array(n));var a,s,l,u=i[0],c=i[1];if(u===c)throw new e("Divide by zero error: xTable[0] and xTable[1] are equal");for(a=0;n>a;a++)s=r[a],l=r[a+n],o[a]=((l-s)*t+c*s-u*l)/(c-u);return o},t}),i("Core/Matrix2",["./Cartesian2","./defaultValue","./DeveloperError","./freezeObject"],function(e,t,i,r){var n=function(e,i,r,n){this[0]=t(e,0),this[1]=t(r,0),this[2]=t(i,0),this[3]=t(n,0)};return n.clone=function(e,t){if(e===void 0)throw new i("values is required");return t===void 0?new n(e[0],e[2],e[1],e[3]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t)},n.fromColumnMajorArray=n.clone,n.fromRowMajorArray=function(e,t){if(e===void 0)throw new i("values is required.");return t===void 0?new n(e[0],e[1],e[2],e[3]):(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t)},n.fromScale=function(e,t){if(e===void 0)throw new i("scale is required.");return t===void 0?new n(e.x,0,0,e.y):(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t)},n.fromUniformScale=function(e,t){if("number"!=typeof e)throw new i("scale is required.");return t===void 0?new n(e,0,0,e):(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t)},n.fromRotation=function(e,t){if(e===void 0)throw new i("angle is required.");var r=Math.cos(e),o=Math.sin(e);return t===void 0?new n(r,-o,o,r):(t[0]=r,t[1]=o,t[2]=-o,t[3]=r,t)},n.toArray=function(e,t){if(e===void 0)throw new i("matrix is required");return t===void 0?[e[0],e[1],e[2],e[3]]:(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t)},n.getElementIndex=function(e,t){if("number"!=typeof t||0>t||t>1)throw new i("row is required and must be 0 or 1.");if("number"!=typeof e||0>e||e>1)throw new i("column is required and must be 0 or 1.");return 2*e+t},n.getColumn=function(t,r,n){if(t===void 0)throw new i("matrix is required.");if("number"!=typeof r||0>r||r>1)throw new i("index is required and must be 0 or 1.");var o=2*r,a=t[o],s=t[o+1];return n===void 0?new e(a,s):(n.x=a,n.y=s,n)},n.setColumn=function(e,t,r,o){if(e===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");if("number"!=typeof t||0>t||t>1)throw new i("index is required and must be 0 or 1.");o=n.clone(e,o);var a=2*t;return o[a]=r.x,o[a+1]=r.y,o},n.getRow=function(t,r,n){if(t===void 0)throw new i("matrix is required.");if("number"!=typeof r||0>r||r>1)throw new i("index is required and must be 0 or 1.");var o=t[r],a=t[r+2];return n===void 0?new e(o,a):(n.x=o,n.y=a,n)},n.setRow=function(e,t,r,o){if(e===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");if("number"!=typeof t||0>t||t>1)throw new i("index is required and must be 0 or 1.");return o=n.clone(e,o),o[t]=r.x,o[t+2]=r.y,o},n.multiply=function(e,t,r){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");var o=e[0]*t[0]+e[2]*t[1],a=e[0]*t[2]+e[2]*t[3],s=e[1]*t[0]+e[3]*t[1],l=e[1]*t[2]+e[3]*t[3];return r===void 0?new n(o,a,s,l):(r[0]=o,r[1]=s,r[2]=a,r[3]=l,r)},n.multiplyByVector=function(t,r,n){if(t===void 0)throw new i("matrix is required");if(r===void 0)throw new i("cartesian is required");var o=t[0]*r.x+t[2]*r.y,a=t[1]*r.x+t[3]*r.y;return n===void 0?new e(o,a):(n.x=o,n.y=a,n)},n.multiplyByScalar=function(e,t,r){if(e===void 0)throw new i("matrix is required");if("number"!=typeof t)throw new i("scalar is required and must be a number");return r===void 0?new n(e[0]*t,e[2]*t,e[1]*t,e[3]*t):(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r)},n.negate=function(e,t){if(e===void 0)throw new i("matrix is required");return t===void 0?new n(-e[0],-e[2],-e[1],-e[3]):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t)},n.transpose=function(e,t){if(e===void 0)throw new i("matrix is required");var r=e[0],o=e[2],a=e[1],s=e[3];return t===void 0?new n(r,a,o,s):(t[0]=r,t[1]=o,t[2]=a,t[3]=s,t)},n.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equalsEpsilon=function(e,t,r){if("number"!=typeof r)throw new i("epsilon is required and must be a number");return e===t||e!==void 0&&t!==void 0&&r>=Math.abs(e[0]-t[0])&&r>=Math.abs(e[1]-t[1])&&r>=Math.abs(e[2]-t[2])&&r>=Math.abs(e[3]-t[3])},n.IDENTITY=r(new n(1,0,0,1)),n.COLUMN0ROW0=0,n.COLUMN0ROW1=1,n.COLUMN1ROW0=2,n.COLUMN1ROW1=3,n.prototype.clone=function(e){return n.clone(this,e)},n.prototype.toArray=function(e){return n.toArray(this,e)},n.prototype.getColumn=function(e,t){return n.getColumn(this,e,t)},n.prototype.setColumn=function(e,t,i){return n.setColumn(this,e,t,i)},n.prototype.getRow=function(e,t){return n.getRow(this,e,t)},n.prototype.setRow=function(e,t,i){return n.setRow(this,e,t,i)},n.prototype.multiply=function(e,t){return n.multiply(this,e,t)},n.prototype.multiplyByVector=function(e,t){return n.multiplyByVector(this,e,t)},n.prototype.multiplyByScalar=function(e,t){return n.multiplyByScalar(this,e,t)},n.prototype.negate=function(e){return n.negate(this,e)},n.prototype.transpose=function(e){return n.transpose(this,e)},n.prototype.equals=function(e){return n.equals(this,e)},n.prototype.equalsEpsilon=function(e,t){return n.equalsEpsilon(this,e,t)},n.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n"+"("+this[1]+", "+this[3]+")"},n}),i("Core/Tipsify",["./DeveloperError","./defaultValue"],function(e,t){var i={};return i.calculateACMR=function(i){i=t(i,t.EMPTY_OBJECT);var r=i.indices,n=i.maximumIndex,o=t(i.cacheSize,24);if(r===void 0)throw new e("indices is required.");var a=r.length;if(3>a||0!==a%3)throw new e("indices length must be a multiple of three.");if(0>=n)throw new e("maximumIndex must be greater than zero.");if(3>o)throw new e("cacheSize must be greater than two.");if(n===void 0){n=0;for(var s=0,l=r[s];a>s;)l>n&&(n=l),++s,l=r[s]}for(var u=[],c=0;n+1>c;c++)u[c]=0;for(var h=o+1,d=0;a>d;++d)h-u[r[d]]>o&&(u[r[d]]=h,++h);return(h-o+1)/(a/3)},i.tipsify=function(i){function r(e,t,i,r){for(;t.length>=1;){var n=t[t.length-1];if(t.splice(t.length-1,1),e[n].numLiveTriangles>0)return n}for(;r>o;){if(e[o].numLiveTriangles>0)return++o,o-1;++o}return-1}function n(e,t,i,n,o,a,s){for(var l,u=-1,c=-1,h=0;i.length>h;){var d=i[h];n[d].numLiveTriangles&&(l=0,t>=o-n[d].timeStamp+2*n[d].numLiveTriangles&&(l=o-n[d].timeStamp),(l>c||-1===c)&&(c=l,u=d)),++h}return-1===u?r(n,a,e,s):u}i=t(i,t.EMPTY_OBJECT);var o,a=i.indices,s=i.maximumIndex,l=t(i.cacheSize,24);if(a===void 0)throw new e("indices is required.");var u=a.length;if(3>u||0!==u%3)throw new e("indices length must be a multiple of three.");if(0>=s)throw new e("maximumIndex must be greater than zero.");if(3>l)throw new e("cacheSize must be greater than two.");var c=0,h=0,d=a[h],m=u;if(s!==void 0)c=s+1;else{for(;m>h;)d>c&&(c=d),++h,d=a[h];if(-1===c)return 0;++c}for(var p=[],f=0;c>f;f++)p[f]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};h=0;for(var v=0;m>h;)p[a[h]].vertexTriangles.push(v),++p[a[h]].numLiveTriangles,p[a[h+1]].vertexTriangles.push(v),++p[a[h+1]].numLiveTriangles,p[a[h+2]].vertexTriangles.push(v),++p[a[h+2]].numLiveTriangles,++v,h+=3;var g=0,_=l+1;o=1;var y,w,C=[],x=[],T=0,S=[],E=u/3,b=[];for(f=0;E>f;f++)b[f]=!1;for(var M,I;-1!==g;){C=[],w=p[g],I=w.vertexTriangles.length;for(var D=0;I>D;++D)if(v=w.vertexTriangles[D],!b[v]){b[v]=!0,h=v+v+v;for(var A=0;3>A;++A)M=a[h],C.push(M),x.push(M),S[T]=M,++T,y=p[M],--y.numLiveTriangles,_-y.timeStamp>l&&(y.timeStamp=_,++_),++h}g=n(a,l,C,p,_,x,c)}return S},i}),i("Core/MeshFilters",["./defaultValue","./DeveloperError","./Cartesian3","./EncodedCartesian3","./GeographicProjection","./ComponentDatatype","./PrimitiveType","./Tipsify"],function(e,t,i,r,n,o,a,s){function l(e,t,i){for(var r in t)if(t.hasOwnProperty(r)&&t[r].values)for(var n=t[r],o=0;n.componentsPerAttribute>o;++o)e[r].values.push(n.values[i*n.componentsPerAttribute+o])}var u={};u.toWireframeInPlace=function(e){function t(e,t,i,r){e.push(t),e.push(i),e.push(i),e.push(r),e.push(r),e.push(t)}function i(e){for(var i=[],r=e.length,n=0;r>n;n+=3)t(i,e[n],e[n+1],e[n+2]);return i}function r(e){var i=[],r=e.length;if(r>=3){t(i,e[0],e[1],e[2]);for(var n=3;r>n;++n)t(i,e[n-1],e[n],e[n-2])}return i}function n(e){var i=[];if(e.length>0)for(var r=e[0],n=e.length-1,o=1;n>o;++o)t(i,r,e[o],e[o+1]);return i}if(e!==void 0){var o=e.indexLists;if(o!==void 0)for(var s=o.length,l=0;s>l;++l){var u=o[l];switch(u.primitiveType){case a.TRIANGLES:u.primitiveType=a.LINES,u.values=i(u.values);break;case a.TRIANGLE_STRIP:u.primitiveType=a.LINES,u.values=r(u.values);break;case a.TRIANGLE_FAN:u.primitiveType=a.LINES,u.values=n(u.values)}}}return e},u.createAttributeIndices=function(e){var t={};if(e!==void 0){var i=e.attributes,r=0;for(var n in i)i.hasOwnProperty(n)&&(t[n]=r++)}return t},u.mapAttributeIndices=function(e,t){var i={};if(e!==void 0&&t!==void 0)for(var r in t)t.hasOwnProperty(r)&&(i[t[r]]=e[r]);return i},u._computeNumberOfAttributes=function(e){var i=-1;for(var r in e.attributes)if(e.attributes.hasOwnProperty(r)&&e.attributes[r].values){var n=e.attributes[r],o=n.values.length/n.componentsPerAttribute;if(i!==o&&-1!==i)throw new t("All mesh attribute lists must have the same number of attributes.");i=o}return i},u.reorderForPreVertexCache=function(e){if(e!==void 0){for(var i=u._computeNumberOfAttributes(e),r=[],n=0;i>n;n++)r[n]=-1;var o=e.indexLists;if(o!==void 0)for(var a=o.length,s=0;a>s;++s){for(var l,c=o[s].values,h=c.length,d=[],m=0,p=0,f=0;h>m;){if(l=r[c[m]],-1!==l)d[p]=l;else{if(l=c[m],l>=i)throw new t("Input indices contains a value greater than or equal to the number of vertices");r[l]=f,d[p]=f,++f}++m,++p}o[s].values=d}var v=e.attributes;if(v!==void 0)for(var g in v)if(v.hasOwnProperty(g)&&v[g].values){for(var _=v[g].values,y=0,w=v[g].componentsPerAttribute,C=[];i>y;){var x=r[y];for(n=0;w>n;n++)C[w*x+n]=_[w*y+n];++y}v[g].values=C}}return e},u.reorderForPostVertexCache=function(e,t){if(e!==void 0){var i=e.indexLists;if(i!==void 0)for(var r=i.length,n=0;r>n;n++){for(var o=i[n].values,a=o.length,l=0,u=0;a>u;u++)o[u]>l&&(l=o[u]);i[n].values=s.tipsify({indices:o,maximumIndex:l,cacheSize:t})}}return e},u._verifyTrianglesPrimitiveType=function(e){for(var i=e.length,r=0;i>r;++r)if(e[r].primitiveType!==a.TRIANGLES)throw new t("indexLists must have PrimitiveType equal to PrimitiveType.TRIANGLES.")},u._copyAttributesDescriptions=function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)&&e[i].values){var r=e[i];t[i]={componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,values:[]}}return t},u.fitToUnsignedShortIndices=function(e){function t(e,t,i){return{attributes:e,indexLists:[{primitiveType:t,values:i}]}}var i=[];if(e!==void 0){u._verifyTrianglesPrimitiveType(e.indexLists);var r=u._computeNumberOfAttributes(e),n=65536,o=e.indexLists;if(o!==void 0&&r>n)for(var a=o.length,s=0;a>s;++s){for(var c=[],h=[],d=0,m=u._copyAttributesDescriptions(e.attributes),p=o[s].values,f=p.length,v=0;f>v;v+=3){var g=p[v],_=p[v+1],y=p[v+2],w=c[g];w===void 0&&(w=d++,c[g]=w,l(m,e.attributes,g));var C=c[_];C===void 0&&(C=d++,c[_]=C,l(m,e.attributes,_));var x=c[y];x===void 0&&(x=d++,c[y]=x,l(m,e.attributes,y)),h.push(w),h.push(C),h.push(x),d+3>n&&(i.push(t(m,o[s].primitiveType,h)),c=[],h=[],d=0,m=u._copyAttributesDescriptions(e.attributes))}0!==h.length&&i.push(t(m,o[s].primitiveType,h))}else i.push(e)}return i},u.projectTo2D=function(e,t){if(e!==void 0&&e.attributes!==void 0&&e.attributes.position!==void 0){t=t!==void 0?t:new n;for(var r=t.getEllipsoid(),a=e.attributes.position.values,s=[],l=0;a.length>l;l+=3){var u=r.cartesianToCartographic(new i(a[l],a[l+1],a[l+2])),c=t.project(u);s.push(c.x,c.y)}e.attributes.position3D=e.attributes.position,e.attributes.position2D={componentDatatype:o.FLOAT,componentsPerAttribute:2,values:s},delete e.attributes.position}return e};var c={high:0,low:0};return u.encodeAttribute=function(i,n,a,s){if(n=e(n,"position"),a=e(a,"positionHigh"),s=e(s,"positionLow"),i===void 0)throw new t("mesh is required.");if(i.attributes===void 0)throw new t("mesh must have an attributes property.");var l=i.attributes[n];if(l===void 0)throw new t("mesh must have attribute matching the attributeName argument: "+n+".");if(l.componentDatatype!==o.FLOAT)throw new t("The attribute componentDatatype must be ComponentDatatype.FLOAT.");for(var u=l.values,h=u.length,d=Array(h),m=Array(h),p=0;h>p;++p)r.encode(u[p],c),d[p]=c.high,m[p]=c.low;return i.attributes[a]={componentDatatype:l.componentDatatype,componentsPerAttribute:l.componentsPerAttribute,values:d},i.attributes[s]={componentDatatype:l.componentDatatype,componentsPerAttribute:l.componentsPerAttribute,values:m},delete i.attributes[n],i},u}),i("Core/Occluder",["./defaultValue","./DeveloperError","./Math","./Cartesian3","./Visibility","./Ellipsoid","./BoundingSphere"],function(e,t,i,r,n,o,a){var s=function(e,i){if(!e)throw new t("occluderBoundingSphere is required.");if(!i)throw new t("camera position is required.");this._occluderPosition=e.center.clone(),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.setCameraPosition(i)};s.prototype.getPosition=function(){return this._occluderPosition},s.prototype.getRadius=function(){return this._occluderRadius},s.prototype.setCameraPosition=function(e){e=r.clone(e);var t,i,n,o=this._occluderPosition.subtract(e),a=o.magnitudeSquared(),s=this._occluderRadius*this._occluderRadius;if(a>s){t=Math.sqrt(a-s),a=1/Math.sqrt(a),i=o.multiplyByScalar(a);var l=t*t*a;n=e.add(i.multiplyByScalar(l))}else t=Number.MAX_VALUE;this._horizonDistance=t,this._horizonPlaneNormal=i,this._horizonPlanePosition=n,this._cameraPosition=e};var l=new r;s.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){var t=r.subtract(e,this._occluderPosition,l),i=this._occluderRadius;if(i=t.magnitudeSquared()-i*i,i>0)return i=Math.sqrt(i)+this._horizonDistance,t=r.subtract(e,this._cameraPosition,t),i*i>t.magnitudeSquared()}return!1},s.prototype.isBoundingSphereVisible=function(e){var t=e.center.clone(),i=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){var n=r.subtract(t,this._occluderPosition,l),o=this._occluderRadius-i;if(o=n.magnitudeSquared()-o*o,this._occluderRadius>i)return o>0?(o=Math.sqrt(o)+this._horizonDistance,n=r.subtract(t,this._cameraPosition,n),o*o+i*i>n.magnitudeSquared()):!1;if(o>0){n=t.subtract(this._cameraPosition);var a=n.magnitudeSquared(),s=this._occluderRadius*this._occluderRadius,u=i*i;return(this._horizonDistance*this._horizonDistance+s)*u>a*s?!0:(o=Math.sqrt(o)+this._horizonDistance,o*o+u>a)}return!0}return!1},s.prototype.getVisibility=function(e){var t=e.center.clone(),i=e.radius;if(i>this._occluderRadius)return n.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var r=t.subtract(this._occluderPosition),o=this._occluderRadius-i,a=r.magnitudeSquared();if(o=a-o*o,o>0){o=Math.sqrt(o)+this._horizonDistance,r=t.subtract(this._cameraPosition);var s=r.magnitudeSquared();return s>o*o+i*i?n.NONE:(o=this._occluderRadius+i,o=a-o*o,o>0?(o=Math.sqrt(o)+this._horizonDistance,o*o+i*i>s?n.FULL:n.PARTIAL):(r=t.subtract(this._horizonPlanePosition),r.dot(this._horizonPlaneNormal)>-i?n.PARTIAL:n.FULL))}}return n.NONE},s.getOccludeePoint=function(e,i,n){if(!e)throw new t("occluderBoundingSphere is required.");if(!n)throw new t("positions is required.");if(0===n.length)throw new t("positions must contain at least one element");var o=r.clone(i),a=e.center.clone(),l=e.radius,u=n.length;if(a.equals(i))throw new t("occludeePosition must be different than occluderBoundingSphere.center");var c=o.subtract(a).normalize(),h=-c.dot(a),d=s._anyRotationVector(a,c,h),m=s._horizonToPlaneNormalDotProduct(e,c,h,d,n[0]);if(!m)return void 0;for(var p,f=1;u>f;++f){if(p=s._horizonToPlaneNormalDotProduct(e,c,h,d,n[f]),!p)return void 0;m>p&&(m=p)}if(.0017453283658983088>m)return void 0;var v=l/m;return a.add(c.multiplyByScalar(v))};var u=[];return s.computeOccludeePointFromExtent=function(i,n){if(i===void 0)throw new t("extent is required.");n=e(n,o.WGS84);var l=i.subsample(n,u),c=a.fromPoints(l),h=r.ZERO;return h.equals(c.center)?void 0:s.getOccludeePoint(new a(h,n.getMinimumRadius()),c.center,l)},s._anyRotationVector=function(e,t,i){var n=t.clone().abs(),o=n.x>n.y?0:1;(0===o&&n.z>n.x||1===o&&n.z>n.y)&&(o=2);
var a=new r;0===o?(n.x=e.x,n.y=e.y+1,n.z=e.z+1,a=r.UNIT_X):1===o?(n.x=e.x+1,n.y=e.y,n.z=e.z+1,a=r.UNIT_Y):(n.x=e.x+1,n.y=e.y+1,n.z=e.z,a=r.UNIT_Z);var s=(t.dot(n)+i)/-t.dot(a);return n.add(a.multiplyByScalar(s)).subtract(e).normalize()},s._rotationVector=function(e,t,r,n,o){var a=n.subtract(e);if(a=a.normalize(),.9999999847691291>t.dot(a)){var s=t.cross(a),l=s.magnitude();if(l>i.EPSILON13)return s.normalize()}return o},s._horizonToPlaneNormalDotProduct=function(e,t,i,n,o){var a=r.clone(o),s=e.center.clone(),l=e.radius,u=s.subtract(a),c=u.magnitudeSquared(),h=l*l;if(h>c)return!1;var d=c-h,m=Math.sqrt(d),p=Math.sqrt(c),f=1/p,v=m*f,g=v*m;u=u.normalize();var _=a.add(u.multiplyByScalar(g)),y=Math.sqrt(d-g*g),w=this._rotationVector(s,t,i,a,n),C=new r(w.x*w.x*u.x+(w.x*w.y-w.z)*u.y+(w.x*w.z+w.y)*u.z,(w.x*w.y+w.z)*u.x+w.y*w.y*u.y+(w.y*w.z-w.x)*u.z,(w.x*w.z-w.y)*u.x+(w.y*w.z+w.x)*u.y+w.z*w.z*u.z);C=C.normalize();var x=C.multiplyByScalar(y);w=_.add(x).subtract(s).normalize();var T=t.dot(w);w=_.subtract(x).subtract(s).normalize();var S=t.dot(w);return S>T?T:S},s}),i("Core/Quaternion",["./Cartesian3","./defaultValue","./DeveloperError","./freezeObject","./Math","./Matrix3"],function(e,t,i,r,n,o){var a,s=function(e,i,r,n){this.x=t(e,0),this.y=t(i,0),this.z=t(r,0),this.w=t(n,0)};s.fromAxisAngle=function(t,r,n){if(t===void 0)throw new i("axis is required.");if("number"!=typeof r)throw new i("angle is required and must be a number.");var o=r/2,l=Math.sin(o);a=e.normalize(t,a);var u=a.x*l,c=a.y*l,h=a.z*l,d=Math.cos(o);return n===void 0?new s(u,c,h,d):(n.x=u,n.y=c,n.z=h,n.w=d,n)};var l=[1,2,0],u=Array(3);s.fromRotationMatrix=function(e,t){if(e===void 0)throw new i("matrix is required.");var r,n,a,c,h,d=e[o.COLUMN0ROW0],m=e[o.COLUMN1ROW1],p=e[o.COLUMN2ROW2],f=d+m+p;if(f>0)r=Math.sqrt(f+1),h=.5*r,r=.5/r,n=(e[o.COLUMN2ROW1]-e[o.COLUMN1ROW2])*r,a=(e[o.COLUMN0ROW2]-e[o.COLUMN2ROW0])*r,c=(e[o.COLUMN1ROW0]-e[o.COLUMN0ROW1])*r;else{var v=l,g=0;m>d&&(g=1),p>d&&p>m&&(g=2);var _=v[g],y=v[_];r=Math.sqrt(e[o.getElementIndex(g,g)]-e[o.getElementIndex(_,_)]-e[o.getElementIndex(y,y)]+1);var w=u;w[g]=.5*r,r=.5/r,h=(e[o.getElementIndex(y,_)]-e[o.getElementIndex(_,y)])*r,w[_]=(e[o.getElementIndex(_,g)]+e[o.getElementIndex(g,_)])*r,w[y]=(e[o.getElementIndex(y,g)]+e[o.getElementIndex(g,y)])*r,n=w[0],a=w[1],c=w[2]}return t===void 0?new s(n,a,c,h):(t.x=n,t.y=a,t.z=c,t.w=h,t)},s.clone=function(e,t){if(e===void 0)throw new i("quaternion is required");return t===void 0?new s(e.x,e.y,e.z,e.w):(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t)},s.conjugate=function(e,t){if(e===void 0)throw new i("quaternion is required");return t===void 0?new s(-e.x,-e.y,-e.z,e.w):(t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t)},s.magnitudeSquared=function(e){if(e===void 0)throw new i("quaternion is required");return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},s.magnitude=function(e){if(e===void 0)throw new i("quaternion is required");return Math.sqrt(s.magnitudeSquared(e))},s.normalize=function(e,t){var i=1/s.magnitude(e),r=e.x*i,n=e.y*i,o=e.z*i,a=e.w*i;return t===void 0?new s(r,n,o,a):(t.x=r,t.y=n,t.z=o,t.w=a,t)},s.inverse=function(e,t){var i=s.magnitudeSquared(e);return t=s.conjugate(e,t),s.multiplyByScalar(t,1/i,t)},s.add=function(e,t,r){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");return r===void 0?new s(e.x+t.x,e.y+t.y,e.z+t.z,e.w+t.w):(r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z,r.w=e.w+t.w,r)},s.subtract=function(e,t,r){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");return r===void 0?new s(e.x-t.x,e.y-t.y,e.z-t.z,e.w-t.w):(r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z,r.w=e.w-t.w,r)},s.negate=function(e,t){if(e===void 0)throw new i("quaternion is required");return t===void 0?new s(-e.x,-e.y,-e.z,-e.w):(t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t)},s.dot=function(e,t){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},s.multiply=function(e,t,r){if(e===void 0)throw new i("left is required");if(t===void 0)throw new i("right is required");var n=e.x,o=e.y,a=e.z,l=e.w,u=t.x,c=t.y,h=t.z,d=t.w,m=l*u+n*d+o*h-a*c,p=l*c-n*h+o*d+a*u,f=l*h+n*c-o*u+a*d,v=l*d-n*u-o*c-a*h;return r===void 0?new s(m,p,f,v):(r.x=m,r.y=p,r.z=f,r.w=v,r)},s.multiplyByScalar=function(e,t,r){if(e===void 0)throw new i("quaternion is required");if("number"!=typeof t)throw new i("scalar is required and must be a number.");return r===void 0?new s(e.x*t,e.y*t,e.z*t,e.w*t):(r.x=e.x*t,r.y=e.y*t,r.z=e.z*t,r.w=e.w*t,r)},s.divideByScalar=function(e,t,r){if(e===void 0)throw new i("quaternion is required");if("number"!=typeof t)throw new i("scalar is required and must be a number.");return r===void 0?new s(e.x/t,e.y/t,e.z/t,e.w/t):(r.x=e.x/t,r.y=e.y/t,r.z=e.z/t,r.w=e.w/t,r)},s.getAxis=function(t,r){if(t===void 0)throw new i("quaternion is required");var o=t.w;if(n.EPSILON6>Math.abs(o-1))return r===void 0?new e:(r.x=r.y=r.z=0,r);var a=1/Math.sqrt(1-o*o);return r===void 0?new e(t.x*a,t.y*a,t.z*a):(r.x=t.x*a,r.y=t.y*a,r.z=t.z*a,r)},s.getAngle=function(e){if(e===void 0)throw new i("quaternion is required");return n.EPSILON6>Math.abs(e.w-1)?0:2*Math.acos(e.w)};var c;s.lerp=function(e,t,r,n){if(e===void 0)throw new i("start is required.");if(t===void 0)throw new i("end is required.");if("number"!=typeof r)throw new i("t is required and must be a number.");return c=s.multiplyByScalar(t,r,c),n=s.multiplyByScalar(e,1-r,n),s.add(c,n,n)};var h,d,m;return s.slerp=function(e,t,r,o){if(e===void 0)throw new i("start is required.");if(t===void 0)throw new i("end is required.");if("number"!=typeof r)throw new i("t is required and must be a number.");var a=s.dot(e,t),l=t;if(0>a&&(a=-a,l=h=s.negate(t,h)),n.EPSILON6>1-a)return s.lerp(e,l,r);var u=Math.acos(a);return d=s.multiplyByScalar(e,Math.sin((1-r)*u),d),m=s.multiplyByScalar(l,Math.sin(r*u),m),o=s.add(d,m,o),s.multiplyByScalar(o,1/Math.sin(u),o)},s.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},s.equalsEpsilon=function(e,t,r){if("number"!=typeof r)throw new i("epsilon is required and must be a number.");return e===t||e!==void 0&&t!==void 0&&r>=Math.abs(e.x-t.x)&&r>=Math.abs(e.y-t.y)&&r>=Math.abs(e.z-t.z)&&r>=Math.abs(e.w-t.w)},s.ZERO=r(new s(0,0,0,0)),s.IDENTITY=r(new s(0,0,0,1)),s.prototype.clone=function(e){return s.clone(this,e)},s.prototype.conjugate=function(e){return s.conjugate(this,e)},s.prototype.magnitudeSquared=function(){return s.magnitudeSquared(this)},s.prototype.magnitude=function(){return s.magnitude(this)},s.prototype.normalize=function(e){return s.normalize(this,e)},s.prototype.inverse=function(e){return s.inverse(this,e)},s.prototype.add=function(e,t){return s.add(this,e,t)},s.prototype.subtract=function(e,t){return s.subtract(this,e,t)},s.prototype.negate=function(e){return s.negate(this,e)},s.prototype.dot=function(e){return s.dot(this,e)},s.prototype.multiply=function(e,t){return s.multiply(this,e,t)},s.prototype.multiplyByScalar=function(e,t){return s.multiplyByScalar(this,e,t)},s.prototype.divideByScalar=function(e,t){return s.divideByScalar(this,e,t)},s.prototype.getAxis=function(e){return s.getAxis(this,e)},s.prototype.getAngle=function(){return s.getAngle(this)},s.prototype.lerp=function(e,t,i){return s.lerp(this,e,t,i)},s.prototype.slerp=function(e,t,i){return s.slerp(this,e,t,i)},s.prototype.equals=function(e){return s.equals(this,e)},s.prototype.equalsEpsilon=function(e,t){return s.equalsEpsilon(this,e,t)},s.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},s}),i("Core/OrientationInterpolator",["./DeveloperError","./Quaternion"],function(e){var t=function(t){if(t===void 0||!(t instanceof Array)||2>t.length)throw new e("controlPoints is required. It must be an array with at least a length of 3.");this._points=t,this._lastTimeIndex=0};return t.prototype.getControlPoints=function(){return this._points},t.prototype._findIndex=function(e){var t=this._lastTimeIndex||0;if(e>=this._points[t].time){if(this._points.length>t+1&&this._points[t+1].time>e)return t;if(this._points.length>t+2&&this._points[t+2].time>e)return this._lastTimeIndex=t+1,this._lastTimeIndex}else if(t-1>=0&&e>=this._points[t-1].time)return this._lastTimeIndex=t-1,this._lastTimeIndex;for(t=0;this._points.length-1>t&&!(e>=this._points[t].time&&this._points[t+1].time>e);++t);return t===this._points.length-1&&(t=this._points.length-2),this._lastTimeIndex=t,this._lastTimeIndex},t.prototype.evaluate=function(t){if(t===void 0)throw new e("time is required.");if(this._points[0].time>t||t>this._points[this._points.length-1].time)throw new e("time is out of range.");var i=this._findIndex(t),r=(t-this._points[i].time)/(this._points[i+1].time-this._points[i].time);return this._points[i].orientation.slerp(this._points[i+1].orientation,r)},t}),i("Core/PlaneTessellator",["./DeveloperError","./Cartesian2","./PrimitiveType","./defaultValue"],function(e,t,i,r){var n={compute:function(n){n=r(n,r.EMPTY_OBJECT);var o=n.resolution!==void 0?n.resolution:new t(2,2),a=n.onInterpolation;if(1>=o.x||1>=o.y)throw new e("Resolution must be greater than one in both the x and y directions.");var s,l;if(a)for(l=0;o.y>l;++l){var u=l/(o.y-1);for(s=0;o.x>s;++s){var c=s/(o.x-1);a(new t(c,u))}}var h=[];for(l=0;o.y-1>l;++l){var d=l*o.x,m=(l+1)*o.x;for(s=0;o.x-1>s;++s)h.push(d+s,d+s+1,m+s+1),h.push(d+s,m+s+1,m+s)}return{attributes:{},indexLists:[{primitiveType:i.TRIANGLES,values:h}]}}};return n}),i("Core/pointInsideTriangle2D",["./DeveloperError"],function(e){var t=function(t,i,r,n){if(t===void 0||i===void 0||r===void 0||n===void 0)throw new e("point, p0, p1, and p2 are required.");var o=r.subtract(i),a=n.subtract(i),s=t.subtract(i),l=o.dot(o),u=o.dot(a),c=o.dot(s),h=a.dot(a),d=a.dot(s),m=1/(l*h-u*u),p=(h*c-u*d)*m,f=(l*d-u*c)*m;return p>0&&f>0&&1>p+f};return t}),i("Core/Queue",[],function(){var e=function(){this._array=[],this._offset=0,this.length=0};return e.prototype.enqueue=function(e){this._array.push(e),this.length++},e.prototype.dequeue=function(){if(0===this.length)return void 0;var e=this._array,t=this._offset,i=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this.length--,i},e.prototype.contains=function(e){return-1!==this._array.indexOf(e)},e.prototype.clear=function(){this._array.length=this._offset=this.length=0},e.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)},e}),i("Core/WindingOrder",["./Enumeration"],function(e){var t={CLOCKWISE:new e(2304,"CLOCKWISE"),COUNTER_CLOCKWISE:new e(2305,"COUNTER_CLOCKWISE"),validate:function(e){return e===t.CLOCKWISE||e===t.COUNTER_CLOCKWISE}};return t}),i("Core/PolygonPipeline",["./DeveloperError","./Math","./Cartesian2","./Cartesian3","./Ellipsoid","./EllipsoidTangentPlane","./defaultValue","./pointInsideTriangle2D","./ComponentDatatype","./PrimitiveType","./Queue","./WindingOrder"],function(e,t,i,r,n,o,a,s,l,u,c,h){function d(){this.head=void 0,this.tail=void 0,this.length=0}function m(e,t,i){var r=t.subtract(e),n=i.subtract(t);return r.x*n.y-r.y*n.x>=0}function p(e){for(var t=e[0].x,i=0,r=0;e.length>r;r++)e[r].x>t&&(t=e[r].x,i=r);return i}function f(e){for(var t=e[0][0].x,i=0,r=0;e.length>r;r++){var n=e[r][p(e[r])].x;n>t&&(t=n,i=r)}return i}function v(e){for(var t=[],i=0;e.length>i;i++){var r=e[(i-1+e.length)%e.length],n=e[i],o=e[(i+1)%e.length];m(r,n,o)||t.push(n)}return t}function g(e,t){for(var i=0;e.length>i;i++)if(t.equals(e[i]))return!0;return!1}function _(e,t,n){n=a(n,[]);var o=Number.MAX_VALUE,s=p(t),l=new r(t[s].x,e.y,0);n.push(s),n.push((s+1)%t.length);for(var u=t[0].x,c=u,h=1;t.length>h;++h)u>t[h].x?u=t[h].x:t[h].x>c&&(c=t[h].x);c+=c-u;var d=new r(c,e.y,0);for(h=0;t.length>h;h++){var m=t[h],f=t[(h+1)%t.length];if((m.x>=e.x||f.x>=e.x)&&(m.y>=e.y&&e.y>=f.y||e.y>=m.y&&f.y>=e.y)){var v=(f.y-m.y)*(d.x-e.x)-(f.x-m.x)*(d.y-e.y);if(0!==v){v=1/v;var g=((f.x-m.x)*(e.y-m.y)-(f.y-m.y)*(e.x-m.x))*v,_=((d.x-e.x)*(e.y-m.y)-(d.y-e.y)*(e.x-m.x))*v;if(g>=0&&1>=g&&_>=0&&1>=_){var y=new i(e.x+g*(d.x-e.x),e.y+g*(d.y-e.y)),w=y.subtract(e);v=w.magnitudeSquared(),o>v&&(l=y,o=v,n[0]=h,n[1]=(h+1)%t.length)}}}}return l}function y(e,t){var r,n=f(t),o=t[n],a=p(o),l=o[a],u=[],c=_(l,e,u);if(g(e,c))r=c;else{var h=e[u[0]].subtract(l).magnitudeSquared(),d=e[u[1]].subtract(l).magnitudeSquared(),m=d>h?e[u[0]]:e[u[1]],y=v(e),w=y.indexOf(m);-1!==w&&y.splice(w,1);for(var C=[],x=0;y.length>x;x++){var T=y[x];s(T,l,c,m)&&C.push(T)}var S=Number.MAX_VALUE;if(C.length>0){var E=new i(1,0,0);for(x=0;C.length>x;x++){var b=C[x].subtract(l),M=E.magnitude()*b.magnitude();if(0!==M){var I=Math.abs(Math.acos(E.dot(b)/M));S>I&&(S=I,m=C[x])}}}r=m}return e.indexOf(r)}function w(e,t,i){for(var r=T.computeWindingOrder2D(e),n=0;t.length>n;n++){var a=t[n];a[0].equals(a[a.length-1])||a.push(a[0]);var s=T.computeWindingOrder2D(a);s===r&&a.reverse()}var l=o.fromPoints(e,i),u=l.projectPointsOntoPlane(e),c=[];for(n=0;t.length>n;n++)c.push(l.projectPointsOntoPlane(t[n]));var h=y(u,c),d=f(c),m=p(c[d]),v=t[d],g=[];for(n=0;e.length>n;n++)g.push(e[n]);var _,w=[];if(0!==m)for(_=0;v.length>=_;_++){var C=(_+m)%v.length;0!==C&&w.push(v[C])}else for(_=0;v.length>_;_++)w.push(v[(_+m)%v.length]);var x=g.lastIndexOf(e[h]);w.push(e[x]);var S=g.slice(0,x+1),E=g.slice(x+1);return g=S.concat(w,E),t.splice(d,1),g}d.prototype.add=function(e){if(e!==void 0){var t={item:e,previous:this.tail,next:void 0};this.tail!==void 0?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this.length}},d.prototype.remove=function(e){e!==void 0&&(e.previous!==void 0&&e.next!==void 0?(e.previous.next=e.next,e.next.previous=e.previous):e.previous!==void 0?(e.previous.next=void 0,this.tail=e.previous):e.next!==void 0?(e.next.previous=void 0,this.head=e.next):(this.head=void 0,this.tail=void 0),--this.length)};var C=new r,x=new r,T={cleanUp:function(t){if(t===void 0)throw new e("positions is required.");var i=t.length;if(3>i)throw new e("At least three positions are required.");for(var r=[],n=i-1,o=0;i>o;n=o++){var a=t[n],s=t[o];a.equals(s)||r.push(s)}return r},computeArea2D:function(t){if(t===void 0)throw new e("positions is required.");var i=t.length;if(3>i)throw new e("At least three positions are required.");for(var r=0,n=i-1,o=0;i>o;n=o++){var a=t[n],s=t[o];r+=a.x*s.y-s.x*a.y}return.5*r},computeWindingOrder2D:function(e){var t=T.computeArea2D(e);return t>=0?h.COUNTER_CLOCKWISE:h.CLOCKWISE},earClip2D:function(t){if(t===void 0)throw new e("positions is required.");var i=t.length;if(3>i)throw new e("At least three positions are required.");for(var r=new d,n=0;i>n;++n)r.add({position:t[n],index:n});for(var o=[],a=r.head,l=a.next,u=l.next,c=i*i;r.length>3;){var h=a.item.position,p=l.item.position,f=u.item.position;if(m(h,p,f)){for(var v=!0,g=u.next?u.next:r.head;g!==a;g=g.next?g.next:r.head)if(s(g.item.position,h,p,f)){v=!1;break}if(v){o.push(a.item.index),o.push(l.item.index),o.push(u.item.index),r.remove(l),l=u,u=u.next?u.next:r.head;continue}}if(a=a.next?a.next:r.head,l=l.next?l.next:r.head,u=u.next?u.next:r.head,0===--c)break}var _=r.head,y=_.next,w=y.next;return o.push(_.item.index),o.push(y.item.index),o.push(w.item.index),o},computeSubdivision:function(i,r,n){if(i===void 0)throw new e("positions is required.");if(r===void 0)throw new e("indices is required.");if(3>r.length)throw new e("At least three indices are required.");if(0!==r.length%3)throw new e("The number of indices must be divisable by three.");if(n=a(n,t.toRadians(1)),0>=n)throw new e("granularity must be greater than zero.");for(var o=new c,s=r.length,h=0;s>h;h+=3)o.enqueue({i0:r[h],i1:r[h+1],i2:r[h+2]});for(var d,m=i.slice(0),p=[],f={};o.length>0;){var v,g=o.dequeue(),_=m[g.i0],y=m[g.i1],w=m[g.i2],C=_.angleBetween(y),x=y.angleBetween(w),T=w.angleBetween(_),S=Math.max(C,Math.max(x,T));S>n?C===S?(v=""+Math.min(g.i0,g.i1)+" "+(""+Math.max(g.i0,g.i1)),d=f[v],d||(m.push(_.add(y).multiplyByScalar(.5)),d=m.length-1,f[v]=d),o.enqueue({i0:g.i0,i1:d,i2:g.i2}),o.enqueue({i0:d,i1:g.i1,i2:g.i2})):x===S?(v=""+Math.min(g.i1,g.i2)+" "+(""+Math.max(g.i1,g.i2)),d=f[v],d||(m.push(y.add(w).multiplyByScalar(.5)),d=m.length-1,f[v]=d),o.enqueue({i0:g.i1,i1:d,i2:g.i0}),o.enqueue({i0:d,i1:g.i2,i2:g.i0})):T===S&&(v=""+Math.min(g.i2,g.i0)+" "+(""+Math.max(g.i2,g.i0)),d=f[v],d||(m.push(w.add(_).multiplyByScalar(.5)),d=m.length-1,f[v]=d),o.enqueue({i0:g.i2,i1:d,i2:g.i1}),o.enqueue({i0:d,i1:g.i0,i2:g.i1})):(p.push(g.i0),p.push(g.i1),p.push(g.i2))}var E=m.length,b=Array(3*E),M=0;for(d=0;E>d;d++){var I=m[d];b[M++]=I.x,b[M++]=I.y,b[M++]=I.z}return{attributes:{position:{componentDatatype:l.FLOAT,componentsPerAttribute:3,values:b}},indexLists:[{primitiveType:u.TRIANGLES,values:p}]}},scaleToGeodeticHeight:function(e,t,i){i=a(i,n.WGS84);var o=C,s=x;if(t=a(t,0),e!==void 0&&e.attributes!==void 0&&e.attributes.position!==void 0)for(var l=e.attributes.position.values,u=l.length,c=0;u>c;c+=3)s.x=l[c],s.y=l[c+1],s.z=l[c+2],i.scaleToGeodeticSurface(s,s),i.geodeticSurfaceNormal(s,o),r.multiplyByScalar(o,t,o),r.add(s,o,s),l[c]=s.x,l[c+1]=s.y,l[c+2]=s.z;return e},eliminateHoles:function(t,i,o){if(t===void 0)throw new e("outerRing is required.");if(0===t.length)throw new e("outerRing must not be empty.");if(i===void 0)throw new e("innerRings is required.");o=a(o,n.WGS84);for(var s=[],l=0;i.length>l;l++){for(var u=[],c=0;i[l].length>c;c++)u.push(r.clone(i[l][c]));s.push(u)}for(var h=t;s.length>0;)h=w(h,s,o);return h}};return T}),i("Core/PolylinePipeline",["./defaultValue","./Cartesian3","./Cartesian4","./IntersectionTests","./Matrix4","./Plane"],function(e,t,i,r,n,o){var a={},s=new n,l=new i,u=new i,c=new o(t.ZERO,0),h=new i,d=new o(t.ZERO,0),m=new t,p=new t;return a.wrapLongitude=function(a,f){var v=[],g=[];if(a!==void 0&&a.length>0){f=e(f,n.IDENTITY);var _=n.inverseTransformation(f,s),y=n.multiplyByPoint(_,t.ZERO,l),w=n.multiplyByVector(_,i.UNIT_Y,u),C=o.fromPointNormal(y,w,c),x=n.multiplyByVector(_,i.UNIT_X,h),T=o.fromPointNormal(y,x,d),S=1;v.push(t.clone(a[0]));for(var E=v[0],b=a.length,M=1;b>M;++M){var I=a[M];if(0>o.getPointDistance(T,E)||0>o.getPointDistance(T,I)){var D=r.lineSegmentPlane(E,I,C,m);if(D!==void 0){var A=t.multiplyByScalar(w,5e-9,p);0>o.getPointDistance(C,E)&&t.negate(A,A),v.push(t.add(D,A)),g.push(S+1),t.negate(A,A),v.push(t.add(D,A)),S=1}}v.push(t.clone(a[M])),S++,E=I}g.push(S)}return{positions:v,lengths:g}},a}),i("Core/ReferenceFrame",["./Enumeration"],function(e){var t={FIXED:new e(0,"FIXED"),INERTIAL:new e(1,"INERTIAL")};return t}),i("Core/destroyObject",["./defaultValue","./DeveloperError"],function(e,t){function i(){return!0}var r=function(r,n){function o(){throw new t(n)}n=e(n,"This object was destroyed, i.e., destroy() was called.");for(var a in r)"function"==typeof r[a]&&(r[a]=o);return r.isDestroyed=i,void 0};return r}),i("Core/ScreenSpaceEventType",["./Enumeration"],function(e){var t={LEFT_DOWN:new e(0,"LEFT_DOWN"),LEFT_UP:new e(1,"LEFT_UP"),LEFT_CLICK:new e(2,"LEFT_CLICK"),LEFT_DOUBLE_CLICK:new e(3,"LEFT_DOUBLE_CLICK"),RIGHT_DOWN:new e(5,"RIGHT_DOWN"),RIGHT_UP:new e(6,"RIGHT_UP"),RIGHT_CLICK:new e(7,"RIGHT_CLICK"),RIGHT_DOUBLE_CLICK:new e(8,"RIGHT_DOUBLE_CLICK"),MIDDLE_DOWN:new e(10,"MIDDLE_DOWN"),MIDDLE_UP:new e(11,"MIDDLE_UP"),MIDDLE_CLICK:new e(12,"MIDDLE_CLICK"),MIDDLE_DOUBLE_CLICK:new e(13,"MIDDLE_DOUBLE_CLICK"),MOUSE_MOVE:new e(15,"MOUSE_MOVE"),WHEEL:new e(16,"WHEEL"),PINCH_START:new e(17,"PINCH_START"),PINCH_END:new e(18,"PINCH_END"),PINCH_MOVE:new e(19,"PINCH_MOVE")};return t}),i("Core/ScreenSpaceEventHandler",["./DeveloperError","./destroyObject","./Cartesian2","./JulianDate","./ScreenSpaceEventType","./KeyboardEventModifier","./defaultValue"],function(e,t,i,r,n,o,a){var s=function(e){this._mouseEvents={};for(var t in n)n.hasOwnProperty(t)&&(this._mouseEvents[t]=void 0);this._modifiedMouseEvents={};for(var i in o)if(o.hasOwnProperty(i)){this._modifiedMouseEvents[i]={};for(t in n)n.hasOwnProperty(t)&&(this._modifiedMouseEvents[i][t]=void 0)}this._leftMouseButtonDown=!1,this._middleMouseButtonDown=!1,this._rightMouseButtonDown=!1,this._isPinching=!1,this._seenAnyTouchEvents=!1,this._lastMouseX=0,this._lastMouseY=0,this._lastTouch2X=0,this._lastTouch2Y=0,this._totalPixels=0,this._touchID1=0,this._touchID2=0,this._clickPixelTolerance=5,this._element=a(e,document),this._register()};return s.prototype._getPosition=function(e){if(this._element===document)return{x:e.clientX,y:e.clientY};var t=this._element.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},s.prototype.setInputAction=function(t,i,r){if(t===void 0)throw new e("action is required.");if(i===void 0)throw new e("type is required.");var n;n=r!==void 0&&r.name!==void 0?this._modifiedMouseEvents[r.name]:this._mouseEvents,i!==void 0&&i.name!==void 0&&n!==void 0&&(n[i.name]=t)},s.prototype.getInputAction=function(t,i){if(t===void 0)throw new e("type is required.");var r;return r=i!==void 0&&i.name!==void 0?this._modifiedMouseEvents[i.name]:this._mouseEvents,t!==void 0&&t.name!==void 0&&r!==void 0?r[t.name]:void 0},s.prototype.removeInputAction=function(t,i){if(t===void 0)throw new e("type is required.");var r;r=i!==void 0&&i.name!==void 0?this._modifiedMouseEvents[i.name]:this._mouseEvents,t!==void 0&&t.name!==void 0&&r!==void 0&&r[t.name]!==void 0&&delete r[t.name]},s.prototype._getModifier=function(e){return e.shiftKey?o.SHIFT:e.ctrlKey?o.CTRL:e.altKey?o.ALT:void 0},s.prototype._handleMouseDown=function(e){var t=this._getPosition(e);if(this._lastMouseX=t.x,this._lastMouseY=t.y,this._totalPixels=0,!this._seenAnyTouchEvents){var r,o=this._getModifier(e);0===e.button?(this._leftMouseButtonDown=!0,r=this.getInputAction(n.LEFT_DOWN,o)):1===e.button?(this._middleMouseButtonDown=!0,r=this.getInputAction(n.MIDDLE_DOWN,o)):2===e.button&&(this._rightMouseButtonDown=!0,r=this.getInputAction(n.RIGHT_DOWN,o)),r!==void 0&&r({position:new i(t.x,t.y)}),e.preventDefault()}},s.prototype._handleMouseUp=function(e){var t,r,o=this._getModifier(e);if(!this._seenAnyTouchEvents){0===e.button?(this._leftMouseButtonDown=!1,t=this.getInputAction(n.LEFT_UP,o),r=this.getInputAction(n.LEFT_CLICK,o)):1===e.button?(this._middleMouseButtonDown=!1,t=this.getInputAction(n.MIDDLE_UP,o),r=this.getInputAction(n.MIDDLE_CLICK,o)):2===e.button&&(this._rightMouseButtonDown=!1,t=this.getInputAction(n.RIGHT_UP,o),r=this.getInputAction(n.RIGHT_CLICK,o));var a=this._getPosition(e),s=this._lastMouseX-a.x,l=this._lastMouseY-a.y;this._totalPixels+=Math.sqrt(s*s+l*l),t!==void 0&&t({position:new i(a.x,a.y)}),r!==void 0&&this._clickPixelTolerance>this._totalPixels&&r({position:new i(a.x,a.y)})}},s.prototype._handleMouseMove=function(e){var t=this._getPosition(e);if(!this._seenAnyTouchEvents){var r=this._lastMouseX-t.x,o=this._lastMouseY-t.y;this._totalPixels+=Math.sqrt(r*r+o*o);var a={startPosition:new i(this._lastMouseX,this._lastMouseY),endPosition:new i(t.x,t.y),motion:new i},s=this._getModifier(e),l=this.getInputAction(n.MOUSE_MOVE,s);l!==void 0&&l(a),this._lastMouseX=a.endPosition.x,this._lastMouseY=a.endPosition.y,(this._leftMouseButtonDown||this._middleMouseButtonDown||this._rightMouseButtonDown)&&e.preventDefault()}},s.prototype._handleTouchStart=function(e){var t,r,o=e.touches.length;this._seenAnyTouchEvents=!0;var a,s=this._getModifier(e);t=this._getPosition(e.touches[0]),1===o?(this._lastMouseX=t.x,this._lastMouseY=t.y,this._totalPixels=0,this._leftMouseButtonDown=!0,a=this.getInputAction(n.LEFT_DOWN,s),a!==void 0&&a({position:new i(t.x,t.y)}),e.preventDefault()):this._leftMouseButtonDown&&(this._leftMouseButtonDown=!1,a=this.getInputAction(n.LEFT_UP,s),a!==void 0&&a({position:new i(t.x,t.y)})),2===o?(this._isPinching=!0,r=this._getPosition(e.touches[1]),this._touchID1=e.touches[0].identifier,this._touchID2=e.touches[1].identifier,this._lastMouseX=t.x,this._lastMouseY=t.y,this._lastTouch2X=r.x,this._lastTouch2Y=r.y,a=this.getInputAction(n.PINCH_START,s),a!==void 0&&a({position1:new i(t.x,t.y),position2:new i(r.x,r.y)})):this._isPinching&&(this._isPinching=!1,a=this.getInputAction(n.PINCH_END,s),a!==void 0&&a())},s.prototype._handleTouchEnd=function(e){var t,r,o=e.touches.length,a=e.changedTouches.length,s=this._getModifier(e);if(this._leftMouseButtonDown&&(this._leftMouseButtonDown=!1,t=this.getInputAction(n.LEFT_UP,s),r=this.getInputAction(n.LEFT_CLICK,s),a>0)){var l=this._getPosition(e.changedTouches[0]),u=this._lastMouseX-l.x,c=this._lastMouseY-l.y;this._totalPixels+=Math.sqrt(u*u+c*c),t!==void 0&&t({position:new i(l.x,l.y)}),r!==void 0&&this._clickPixelTolerance>this._totalPixels&&r({position:new i(l.x,l.y)})}this._isPinching&&(this._isPinching=!1,t=this.getInputAction(n.PINCH_END,s),t&&t()),(1===o||2===o)&&this._handleTouchStart(e)},s.prototype._handleTouchMove=function(e){var t,r,o,a,s=this._getModifier(e);if(this._leftMouseButtonDown&&1===e.touches.length){t=this._getPosition(e.touches[0]);var l=this._lastMouseX-t.x,u=this._lastMouseY-t.y;this._totalPixels+=Math.sqrt(l*l+u*u),a={startPosition:new i(this._lastMouseX,this._lastMouseY),endPosition:new i(t.x,t.y),motion:new i},o=this.getInputAction(n.MOUSE_MOVE,s),o!==void 0&&o(a),this._lastMouseX=a.endPosition.x,this._lastMouseY=a.endPosition.y,(this._leftMouseButtonDown||this._middleMouseButtonDown||this._rightMouseButtonDown)&&e.preventDefault()}if(this._isPinching&&2===e.touches.length){if(e.touches[0].identifier===this._touchID2?(t=this._getPosition(e.touches[1]),r=this._getPosition(e.touches[0])):(t=this._getPosition(e.touches[0]),r=this._getPosition(e.touches[1])),o=this.getInputAction(n.PINCH_MOVE,s),o!==void 0){var c=r.x-t.x,h=r.y-t.y,d=.25*Math.sqrt(c*c+h*h),m=this._lastTouch2X-this._lastMouseX,p=this._lastTouch2Y-this._lastMouseY,f=.25*Math.sqrt(m*m+p*p),v=.125*(r.y+t.y),g=.125*(this._lastTouch2Y+this._lastMouseY),_=Math.atan2(h,c),y=Math.atan2(p,m);a={distance:{startPosition:new i(0,f),endPosition:new i(0,d),motion:new i},angleAndHeight:{startPosition:new i(y,g),endPosition:new i(_,v),motion:new i}},o(a)}this._lastMouseX=t.x,this._lastMouseY=t.y,this._lastTouch2X=r.x,this._lastTouch2Y=r.y}},s.prototype._handleMouseWheel=function(e){var t=e.detail?-120*e.detail:e.wheelDelta,i=this._getModifier(e),r=n.WHEEL,o=this.getInputAction(r,i);o!==void 0&&(e.preventDefault(),o(t))},s.prototype._handleMouseDblClick=function(e){var t,r=this._getModifier(e),o=this._getPosition(e);0===e.button?t=this.getInputAction(n.LEFT_DOUBLE_CLICK,r):1===e.button?t=this.getInputAction(n.MIDDLE_DOUBLE_CLICK,r):2===e.button&&(t=this.getInputAction(n.RIGHT_DOUBLE_CLICK,r)),t!==void 0&&t({position:new i(o.x,o.y)})},s.prototype._register=function(){var e=this,t=!0;this._callbacks=[],this._element.disableRootEvents!==void 0&&(t=!1),this._callbacks.push({name:"mousedown",onDoc:!1,action:function(t){e._handleMouseDown(t)}}),this._callbacks.push({name:"mouseup",onDoc:t,action:function(t){e._handleMouseUp(t)}}),this._callbacks.push({name:"mousemove",onDoc:t,action:function(t){e._handleMouseMove(t)}}),this._callbacks.push({name:"dblclick",onDoc:!1,action:function(t){e._handleMouseDblClick(t)}}),this._callbacks.push({name:"touchstart",onDoc:!1,action:function(t){e._handleTouchStart(t)}}),this._callbacks.push({name:"touchend",onDoc:t,action:function(t){e._handleTouchEnd(t)}}),this._callbacks.push({name:"touchmove",onDoc:t,action:function(t){e._handleTouchMove(t)}}),this._callbacks.push({name:"mousewheel",onDoc:!1,action:function(t){e._handleMouseWheel(t)}}),this._callbacks.push({name:"DOMMouseScroll",onDoc:!1,action:function(t){e._handleMouseWheel(t)}});for(var i=0;this._callbacks.length>i;i++){var r=this._callbacks[i];r.onDoc?document.addEventListener(r.name,r.action,!1):this._element.addEventListener(r.name,r.action,!1)}},s.prototype._unregister=function(){for(var e=0;this._callbacks.length>e;e++){var t=this._callbacks[e];t.onDoc?document.removeEventListener(t.name,t.action,!1):this._element.removeEventListener(t.name,t.action,!1)}},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._unregister(),t(this)},s}),i("Core/Shapes",["./defaultValue","./DeveloperError","./Math","./Cartesian2","./Cartesian3","./Quaternion","./Matrix3"],function(e,t,i,r,n,o,a){function s(e,t,i,r,n,s,l,u,c,h,d,m,p,f,v,g,_,y){for(var w,C,x,T,S,E,b,M,I=0;y>I;I++,p+=v,++_){C=v>0?m[p]+f:f-m[p],T=C+d,S=-Math.cos(T),b=c.multiplyByScalar(S),S=Math.sin(T),M=h.multiplyByScalar(S),b=b.add(M),S=Math.cos(C),S*=S,E=Math.sin(C),E*=E,x=n/Math.sqrt(r*S+i*E),w=x/t,S=Math.sin(w/2);var D=new o(b.x*S,b.y*S,b.z*S,Math.cos(w/2)).normalize(),A=a.fromQuaternion(D),P=A.multiplyByVector(u),R=P.normalize();P=R.multiplyByScalar(l),g[_]=P}}var l={computeCircleBoundary:function(r,n,o,a){if(r===void 0||n===void 0||o===void 0)throw new t("ellipsoid, center, and radius are required.");if(0>=o)throw new t("radius must be greater than zero.");if(a=e(a,i.toRadians(1)),0>=a)throw new t("granularity must be greater than zero.");return this.computeEllipseBoundary(r,n,o,o,0,a)},computeEllipseBoundary:function(r,o,a,l,u,c){if(r===void 0||o===void 0||a===void 0||l===void 0)throw new t("ellipsoid, center, semiMajorAxis, and semiMinorAxis are required.");if(0>=a||0>=l)throw new t("Semi-major and semi-minor axes must be greater than zero.");if(u=u||0,c=e(c,i.toRadians(1)),0>=c)throw new t("granularity must be greater than zero.");if(l>a){var h=a;a=l,l=h}for(var d=2.31,m=a*a,p=l*l,f=a*l,v=1-p/m,g=Math.sqrt(v),_=n.clone(o),y=_.magnitude(),w=new n(0,0,1),C=1/y,x=_.multiplyByScalar(C),T=w.cross(_).normalize(),S=x.cross(T),E=1+Math.ceil(i.PI_OVER_TWO/c),b=d/(E-1),M=[],I=0,D=0,A=0;E>A;A++,D+=b,++I)if(M[I]=D-g*Math.sin(D),M[I]>=i.PI_OVER_TWO){M[I]=i.PI_OVER_TWO,E=A+1;break}var P=[];return s(r,_.magnitude(),m,p,f,g,y,x,T,S,u,M,0,0,1,P,0,E-1),s(r,_.magnitude(),m,p,f,g,y,x,T,S,u,M,E-1,Math.PI,-1,P,E-1,E-1),s(r,_.magnitude(),m,p,f,g,y,x,T,S,u,M,0,Math.PI,1,P,2*E-2,E-1),s(r,_.magnitude(),m,p,f,g,y,x,T,S,u,M,E-1,i.TWO_PI,-1,P,3*E-3,E),P.push(P[0].clone()),P}};return l}),i("Core/Simon1994PlanetaryPositions",["./Cartesian3","./DeveloperError","./JulianDate","./Math","./Matrix3","./TimeConstants","./TimeStandard","./Transforms"],function(e,t,i,r,n,o,a){function s(e){var t=6.239996+.0172019696544*e;return.001657*Math.sin(t+.01671*Math.sin(t))}function l(e,t){t=e.addSeconds(y,t);var i=t.getTotalDays()-w;return t=t.addSeconds(s(i),t)}function u(i,n,o,a,s,l,u,d){if(0>o&&(o=-o,s+=r.PI),0>o||o>r.PI)throw new t("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");var m=i*(1-n),f=a-s,v=s,g=h(l-a,n),_=c(n,0);if("Hyperbolic"===_&&Math.abs(r.NegativePiToPi(g))>=Math.acos(-1/n))throw new t("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");p(f,o,v,I);var y=m*(1+n),w=Math.cos(g),C=Math.sin(g),x=1+n*w;if(r.Epsilon10>=x)throw new t("elements cannot be converted to cartesian");var T=y/x;return d===void 0?d=new e(T*w,T*C,0):(d.x=T*w,d.y=T*C,d.z=0),I.multiplyByVector(d,d)}function c(e,i){if(0>e)throw new t("eccentricity cannot be negative.");return i>=e?"Circular":1-i>e?"Elliptical":1+i>=e?"Parabolic":"Hyperbolic"}function h(e,i){if(0>i||i>=1)throw new t("eccentricity out of range.");var r=d(e,i);return m(r,i)}function d(e,i){if(0>i||i>=1)throw new t("eccentricity out of range.");var n=Math.floor(e/r.TWO_PI);e-=n*r.TWO_PI;var o,a=e+i*Math.sin(e)/(1-Math.sin(e+i)+Math.sin(e)),s=Number.MAX_VALUE;for(o=0;D>o&&Math.abs(s-a)>A;++o){s=a;var l=s-i*Math.sin(s)-e,u=1-i*Math.cos(s);a=s-l/u}if(o>=D)throw new t("Kepler equation did not converge");return s=a+n*r.TWO_PI}function m(e,i){if(0>i||i>=1)throw new t("eccentricity out of range.");var n=Math.floor(e/r.TWO_PI);e-=n*r.TWO_PI;var o=Math.cos(e)-i,a=Math.sin(e)*Math.sqrt(1-i*i),s=Math.atan2(a,o);return s=r.zeroToTwoPi(s),0>e&&(s-=r.TWO_PI),s+=n*r.TWO_PI}function p(e,i,o,a){if(0>i||i>r.PI)throw new t("inclination out of range");var s=Math.cos(e),l=Math.sin(e),u=Math.cos(i),c=Math.sin(i),h=Math.cos(o),d=Math.sin(o);return a===void 0?a=new n(h*s-d*l*u,-h*l-d*s*u,d*c,d*s+h*l*u,-d*l+h*s*u,-h*c,l*c,s*c,u):(a[0]=h*s-d*l*u,a[1]=d*s+h*l*u,a[2]=l*c,a[3]=-h*l-d*s*u,a[4]=-d*l+h*s*u,a[5]=s*c,a[6]=d*c,a[7]=-h*c,a[8]=u),a
}function f(e,t){l(e,It);var i=It.getJulianDayNumber()-C.getJulianDayNumber()+(It.getSecondsOfDay()-C.getSecondsOfDay())/o.SECONDS_PER_DAY,r=i/(10*o.DAYS_PER_JULIAN_CENTURY),n=.3595362*r,a=P+k*Math.cos(z*n)+K*Math.sin(z*n)+W*Math.cos(L*n)+J*Math.sin(L*n)+H*Math.cos(N*n)+Q*Math.sin(N*n)+j*Math.cos(V*n)+$*Math.sin(V*n)+G*Math.cos(B*n)+et*Math.sin(B*n)+Y*Math.cos(F*n)+tt*Math.sin(F*n)+X*Math.cos(q*n)+it*Math.sin(q*n)+Z*Math.cos(U*n)+rt*Math.sin(U*n),s=R+O*r+dt*Math.cos(nt*n)+wt*Math.sin(nt*n)+mt*Math.cos(ot*n)+Ct*Math.sin(ot*n)+pt*Math.cos(at*n)+xt*Math.sin(at*n)+ft*Math.cos(st*n)+Tt*Math.sin(st*n)+vt*Math.cos(lt*n)+St*Math.sin(lt*n)+gt*Math.cos(ut*n)+Et*Math.sin(ut*n)+_t*Math.cos(ct*n)+bt*Math.sin(ct*n)+yt*Math.cos(ht*n)+Mt*Math.sin(ht*n),c=.0167086342-.0004203654*r,h=102.93734808*E+11612.3529*b*r,d=469.97289*b*r,m=174.87317577*E-8679.27034*b*r;return u(a,c,d,h,m,s,T,t)}function v(e,t){l(e,It);var i=It.getJulianDayNumber()-C.getJulianDayNumber()+(It.getSecondsOfDay()-C.getSecondsOfDay())/o.SECONDS_PER_DAY,r=i/o.DAYS_PER_JULIAN_CENTURY,n=r*r,a=n*r,s=a*r,c=383397.7725+.004*r,h=.055545526-1.6e-8*r,d=5.15668983*E,m=-8e-5*r+.02966*n-42e-6*a-1.3e-7*s,p=83.35324312*E,f=14643420.2669*r-38.2702*n-.045047*a+21301e-8*s,v=125.04455501*E,g=-6967919.3631*r+6.3602*n+.007625*a-3586e-8*s,_=218.31664563*E,y=1732559343.4847*r-6.391*n+.006588*a-3169e-8*s,w=297.85019547*E+b*(1602961601.209*r-6.3706*n+.006593*a-3169e-8*s),T=93.27209062*E+b*(1739527262.8478*r-12.7512*n-.001037*a+417e-8*s),M=134.96340251*E+b*(1717915923.2178*r+31.8792*n+.051635*a-2447e-7*s),I=357.52910918*E+b*(129596581.0481*r-.5532*n+136e-6*a-1149e-8*s),D=310.17137918*E-b*(6967051.436*r+6.2068*n+.007618*a-3219e-8*s),A=2*w,P=4*w,R=6*w,O=2*M,z=3*M,L=4*M,N=2*T;c+=3400.4*Math.cos(A)-635.6*Math.cos(A-M)-235.6*Math.cos(M)+218.1*Math.cos(A-I)+181*Math.cos(A+M),h+=.014216*Math.cos(A-M)+.008551*Math.cos(A-O)-.001383*Math.cos(M)+.001356*Math.cos(A+M)-.001147*Math.cos(P-z)-914e-6*Math.cos(P-O)+869e-6*Math.cos(A-I-M)-627e-6*Math.cos(A)-394e-6*Math.cos(P-L)+282e-6*Math.cos(A-I-O)-279e-6*Math.cos(w-M)-236e-6*Math.cos(O)+231e-6*Math.cos(P)+229e-6*Math.cos(R-L)-201e-6*Math.cos(O-N),m+=486.26*Math.cos(A-N)-40.13*Math.cos(A)+37.51*Math.cos(N)+25.73*Math.cos(O-N)+19.97*Math.cos(A-I-N),f+=-55609*Math.sin(A-M)-34711*Math.sin(A-O)-9792*Math.sin(M)+9385*Math.sin(P-z)+7505*Math.sin(P-O)+5318*Math.sin(A+M)+3484*Math.sin(P-L)-3417*Math.sin(A-I-M)-2530*Math.sin(R-L)-2376*Math.sin(A)-2075*Math.sin(A-z)-1883*Math.sin(O)-1736*Math.sin(R-5*M)+1626*Math.sin(I)-1370*Math.sin(R-z),g+=-5392*Math.sin(A-N)-540*Math.sin(I)-441*Math.sin(A)+423*Math.sin(N)-288*Math.sin(O-N),y+=-3332.9*Math.sin(A)+1197.4*Math.sin(A-M)-662.5*Math.sin(I)+396.3*Math.sin(M)-218*Math.sin(A-I);var V=2*D,B=3*D;m+=46.997*Math.cos(D)*r-.614*Math.cos(A-N+D)*r+.614*Math.cos(A-N-D)*r-.0297*Math.cos(V)*n-.0335*Math.cos(D)*n+.0012*Math.cos(A-N+V)*n-16e-5*Math.cos(D)*a+4e-5*Math.cos(B)*a+4e-5*Math.cos(V)*a;var F=2.116*Math.sin(D)*r-.111*Math.sin(A-N-D)*r-.0015*Math.sin(D)*n;f+=F,y+=F,g+=-520.77*Math.sin(D)*r+13.66*Math.sin(A-N+D)*r+1.12*Math.sin(A-D)*r-1.06*Math.sin(N-D)*r+.66*Math.sin(V)*n+.371*Math.sin(D)*n-.035*Math.sin(A-N+V)*n-.015*Math.sin(A-N+D)*n+.0014*Math.sin(D)*a-.0011*Math.sin(B)*a-9e-4*Math.sin(V)*a,c*=S;var q=d+m*b,U=p+f*b,k=_+y*b,W=v+g*b;return u(c,h,q,U,W,k,x,t)}function g(e,t){var i=v(e);return t=i.multiplyByScalar(At,t)}var _={},y=32.184,w=2451545,C=i.fromTotalDays(2451545,a.TAI),x=398600435e6,T=328900.56*1.012300034*x,S=1e3,E=r.RADIANS_PER_DEGREE,b=r.RADIANS_PER_ARCSECOND,M=14959787e4,I=new n,D=50,A=r.EPSILON8,P=1.0000010178*M,R=100.46645683*E,O=1295977422.83429*b,z=16002,L=21863,N=32004,V=10931,B=14529,F=16368,q=15318,U=32794,k=64e-7*M,W=-152*1e-7*M,H=62e-7*M,j=-8e-7*M,G=32e-7*M,Y=-41*1e-7*M,X=19e-7*M,Z=-11*1e-7*M,K=-150*1e-7*M,J=-46*1e-7*M,Q=68*1e-7*M,$=54e-7*M,et=14e-7*M,tt=24e-7*M,it=-28*1e-7*M,rt=22e-7*M,nt=10,ot=16002,at=21863,st=10931,lt=1473,ut=32004,ct=4387,ht=73,dt=-325*1e-7,mt=-322*1e-7,pt=-79*1e-7,ft=232*1e-7,vt=-52*1e-7,gt=97e-7,_t=55e-7,yt=-41*1e-7,wt=-105*1e-7,Ct=-137*1e-7,xt=258e-7,Tt=35e-7,St=-116*1e-7,Et=-88*1e-7,bt=-112*1e-7,Mt=-80*1e-7,It=new i,Dt=.012300034,At=-1*(Dt/(Dt+1)),Pt=new n(1.0000000000000002,5.619723173785822e-16,4.690511510146299e-19,-5.154129427414611e-16,.9174820620691819,-.39777715593191376,-2.23970096136568e-16,.39777715593191376,.9174820620691819),Rt=new e;return _.ComputeSunPositionInEarthInertialFrame=function(e,t){return e===void 0&&(e=new i),Rt=f(e,Rt),t=Rt.negate(t),g(e,Rt),t.subtract(Rt,t),Pt.multiplyByVector(t,t),t},_.ComputeMoonPositionInEarthInertialFrame=function(e,t){return e===void 0&&(e=new i),t=v(e,t),Pt.multiplyByVector(t,t),t},_}),i("Core/Spherical",["./DeveloperError","./defaultValue"],function(e,t){var i=function(e,i,r){this.clock=t(e,0),this.cone=t(i,0),this.magnitude=t(r,1)};return i.fromCartesian3=function(t,r){if(t===void 0)throw new e("cartesian3 is required");var n=t.x,o=t.y,a=t.z,s=n*n+o*o;return r===void 0&&(r=new i),r.clock=Math.atan2(o,n),r.cone=Math.atan2(Math.sqrt(s),a),r.magnitude=Math.sqrt(s+a*a),r},i.clone=function(t,r){if(t===void 0)throw new e("spherical is required");return r===void 0?new i(t.clock,t.cone,t.magnitude):(r.clock=t.clock,r.cone=t.cone,r.magnitude=t.magnitude,r)},i.normalize=function(t,r){if(t===void 0)throw new e("spherical is required");return r===void 0?new i(t.clock,t.cone,1):(r.clock=t.clock,r.cone=t.cone,r.magnitude=1,r)},i.equals=function(e,t){return e===t||e!==void 0&&t!==void 0&&e.clock===t.clock&&e.cone===t.cone&&e.magnitude===t.magnitude},i.equalsEpsilon=function(e,i,r){return r=t(r,0),e===i||e!==void 0&&i!==void 0&&r>=Math.abs(e.clock-i.clock)&&r>=Math.abs(e.cone-i.cone)&&r>=Math.abs(e.magnitude-i.magnitude)},i.toString=function(e){return"("+e.clock+", "+e.cone+", "+e.magnitude+")"},i.prototype.clone=function(e){return i.clone(this,e)},i.prototype.normalize=function(e){return i.normalize(this,e)},i.prototype.equals=function(e){return i.equals(this,e)},i.prototype.equalsEpsilon=function(e,t){return i.equalsEpsilon(this,e,t)},i.prototype.toString=function(){return i.toString(this)},i}),i("Core/isCrossOriginUrl",[],function(){var e,t=function(t){e===void 0&&(e=document.createElement("a")),e.href=window.location.href;var i=e.host,r=e.protocol;return e.href=t,e.href=e.href,r!==e.protocol||i!==e.host};return t}),i("ThirdParty/Uri",[],function(){function e(t){if(t instanceof e)this.scheme=t.scheme,this.authority=t.authority,this.path=t.path,this.query=t.query,this.fragment=t.fragment;else if(t){var i=r.exec(t);this.scheme=i[1],this.authority=i[2],this.path=i[3],this.query=i[4],this.fragment=i[5]}}function t(e){var t=unescape(e);return o.test(t)?t:e.toUpperCase()}function i(e,t,i,r){return(t||"")+i.toLowerCase()+(r||"")}e.prototype.scheme=null,e.prototype.authority=null,e.prototype.path="",e.prototype.query=null,e.prototype.fragment=null;var r=RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");e.prototype.getScheme=function(){return this.scheme},e.prototype.getAuthority=function(){return this.authority},e.prototype.getPath=function(){return this.path},e.prototype.getQuery=function(){return this.query},e.prototype.getFragment=function(){return this.fragment},e.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},e.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},e.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},e.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(a,i).replace(n,t)),this.path&&(this.path=this.path.replace(n,t)),this.query&&(this.query=this.query.replace(n,t)),this.fragment&&(this.fragment=this.fragment.replace(n,t))};var n=/%[0-9a-z]{2}/gi,o=/[a-zA-Z0-9\-\._~]/,a=/(.*@)?([^@:]*)(:.*)?/;e.prototype.resolve=function(t){var i=new e;return this.scheme?(i.scheme=this.scheme,i.authority=this.authority,i.path=this.path,i.query=this.query):(i.scheme=t.scheme,this.authority?(i.authority=this.authority,i.path=this.path,i.query=this.query):(i.authority=t.authority,""==this.path?(i.path=t.path,i.query=this.query||t.query):("/"==this.path.charAt(0)?(i.path=this.path,i.removeDotSegments()):(i.path=t.authority&&""==t.path?"/"+this.path:t.path.substring(0,t.path.lastIndexOf("/")+1)+this.path,i.removeDotSegments()),i.query=this.query))),i.fragment=this.fragment,i},e.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),i=[],r=""==t[0];for(r&&t.shift(),""==t[0]?t.shift():null;t.length;)e=t.shift(),".."==e?i.pop():"."!=e&&i.push(e);("."==e||".."==e)&&i.push(""),r&&i.unshift(""),this.path=i.join("/")},e.resolve=function(t,i){var r=s[t]||(s[t]=new e(t)),n=s[i]||(s[i]=new e(i));return""+r.resolve(n)};var s={};return e.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},e}),i("Core/TaskProcessor",["require","./buildModuleUrl","./defaultValue","./isCrossOriginUrl","../ThirdParty/when","../ThirdParty/Uri"],function(e,t,i,r,n,o){function a(e,t){--e._activeTasks;var i=t.data,r=i.id,n=i.result,o=e._deferreds,a=o[r];a.resolve(n),delete o[r]}function s(){if(u!==void 0)return u;if(u=t("Workers/cesiumWorkerBootstrapper.js"),r(u)){var e,i='importScripts("'+u+'");';try{e=new Blob([i],{type:"application/javascript"})}catch(n){var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=new o;a.append(i),e=a.getBlob("application/javascript")}var s=window.URL||window.webkitURL;u=s.createObjectURL(e)}return u}function l(r){var n=s(),l=new Worker(n);l.postMessage=i(l.webkitPostMessage,l.postMessage);var u={loaderConfig:{},workerModule:"Workers/"+r._workerName};if(e.toUrl!==void 0){var c=new o(t("Workers/cesiumWorkerBootstrapper.js")).resolve(new o(document.location.href)),h=""+new o("..").resolve(c);u.loaderConfig.baseUrl=h}else{var d=""+new o(t("Workers")).resolve(new o(document.location.href));u.loaderConfig.paths={Workers:d}}l.postMessage(u),l.onmessage=function(e){a(r,e)},r._worker=l}var u,c=function(e,t){this._workerName=e,this._maximumActiveTasks=i(t,5),this._activeTasks=0,this._deferreds={},this._nextID=0};return c.prototype.scheduleTask=function(e,t){if(this._worker===void 0&&l(this),this._activeTasks>=this._maximumActiveTasks)return void 0;++this._activeTasks;var i=this._nextID++,r=n.defer();return this._deferreds[i]=r,this._worker.postMessage({id:i,parameters:e},t),r.promise},c}),i("Core/TimeIntervalCollection",["./DeveloperError","./binarySearch","./TimeInterval","./JulianDate"],function(e,t,i,r){function n(e,t){return r.compare(e.start,t.start)}var o=function(){this._intervals=[]};return o.prototype.get=function(t){if(isNaN(t))throw new e("index must be a number.");return this._intervals[t]},o.prototype.getStart=function(){var e=this._intervals;return 0===e.length?void 0:e[0].start},o.prototype.getStop=function(){var e=this._intervals,t=e.length;return 0===t?void 0:e[t-1].stop},o.prototype.getLength=function(){return this._intervals.length},o.prototype.clear=function(){this._intervals=[]},o.prototype.isEmpty=function(){return 0===this._intervals.length},o.prototype.findIntervalContainingDate=function(e){var t=this.indexOf(e);return t>=0?this._intervals[t]:void 0},o.prototype.contains=function(e){return this.indexOf(e)>=0},o.prototype.indexOf=function(r){if(r===void 0)throw new e("date required");var o=this._intervals,a=t(o,new i(r,r,!0,!0),n);return a>=0?o[a].isStartIncluded?a:a>0&&o[a-1].stop.equals(r)&&o[a-1].isStopIncluded?a-1:~a:(a=~a,a>0&&o.length>a-1&&o[a-1].contains(r)?a-1:~a)},o.prototype.findInterval=function(e,t,i,r){for(var n,o=this._intervals,a=0,s=o.length;s>a;a++)if(n=o[a],!(void 0!==e&&!n.start.equals(e)||void 0!==t&&!n.stop.equals(t)||void 0!==i&&n.isStartIncluded!==i||void 0!==r&&n.isStopIncluded!==r))return o[a];return void 0},o.prototype.addInterval=function(o,a){if(o===void 0)throw new e("interval is required");if(!o.isEmpty){var s,l,u=this._intervals;if(0===u.length||o.start.greaterThan(u[u.length-1].stop))return u.push(o),void 0;for(l=t(u,o,n),0>l?l=~l:l>0&&o.isStartIncluded&&u[l-1].isStartIncluded&&u[l-1].start.equals(o.start)?--l:u.length>l&&!o.isStartIncluded&&u[l].isStartIncluded&&u[l].start.equals(o.start)&&++l,l>0&&(s=r.compare(u[l-1].stop,o.start),(s>0||0===s&&(u[l-1].isStopIncluded||o.isStartIncluded))&&((a!==void 0?a(u[l-1].data,o.data):u[l-1].data===o.data)?(o=o.stop.greaterThan(u[l-1].stop)?new i(u[l-1].start,o.stop,u[l-1].isStartIncluded,o.isStopIncluded,o.data):new i(u[l-1].start,u[l-1].stop,u[l-1].isStartIncluded,u[l-1].isStopIncluded||o.stop.equals(u[l-1].stop)&&o.isStopIncluded,o.data),u.splice(l-1,1),--l):(s=r.compare(u[l-1].stop,o.stop),s>0||0===s&&u[l-1].isStopIncluded&&!o.isStopIncluded?u.splice(l-1,1,new i(u[l-1].start,o.start,u[l-1].isStartIncluded,!o.isStartIncluded,u[l-1].data),new i(o.stop,u[l-1].stop,!o.isStopIncluded,u[l-1].isStopIncluded,u[l-1].data)):u[l-1]=new i(u[l-1].start,o.start,u[l-1].isStartIncluded,!o.isStartIncluded,u[l-1].data))));u.length>l&&(s=r.compare(o.stop,u[l].start),s>0||0===s&&(o.isStopIncluded||u[l].isStartIncluded));)if(a!==void 0?a(u[l].data,o.data):u[l].data===o.data)o=new i(o.start,u[l].stop.greaterThan(o.stop)?u[l].stop:o.stop,o.isStartIncluded,u[l].stop.greaterThan(o.stop)?u[l].isStopIncluded:o.isStopIncluded,o.data),u.splice(l,1);else{if(u[l]=new i(o.stop,u[l].stop,!o.isStopIncluded,u[l].isStopIncluded,u[l].data),!u[l].isEmpty)break;u.splice(l,1)}u.splice(l,0,o)}},o.prototype.removeInterval=function(r){if(r===void 0)throw new e("interval is required");if(r.isEmpty)return!1;var o=!1,a=this._intervals,s=t(a,r,n);0>s&&(s=~s);var l=r.start,u=r.stop,c=r.isStartIncluded,h=r.isStopIncluded;if(s>0){var d=a[s-1],m=d.stop;(m.greaterThan(l)||m.equals(l)&&d.isStopIncluded&&c)&&(o=!0,(m.greaterThan(u)||d.isStopIncluded&&!h&&m.equals(u))&&a.splice(s,0,new i(u,m,!h,d.isStopIncluded,d.data)),a[s-1]=new i(d.start,l,d.isStartIncluded,!c,d.data))}var p=a[s];for(a.length>s&&!c&&p.isStartIncluded&&l.equals(p.start)&&(o=!0,a.splice(s,0,new i(p.start,p.start,!0,!0,p.data)),++s,p=a[s]);a.length>s&&u.greaterThan(p.stop);)o=!0,a.splice(s,1);return a.length>s&&u.equals(p.stop)&&(o=!0,!h&&p.isStopIncluded?a.length>s+1&&a[s+1].start.equals(u)&&p.data===a[s+1].data?(a.splice(s,1),a[s]=p=new i(p.start,p.stop,!0,p.isStopIncluded,p.data)):a[s]=p=new i(u,u,!0,!0,p.data):a.splice(s,1)),a.length>s&&(u.greaterThan(p.start)||u.equals(p.start)&&h&&p.isStartIncluded)&&(o=!0,a[s]=new i(u,p.stop,!h,p.isStopIncluded,p.data)),o},o.prototype.intersect=function(t,i,r){if(t===void 0)throw new e("timeIntervalCollection is required.");return this._intersectInternal(t,i,r)},o.prototype.intersectInterval=function(t,i,r){if(t===void 0)throw new e("interval is required.");var n=new o;return n.addInterval(t),this._intersectInternal(n,i,r)},o.prototype._intersectInternal=function(e,t,i){for(var r=0,n=0,a=new o,s=this._intervals,l=e._intervals;s.length>r&&l.length>n;){var u=s[r],c=l[n];if(u.stop.lessThan(c.start))++r;else if(c.stop.lessThan(u.start))++n;else{if(i!==void 0||t!==void 0&&t(u,c)||t===void 0&&c.data===u.data){var h=u.intersect(c,i);h.isEmpty||a.addInterval(h,t)}u.stop.lessThan(c.stop)||u.stop.equals(c.stop)&&!u.isStopIncluded&&c.isStopIncluded?++r:++n}}return a},o}),i("Core/WebMercatorProjection",["./defaultValue","./Cartesian3","./Cartographic","./Math","./Ellipsoid"],function(e,t,i,r,n){var o=function(t){this._ellipsoid=e(t,n.WGS84),this._semimajorAxis=this._ellipsoid.getMaximumRadius(),this._oneOverSemimajorAxis=1/this._semimajorAxis};return o.mercatorAngleToGeodeticLatitude=function(e){return r.PI_OVER_TWO-2*Math.atan(Math.exp(-e))},o.geodeticLatitudeToMercatorAngle=function(e){e>o.MaximumLatitude?e=o.MaximumLatitude:-o.MaximumLatitude>e&&(e=-o.MaximumLatitude);var t=Math.sin(e);return.5*Math.log((1+t)/(1-t))},o.MaximumLatitude=o.mercatorAngleToGeodeticLatitude(Math.PI),o.prototype.getEllipsoid=function(){return this._ellipsoid},o.prototype.project=function(e,i){var r=this._semimajorAxis,n=e.longitude*r,a=o.geodeticLatitudeToMercatorAngle(e.latitude)*r,s=e.height;return i===void 0?new t(n,a,s):(i.x=n,i.y=a,i.z=s,i)},o.prototype.unproject=function(e,t){var r=this._oneOverSemimajorAxis,n=e.x*r,a=o.mercatorAngleToGeodeticLatitude(e.y*r),s=e.z;return t===void 0?new i(n,a,s):(t.longitude=n,t.latitude=a,t.height=s,t)},o}),i("Core/combine",["./DeveloperError","./defaultValue"],function(e,t){var i=function(e,i,n){i=t(i,!0),n=t(n,!0);for(var o={},a=0;e.length>a;a++)r(o,e[a],i,n);return o},r=function(t,i,n,o){for(var a in i)if(i.hasOwnProperty(a))if(t.hasOwnProperty(a)&&t[a]!==void 0){if(!o)throw new e("Duplicate member: "+a);n&&"object"==typeof t[a]&&"object"==typeof i[a]&&r(t[a],i[a],n,o)}else t[a]=i[a]};return i}),i("Core/createGuid",[],function(){var e=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),i="x"===e?t:8|3&t;return i.toString(16)})};return e}),i("Core/jsonp",["./defaultValue","./DeveloperError","../ThirdParty/when"],function(e,t,i){function r(e,t,i){e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}var n=function(o,a){if(o===void 0)throw new t("url is required.");a=e(a,e.EMPTY_OBJECT);var s,l=i.defer();do s="jsonp"+(""+Math.random()).substring(2,8);while(window[s]!==void 0);window[s]=function(e){l.resolve(e);try{delete window[s]}catch(t){window[s]=void 0}};var u=e(a.callbackParameterName,"callback"),c=[];r(c,u,s);var h=e(a.parameters,e.EMPTY_OBJECT);for(var d in h)h.hasOwnProperty(d)&&r(c,d,h[d]);c.length>0&&(o+=-1===o.indexOf("?")?"?":"&",o+=c.join("&"));var m=a.proxy;return m!==void 0&&(o=m.getURL(o)),n.loadAndExecuteScript(o,s,l),l.promise};return n.loadAndExecuteScript=function(e,t,i){var r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];r.onload=function(){r.onload=void 0,n.removeChild(r)},r.onerror=function(e){i.reject(e)},n.appendChild(r)},n.defaultLoadAndExecuteScript=n.loadAndExecuteScript,n}),i("Core/loadArrayBuffer",["./DeveloperError","./RequestErrorEvent","../ThirdParty/when"],function(e,t,i){var r=function(t,n){if(t===void 0)throw new e("url is required.");return i(t,function(e){var t=i.defer();return r.load(e,n,t),t.promise})};return r.load=function(e,i,r){var n=new XMLHttpRequest;if(n.open("GET",e,!0),i!==void 0)for(var o in i)i.hasOwnProperty(o)&&n.setRequestHeader(o,i[o]);n.responseType="arraybuffer",n.onload=function(){200===n.status?r.resolve(n.response):r.reject(new t(n.status,n.response))},n.onerror=function(){r.reject(new t)},n.send()},r.defaultLoad=r.load,r}),i("Core/loadImage",["./defaultValue","./DeveloperError","./isCrossOriginUrl","../ThirdParty/when"],function(e,t,i,r){var n=/^data:/,o=function(a,s){if(a===void 0)throw new t("url is required.");return s=e(s,!0),r(a,function(e){var t;t=n.test(e)||!s?!1:i(e);var a=r.defer();return o.createImage(e,t,a),a.promise})};return o.createImage=function(e,t,i){var r=new Image;r.onload=function(){i.resolve(r)},r.onerror=function(e){i.reject(e)},t&&(r.crossOrigin=""),r.src=e},o.defaultCreateImage=o.createImage,o}),i("Core/loadXML",["./DeveloperError","./RequestErrorEvent","../ThirdParty/when"],function(e,t,i){var r=function(t,n){if(t===void 0)throw new e("url is required.");return i(t,function(e){var t=i.defer();return r.loadXML(e,n,t),t.promise})};return r.loadXML=function(e,i,r){var n=new XMLHttpRequest;if(n.overrideMimeType("text/xml"),n.open("GET",e,!0),i!==void 0)for(var o in i)i.hasOwnProperty(o)&&n.setRequestHeader(o,i[o]);n.onload=function(){200===n.status?r.resolve(n.responseXML):r.reject(new t(n.status,n.response))},n.onerror=function(){r.reject(new t)},n.send()},r.defaultLoadXML=r.loadXML,r}),i("Core/requestAnimationFrame",[],function(){var e=window.requestAnimationFrame;if(e===void 0)for(var t=["webkit","moz","ms","o"],i=0,r=t.length;r>i&&e===void 0;)e=window[t[i]+"RequestAnimationFrame"],++i;if(e===void 0){var n=0;e=function(e){var t=Date.now(),i=Math.max(16-(t-n),0);return n=t+i,setTimeout(function(){e(n)},i)}}var o=function(t){e(t)};return o}),i("Core/throttleRequestByServer",["./defaultValue","../ThirdParty/when"],function(e,t){function i(e){return n===void 0&&(n=document.createElement("a")),n.href=e,n.hostname+"%"+n.port}function r(r,n){var s=i(r),l=e(a[s],0);return l>o?void 0:(a[s]=l+1,t(n(r),function(e){return a[s]--,e},function(e){return a[s]--,t.reject(e)}))}var n,o=6,a={};return r}),i("ThirdParty/measureText",[],function(){var e=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},t=function(t,i,r,n){var o=t.measureText(i),a=e(t.canvas,"font-family"),s=e(t.canvas,"font-size").replace("px",""),l=!/\S/.test(i);o.fontsize=s;var u=document.createElement("div");u.style.position="absolute",u.style.opacity=0,u.style.font=s+"px "+a,u.innerHTML=i+"<br/>"+i,document.body.appendChild(u),o.leading=1.2*s;var c=e(u,"height");if(c=c.replace("px",""),c>=2*s&&(o.leading=0|c/2),document.body.removeChild(u),l)o.ascent=0,o.descent=0,o.bounds={minx:0,maxx:o.width,miny:0,maxy:0},o.height=0;else{var h=document.createElement("canvas"),d=100;h.width=o.width+d,h.height=3*s,h.style.opacity=1,h.style.fontFamily=a,h.style.fontSize=s;var m=h.getContext("2d");m.font=s+"px "+a;var p=h.width,f=h.height,v=f/2;m.fillStyle="white",m.fillRect(-1,-1,p+2,f+2),r&&(m.strokeStyle="black",m.lineWidth=t.lineWidth,m.strokeText(i,d/2,v)),n&&(m.fillStyle="black",m.fillText(i,d/2,v));for(var g=m.getImageData(0,0,p,f).data,_=0,y=4*p,w=g.length;w>++_&&255===g[_];);var C=0|_/y;for(_=w-1;--_>0&&255===g[_];);var x=0|_/y;for(_=0;w>_&&255===g[_];)_+=y,_>=w&&(_=_-w+4);var T=0|_%y/4,S=1;for(_=w-3;_>=0&&255===g[_];)_-=y,0>_&&(_=w-3-4*S++);var E=0|_%y/4+1;o.ascent=v-C,o.descent=x-v,o.bounds={minx:T-d/2,maxx:E-d/2,miny:0,maxy:x-C},o.height=1+(x-C)}return o};return t}),i("Core/writeTextToCanvas",["./defaultValue","./DeveloperError","./Color","../ThirdParty/measureText"],function(e,t,i,r){var n=function(n,o){if(n===void 0)throw new t("text is required.");if(""===n)return void 0;o=e(o,e.EMPTY_OBJECT);var a=e(o.font,"10px sans-serif"),s=document.createElement("canvas");s.width=s.height=1,s.style.font=a;var l=s.getContext("2d");l.font=a,l.textBaseline=e(o.textBaseline,"bottom"),s.style.visibility="hidden",document.body.appendChild(s);var u=e(o.stroke,!1),c=e(o.fill,!0),h=2*e(o.strokeWidth,1);l.lineWidth=h;var d=r(l,n,u,c);s.dimensions=d,document.body.removeChild(s),s.style.visibility=void 0;var m=d.height-d.ascent;s.width=d.width,s.height=d.height;var p=s.height-m;if(l.font=a,u){var f=e(o.strokeColor,i.BLACK);l.strokeStyle=f.toCssColorString(),l.lineWidth=h,l.strokeText(n,0,p)}if(c){var v=e(o.fillColor,i.WHITE);l.fillStyle=v.toCssColorString(),l.fillText(n,0,p)}return s};return n}),i("DynamicScene/DynamicProperty",["../Core/DeveloperError","../Core/Iso8601","../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/binarySearch","../Core/HermitePolynomialApproximation","../Core/LinearApproximation","../Core/LagrangePolynomialApproximation"],function(e,t,i,r,n,o,a,s,l){function u(){this.interpolationAlgorithm=s,this.numberOfPoints=s.getRequiredDataPoints(1),this.interpolationDegree=1,this.times=void 0,this.values=void 0,this.isSampled=!1,this.xTable=void 0,this.yTable=void 0}function c(e,t){return"string"==typeof e?i.fromIso8601(e):t.addSeconds(e)}var h={HERMITE:a,LAGRANGE:l,LINEAR:s},d=function(t){if(t===void 0)throw new e("valueType is required.");this.valueType=t,this._intervals=new n,this._cachedTime=void 0,this._cachedInterval=void 0};d.prototype.processCzmlIntervals=function(e,t,i){if(Array.isArray(e))for(var r=0,n=e.length;n>r;r++)this._addCzmlInterval(e[r],t,i);else this._addCzmlInterval(e,t,i)};var m;return d.prototype.getValue=function(e,t){var r=this.valueType;if(this._staticValue!==void 0)return r.getValue(this._staticValue,t);var n=this._cachedInterval;if(i.equals(this._cachedTime,e)||(this._cachedTime=i.clone(e,this._cachedTime),void 0!==n&&n.contains(e)||(n=this._intervals.findIntervalContainingDate(e),this._cachedInterval=n)),n===void 0)return void 0;var a=n.data,s=a.times,l=a.values;if(a.isSampled&&s.length>=0&&l.length>0){var u=r.doublesPerValue,c=o(s,e,i.compare);if(0>c){if(2>a.numberOfPoints)return void 0;c=~c,c>=s.length&&(c=s.length-1);var h=0,d=s.length-1,p=a.numberOfPoints-1,f=d-h+1;if(p+1>f);else{var v=c-(0|p/2)-1;h>v&&(v=h);var g=v+p;g>d&&(g=d,v=g-p,h>v&&(v=h)),h=v,d=g}var _=d-h+1,y=r.doublesPerInterpolationValue,w=a.xTable,C=a.yTable;w===void 0&&(w=a.xTable=Array(a.numberOfPoints),C=a.yTable=Array(a.numberOfPoints*y));for(var x=0;_>x;++x)w[x]=s[d].getSecondsDifference(s[h+x]);var T=r.packValuesForInterpolation;if(T===void 0)for(var S=0,E=h*u,b=(d+1)*u;b>E;)C[S]=l[E],E++,S++;else T(l,C,h,d);var M=s[d].getSecondsDifference(e);m=a.interpolationAlgorithm.interpolateOrderZero(M,w,C,y,m);var I=r.getValueFromInterpolationResult;return I===void 0?r.getValueFromArray(m,0,t):I(m,t,l,h,d)}return r.getValueFromArray(a.values,c*u,t)}return r.getValue(a.values,t)},d._mergeNewSamples=function(e,t,r,n,a){for(var s,l,u,h,d,m,p,f,v=0;n.length>v;)if(p=c(n[v],e),u=o(t,p,i.compare),0>u){for(u=~u,d=[u,0],h=u*a,m=[h,0],l=void 0,f=t[u];n.length>v&&(p=c(n[v],e),!(l!==void 0&&i.compare(l,p)>=0||f!==void 0&&i.compare(p,f)>=0));){for(d.push(p),v+=1,s=0;a>s;s++)m.push(n[v]),v+=1;l=p}Array.prototype.splice.apply(r,m),Array.prototype.splice.apply(t,d)}else{for(s=0;a>s;s++)v++,r[u*a+s]=n[v];v++}},d.prototype._addCzmlInterval=function(e,i,n){var o=e.interval;o=o===void 0?t.MAXIMUM_INTERVAL:r.fromIso8601(o),i!==void 0&&(o=o.intersect(i));var a=this.valueType.unwrapInterval(e,n);a!==void 0&&this._addCzmlIntervalUnwrapped(o.start,o.stop,a,e.epoch,e.interpolationAlgorithm,e.interpolationDegree)},d.prototype._addCzmlIntervalUnwrapped=function(e,n,o,a,s,l){var c=this._intervals,m=c.findInterval(e,n);this._cachedTime=void 0,this._cachedInterval=void 0;var p;m===void 0?(p=new u,m=new r(e,n,!0,!0,p),c.addInterval(m)):p=m.data;var f=this.valueType;if(f.isSampled(o)){var v;s!==void 0&&(v=h[s],p.interpolationAlgorithm=v),v!==void 0&&l!==void 0&&(p.interpolationDegree=l,p.xTable=void 0,p.yTable=void 0),p.isSampled||(p.times=[],p.values=[],p.isSampled=!0),a!==void 0&&(a=i.fromIso8601(a)),d._mergeNewSamples(a,p.times,p.values,o,f.doublesPerValue,f),p.numberOfPoints=Math.min(p.interpolationAlgorithm.getRequiredDataPoints(p.interpolationDegree),p.times.length),this._staticValue=void 0}else p.times=void 0,p.values=o,p.isSampled=!1,this._staticValue=m.equals(t.MAXIMUM_INTERVAL)?o:void 0},d}),i("DynamicScene/CzmlPosition",["../Core/Cartesian3","../Core/Cartographic","../Core/Math","../Core/Ellipsoid"],function(e,t,i,r){var n=3,o=new e,a=new t,s={doublesPerValue:n,doublesPerInterpolationValue:n,unwrapInterval:function(e){var t=e.cartesian;if(t!==void 0)return t;var n,s,l=o,u=e.cartographicRadians;if(u!==void 0)if(this.isSampled(u))for(s=u.length,t=Array(s),n=0;s>n;n+=4)a.longitude=u[n+1],a.latitude=u[n+2],a.height=u[n+3],r.WGS84.cartographicToCartesian(a,l),t[n]=u[n],t[n+1]=l.x,t[n+2]=l.y,t[n+3]=l.z;else a.longitude=u[0],a.latitude=u[1],a.height=u[2],r.WGS84.cartographicToCartesian(a,l),t=[l.x,l.y,l.z];else{var c=e.cartographicDegrees;if(c===void 0)return void 0;if(this.isSampled(c))for(s=c.length,t=Array(s),n=0;s>n;n+=4)a.longitude=i.toRadians(c[n+1]),a.latitude=i.toRadians(c[n+2]),a.height=c[n+3],r.WGS84.cartographicToCartesian(a,l),t[n]=c[n],t[n+1]=l.x,t[n+2]=l.y,t[n+3]=l.z;else a.longitude=i.toRadians(c[0]),a.latitude=i.toRadians(c[1]),a.height=c[2],r.WGS84.cartographicToCartesian(a,l),t=[l.x,l.y,l.z]}return t},isSampled:function(e){return Array.isArray(e)&&e.length>n},getValue:function(t,i){return i===void 0&&(i=new e),i.x=t[0],i.y=t[1],i.z=t[2],i},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.x=t[i],r.y=t[i+1],r.z=t[i+2],r}};return s}),i("DynamicScene/DynamicPositionProperty",["../Core/Cartesian3","../Core/Cartographic","../Core/DeveloperError","../Core/Ellipsoid","../Core/Iso8601","../Core/JulianDate","../Core/Matrix3","../Core/ReferenceFrame","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Transforms","./CzmlPosition","./DynamicProperty"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){var m=new a,p=r.WGS84,f=function(){this._dynamicProperties=[],this._propertyIntervals=new u,this._cachedTime=void 0,this._cachedInterval=void 0};return f.prototype.processCzmlIntervals=function(e,t){if(Array.isArray(e))for(var i=0,r=e.length;r>i;i++)this._addCzmlInterval(e[i],t);else this._addCzmlInterval(e,t)},f.prototype.getValueCartographic=function(e,t){if(e===void 0)throw new i("time is required.");var r=this._cachedInterval;if(o.equals(this._cachedTime,e)||(this._cachedTime=o.clone(e,this._cachedTime),void 0!==r&&r.contains(e)||(r=this._propertyIntervals.findIntervalContainingDate(e),this._cachedInterval=r)),r===void 0)return void 0;var n=r.data;if(t=r.cachedValue=n.getValue(e,r.cachedValue),t!==void 0){if(r.data.referenceFrame===s.INERTIAL){var a=c.computeIcrfToFixedMatrix(e,m);if(a===void 0)return void 0;t=a.multiplyByVector(t,t)}t=p.cartesianToCartographic(t)}return t},f.prototype.getValueCartesian=function(e,t){if(e===void 0)throw new i("time is required.");var r=this._cachedInterval;if(o.equals(this._cachedTime,e)||(this._cachedTime=o.clone(e,this._cachedTime),void 0!==r&&r.contains(e)||(r=this._propertyIntervals.findIntervalContainingDate(e),this._cachedInterval=r)),r===void 0)return void 0;var n=r.data;if(t=n.getValue(e,t),r.data.referenceFrame===s.INERTIAL){var a=c.computeIcrfToFixedMatrix(e,m);return a===void 0?void 0:a.multiplyByVector(t,t)}return t},f.prototype.getValueRangeCartesian=function(e,t,r,n){if(e===void 0)throw new i("start is required");if(t===void 0)throw new i("stop is required");n===void 0&&(n=[]);var o=this._propertyIntervals,a=e!==void 0?o.indexOf(e):0,s=t!==void 0?o.indexOf(t):o.length-1;if(0>a&&(a=~a),a===o.getLength())return n.length=0,n;if(0>s){if(s=~s,s!==o.getLength())return n.length=0,n;s-=1}var l,u=0;l=this.getValueCartesian(e,n[u]),l!==void 0&&(n[u++]=l);for(var c=r===void 0||r.lessThan(e)||r.greaterThan(t),h=a;s+1>h;h++){var d,m=o.get(h),p=o.get(h+1),f=t;p!==void 0&&t.greaterThan(p.start)&&(f=p.start);var v=m.data,g=v._intervals.get(0),_=g.data.times;if(_!==void 0){var y;for(y=0;_.length>y;y++)d=_[y],!c&&d.greaterThanOrEquals(r)&&(l=v.getValue(r,n[u]),l!==void 0&&(n[u++]=l),c=!0),d.greaterThan(e)&&d.lessThan(f)&&(l=v.getValue(d,n[u]),l!==void 0&&(n[u++]=l))}else d=m.start,c=c||d.greaterThanOrEquals(r),d.lessThan(f)&&(l=v.getValue(d,n[u]),l!==void 0&&(n[u++]=l))}return l=this.getValueCartesian(t,n[u]),l!==void 0&&(n[u++]=l),n.length=u,n},f.prototype._addCzmlInterval=function(e,t){this._cachedTime=void 0,this._cachedInterval=void 0;var i,r,o=e.interval;o=o===void 0?n.MAXIMUM_INTERVAL.clone():l.fromIso8601(o),t!==void 0&&(o=o.intersect(t));var a=this._propertyIntervals,u=a.findInterval(o.start,o.stop);u!==void 0?(i=u.data,i!==void 0&&(r=h.unwrapInterval(e))):(u=o,a.addInterval(u)),r===void 0&&(r=h.unwrapInterval(e),r!==void 0&&(i=new d(h),this._dynamicProperties.push(i),u.data=i,i.referenceFrame=s.FIXED)),r!==void 0&&(e.referenceFrame!==void 0&&(u.data.referenceFrame=s[e.referenceFrame]),i._addCzmlIntervalUnwrapped(o.start,o.stop,r,e.epoch,e.interpolationAlgorithm,e.interpolationDegree))},f.prototype._getReferenceFrame=function(){var e=this._propertyIntervals;return e.getLength()>0?e.get(0).data.referenceFrame:void 0},f.prototype._getValueInReferenceFrame=function(e,t,r){if(e===void 0)throw new i("time is required.");var n=this._cachedInterval;if(o.equals(this._cachedTime,e)||(this._cachedTime=o.clone(e,this._cachedTime),void 0!==n&&n.contains(e)||(n=this._propertyIntervals.findIntervalContainingDate(e),this._cachedInterval=n)),n===void 0)return void 0;var a=n.data;if(r=a.getValue(e,r),n.data.referenceFrame!==t){if(t===s.FIXED){var l=c.computeIcrfToFixedMatrix(e,m);
return l===void 0?void 0:l.multiplyByVector(r,r)}if(t===s.INERTIAL){var u=c.computeFixedToIcrfMatrix(e,m);return u===void 0?void 0:u.multiplyByVector(r,r)}}return r},f.prototype._getValueRangeInReferenceFrame=function(e,t,r,n,o,a){if(e===void 0)throw new i("start is required");if(t===void 0)throw new i("stop is required");a===void 0&&(a=[]);var s=this._propertyIntervals,l=e!==void 0?s.indexOf(e):0,u=t!==void 0?s.indexOf(t):s.length-1;if(0>l&&(l=~l),l===s.getLength())return a.length=0,a;if(0>u){if(u=~u,u!==s.getLength())return a.length=0,a;u-=1}var c,h=0;c=this._getValueInReferenceFrame(e,n,a[h]),c!==void 0&&(a[h++]=c);for(var d=r===void 0||r.lessThan(e)||r.greaterThan(t),m=l;u+1>m;m++){var p,f=s.get(m),v=s.get(m+1),g=t;v!==void 0&&t.greaterThan(v.start)&&(g=v.start);var _,y,w,C=!1,x=f.data,T=x._intervals.get(0),S=T.data.times;if(S!==void 0){var E=0,b=S.length;for(p=S[E];b>E;){if(!d&&p.greaterThanOrEquals(r)&&(c=this._getValueInReferenceFrame(r,n,a[h]),c!==void 0&&(a[h++]=c),d=!0),p.greaterThan(e)&&p.lessThan(g)&&(c=this._getValueInReferenceFrame(p,n,a[h]),c!==void 0&&(a[h++]=c)),b-1>E){if(!C){var M=S[E+1],I=p.getSecondsDifference(M);C=I>o,C&&(_=Math.floor(I/o),y=0,w=I/Math.max(_,2),_=Math.max(_-2,1))}if(C&&_>y){p=p.addSeconds(w),y++;continue}}C=!1,E++,p=S[E]}}else p=f.start,d=d||p.greaterThanOrEquals(r),p.lessThan(g)&&(c=this._getValueInReferenceFrame(p,n,a[h]),c!==void 0&&(a[h++]=c))}return c=this._getValueInReferenceFrame(t,n,a[h]),c!==void 0&&(a[h++]=c),a.length=h,a},f}),i("DynamicScene/ReferenceProperty",["../Core/defaultValue","../Core/DeveloperError"],function(e,t){function i(t){var i=t._targetProperty;if(i===void 0){var r=e(t._dynamicObjectCollection.compositeCollection,t._dynamicObjectCollection),n=r.getObject(t._targetObjectId);n!==void 0&&(i=n[t._targetPropertyName],t._targetProperty=i,t._targetObject=n)}return i}var r=function(e,i,r){if(e===void 0)throw new t("dynamicObjectCollection is required.");if(i===void 0)throw new t("targetObjectId is required.");if(r===void 0)throw new t("targetPropertyName is required.");this._targetProperty=void 0,this._dynamicObjectCollection=e,this._targetObjectId=i,this._targetObject=void 0,this._targetPropertyName=r};return r.fromString=function(e,i){if(e===void 0)throw new t("dynamicObjectCollection is required.");if(i===void 0)throw new t("referenceString is required.");var n=i.split(".");if(2!==n.length)throw new t("referenceString must contain a single . delineating the target object ID and property name.");return new r(e,n[0],n[1])},r.prototype.getValue=function(e,t){var r=i(this);return r!==void 0&&this._targetObject.isAvailable(e)?r.getValue(e,t):void 0},r.prototype.getValueCartographic=function(e,t){var r=i(this);return r!==void 0&&this._targetObject.isAvailable(e)?r.getValueCartographic(e,t):void 0},r.prototype.getValueCartesian=function(e,t){var r=i(this);return r!==void 0&&this._targetObject.isAvailable(e)?r.getValueCartesian(e,t):void 0},r.prototype.getValueSpherical=function(e,t){var r=i(this);return r!==void 0&&this._targetObject.isAvailable(e)?r.getValueSpherical(e,t):void 0},r}),i("DynamicScene/DynamicVertexPositionsProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Cartesian3","../Core/Cartographic","../Core/Iso8601","../Core/Ellipsoid","./ReferenceProperty","./DynamicPositionProperty"],function(e,t,i,r,n,o,a,s){function l(e){var t,i,o,a=[];if(o=e.cartesian,o!==void 0){for(t=0,i=o.length;i>t;t+=3)a.push(new r(o[t],o[t+1],o[t+2]));this.cartesian=a}else if(o=e.cartographicRadians,o!==void 0){for(t=0,i=o.length;i>t;t+=3)a.push(new n(o[t],o[t+1],o[t+2]));this.cartographic=a}else if(o=e.cartographicDegrees,o!==void 0){for(t=0,i=o.length;i>t;t+=3)a.push(n.fromDegrees(o[t],o[t+1],o[t+2]));this.cartographic=a}}var u=a.WGS84;l.prototype.getValueCartographic=function(){return this.cartographic===void 0&&(this.cartographic=u.cartesianArrayToCartographicArray(this.cartesian)),this.cartographic},l.prototype.getValueCartesian=function(){return this.cartesian===void 0&&(this.cartesian=u.cartographicArrayToCartesianArray(this.cartographic)),this.cartesian};var c=function(){this._propertyIntervals=new i};return c.prototype.processCzmlIntervals=function(e,t,i){if(Array.isArray(e))for(var r=0,n=e.length;n>r;r++)this._addCzmlInterval(e[r],t,i);else this._addCzmlInterval(e,t,i)},c.prototype.getValueCartographic=function(e){var t=this._propertyIntervals.findIntervalContainingDate(e);if(t===void 0)return void 0;var i=t.data;if(Array.isArray(i)){for(var r=[],n=0,o=i.length;o>n;n++){var a=i[n].getValueCartographic(e);a!==void 0&&r.push(a)}return r}return i.getValueCartographic()},c.prototype.getValueCartesian=function(e){var t=this._propertyIntervals.findIntervalContainingDate(e);if(t===void 0)return void 0;var i=t.data;if(Array.isArray(i)){for(var r=[],n=0,o=i.length;o>n;n++){var a=i[n].getValueCartesian(e);a!==void 0&&r.push(a)}return r}return i.getValueCartesian()},c.prototype._addCzmlInterval=function(e,i,r){var n=e.interval;n=n===void 0?o.MAXIMUM_INTERVAL.clone():t.fromIso8601(n),i!==void 0&&(n=n.intersect(i));var a=this._propertyIntervals,u=a.findInterval(n.start,n.stop);u===void 0&&(u=n,a.addInterval(u));var c=e.references;if(c===void 0)u.data=new l(e);else{for(var h=[],d=0,m=c.length;m>d;d++)h.push(s.fromString(r,c[d]));u.data=h}},c}),i("DynamicScene/CzmlUnitQuaternion",["../Core/Quaternion","../Core/Cartesian3"],function(e,t){var i=3,r=4,n=new t,o=new t,a=new e,s=new e,l=new e,u={doublesPerValue:r,doublesPerInterpolationValue:i,unwrapInterval:function(e){return e.unitQuaternion},isSampled:function(e){return Array.isArray(e)&&e.length>r},packValuesForInterpolation:function(e,t,o,s){u.getValueFromArray(e,s*r,l),l.conjugate(l);for(var c=0,h=s-o+1;h>c;c++){var d=c*i;u.getValueFromArray(e,(o+c)*r,a),a.multiply(l,a),0>a.w&&a.negate(a),a.getAxis(n);var m=a.getAngle();t[d]=n.x*m,t[d+1]=n.y*m,t[d+2]=n.z*m}},getValue:function(t,i){return i===void 0&&(i=new e),i.x=t[0],i.y=t[1],i.z=t[2],i.w=t[3],i.normalize(i)},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.x=t[i],r.y=t[i+1],r.z=t[i+2],r.w=t[i+3],r.normalize(r)},getValueFromInterpolationResult:function(t,i,n,l,c){i===void 0&&(i=new e),o.x=t[0],o.y=t[1],o.z=t[2];var h=o.magnitude();return u.getValueFromArray(n,c*r,s),0===h?(a.x=a.y=a.z=0,a.w=1):e.fromAxisAngle(o,h,a),i.normalize(a.multiply(s,i),i)}};return u}),i("DynamicScene/CzmlCartesian3",["../Core/Cartesian3"],function(e){var t=3,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(e){return e.cartesian},isSampled:function(e){return Array.isArray(e)&&e.length>t},getValue:function(t,i){return i===void 0&&(i=new e),i.x=t[0],i.y=t[1],i.z=t[2],i},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.x=t[i],r.y=t[i+1],r.z=t[i+2],r}};return i}),i("DynamicScene/DynamicObject",["../Core/createGuid","../Core/defaultValue","../Core/DeveloperError","../Core/JulianDate","../Core/TimeInterval","./DynamicProperty","./DynamicPositionProperty","./DynamicVertexPositionsProperty","./CzmlUnitQuaternion","./CzmlCartesian3"],function(e,t,i,r,n,o,a,s,l,u){var c=function(t){this._cachedAvailabilityDate=void 0,this._cachedAvailabilityValue=void 0,t===void 0&&(t=e()),this.id=t,this.availability=void 0,this.position=void 0,this.orientation=void 0,this.billboard=void 0,this.cone=void 0,this.ellipsoid=void 0,this.ellipse=void 0,this.label=void 0,this.path=void 0,this.point=void 0,this.polygon=void 0,this.polyline=void 0,this.pyramid=void 0,this.vertexPositions=void 0,this.viewFrom=void 0};return c.prototype.isAvailable=function(e){if(e===void 0)throw new i("time is required.");var t=this.availability;if(t===void 0)return!0;if(r.equals(this._cachedAvailabilityDate,e))return this._cachedAvailabilityValue;var n=t.contains(e);return this._cachedAvailabilityDate=r.clone(e,this._cachedAvailabilityDate),this._cachedAvailabilityValue=n,n},c.processCzmlPacketPosition=function(e,t){var i=t.position;if(i===void 0)return!1;var r=e.position,n=r===void 0;return n&&(e.position=r=new a),r.processCzmlIntervals(i),n},c.processCzmlPacketViewFrom=function(e,t){var i=t.viewFrom;if(i===void 0)return!1;var r=e.viewFrom,n=r===void 0;return n&&(e.viewFrom=r=new o(u)),r.processCzmlIntervals(i),n},c.processCzmlPacketOrientation=function(e,t){var i=t.orientation;if(i===void 0)return!1;var r=e.orientation,n=r===void 0;return n&&(e.orientation=r=new o(l)),r.processCzmlIntervals(i),n},c.processCzmlPacketVertexPositions=function(e,t,i){var r=t.vertexPositions;if(r===void 0)return!1;var n=e.vertexPositions,o=e.vertexPositions===void 0;return o&&(e.vertexPositions=n=new s),n.processCzmlIntervals(r,void 0,i),o},c.processCzmlPacketAvailability=function(e,t){var i=t.availability;if(i===void 0)return!1;var r=!1,o=n.fromIso8601(i);return o!==void 0&&(r=e._setAvailability(o)),r},c.mergeProperties=function(e,i){e.position=t(e.position,i.position),e.orientation=t(e.orientation,i.orientation),e.vertexPositions=t(e.vertexPositions,i.vertexPositions),e.viewFrom=t(e.viewFrom,i.viewFrom);var r=i.availability;r!==void 0&&e._setAvailability(r)},c.undefineProperties=function(e){e.position=void 0,e.orientation=void 0,e.vertexPositions=void 0,e.viewFrom=void 0,e._setAvailability(void 0)},c.prototype._setAvailability=function(e){var t=!n.equals(this.availability,e);return this.availability=e,this._cachedAvailabilityDate=void 0,this._cachedAvailabilityValue=void 0,t},c}),i("DynamicScene/DynamicObjectCollection",["../Core/Event","../Core/TimeInterval","../Core/Iso8601","../Core/DeveloperError","./DynamicObject"],function(e,t,i,r,n){var o=function(){this._hash={},this._array=[],this.compositeCollection=void 0,this.objectPropertiesChanged=new e,this.objectsRemoved=new e};return o.prototype.computeAvailability=function(){for(var e=i.MAXIMUM_VALUE,r=i.MINIMUM_VALUE,n=this._array,o=0,a=n.length;a>o;o++){var s=n[o],l=s.availability;if(l!==void 0){var u=l.start,c=l.stop;u.lessThan(e)&&!u.equals(i.MINIMUM_VALUE)&&(e=s.availability.start),c.greaterThan(r)&&!c.equals(i.MAXIMUM_VALUE)&&(r=s.availability.stop)}}return i.MAXIMUM_VALUE.equals(e)&&(e=i.MINIMUM_VALUE),i.MINIMUM_VALUE.equals(r)&&(r=i.MAXIMUM_VALUE),new t(e,r,!0,!0)},o.prototype.getObject=function(e){if(e===void 0)throw new r("id is required.");return this._hash[e]},o.prototype.removeObject=function(e){if(e===void 0)throw new r("id is required.");var t=this._hash[e],i=t!==void 0;return i&&(this._hash[e]=void 0,this._array.splice(this._array.indexOf(t),1),this.objectsRemoved.raiseEvent(this,[t])),i},o.prototype.getObjects=function(){return this._array},o.prototype.getOrCreateObject=function(e){if(e===void 0)throw new r("id is required.");var t=this._hash[e];return t||(t=new n(e),this._hash[e]=t,this._array.push(t)),t},o.prototype.clear=function(){var e=this._array;this._hash={},this._array=[],e.length>0&&this.objectsRemoved.raiseEvent(this,e)},o}),i("DynamicScene/CzmlBoolean",["../Core/defaultValue"],function(e){var t={unwrapInterval:function(t){return e(t["boolean"],t)},isSampled:function(){return!1},getValue:function(e){return e}};return t}),i("DynamicScene/CzmlCartesian2",["../Core/Cartesian2"],function(e){var t=2,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(e){return e.cartesian2},isSampled:function(e){return Array.isArray(e)&&e.length>t},getValue:function(t,i){return i===void 0&&(i=new e),i.x=t[0],i.y=t[1],i},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.x=t[i],r.y=t[i+1],r}};return i}),i("DynamicScene/CzmlNumber",["../Core/defaultValue"],function(e){var t=1,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(t){return e(t.number,t)},isSampled:function(e){return Array.isArray(e)},getValue:function(e){return e},getValueFromArray:function(e,t){return e[t]}};return i}),i("DynamicScene/CzmlImage",["../Core/defaultValue","../ThirdParty/Uri"],function(e,t){var i={unwrapInterval:function(i,r){var n=e(i.image,i);if(r!==void 0){var o=new t(document.location.href);r=new t(r),n=""+new t(n).resolve(r.resolve(o))}return n},isSampled:function(){return!1},getValue:function(e){return e}};return i}),i("Scene/HorizontalOrigin",["../Core/Enumeration"],function(e){var t={CENTER:new e(0,"CENTER"),LEFT:new e(1,"LEFT"),RIGHT:new e(-1,"RIGHT")};return t}),i("DynamicScene/CzmlHorizontalOrigin",["../Core/defaultValue","../Scene/HorizontalOrigin"],function(e,t){var i={unwrapInterval:function(t){return e(t.horizontalOrigin,t)},isSampled:function(){return!1},getValue:function(e){return t[e]}};return i}),i("Scene/VerticalOrigin",["../Core/Enumeration"],function(e){var t={CENTER:new e(0,"CENTER"),BOTTOM:new e(1,"BOTTOM"),TOP:new e(-1,"TOP")};return t}),i("DynamicScene/CzmlVerticalOrigin",["../Core/defaultValue","../Scene/VerticalOrigin"],function(e,t){var i={unwrapInterval:function(t){return e(t.verticalOrigin,t)},isSampled:function(){return!1},getValue:function(e){return t[e]}};return i}),i("DynamicScene/CzmlColor",["../Core/Color"],function(e){var t=4,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(t){var i=t.rgbaf;if(i!==void 0)return i;var r=t.rgba;if(r===void 0)return void 0;if(!this.isSampled(r))return[e.byteToFloat(r[0]),e.byteToFloat(r[1]),e.byteToFloat(r[2]),e.byteToFloat(r[3])];var n=r.length;i=Array(n);for(var o=0;n>o;o+=5)i[o]=r[o],i[o+1]=e.byteToFloat(r[o+1]),i[o+2]=e.byteToFloat(r[o+2]),i[o+3]=e.byteToFloat(r[o+3]),i[o+4]=e.byteToFloat(r[o+4]);return i},isSampled:function(e){return Array.isArray(e)&&e.length>t},getValue:function(t,i){return i===void 0&&(i=new e),i.red=t[0],i.green=t[1],i.blue=t[2],i.alpha=t[3],i},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.red=t[i],r.green=t[i+1],r.blue=t[i+2],r.alpha=t[i+3],r}};return i}),i("DynamicScene/DynamicBillboard",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian2","./CzmlCartesian3","./CzmlNumber","./CzmlImage","./CzmlHorizontalOrigin","./CzmlVerticalOrigin","./CzmlColor","./DynamicProperty"],function(e,t,i,r,n,o,a,s,l,u,c){var h=function(){this.image=void 0,this.scale=void 0,this.horizontalOrigin=void 0,this.verticalOrigin=void 0,this.color=void 0,this.eyeOffset=void 0,this.pixelOffset=void 0,this.show=void 0};return h.processCzmlPacket=function(t,d,m,p){var f=d.billboard;if(f===void 0)return!1;var v=!1,g=t.billboard;v=g===void 0,v&&(t.billboard=g=new h);var _=f.interval;if(_!==void 0&&(_=e.fromIso8601(_)),f.color!==void 0){var y=g.color;y===void 0&&(g.color=y=new c(u),v=!0),y.processCzmlIntervals(f.color,_)}if(f.eyeOffset!==void 0){var w=g.eyeOffset;w===void 0&&(g.eyeOffset=w=new c(n),v=!0),w.processCzmlIntervals(f.eyeOffset,_)}if(f.horizontalOrigin!==void 0){var C=g.horizontalOrigin;C===void 0&&(g.horizontalOrigin=C=new c(s),v=!0),C.processCzmlIntervals(f.horizontalOrigin,_)}if(f.image!==void 0){var x=g.image;x===void 0&&(g.image=x=new c(a),v=!0),x.processCzmlIntervals(f.image,_,p)}if(f.pixelOffset!==void 0){var T=g.pixelOffset;T===void 0&&(g.pixelOffset=T=new c(r),v=!0),T.processCzmlIntervals(f.pixelOffset,_)}if(f.scale!==void 0){var S=g.scale;S===void 0&&(g.scale=S=new c(o),v=!0),S.processCzmlIntervals(f.scale,_)}if(f.show!==void 0){var E=g.show;E===void 0&&(g.show=E=new c(i),v=!0),E.processCzmlIntervals(f.show,_)}if(f.verticalOrigin!==void 0){var b=g.verticalOrigin;b===void 0&&(g.verticalOrigin=b=new c(l),v=!0),b.processCzmlIntervals(f.verticalOrigin,_)}return v},h.mergeProperties=function(e,i){var r=i.billboard;if(r!==void 0){var n=e.billboard;n===void 0&&(e.billboard=n=new h),n.color=t(n.color,r.color),n.eyeOffset=t(n.eyeOffset,r.eyeOffset),n.horizontalOrigin=t(n.horizontalOrigin,r.horizontalOrigin),n.image=t(n.image,r.image),n.pixelOffset=t(n.pixelOffset,r.pixelOffset),n.scale=t(n.scale,r.scale),n.show=t(n.show,r.show),n.verticalOrigin=t(n.verticalOrigin,r.verticalOrigin)}},h.undefineProperties=function(e){e.billboard=void 0},h}),i("DynamicScene/DynamicClock",["../Core/TimeInterval","../Core/Iso8601","../Core/defaultValue","../Core/Clock","../Core/ClockRange","../Core/ClockStep","../Core/JulianDate"],function(e,t,i,r,n,o,a){var s=function(){this.startTime=t.MAXIMUM_INTERVAL.start,this.stopTime=t.MAXIMUM_INTERVAL.stop,this.currentTime=t.MAXIMUM_INTERVAL.start,this.clockRange=n.LOOP_STOP,this.clockStep=o.SYSTEM_CLOCK_MULTIPLIER,this.multiplier=1};return s.processCzmlPacket=function(t,i){var r=!1,l=i.clock;if(l!==void 0&&"document"===t.id){var u=t.clock;if(u===void 0&&(u=new s,t.clock=u,r=!0),l.interval!==void 0){var c=e.fromIso8601(l.interval);c!==void 0&&(u.startTime=c.start,u.stopTime=c.stop)}l.currentTime!==void 0&&(u.currentTime=a.fromIso8601(l.currentTime)),typeof l.range!==void 0&&(u.clockRange=n[l.range]),l.step!==void 0&&(u.clockStep=o[l.step]),l.multiplier!==void 0&&(u.multiplier=l.multiplier)}return r},s.mergeProperties=function(e,t){var i=t.clock;if(i!==void 0){var r=e.clock;r===void 0&&(r=new s,e.clock=r),r.startTime=i.startTime,r.stopTime=i.stopTime,r.currentTime=i.currentTime,r.clockRange=i.clockRange,r.clockStep=i.clockStep,r.multiplier=i.multiplier}},s.undefineProperties=function(e){e.clock=void 0},s}),i("DynamicScene/DynamicEllipse",["../Core/TimeInterval","../Core/defaultValue","../Core/Cartesian3","../Core/Ellipsoid","../Core/Shapes","./CzmlNumber","./DynamicProperty"],function(e,t,i,r,n,o,a){var s=function(){this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.bearing=void 0,this._lastPosition=void 0,this._lastSemiMajorAxis=void 0,this._lastSemiMinorAxis=void 0,this._lastBearing=void 0,this._cachedVertexPositions=void 0};return s.processCzmlPacket=function(t,i){var r=i.ellipse;if(r===void 0)return!1;var n=!1,l=t.ellipse;n=l===void 0,n&&(t.ellipse=l=new s);var u=r.interval;if(u!==void 0&&(u=e.fromIso8601(u)),r.bearing!==void 0){var c=l.bearing;c===void 0&&(l.bearing=c=new a(o),n=!0),c.processCzmlIntervals(r.bearing,u)}if(r.semiMajorAxis!==void 0){var h=l.semiMajorAxis;h===void 0&&(l.semiMajorAxis=h=new a(o),n=!0),h.processCzmlIntervals(r.semiMajorAxis,u)}if(r.semiMinorAxis!==void 0){var d=l.semiMinorAxis;d===void 0&&(l.semiMinorAxis=d=new a(o),n=!0),d.processCzmlIntervals(r.semiMinorAxis,u)}return n},s.mergeProperties=function(e,i){var r=i.ellipse;if(r!==void 0){var n=e.ellipse;n===void 0&&(e.ellipse=n=new s),n.bearing=t(n.bearing,r.bearing),n.semiMajorAxis=t(n.semiMajorAxis,r.semiMajorAxis),n.semiMinorAxis=t(n.semiMinorAxis,r.semiMinorAxis)}},s.undefineProperties=function(e){e.ellipse=void 0},s.prototype.getValue=function(e,t){var o=this.semiMajorAxis,a=this.semiMinorAxis;if(t===void 0||o===void 0||a===void 0)return void 0;var s=o.getValue(e),l=a.getValue(e),u=0,c=this.bearing;if(c!==void 0&&(u=c.getValue(e)),s===void 0||l===void 0||0===s||0===l)return void 0;var h=this._lastPosition,d=this._lastSemiMajorAxis,m=this._lastSemiMinorAxis,p=this._lastBearing;return u===p&&d===s&&m===l&&i.equals(h,t)||(this._cachedVertexPositions=n.computeEllipseBoundary(r.WGS84,t,s,l,u),this._lastPosition=i.clone(t,this._lastPosition),this._lastBearing=u,this._lastSemiMajorAxis=s,this._lastSemiMinorAxis=l),this._cachedVertexPositions},s}),i("Renderer/MipmapHint",["../Core/Enumeration"],function(e){var t={DONT_CARE:new e(4352,"DONT_CARE"),FASTEST:new e(4353,"FASTEST"),NICEST:new e(4354,"NICEST"),validate:function(e){return e===t.DONT_CARE||e===t.FASTEST||e===t.NICEST}};return t}),i("Renderer/PixelFormat",["../Core/Enumeration"],function(e){var t={DEPTH_COMPONENT:new e(6402,"DEPTH_COMPONENT"),DEPTH_STENCIL:new e(34041,"DEPTH_STENCIL"),ALPHA:new e(6406,"ALPHA"),RGB:new e(6407,"RGB"),RGBA:new e(6408,"RGBA"),LUMINANCE:new e(6409,"LUMINANCE"),LUMINANCE_ALPHA:new e(6410,"LUMINANCE_ALPHA"),validate:function(e){return e===t.DEPTH_COMPONENT||e===t.DEPTH_STENCIL||e===t.ALPHA||e===t.RGB||e===t.RGBA||e===t.LUMINANCE||e===t.LUMINANCE_ALPHA},isColorFormat:function(e){return e===t.ALPHA||e===t.RGB||e===t.RGBA||e===t.LUMINANCE||e===t.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===t.DEPTH_COMPONENT||e===t.DEPTH_STENCIL}};return t}),i("Renderer/TextureMagnificationFilter",["../Core/Enumeration"],function(e){var t={NEAREST:new e(9728,"NEAREST"),LINEAR:new e(9729,"LINEAR"),validate:function(e){return e===t.NEAREST||e===t.LINEAR}};return t}),i("Renderer/TextureMinificationFilter",["../Core/Enumeration"],function(e){var t={NEAREST:new e(9728,"NEAREST"),LINEAR:new e(9729,"LINEAR"),NEAREST_MIPMAP_NEAREST:new e(9984,"NEAREST_MIPMAP_NEAREST"),LINEAR_MIPMAP_NEAREST:new e(9985,"LINEAR_MIPMAP_NEAREST"),NEAREST_MIPMAP_LINEAR:new e(9986,"NEAREST_MIPMAP_LINEAR"),LINEAR_MIPMAP_LINEAR:new e(9987,"LINEAR_MIPMAP_LINEAR"),validate:function(e){return e===t.NEAREST||e===t.LINEAR||e===t.NEAREST_MIPMAP_NEAREST||e===t.LINEAR_MIPMAP_NEAREST||e===t.NEAREST_MIPMAP_LINEAR||e===t.LINEAR_MIPMAP_LINEAR}};return t}),i("Renderer/TextureWrap",["../Core/Enumeration"],function(e){var t={CLAMP:new e(33071,"CLAMP"),REPEAT:new e(10497,"REPEAT"),MIRRORED_REPEAT:new e(33648,"MIRRORED_REPEAT"),validate:function(e){return e===t.CLAMP||e===t.REPEAT||e===t.MIRRORED_REPEAT}};return t}),i("Renderer/Texture",["../Core/Cartesian2","../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","../Core/Math","./MipmapHint","./PixelFormat","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap"],function(e,t,i,r,n,o,a,s,l,u){var c=function(t,i,r,n,o,a,s,l,u,c){this._gl=t,this._textureFilterAnisotropic=i,this._textureTarget=r,this._texture=n,this._pixelFormat=o,this._pixelDatatype=a,this._width=s,this._height=l,this._dimensions=new e(s,l),this._preMultiplyAlpha=u,this._flipY=c,this._sampler=void 0,this.setSampler()};return c.prototype.copyFrom=function(e,i,n){if(e===void 0)throw new r("source is required.");if(a.isDepthFormat(this._pixelFormat))throw new r("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(i=t(i,0),n=t(n,0),0>i)throw new r("xOffset must be greater than or equal to zero.");if(0>n)throw new r("yOffset must be greater than or equal to zero.");var o=e.width,s=e.height;if(i+o>this._width)throw new r("xOffset + source.width must be less than or equal to getWidth().");if(n+s>this._height)throw new r("yOffset + source.height must be less than or equal to getHeight().");var l=this._gl,u=this._textureTarget;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._preMultiplyAlpha),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,this._flipY),l.activeTexture(l.TEXTURE0),l.bindTexture(u,this._texture),e.arrayBufferView?l.texSubImage2D(u,0,i,n,o,s,+this._pixelFormat,+this._pixelDatatype,e.arrayBufferView):l.texSubImage2D(u,0,i,n,this._pixelFormat,this._pixelDatatype,e),l.bindTexture(u,null)},c.prototype.copyFromFramebuffer=function(e,i,n,o,s,l){if(a.isDepthFormat(this._pixelFormat))throw new r("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(e=t(e,0),i=t(i,0),n=t(n,0),o=t(o,0),s=t(s,this._width),l=t(l,this._height),0>e)throw new r("xOffset must be greater than or equal to zero.");if(0>i)throw new r("yOffset must be greater than or equal to zero.");if(0>n)throw new r("framebufferXOffset must be greater than or equal to zero.");if(0>o)throw new r("framebufferYOffset must be greater than or equal to zero.");if(e+s>this._width)throw new r("xOffset + width must be less than or equal to getWidth().");if(i+l>this._height)throw new r("yOffset + height must be less than or equal to getHeight().");var u=this._gl,c=this._textureTarget;u.activeTexture(u.TEXTURE0),u.bindTexture(c,this._texture),u.copyTexSubImage2D(c,0,e,i,n,o,s,l),u.bindTexture(c,null)},c.prototype.generateMipmap=function(e){if(a.isDepthFormat(this._pixelFormat))throw new r("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._width>1&&!n.isPowerOfTwo(this._width))throw new r("width must be a power of two to call generateMipmap().");if(this._height>1&&!n.isPowerOfTwo(this._height))throw new r("height must be a power of two to call generateMipmap().");if(e=t(e,o.DONT_CARE),!o.validate(e))throw new r("hint is invalid.");var i=this._gl,s=this._textureTarget;i.hint(i.GENERATE_MIPMAP_HINT,e),i.activeTexture(i.TEXTURE0),i.bindTexture(s,this._texture),i.generateMipmap(s),i.bindTexture(s,null)},c.prototype.getSampler=function(){return this._sampler},c.prototype.setSampler=function(e){e===void 0&&(e={wrapS:u.CLAMP,wrapT:u.CLAMP,minificationFilter:l.LINEAR,magnificationFilter:s.LINEAR,maximumAnisotropy:1});var t=this._gl,i=this._textureTarget;t.activeTexture(t.TEXTURE0),t.bindTexture(i,this._texture),t.texParameteri(i,t.TEXTURE_MIN_FILTER,e.minificationFilter),t.texParameteri(i,t.TEXTURE_MAG_FILTER,e.magnificationFilter),t.texParameteri(i,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(i,t.TEXTURE_WRAP_T,e.wrapT),this._textureFilterAnisotropic&&t.texParameteri(i,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),t.bindTexture(i,null),this._sampler={wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minificationFilter,magnificationFilter:e.magnificationFilter,maximumAnisotropy:e.maximumAnisotropy}},c.prototype.getPixelFormat=function(){return this._pixelFormat},c.prototype.getPixelDatatype=function(){return this._pixelDatatype},c.prototype.getDimensions=function(){return this._dimensions},c.prototype.getPreMultiplyAlpha=function(){return this._preMultiplyAlpha},c.prototype.getFlipY=function(){return this._flipY},c.prototype.getWidth=function(){return this._width},c.prototype.getHeight=function(){return this._height},c.prototype._getTexture=function(){return this._texture},c.prototype._getTarget=function(){return this._textureTarget},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._gl.deleteTexture(this._texture),i(this)},c}),i("Renderer/CubeMapFace",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","./MipmapHint","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap"],function(e,t){var i=function(e,t,i,r,n,o,a,s,l){this._gl=e,this._texture=t,this._textureTarget=i,this._targetFace=r,this._pixelFormat=n,this._pixelDatatype=o,this._size=a,this._preMultiplyAlpha=s,this._flipY=l};return i.prototype.copyFrom=function(i,r,n){if(!i)throw new t("source is required.");r=e(r,0),n=e(n,0);var o=i.width,a=i.height;if(0>r)throw new t("xOffset must be greater than or equal to zero.");if(0>n)throw new t("yOffset must be greater than or equal to zero.");if(r+o>this._size)throw new t("xOffset + source.width must be less than or equal to getWidth().");if(n+a>this._size)throw new t("yOffset + source.height must be less than or equal to getHeight().");var s=this._gl,l=this._textureTarget;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._preMultiplyAlpha),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this._flipY),s.activeTexture(s.TEXTURE0),s.bindTexture(l,this._texture),i.arrayBufferView?s.texSubImage2D(this._targetFace,0,r,n,o,a,+this._pixelFormat,+this._pixelDatatype,i.arrayBufferView):s.texSubImage2D(this._targetFace,0,r,n,+this._pixelFormat,+this._pixelDatatype,i),s.bindTexture(l,null)},i.prototype.copyFromFramebuffer=function(i,r,n,o,a,s){if(i=e(i,0),r=e(r,0),n=e(n,0),o=e(o,0),a=e(a,this._size),s=e(s,this._size),0>i)throw new t("xOffset must be greater than or equal to zero.");if(0>r)throw new t("yOffset must be greater than or equal to zero.");if(0>n)throw new t("framebufferXOffset must be greater than or equal to zero.");if(0>o)throw new t("framebufferYOffset must be greater than or equal to zero.");if(i+a>this._size)throw new t("xOffset + source.width must be less than or equal to getWidth().");if(r+s>this._size)throw new t("yOffset + source.height must be less than or equal to getHeight().");var l=this._gl,u=this._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(u,this._texture),l.copyTexSubImage2D(this._targetFace,0,i,r,n,o,a,s),l.bindTexture(u,null)},i.prototype.getPixelFormat=function(){return this._pixelFormat},i.prototype._getTexture=function(){return this._texture},i.prototype._getTarget=function(){return this._targetFace},i}),i("Renderer/CubeMap",["../Core/DeveloperError","../Core/destroyObject","../Core/Math","./MipmapHint","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap","./CubeMapFace"],function(e,t,i,r,n,o,a,s){var l=function(e,t,i,r,n,o,a,l,u){this._gl=e,this._textureFilterAnisotropic=t,this._textureTarget=i,this._texture=r,this._pixelFormat=n,this._pixelDatatype=o,this._size=a,this._preMultiplyAlpha=l,this._flipY=u,this._sampler=void 0,this._positiveX=new s(e,r,i,e.TEXTURE_CUBE_MAP_POSITIVE_X,n,o,a,l,u),this._negativeX=new s(e,r,i,e.TEXTURE_CUBE_MAP_NEGATIVE_X,n,o,a,l,u),this._positiveY=new s(e,r,i,e.TEXTURE_CUBE_MAP_POSITIVE_Y,n,o,a,l,u),this._negativeY=new s(e,r,i,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,n,o,a,l,u),this._positiveZ=new s(e,r,i,e.TEXTURE_CUBE_MAP_POSITIVE_Z,n,o,a,l,u),this._negativeZ=new s(e,r,i,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,n,o,a,l,u),this.setSampler()};return l.prototype.getPositiveX=function(){return this._positiveX},l.prototype.getNegativeX=function(){return this._negativeX},l.prototype.getPositiveY=function(){return this._positiveY},l.prototype.getNegativeY=function(){return this._negativeY},l.prototype.getPositiveZ=function(){return this._positiveZ},l.prototype.getNegativeZ=function(){return this._negativeZ},l.prototype.generateMipmap=function(t){if(this._size>1&&!i.isPowerOfTwo(this._size))throw new e("width and height must be a power of two to call generateMipmap().");if(t=t||r.DONT_CARE,!r.validate(t))throw new e("hint is invalid.");var n=this._gl,o=this._textureTarget;n.hint(n.GENERATE_MIPMAP_HINT,t),n.activeTexture(n.TEXTURE0),n.bindTexture(o,this._texture),n.generateMipmap(o),n.bindTexture(o,null)},l.prototype.setSampler=function(e){var t=e||{wrapS:a.CLAMP,wrapT:a.CLAMP,minificationFilter:o.LINEAR,magnificationFilter:n.LINEAR,maximumAnisotropy:1},i=this._gl,r=this._textureTarget;i.activeTexture(i.TEXTURE0),i.bindTexture(r,this._texture),i.texParameteri(r,i.TEXTURE_MIN_FILTER,t.minificationFilter),i.texParameteri(r,i.TEXTURE_MAG_FILTER,t.magnificationFilter),i.texParameteri(r,i.TEXTURE_WRAP_S,t.wrapS),i.texParameteri(r,i.TEXTURE_WRAP_T,t.wrapT),this._textureFilterAnisotropic&&i.texParameteri(r,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),i.bindTexture(r,null),this._sampler={wrapS:t.wrapS,wrapT:t.wrapT,minificationFilter:t.minificationFilter,magnificationFilter:t.magnificationFilter,maximumAnisotropy:t.maximumAnisotropy}},l.prototype.getSampler=function(){return this._sampler},l.prototype.getPixelFormat=function(){return this._pixelFormat},l.prototype.getPixelDatatype=function(){return this._pixelDatatype},l.prototype.getWidth=function(){return this._size},l.prototype.getHeight=function(){return this._size},l.prototype.getPreMultiplyAlpha=function(){return this._preMultiplyAlpha},l.prototype.getFlipY=function(){return this._flipY},l.prototype._getTexture=function(){return this._texture},l.prototype._getTarget=function(){return this._textureTarget},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this._gl.deleteTexture(this._texture),this._positiveX=t(this._positiveX),this._negativeX=t(this._negativeX),this._positiveY=t(this._positiveY),this._negativeY=t(this._negativeY),this._positiveZ=t(this._positiveZ),this._negativeZ=t(this._negativeZ),t(this)},l}),i("Shaders/Materials/AsphaltMaterial",[],function(){return"uniform vec4 asphaltColor;\nuniform float bumpSize;\nuniform float roughness;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 color = asphaltColor;\nvec2 st = materialInput.st;\nvec2 F = czm_cellular(st / bumpSize);\ncolor.rgb -= (F.x / F.y) * 0.1;\nfloat noise = czm_snoise(st / bumpSize);\nnoise = pow(noise, 5.0) * roughness;\ncolor.rgb += noise;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/BlobMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 F = czm_cellular(materialInput.st * frequency);\nfloat t = 1.0 - F.x * F.x;\nvec4 color = mix(lightColor, darkColor, t);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"
}),i("Shaders/Materials/BrickMaterial",[],function(){return"uniform vec4 brickColor;\nuniform vec4 mortarColor;\nuniform vec2 brickSize;\nuniform vec2 brickPct;\nuniform float brickRoughness;\nuniform float mortarRoughness;\n#define Integral(x, p) ((floor(x) * p) + max(fract(x) - (1.0 - p), 0.0))\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 position = st / brickSize;\nif(fract(position.y * 0.5) > 0.5) {\nposition.x += 0.5;\n}\nvec2 filterWidth = vec2(0.02);\nvec2 useBrick = (Integral(position + filterWidth, brickPct) -\nIntegral(position, brickPct)) / filterWidth;\nfloat useBrickFinal = useBrick.x * useBrick.y;\nvec4 color = mix(mortarColor, brickColor, useBrickFinal);\nvec2 brickScaled = vec2(st.x / 0.1, st.y / 0.006);\nfloat brickNoise = abs(czm_snoise(brickScaled) * brickRoughness / 5.0);\ncolor.rg += brickNoise * useBrickFinal;\nvec2 mortarScaled = st / 0.005;\nfloat mortarNoise = max(czm_snoise(mortarScaled) * mortarRoughness, 0.0);\ncolor.rgb += mortarNoise * (1.0 - useBrickFinal);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/BumpMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 centerPixel = fract(repeat * st);\nfloat centerBump = texture2D(image, centerPixel).channel;\nfloat imageWidth = float(imageDimensions.x);\nvec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\nfloat rightBump = texture2D(image, rightPixel).channel;\nfloat imageHeight = float(imageDimensions.y);\nvec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\nfloat topBump = texture2D(image, leftPixel).channel;\nvec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nmaterial.diffuse = vec3(0.01);\nreturn material;\n}\n"}),i("Shaders/Materials/CementMaterial",[],function(){return"uniform vec4 cementColor;\nuniform float grainScale;\nuniform float roughness;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat noise = czm_snoise(materialInput.st / grainScale);\nnoise = pow(noise, 5.0) * roughness;\nvec4 color = cementColor;\ncolor.rgb += noise;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/CheckerboardMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);\nfloat scaledWidth = fract(repeat.s * st.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(repeat.t * st.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value = min(scaledWidth, scaledHeight);\nvec4 currentColor = mix(lightColor, darkColor, b);\nvec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/DotMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));\nvec4 color = mix(lightColor, darkColor, b);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/FacetMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 F = czm_cellular(materialInput.st * frequency);\nfloat t = 0.1 + (F.y - F.x);\nvec4 color = mix(lightColor, darkColor, t);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/FresnelMaterial",[],function(){return"czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\nvec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\nfloat cosAngIncidence = max(dot(normalWC, positionWC), 0.0);\nmaterial.diffuse = mix(reflection.diffuse, refraction.diffuse, cosAngIncidence);\nreturn material;\n}\n"}),i("Shaders/Materials/GrassMaterial",[],function(){return"uniform vec4 grassColor;\nuniform vec4 dirtColor;\nuniform float patchiness;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat noise1 = (czm_snoise(st * patchiness * 1.0)) * 1.0;\nfloat noise2 = (czm_snoise(st * patchiness * 2.0)) * 0.5;\nfloat noise3 = (czm_snoise(st * patchiness * 4.0)) * 0.25;\nfloat noise = sin(noise1 + noise2 + noise3) * 0.1;\nvec4 color = mix(grassColor, dirtColor, noise);\nfloat verticalNoise = czm_snoise(vec2(st.x * 100.0, st.y * 20.0)) * 0.02;\nfloat horizontalNoise = czm_snoise(vec2(st.x * 20.0, st.y * 100.0)) * 0.02;\nfloat stripeNoise = min(verticalNoise, horizontalNoise);\ncolor.rgb += stripeNoise;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/GridMaterial",[],function(){return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat scaledWidth = fract(lineCount.s * st.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(lineCount.t * st.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value;\n#ifdef GL_OES_standard_derivatives\nconst float fuzz = 1.2;\nvec2 thickness = lineThickness - 1.0;\nvec2 dx = abs(dFdx(st));\nvec2 dy = abs(dFdy(st));\nvec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\nvalue = min(\nsmoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\nsmoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\nconst float fuzz = 0.05;\nvec2 range = 0.5 - (lineThickness * 0.05);\nvalue = min(\n1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\nfloat dRim = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat sRim = smoothstep(0.8, 1.0, dRim);\nvalue *= (1.0 - sRim);\nvec3 halfColor = color.rgb * 0.5;\nmaterial.diffuse = halfColor;\nmaterial.emission = halfColor;\nmaterial.alpha = color.a * (1.0 - ((1.0 - cellAlpha) * value));\nreturn material;\n}\n"}),i("Shaders/Materials/NormalMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\nvec3 normalTangentSpace = textureValue.channels;\nnormalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\nnormalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\nnormalTangentSpace = normalize(normalTangentSpace);\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nreturn material;\n}\n"}),i("Shaders/Materials/ReflectionMaterial",[],function(){return"uniform samplerCube cubeMap;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\nvec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\nvec3 reflectedWC = reflect(positionWC, normalWC);\nmaterial.diffuse = textureCube(cubeMap, reflectedWC).channels;\nreturn material;\n}\n"}),i("Shaders/Materials/RefractionMaterial",[],function(){return"uniform samplerCube cubeMap;\nuniform float indexOfRefractionRatio;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec3 normalWC = normalize(czm_inverseViewRotation * material.normal);\nvec3 positionWC = normalize(czm_inverseViewRotation * materialInput.positionToEyeEC);\nvec3 refractedWC = refract(positionWC, -normalWC, indexOfRefractionRatio);\nmaterial.diffuse = textureCube(cubeMap, refractedWC).channels;\nreturn material;\n}\n"}),i("Shaders/Materials/StripeMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\nfloat value = fract((coord - offset) * (repeat * 0.5));\nfloat dist = min(value, min(abs(value - 0.5), 1.0 - value));\nvec4 currentColor = mix(lightColor, darkColor, step(0.5, value));\nvec4 color = czm_antialias(lightColor, darkColor, currentColor, dist);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/TieDyeMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec3 scaled = materialInput.str * frequency;\nfloat t = abs(czm_snoise(scaled));\nvec4 color = mix(lightColor, darkColor, t);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/Water",[],function(){return"uniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat time = czm_frameNumber * animationSpeed;\nfloat fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\nfloat specularMapValue = texture2D(specularMap, materialInput.st).r;\nvec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\nvec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\nnormalTangentSpace.xy /= fade;\nnormalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\nnormalTangentSpace = normalize(normalTangentSpace);\nfloat tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\nmaterial.alpha = specularMapValue;\nmaterial.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\nmaterial.diffuse += (0.1 * tsPerturbationRatio);\nmaterial.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\nmaterial.specular = specularIntensity;\nmaterial.shininess = 10.0;\nreturn material;\n}\n"}),i("Shaders/Materials/WoodMaterial",[],function(){return"uniform vec4 lightWoodColor;\nuniform vec4 darkWoodColor;\nuniform float ringFrequency;\nuniform vec2 noiseScale;\nuniform float grainFrequency;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 noisevec;\nnoisevec.x = czm_snoise(st * noiseScale.x);\nnoisevec.y = czm_snoise(st * noiseScale.y);\nvec2 location = st + noisevec;\nfloat dist = sqrt(location.x * location.x + location.y * location.y);\ndist *= ringFrequency;\nfloat r = fract(dist + noisevec[0] + noisevec[1]) * 2.0;\nif(r > 1.0)\nr = 2.0 - r;\nvec4 color = mix(lightWoodColor, darkWoodColor, r);\nr = abs(czm_snoise(vec2(st.x * grainFrequency, st.y * grainFrequency * 0.02))) * 0.2;\ncolor.rgb += lightWoodColor.rgb * r;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/RimLightingMaterial",[],function(){return"uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat s = smoothstep(1.0 - width, 1.0, d);\nmaterial.diffuse = color.rgb;\nmaterial.emission = rimColor.rgb * s;\nmaterial.alpha = mix(color.a, rimColor.a, s);\nreturn material;\n}\n"}),i("Shaders/Materials/ErosionMaterial",[],function(){return"uniform vec4 color;\nuniform float time;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat alpha = 1.0;\nif (time != 1.0)\n{\nfloat t = 0.5 + (0.5 * czm_snoise(materialInput.str / (1.0 / 10.0)));\nif (t > time)\n{\nalpha = 0.0;\n}\n}\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a * alpha;\nreturn material;\n}\n"}),i("Shaders/Materials/FadeMaterial",[],function(){return"uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\nfloat getTime(float t, float coord)\n{\nfloat scalar = 1.0 / maximumDistance;\nfloat q  = distance(t, coord) * scalar;\nif (repeat)\n{\nfloat r = distance(t, coord + 1.0) * scalar;\nfloat s = distance(t, coord - 1.0) * scalar;\nq = min(min(r, s), q);\n}\nreturn clamp(q, 0.0, 1.0);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat s = getTime(time.x, st.s) * fadeDirection.s;\nfloat t = getTime(time.y, st.t) * fadeDirection.t;\nfloat u = length(vec2(s, t));\nvec4 color = mix(fadeInColor, fadeOutColor, u);\nmaterial.emission = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/PolylineArrowMaterial",[],function(){return"#extension GL_OES_standard_derivatives : enable\nuniform vec4 color;\nvarying float v_width;\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\nfloat slope = (p0.y - p1.y) / (p0.x - p1.x);\nreturn slope * (x - p0.x) + p0.y;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat base = 1.0 - abs(dFdx(st.s)) * 10.0;\nvec2 center = vec2(1.0, 0.5);\nfloat ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\nfloat ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\nfloat halfWidth = 0.15;\nfloat s = step(0.5 - halfWidth, st.t);\ns *= 1.0 - step(0.5 + halfWidth, st.t);\ns *= 1.0 - step(base, st.s);\nfloat t = step(base, materialInput.st.s);\nt *= 1.0 - step(ptOnUpperLine, st.t);\nt *= step(ptOnLowerLine, st.t);\nfloat dist;\nif (st.s < base)\n{\nfloat d1 = abs(st.t - (0.5 - halfWidth));\nfloat d2 = abs(st.t - (0.5 + halfWidth));\ndist = min(d1, d2);\n}\nelse\n{\nfloat d1 = czm_infinity;\nif (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n{\nd1 = abs(st.s - base);\n}\nfloat d2 = abs(st.t - ptOnUpperLine);\nfloat d3 = abs(st.t - ptOnLowerLine);\ndist = min(min(d1, d2), d3);\n}\nvec4 outsideColor = vec4(0.0);\nvec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\nvec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"}),i("Shaders/Materials/PolylineGlowMaterial",[],function(){return"uniform vec4 color;\nuniform float glowPower;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat glow = glowPower / abs(st.t - 0.5);\nmaterial.emission = max(vec3(glow - 1.0 + color.rgb), color.rgb);\nmaterial.alpha = clamp(0.0, 1.0, glow) * color.a;\nreturn material;\n}\n"}),i("Shaders/Materials/PolylineOutlineMaterial",[],function(){return"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\nfloat b = step(0.5 - halfInteriorWidth, st.t);\nb *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\nfloat d1 = abs(st.t - (0.5 - halfInteriorWidth));\nfloat d2 = abs(st.t - (0.5 + halfInteriorWidth));\nfloat dist = min(d1, d2);\nvec4 currentColor = mix(outlineColor, color, b);\nvec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"}),i("Scene/Material",["../ThirdParty/when","../Core/loadImage","../Core/DeveloperError","../Core/createGuid","../Core/clone","../Core/Color","../Core/combine","../Core/defaultValue","../Core/destroyObject","../Core/Cartesian2","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Renderer/Texture","../Renderer/CubeMap","../Shaders/Materials/AsphaltMaterial","../Shaders/Materials/BlobMaterial","../Shaders/Materials/BrickMaterial","../Shaders/Materials/BumpMapMaterial","../Shaders/Materials/CementMaterial","../Shaders/Materials/CheckerboardMaterial","../Shaders/Materials/DotMaterial","../Shaders/Materials/FacetMaterial","../Shaders/Materials/FresnelMaterial","../Shaders/Materials/GrassMaterial","../Shaders/Materials/GridMaterial","../Shaders/Materials/NormalMapMaterial","../Shaders/Materials/ReflectionMaterial","../Shaders/Materials/RefractionMaterial","../Shaders/Materials/StripeMaterial","../Shaders/Materials/TieDyeMaterial","../Shaders/Materials/Water","../Shaders/Materials/WoodMaterial","../Shaders/Materials/RimLightingMaterial","../Shaders/Materials/ErosionMaterial","../Shaders/Materials/FadeMaterial","../Shaders/Materials/PolylineArrowMaterial","../Shaders/Materials/PolylineGlowMaterial","../Shaders/Materials/PolylineOutlineMaterial"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P,R,O,z,L,N,V,B){function F(e,t){e=s(e,s.EMPTY_OBJECT),t._context=e.context,t._strict=s(e.strict,!1),t._count=s(e.count,0),t._template=n(s(e.fabric,s.EMPTY_OBJECT)),t._template.uniforms=n(s(t._template.uniforms,s.EMPTY_OBJECT)),t._template.materials=n(s(t._template.materials,s.EMPTY_OBJECT)),t.type=t._template.type!==void 0?t._template.type:r(),t.shaderSource="",t.materials={},t.uniforms={},t._uniforms={};var i=Q._materialCache.getMaterial(t.type);if(i!==void 0){var o=n(i,!0);t._template=a([t._template,o])}W(t),i===void 0&&Q._materialCache.addMaterial(t.type,t._template),H(t),j(t),Z(t)}function q(e,t,i,r){if(e!==void 0)for(var n in e)if(e.hasOwnProperty(n)){var o=-1!==t.indexOf(n);(r&&!o||!r&&o)&&i(n,t)}}function U(e,t){for(var r="fabric: property name '"+e+"' is not valid. It should be ",n=0;t.length>n;n++){var o="'"+t[n]+"'";r+=n===t.length-1?"or "+o+".":o+", "}throw new i(r)}function k(e){var t="fabric: uniforms and materials cannot share the same property '"+e+"'";throw new i(t)}function W(e){var t=e._template,r=t.uniforms,n=t.materials,o=t.components;if(o!==void 0&&t.source!==void 0)throw new i("fabric: cannot have source and components in the same template.");q(t,$,U,!0),q(o,et,U,!0);var a=[];for(var s in n)n.hasOwnProperty(s)&&a.push(s);q(r,a,k,!1)}function H(e){var t=e._template.components,i=e._template.source;if(i!==void 0)e.shaderSource+=i+"\n";else{if(e.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",e.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n",t!==void 0)for(var r in t)t.hasOwnProperty(r)&&(e.shaderSource+="material."+r+" = "+t[r]+";\n");e.shaderSource+="return material;\n}\n"}}function j(e){var t=e._template.uniforms;for(var i in t)t.hasOwnProperty(i)&&G(e,i)}function G(e,t){var r=e._strict,n=e._template.uniforms,o=n[t],a=X(o);if(a===void 0)throw new i("fabric: uniform '"+t+"' has invalid type.");if("channels"===a){if(0===K(e,t,o,!1)&&r)throw new i("strict: shader source does not use channels '"+t+"'.")}else{if(-1!==a.indexOf("sampler")&&e._context===void 0)throw new i("image: context is not defined");if("sampler2D"===a){var s=t+"Dimensions";J(e,s)>0&&(n[s]={type:"ivec3",x:1,y:1},G(e,s))}var l="uniform "+a+" "+t+";\n";-1===e.shaderSource.indexOf(l)&&(e.shaderSource=l+e.shaderSource);var u=t+"_"+e._count++;if(1===K(e,t,u)&&r)throw new i("strict: shader source does not use uniform '"+t+"'.");e.uniforms[t]=o,e._uniforms[u]=Y(e,t,a)}}function Y(e,t,r){return function(){var n=e.uniforms,o=n[t],a=X(o);if("sampler2D"===r&&(a===r||o instanceof m)){a===r&&(o=Q._textureCache.registerTexture2DToMaterial(e,t,o));var s=t+"Dimensions";if(n.hasOwnProperty(s)){var l=n[s];l.x=o._width,l.y=o._height}}else if("samplerCube"===r&&(a===r||o instanceof p))a===r&&(o=Q._textureCache.registerCubeMapToMaterial(e,t,o));else if(-1!==r.indexOf("mat")&&(a===r||o instanceof tt[r]))a===r&&(o=tt[r].fromColumnMajorArray(o));else if(a===void 0||r!==a)throw new i("fabric: uniform '"+t+"' has invalid value.");return n[t]=o,n[t]}}function X(e){var t=e.type;if(t===void 0){var i=typeof e;if("number"===i)t="float";else if("boolean"===i)t="bool";else if("string"===i)t=/^([rgba]){1,4}$/i.test(e)?"channels":e===Q.DefaultCubeMapId?"samplerCube":"sampler2D";else if("object"===i)if(Array.isArray(e))(4===e.length||9===e.length||16===e.length)&&(t="mat"+Math.sqrt(e.length));else{var r=0;for(var n in e)e.hasOwnProperty(n)&&(r+=1);r>=2&&4>=r?t="vec"+r:6===r&&(t="samplerCube")}}return t}function Z(e){var t=e._context,r=e._strict,n=e._template.materials;for(var o in n)if(n.hasOwnProperty(o)){var s=new Q({context:t,strict:r,fabric:n[o],count:e._count});e._count=s._count,e._uniforms=a([e._uniforms,s._uniforms]),e.materials[o]=s;var l="czm_getMaterial",u=l+"_"+e._count++;K(s,l,u),e.shaderSource=s.shaderSource+e.shaderSource;var c=u+"(materialInput)";if(0===K(e,o,c)&&r)throw new i("strict: shader source does not use material '"+o+"'.")}}function K(e,t,i,r){r=s(r,!0);var n=0,o="a-zA-Z0-9_",a="(["+o+"])?",l="(["+o+(r?".":"")+"])?",u=RegExp(l+t+a,"g");return e.shaderSource=e.shaderSource.replace(u,function(e,t,r){return t||r?e:(n+=1,i)}),n}function J(e,t,i){return K(e,t,t,i)}var Q=function(e){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this._context=void 0,this._strict=void 0,this._template=void 0,this._count=void 0,F(e,this),Object.defineProperty(this,"type",{value:this.type,writable:!1}),Q._uniformList[this.type]===void 0&&(Q._uniformList[this.type]=Object.keys(this._uniforms))};Q._uniformList={},Q.fromType=function(e,t){if(Q._materialCache.getMaterial(t)===void 0)throw new i("material with type '"+t+"' does not exist.");return new Q({context:e,fabric:{type:t}})},Q.prototype.isDestroyed=function(){return!1},Q.prototype.destroy=function(){var e=this.materials,t=this.uniforms;for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];(r instanceof m||r instanceof p)&&Q._textureCache.releaseTexture(this,r)}for(var n in e)e.hasOwnProperty(n)&&e[n].destroy();return l(this)};var $=["type","materials","uniforms","components","source"],et=["diffuse","specular","shininess","normal","emission","alpha"],tt={mat2:c,mat3:h,mat4:d};return Q._textureCache={_pathsToMaterials:{},_pathsToTextures:{},_updateMaterialsOnLoad:function(e,t){this._pathsToTextures[t]=e;for(var i=this._pathsToMaterials[t],r=0;i.length>r;r++){var n=i[r],o=n.material,a=n.property;this.releaseTexture(o,o.uniforms[a]),o.uniforms[a]=e}},releaseTexture:function(e,t){var i=this._pathsToTextures;for(var r in i)if(i[r]===t)for(var n=this._pathsToMaterials[r],o=0;n.length>o;o++)if(n[o].material===e){n.splice(o,1);var a=n.length;0===a&&(t.destroy(),delete i.path,delete n.path)}},registerCubeMapToMaterial:function(i,r,n){var o,a=this;if(n===Q.DefaultCubeMapId)o=i._context.getDefaultCubeMap();else{var l=n.positiveX+n.negativeX+n.positiveY+n.negativeY+n.positiveZ+n.negativeZ;if(this._pathsToMaterials[l]=s(this._pathsToMaterials[l],[]),this._pathsToMaterials[l].push({material:i,property:r}),o=this._pathsToTextures[l],o===void 0){var u=i.uniforms[r],c=u instanceof p;o=c?u:i._context.getDefaultCubeMap(),1===this._pathsToMaterials[l].length&&e.all([t(n.positiveX),t(n.negativeX),t(n.positiveY),t(n.negativeY),t(n.positiveZ),t(n.negativeZ)]).then(function(e){o=i._context.createCubeMap({source:{positiveX:e[0],negativeX:e[1],positiveY:e[2],negativeY:e[3],positiveZ:e[4],negativeZ:e[5]}}),a._updateMaterialsOnLoad(o,l)})}}return o},registerTexture2DToMaterial:function(i,r,n){var o,a=this;if(n===Q.DefaultImageId)o=i._context.getDefaultTexture();else{var l=n;if(this._pathsToMaterials[l]=s(this._pathsToMaterials[l],[]),this._pathsToMaterials[l].push({material:i,property:r}),o=this._pathsToTextures[l],o===void 0){var u=i.uniforms[r],c=u instanceof m;o=c?u:i._context.getDefaultTexture(),1===this._pathsToMaterials[l].length&&e(t(l),function(e){o=i._context.createTexture2D({source:e}),a._updateMaterialsOnLoad(o,l)})}}return o}},Q._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}},Q.DefaultImageId="czm_defaultImage",Q.DefaultCubeMapId="czm_defaultCubeMap",Q.ColorType="Color",Q._materialCache.addMaterial(Q.ColorType,{type:Q.ColorType,uniforms:{color:new o(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}}),Q.ImageType="Image",Q._materialCache.addMaterial(Q.ImageType,{type:Q.ImageType,uniforms:{image:Q.DefaultImageId,repeat:new u(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a"}}),Q.DiffuseMapType="DiffuseMap",Q._materialCache.addMaterial(Q.DiffuseMapType,{type:Q.DiffuseMapType,uniforms:{image:Q.DefaultImageId,channels:"rgb",repeat:new u(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}}),Q.AlphaMapType="AlphaMap",Q._materialCache.addMaterial(Q.AlphaMapType,{type:Q.AlphaMapType,uniforms:{image:Q.DefaultImageId,channel:"a",repeat:new u(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}}),Q.SpecularMapType="SpecularMap",Q._materialCache.addMaterial(Q.SpecularMapType,{type:Q.SpecularMapType,uniforms:{image:Q.DefaultImageId,channel:"r",repeat:new u(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}}),Q.EmissionMapType="EmissionMap",Q._materialCache.addMaterial(Q.EmissionMapType,{type:Q.EmissionMapType,uniforms:{image:Q.DefaultImageId,channels:"rgb",repeat:new u(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}}),Q.BumpMapType="BumpMap",Q._materialCache.addMaterial(Q.BumpMapType,{type:Q.BumpMapType,uniforms:{image:Q.DefaultImageId,channel:"r",strength:.8,repeat:new u(1,1)},source:_}),Q.NormalMapType="NormalMap",Q._materialCache.addMaterial(Q.NormalMapType,{type:Q.NormalMapType,uniforms:{image:Q.DefaultImageId,channels:"rgb",strength:.8,repeat:new u(1,1)},source:b}),Q.ReflectionType="Reflection",Q._materialCache.addMaterial(Q.ReflectionType,{type:Q.ReflectionType,uniforms:{cubeMap:Q.DefaultCubeMapId,channels:"rgb"},source:M}),Q.RefractionType="Refraction",Q._materialCache.addMaterial(Q.RefractionType,{type:Q.RefractionType,uniforms:{cubeMap:Q.DefaultCubeMapId,channels:"rgb",indexOfRefractionRatio:.9},source:I}),Q.FresnelType="Fresnel",Q._materialCache.addMaterial(Q.FresnelType,{type:Q.FresnelType,materials:{reflection:{type:Q.ReflectionType},refraction:{type:Q.RefractionType}},source:T}),Q.BrickType="Brick",Q._materialCache.addMaterial(Q.BrickType,{type:Q.BrickType,uniforms:{brickColor:new o(.6,.3,.1,1),mortarColor:new o(.8,.8,.7,1),brickSize:new u(.3,.15),brickPct:new u(.9,.85),brickRoughness:.2,mortarRoughness:.1},source:g}),Q.WoodType="Wood",Q._materialCache.addMaterial(Q.WoodType,{type:Q.WoodType,uniforms:{lightWoodColor:new o(.6,.3,.1,1),darkWoodColor:new o(.4,.2,.07,1),ringFrequency:3,noiseScale:new u(.7,.5),grainFrequency:27},source:R}),Q.AsphaltType="Asphalt",Q._materialCache.addMaterial(Q.AsphaltType,{type:Q.AsphaltType,uniforms:{asphaltColor:new o(.15,.15,.15,1),bumpSize:.02,roughness:.2},source:f}),Q.CementType="Cement",Q._materialCache.addMaterial(Q.CementType,{type:Q.CementType,uniforms:{cementColor:new o(.95,.95,.85,1),grainScale:.01,roughness:.3},source:y}),Q.GrassType="Grass",Q._materialCache.addMaterial(Q.GrassType,{type:Q.GrassType,uniforms:{grassColor:new o(.25,.4,.1,1),dirtColor:new o(.1,.1,.1,1),patchiness:1.5},source:S}),Q.GridType="Grid",Q._materialCache.addMaterial(Q.GridType,{type:Q.GridType,uniforms:{color:new o(0,1,0,1),cellAlpha:.1,lineCount:new u(8,8),lineThickness:new u(1,1)},source:E}),Q.StripeType="Stripe",Q._materialCache.addMaterial(Q.StripeType,{type:Q.StripeType,uniforms:{horizontal:!0,lightColor:new o(1,1,1,.5),darkColor:new o(0,0,1,.5),offset:0,repeat:5},source:D}),Q.CheckerboardType="Checkerboard",Q._materialCache.addMaterial(Q.CheckerboardType,{type:Q.CheckerboardType,uniforms:{lightColor:new o(1,1,1,.5),darkColor:new o(0,0,0,.5),repeat:new u(5,5)},source:w}),Q.DotType="Dot",Q._materialCache.addMaterial(Q.DotType,{type:Q.DotType,uniforms:{lightColor:new o(1,1,0,.75),darkColor:new o(0,1,1,.75),repeat:new u(5,5)},source:C}),Q.TyeDyeType="TieDye",Q._materialCache.addMaterial(Q.TyeDyeType,{type:Q.TyeDyeType,uniforms:{lightColor:new o(1,1,0,.75),darkColor:new o(1,0,0,.75),frequency:5},source:A}),Q.FacetType="Facet",Q._materialCache.addMaterial(Q.FacetType,{type:Q.FacetType,uniforms:{lightColor:new o(.25,.25,.25,.75),darkColor:new o(.75,.75,.75,.75),frequency:10},source:x}),Q.BlobType="Blob",Q._materialCache.addMaterial(Q.BlobType,{type:Q.BlobType,uniforms:{lightColor:new o(1,1,1,.5),darkColor:new o(0,0,1,.5),frequency:10},source:v}),Q.WaterType="Water",Q._materialCache.addMaterial(Q.WaterType,{type:Q.WaterType,uniforms:{baseWaterColor:{red:.2,green:.3,blue:.6,alpha:1},blendColor:{red:0,green:1,blue:.699,alpha:1},specularMap:Q.DefaultImageId,normalMap:Q.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:P}),Q.RimLightingType="RimLighting",Q._materialCache.addMaterial(Q.RimLightingType,{type:Q.RimLightingType,uniforms:{color:new o(1,0,0,.7),rimColor:new o(1,1,1,.4),width:.3},source:O}),Q.ErosionType="Erosion",Q._materialCache.addMaterial(Q.ErosionType,{type:Q.ErosionType,uniforms:{color:new o(1,0,0,.5),time:1},source:z}),Q.FadeType="Fade",Q._materialCache.addMaterial(Q.FadeType,{type:Q.FadeType,uniforms:{fadeInColor:new o(1,0,0,1),fadeOutColor:new o(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new u(.5,.5)},source:L}),Q.PolylineArrowType="PolylineArrow",Q._materialCache.addMaterial(Q.PolylineArrowType,{type:Q.PolylineArrowType,uniforms:{color:new o(1,1,1,1)},source:N}),Q.PolylineGlowType="PolylineGlow",Q._materialCache.addMaterial(Q.PolylineGlowType,{type:Q.PolylineGlowType,uniforms:{color:new o(0,.5,1,1),glowPower:.1},source:V}),Q.PolylineOutlineType="PolylineOutline",Q._materialCache.addMaterial(Q.PolylineOutlineType,{type:Q.PolylineOutlineType,uniforms:{color:new o(1,1,1,1),outlineColor:new o(1,0,0,1),outlineWidth:1},source:B}),Q
}),i("DynamicScene/DynamicColorMaterial",["./DynamicProperty","./CzmlColor","../Scene/Material"],function(e,t,i){var r=function(){this.color=void 0};return r.isMaterial=function(e){return e!==void 0&&e.solidColor!==void 0},r.prototype.isMaterial=r.isMaterial,r.prototype.processCzmlIntervals=function(i){var r=i.solidColor;if(r!==void 0&&r.color!==void 0){var n=this.color;n===void 0&&(this.color=n=new e(t)),n.processCzmlIntervals(r.color)}},r.prototype.getValue=function(e,t,r){return(r===void 0||r.type!==i.ColorType)&&(r=i.fromType(t,i.ColorType)),r.uniforms.color=this.color.getValue(e,r.uniforms.color),r},r}),i("DynamicScene/DynamicImageMaterial",["./DynamicProperty","./CzmlImage","./CzmlNumber","../Scene/Material"],function(e,t,i,r){var n=function(){this.image=void 0,this.verticalRepeat=void 0,this.horizontalRepeat=void 0};return n.isMaterial=function(e){return e.image!==void 0},n.prototype.isMaterial=n.isMaterial,n.prototype.processCzmlIntervals=function(r,n){var o=r.image;if(void 0!==o){if(o.image!==void 0){var a=this.image;a===void 0&&(this.image=a=new e(t)),a.processCzmlIntervals(o.image,void 0,n)}if(o.verticalRepeat!==void 0){var s=this.verticalRepeat;s===void 0&&(this.verticalRepeat=s=new e(i)),s.processCzmlIntervals(o.verticalRepeat)}if(o.horizontalRepeat!==void 0){var l=this.horizontalRepeat;l===void 0&&(this.horizontalRepeat=l=new e(i)),l.processCzmlIntervals(o.horizontalRepeat)}}},n.prototype.getValue=function(e,t,i){(i===void 0||i.type!==r.ImageType)&&(i=r.fromType(t,r.ImageType));var n,o=this.verticalRepeat;o!==void 0&&(n=o.getValue(e),n!==void 0&&(i.uniforms.repeat.x=n));var a;if(o=this.horizontalRepeat,o!==void 0&&(a=o.getValue(e),a!==void 0&&(i.uniforms.repeat.y=a)),o=this.image,o!==void 0){var s=this.image.getValue(e);s!==void 0&&i.currentUrl!==s&&(i.currentUrl=s,i.uniforms.image=s)}return i},n}),i("DynamicScene/DynamicGridMaterial",["./DynamicProperty","./CzmlColor","./CzmlNumber","../Scene/Material"],function(e,t,i,r){var n=function(){this.color=void 0,this.cellAlpha=void 0,this.rowCount=void 0,this.columnCount=void 0,this.rowThickness=void 0,this.columnThickness=void 0};return n.isMaterial=function(e){return e.grid!==void 0},n.prototype.isMaterial=n.isMaterial,n.prototype.processCzmlIntervals=function(r,n){var o=r.grid;if(void 0!==o){if(o.color!==void 0){var a=this.color;a===void 0&&(this.color=a=new e(t)),a.processCzmlIntervals(o.color,void 0,n)}if(o.cellAlpha!==void 0){var s=this.cellAlpha;s===void 0&&(this.cellAlpha=s=new e(i)),s.processCzmlIntervals(o.cellAlpha,void 0,n)}if(o.rowCount!==void 0){var l=this.rowCount;l===void 0&&(this.rowCount=l=new e(i)),l.processCzmlIntervals(o.rowCount,void 0,n)}if(o.columnCount!==void 0){var u=this.columnCount;u===void 0&&(this.columnCount=u=new e(i)),u.processCzmlIntervals(o.columnCount,void 0,n)}if(o.rowThickness!==void 0){var c=this.rowThickness;c===void 0&&(this.rowThickness=c=new e(i)),c.processCzmlIntervals(o.rowThickness,void 0,n)}if(o.columnThickness!==void 0){var h=this.columnThickness;h===void 0&&(this.columnThickness=h=new e(i)),h.processCzmlIntervals(o.columnThickness,void 0,n)}}},n.prototype.getValue=function(e,t,i){(i===void 0||i.type!==r.GridType)&&(i=r.fromType(t,r.GridType));var n=this.color;if(n!==void 0&&n.getValue(e,i.uniforms.color),n=this.cellAlpha,n!==void 0){var o=n.getValue(e);o!==void 0&&(i.uniforms.cellAlpha=o)}var a=i.uniforms.lineCount;if(n=this.rowCount,n!==void 0){var s=n.getValue(e);s!==void 0&&(a.x=s)}if(n=this.columnCount,n!==void 0){var l=n.getValue(e);l!==void 0&&(a.y=l)}var u=i.uniforms.lineThickness;if(n=this.rowThickness,n!==void 0){var c=n.getValue(e);c!==void 0&&(u.x=c)}if(n=this.columnThickness,n!==void 0){var h=n.getValue(e);h!==void 0&&(u.y=h)}return i},n}),i("DynamicScene/DynamicMaterialProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Iso8601","./DynamicColorMaterial","./DynamicImageMaterial","./DynamicGridMaterial"],function(e,t,i,r,n,o,a){var s=[n,o,a],l=function(){this._intervals=new i};return l.prototype.processCzmlIntervals=function(e,t,i){if(Array.isArray(e))for(var r=0,n=e.length;n>r;r++)this._addCzmlInterval(e[r],t,i);else this._addCzmlInterval(e,t,i)},l.prototype.getValue=function(e,t,i){var r=this._intervals.findIntervalContainingDate(e),n=r!==void 0?r.data:void 0;return n!==void 0?n.getValue(e,t,i):i},l.prototype._addCzmlInterval=function(e,i,n){var o=e.interval;o=o===void 0?r.MAXIMUM_INTERVAL.clone():t.fromIso8601(o),i!==void 0&&(o=o.intersect(i));var a,l=this._intervals,u=l.findInterval(o.start,o.stop),c=!1;if(u!==void 0?(a=u.data,c=a.isMaterial(e)):(u=o,l.addInterval(u)),c===!1)for(var h=0,d=s.length;d>h;h++){var m=s[h];if(c=m.isMaterial(e)){u.data=a=new m;break}}c&&a.processCzmlIntervals(e,n)},l}),i("DynamicScene/DynamicEllipsoid",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian3","./CzmlColor","./DynamicProperty","./DynamicMaterialProperty"],function(e,t,i,r,n,o,a){var s=function(){this.show=void 0,this.radii=void 0,this.material=void 0};return s.processCzmlPacket=function(t,n){var l=n.ellipsoid;if(l===void 0)return!1;var u=!1,c=t.ellipsoid;u=c===void 0,u&&(t.ellipsoid=c=new s);var h=l.interval;if(h!==void 0&&(h=e.fromIso8601(h)),l.show!==void 0){var d=c.show;d===void 0&&(c.show=d=new o(i),u=!0),d.processCzmlIntervals(l.show,h)}if(l.radii!==void 0){var m=c.radii;m===void 0&&(c.radii=m=new o(r),u=!0),m.processCzmlIntervals(l.radii,h)}if(l.material!==void 0){var p=c.material;p===void 0&&(c.material=p=new a,u=!0),p.processCzmlIntervals(l.material,h)}return u},s.mergeProperties=function(e,i){var r=i.ellipsoid;if(r!==void 0){var n=e.ellipsoid;n===void 0&&(e.ellipsoid=n=new s),n.show=t(n.show,r.show),n.radii=t(n.radii,r.radii),n.material=t(n.material,r.material)}},s.undefineProperties=function(e){e.ellipsoid=void 0},s}),i("DynamicScene/DynamicCone",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty","./DynamicMaterialProperty"],function(e,t,i,r,n,o,a){var s=function(){this.minimumClockAngle=void 0,this.maximumClockAngle=void 0,this.innerHalfAngle=void 0,this.outerHalfAngle=void 0,this.capMaterial=void 0,this.innerMaterial=void 0,this.outerMaterial=void 0,this.silhouetteMaterial=void 0,this.intersectionColor=void 0,this.showIntersection=void 0,this.radius=void 0,this.show=void 0};return s.processCzmlPacket=function(t,l){var u=l.cone;if(u===void 0)return!1;var c=!1,h=t.cone;c=h===void 0,c&&(t.cone=h=new s);var d=u.interval;if(d!==void 0&&(d=e.fromIso8601(d)),u.show!==void 0){var m=h.show;m===void 0&&(h.show=m=new o(i),c=!0),m.processCzmlIntervals(u.show,d)}if(u.innerHalfAngle!==void 0){var p=h.innerHalfAngle;p===void 0&&(h.innerHalfAngle=p=new o(r),c=!0),p.processCzmlIntervals(u.innerHalfAngle,d)}if(u.outerHalfAngle!==void 0){var f=h.outerHalfAngle;f===void 0&&(h.outerHalfAngle=f=new o(r),c=!0),f.processCzmlIntervals(u.outerHalfAngle,d)}if(u.minimumClockAngle!==void 0){var v=h.minimumClockAngle;v===void 0&&(h.minimumClockAngle=v=new o(r),c=!0),v.processCzmlIntervals(u.minimumClockAngle,d)}if(u.maximumClockAngle!==void 0){var g=h.maximumClockAngle;g===void 0&&(h.maximumClockAngle=g=new o(r),c=!0),g.processCzmlIntervals(u.maximumClockAngle,d)}if(u.radius!==void 0){var _=h.radius;_===void 0&&(h.radius=_=new o(r),c=!0),_.processCzmlIntervals(u.radius,d)}if(u.showIntersection!==void 0){var y=h.showIntersection;y===void 0&&(h.showIntersection=y=new o(i),c=!0),y.processCzmlIntervals(u.showIntersection,d)}if(u.intersectionColor!==void 0){var w=h.intersectionColor;w===void 0&&(h.intersectionColor=w=new o(n),c=!0),w.processCzmlIntervals(u.intersectionColor,d)}if(u.capMaterial!==void 0){var C=h.capMaterial;C===void 0&&(h.capMaterial=C=new a,c=!0),C.processCzmlIntervals(u.capMaterial,d)}if(u.innerMaterial!==void 0){var x=h.innerMaterial;x===void 0&&(h.innerMaterial=x=new a,c=!0),x.processCzmlIntervals(u.innerMaterial,d)}if(u.outerMaterial!==void 0){var T=h.outerMaterial;T===void 0&&(h.outerMaterial=T=new a,c=!0),T.processCzmlIntervals(u.outerMaterial,d)}if(u.silhouetteMaterial!==void 0){var S=h.silhouetteMaterial;S===void 0&&(h.silhouetteMaterial=S=new a,c=!0),S.processCzmlIntervals(u.silhouetteMaterial,d)}return c},s.mergeProperties=function(e,i){var r=i.cone;if(r!==void 0){var n=e.cone;n===void 0&&(e.cone=n=new s),n.show=t(n.show,r.show),n.innerHalfAngle=t(n.innerHalfAngle,r.innerHalfAngle),n.outerHalfAngle=t(n.outerHalfAngle,r.outerHalfAngle),n.minimumClockAngle=t(n.minimumClockAngle,r.minimumClockAngle),n.maximumClockAngle=t(n.maximumClockAngle,r.maximumClockAngle),n.radius=t(n.radius,r.radius),n.showIntersection=t(n.showIntersection,r.showIntersection),n.intersectionColor=t(n.intersectionColor,r.intersectionColor),n.capMaterial=t(n.capMaterial,r.capMaterial),n.innerMaterial=t(n.innerMaterial,r.innerMaterial),n.outerMaterial=t(n.outerMaterial,r.outerMaterial),n.silhouetteMaterial=t(n.silhouetteMaterial,r.silhouetteMaterial)}},s.undefineProperties=function(e){e.cone=void 0},s}),i("DynamicScene/CzmlString",["../Core/defaultValue"],function(e){var t={unwrapInterval:function(t){return e(t.string,t)},isSampled:function(){return!1},getValue:function(e){return e}};return t}),i("Scene/LabelStyle",["../Core/Enumeration"],function(e){var t={FILL:new e(0,"FILL"),OUTLINE:new e(1,"OUTLINE"),FILL_AND_OUTLINE:new e(2,"FILL_AND_OUTLINE")};return t}),i("DynamicScene/CzmlLabelStyle",["../Core/defaultValue","../Scene/LabelStyle"],function(e,t){var i={unwrapInterval:function(t){return e(t.labelStyle,t)},isSampled:function(){return!1},getValue:function(e){return t[e]}};return i}),i("DynamicScene/DynamicLabel",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlCartesian2","./CzmlCartesian3","./CzmlNumber","./CzmlString","./CzmlHorizontalOrigin","./CzmlVerticalOrigin","./CzmlLabelStyle","./CzmlColor","./DynamicProperty"],function(e,t,i,r,n,o,a,s,l,u,c,h){var d=function(){this.text=void 0,this.font=void 0,this.style=void 0,this.fillColor=void 0,this.outlineColor=void 0,this.outlineWidth=void 0,this.horizontalOrigin=void 0,this.verticalOrigin=void 0,this.eyeOffset=void 0,this.pixelOffset=void 0,this.scale=void 0,this.show=void 0};return d.processCzmlPacket=function(t,m){var p=m.label;if(p===void 0)return!1;var f=!1,v=t.label;f=v===void 0,f&&(t.label=v=new d);var g=p.interval;if(g!==void 0&&(g=e.fromIso8601(g)),p.fillColor!==void 0){var _=v.fillColor;_===void 0&&(v.fillColor=_=new h(c),f=!0),_.processCzmlIntervals(p.fillColor,g)}if(p.outlineColor!==void 0){var y=v.outlineColor;y===void 0&&(v.outlineColor=y=new h(c),f=!0),y.processCzmlIntervals(p.outlineColor,g)}if(p.outlineWidth!==void 0){var w=v.outlineWidth;w===void 0&&(v.outlineWidth=w=new h(o),f=!0),w.processCzmlIntervals(p.outlineWidth,g)}if(p.eyeOffset!==void 0){var C=v.eyeOffset;C===void 0&&(v.eyeOffset=C=new h(n),f=!0),C.processCzmlIntervals(p.eyeOffset,g)}if(p.horizontalOrigin!==void 0){var x=v.horizontalOrigin;x===void 0&&(v.horizontalOrigin=x=new h(s),f=!0),x.processCzmlIntervals(p.horizontalOrigin,g)}if(p.text!==void 0){var T=v.text;T===void 0&&(v.text=T=new h(a),f=!0),T.processCzmlIntervals(p.text,g)}if(p.pixelOffset!==void 0){var S=v.pixelOffset;S===void 0&&(v.pixelOffset=S=new h(r),f=!0),S.processCzmlIntervals(p.pixelOffset,g)}if(p.scale!==void 0){var E=v.scale;E===void 0&&(v.scale=E=new h(o),f=!0),E.processCzmlIntervals(p.scale,g)}if(p.show!==void 0){var b=v.show;b===void 0&&(v.show=b=new h(i),f=!0),b.processCzmlIntervals(p.show,g)}if(p.verticalOrigin!==void 0){var M=v.verticalOrigin;M===void 0&&(v.verticalOrigin=M=new h(l),f=!0),M.processCzmlIntervals(p.verticalOrigin,g)}if(p.font!==void 0){var I=v.font;I===void 0&&(v.font=I=new h(a),f=!0),I.processCzmlIntervals(p.font,g)}if(p.style!==void 0){var D=v.style;D===void 0&&(v.style=D=new h(u),f=!0),D.processCzmlIntervals(p.style,g)}return f},d.mergeProperties=function(e,i){var r=i.label;if(r!==void 0){var n=e.label;n===void 0&&(e.label=n=new d),n.text=t(n.text,r.text),n.font=t(n.font,r.font),n.show=t(n.show,r.show),n.style=t(n.style,r.style),n.fillColor=t(n.fillColor,r.fillColor),n.outlineColor=t(n.outlineColor,r.outlineColor),n.outlineWidth=t(n.outlineWidth,r.outlineWidth),n.scale=t(n.scale,r.scale),n.horizontalOrigin=t(n.horizontalOrigin,r.horizontalOrigin),n.verticalOrigin=t(n.verticalOrigin,r.verticalOrigin),n.eyeOffset=t(n.eyeOffset,r.eyeOffset),n.pixelOffset=t(n.pixelOffset,r.pixelOffset)}},d.undefineProperties=function(e){e.label=void 0},d}),i("DynamicScene/DynamicPath",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(e,t,i,r,n,o){var a=function(){this.color=void 0,this.outlineColor=void 0,this.outlineWidth=void 0,this.show=void 0,this.width=void 0,this.resolution=void 0,this.leadTime=void 0,this.trailTime=void 0};return a.processCzmlPacket=function(t,s){var l=s.path;if(l===void 0)return!1;var u=!1,c=t.path;u=c===void 0,u&&(t.path=c=new a);var h=l.interval;if(h!==void 0&&(h=e.fromIso8601(h)),l.color!==void 0){var d=c.color;d===void 0&&(c.color=d=new o(n),u=!0),d.processCzmlIntervals(l.color,h)}if(l.width!==void 0){var m=c.width;m===void 0&&(c.width=m=new o(r),u=!0),m.processCzmlIntervals(l.width,h)}if(l.resolution!==void 0){var p=c.resolution;p===void 0&&(c.resolution=p=new o(r),u=!0),p.processCzmlIntervals(l.resolution,h)}if(l.outlineColor!==void 0){var f=c.outlineColor;f===void 0&&(c.outlineColor=f=new o(n),u=!0),f.processCzmlIntervals(l.outlineColor,h)}if(l.outlineWidth!==void 0){var v=c.outlineWidth;v===void 0&&(c.outlineWidth=v=new o(r),u=!0),v.processCzmlIntervals(l.outlineWidth,h)}if(l.show!==void 0){var g=c.show;g===void 0&&(c.show=g=new o(i),u=!0),g.processCzmlIntervals(l.show,h)}if(l.leadTime!==void 0){var _=c.leadTime;_===void 0&&(c.leadTime=_=new o(r),u=!0),_.processCzmlIntervals(l.leadTime,h)}if(l.trailTime!==void 0){var y=c.trailTime;y===void 0&&(c.trailTime=y=new o(r),u=!0),y.processCzmlIntervals(l.trailTime,h)}return u},a.mergeProperties=function(e,i){var r=i.path;if(r!==void 0){var n=e.path;n===void 0&&(e.path=n=new a),n.color=t(n.color,r.color),n.width=t(n.width,r.width),n.resolution=t(n.resolution,r.resolution),n.outlineColor=t(n.outlineColor,r.outlineColor),n.outlineWidth=t(n.outlineWidth,r.outlineWidth),n.show=t(n.show,r.show),n.leadTime=t(n.leadTime,r.leadTime),n.trailTime=t(n.trailTime,r.trailTime)}},a.undefineProperties=function(e){e.path=void 0},a}),i("DynamicScene/DynamicPoint",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(e,t,i,r,n,o){var a=function(){this.color=void 0,this.pixelSize=void 0,this.outlineColor=void 0,this.outlineWidth=void 0,this.show=void 0};return a.processCzmlPacket=function(t,s){var l=s.point;if(l===void 0)return!1;var u=!1,c=t.point;u=c===void 0,u&&(t.point=c=new a);var h=l.interval;if(h!==void 0&&(h=e.fromIso8601(h)),l.color!==void 0){var d=c.color;d===void 0&&(c.color=d=new o(n),u=!0),d.processCzmlIntervals(l.color,h)}if(l.pixelSize!==void 0){var m=c.pixelSize;m===void 0&&(c.pixelSize=m=new o(r),u=!0),m.processCzmlIntervals(l.pixelSize,h)}if(l.outlineColor!==void 0){var p=c.outlineColor;p===void 0&&(c.outlineColor=p=new o(n),u=!0),p.processCzmlIntervals(l.outlineColor,h)}if(l.outlineWidth!==void 0){var f=c.outlineWidth;f===void 0&&(c.outlineWidth=f=new o(r),u=!0),f.processCzmlIntervals(l.outlineWidth,h)}if(l.show!==void 0){var v=c.show;v===void 0&&(c.show=v=new o(i),u=!0),v.processCzmlIntervals(l.show,h)}return u},a.mergeProperties=function(e,i){var r=i.point;if(r!==void 0){var n=e.point;n===void 0&&(e.point=n=new a),n.color=t(n.color,r.color),n.pixelSize=t(n.pixelSize,r.pixelSize),n.outlineColor=t(n.outlineColor,r.outlineColor),n.outlineWidth=t(n.outlineWidth,r.outlineWidth),n.show=t(n.show,r.show)}},a.undefineProperties=function(e){e.point=void 0},a}),i("DynamicScene/DynamicPolygon",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./DynamicProperty","./DynamicMaterialProperty"],function(e,t,i,r,n){var o=function(){this.show=void 0,this.material=void 0};return o.processCzmlPacket=function(t,a,s,l){var u=a.polygon;if(u===void 0)return!1;var c=!1,h=t.polygon;c=h===void 0,c&&(t.polygon=h=new o);var d=u.interval;if(d!==void 0&&(d=e.fromIso8601(d)),u.show!==void 0){var m=h.show;m===void 0&&(h.show=m=new r(i),c=!0),m.processCzmlIntervals(u.show,d)}if(u.material!==void 0){var p=h.material;p===void 0&&(h.material=p=new n,c=!0),p.processCzmlIntervals(u.material,d,l)}return c},o.mergeProperties=function(e,i){var r=i.polygon;if(r!==void 0){var n=e.polygon;n===void 0&&(e.polygon=n=new o),n.show=t(n.show,r.show),n.material=t(n.material,r.material)}},o.undefineProperties=function(e){e.polygon=void 0},o}),i("DynamicScene/DynamicPolyline",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty"],function(e,t,i,r,n,o){var a=function(){this.color=void 0,this.outlineColor=void 0,this.outlineWidth=void 0,this.show=void 0,this.width=void 0};return a.processCzmlPacket=function(t,s){var l=s.polyline;if(l===void 0)return!1;var u=!1,c=t.polyline;u=c===void 0,u&&(t.polyline=c=new a);var h=l.interval;if(h!==void 0&&(h=e.fromIso8601(h)),l.color!==void 0){var d=c.color;d===void 0&&(c.color=d=new o(n),u=!0),d.processCzmlIntervals(l.color,h)}if(l.width!==void 0){var m=c.width;m===void 0&&(c.width=m=new o(r),u=!0),m.processCzmlIntervals(l.width,h)}if(l.outlineColor!==void 0){var p=c.outlineColor;p===void 0&&(c.outlineColor=p=new o(n),u=!0),p.processCzmlIntervals(l.outlineColor,h)}if(l.outlineWidth!==void 0){var f=c.outlineWidth;f===void 0&&(c.outlineWidth=f=new o(r),u=!0),f.processCzmlIntervals(l.outlineWidth,h)}if(l.show!==void 0){var v=c.show;v===void 0&&(c.show=v=new o(i),u=!0),v.processCzmlIntervals(l.show,h)}return u},a.mergeProperties=function(e,i){var r=i.polyline;if(r!==void 0){var n=e.polyline;n===void 0&&(e.polyline=n=new a),n.color=t(n.color,r.color),n.width=t(n.width,r.width),n.outlineColor=t(n.outlineColor,r.outlineColor),n.outlineWidth=t(n.outlineWidth,r.outlineWidth),n.show=t(n.show,r.show)}},a.undefineProperties=function(e){e.polyline=void 0},a}),i("DynamicScene/DynamicDirectionsProperty",["../Core/JulianDate","../Core/TimeInterval","../Core/TimeIntervalCollection","../Core/Cartesian3","../Core/Spherical","../Core/Iso8601"],function(e,t,i,r,n,o){function a(e){var t,i,o=[],a=e.unitSpherical;if(a!==void 0){for(t=0,i=a.length;i>t;t+=2)o.push(new n(a[t],a[t+1]));this.spherical=o}if(a=e.unitCartesian,a!==void 0){for(t=0,i=a.length;i>t;t+=3)o.push(new r(a[t],a[t+1],a[t+2],!0));this.cartesian=o}}a.prototype.getValueSpherical=function(){var e=this.spherical;if(e===void 0){e=[],this.spherical=e;for(var t=this.cartesian,i=0,r=t.length;r>i;i++)e.push(n.fromCartesian3(t[i]))}return e},a.prototype.getValueCartesian=function(){var e=this.cartesian;if(e===void 0){e=[],this.cartesian=e;for(var t=this.spherical,i=0,n=t.length;n>i;i++)e.push(r.fromSpherical(t[i]))}return e};var s=function(){this._propertyIntervals=new i};return s.prototype.processCzmlIntervals=function(e,t,i){if(Array.isArray(e))for(var r=0,n=e.length;n>r;r++)this._addCzmlInterval(e[r],t,i);else this._addCzmlInterval(e,t,i)},s.prototype.getValueSpherical=function(e){var t=this._propertyIntervals.findIntervalContainingDate(e);return t===void 0?void 0:t.data.getValueSpherical()},s.prototype.getValueCartesian=function(e){var t=this._propertyIntervals.findIntervalContainingDate(e);return t===void 0?void 0:t.data.getValueCartesian()},s.prototype._addCzmlInterval=function(e,i){var r=e.interval;r=r===void 0?o.MAXIMUM_INTERVAL.clone():t.fromIso8601(r),i!==void 0&&(r=r.intersect(i));var n=this._propertyIntervals,s=n.findInterval(r.start,r.stop);s===void 0&&(s=r,n.addInterval(s)),s.data=new a(e)},s}),i("DynamicScene/DynamicPyramid",["../Core/TimeInterval","../Core/defaultValue","./CzmlBoolean","./CzmlNumber","./CzmlColor","./DynamicProperty","./DynamicDirectionsProperty","./DynamicMaterialProperty"],function(e,t,i,r,n,o,a,s){var l=function(){this.show=void 0,this.directions=void 0,this.radius=void 0,this.showIntersection=void 0,this.intersectionColor=void 0,this.material=void 0};return l.processCzmlPacket=function(t,u){var c=u.pyramid;if(c===void 0)return!1;var h=!1,d=t.pyramid;h=d===void 0,h&&(t.pyramid=d=new l);var m=c.interval;if(m!==void 0&&(m=e.fromIso8601(m)),c.show!==void 0){var p=d.show;p===void 0&&(d.show=p=new o(i),h=!0),p.processCzmlIntervals(c.show,m)}if(c.radius!==void 0){var f=d.radius;f===void 0&&(d.radius=f=new o(r),h=!0),f.processCzmlIntervals(c.radius,m)}if(c.showIntersection!==void 0){var v=d.showIntersection;v===void 0&&(d.showIntersection=v=new o(i),h=!0),v.processCzmlIntervals(c.showIntersection,m)}if(c.intersectionColor!==void 0){var g=d.intersectionColor;g===void 0&&(d.intersectionColor=g=new o(n),h=!0),g.processCzmlIntervals(c.intersectionColor,m)}if(c.material!==void 0){var _=d.material;_===void 0&&(d.material=_=new s,h=!0),_.processCzmlIntervals(c.material,m)}if(c.directions!==void 0){var y=d.directions;y===void 0&&(d.directions=y=new a,h=!0),y.processCzmlIntervals(c.directions,m)}return h},l.mergeProperties=function(e,i){var r=i.pyramid;if(r!==void 0){var n=e.pyramid;n===void 0&&(e.pyramid=n=new l),n.show=t(n.show,r.show),n.directions=t(n.directions,r.directions),n.radius=t(n.radius,r.radius),n.showIntersection=t(n.showIntersection,r.showIntersection),n.intersectionColor=t(n.intersectionColor,r.intersectionColor),n.material=t(n.material,r.material)}},l.undefineProperties=function(e){e.pyramid=void 0},l}),i("Renderer/BlendEquation",["../Core/Enumeration"],function(e){var t={ADD:new e(32774,"ADD"),SUBTRACT:new e(32778,"SUBTRACT"),REVERSE_SUBTRACT:new e(32779,"REVERSE_SUBTRACT"),validate:function(e){return e===t.ADD||e===t.SUBTRACT||e===t.REVERSE_SUBTRACT}};return t}),i("Renderer/BlendFunction",["../Core/Enumeration"],function(e){var t={ZERO:new e(0,"ZERO"),ONE:new e(1,"ONE"),SOURCE_COLOR:new e(768,"SOURCE_COLOR"),ONE_MINUS_SOURCE_COLOR:new e(769,"ONE_MINUS_SOURCE_COLOR"),DESTINATION_COLOR:new e(774,"DESTINATION_COLOR"),ONE_MINUS_DESTINATION_COLOR:new e(775,"ONE_MINUS_DESTINATION_COLOR"),SOURCE_ALPHA:new e(770,"SOURCE_ALPHA"),ONE_MINUS_SOURCE_ALPHA:new e(771,"ONE_MINUS_SOURCE_ALPHA"),DESTINATION_ALPHA:new e(772,"DESTINATION_ALPHA"),ONE_MINUS_DESTINATION_ALPHA:new e(773,"ONE_MINUS_DESTINATION_ALPHA"),CONSTANT_COLOR:new e(32769,"CONSTANT_COLOR"),ONE_MINUS_CONSTANT_COLOR:new e(32770,"ONE_MINUS_CONSTANT_COLOR"),CONSTANT_ALPHA:new e(32771,"CONSTANT_ALPHA"),ONE_MINUS_CONSTANT_ALPHA:new e(32772,"ONE_MINUS_CONSTANT_ALPHA"),SOURCE_ALPHA_SATURATE:new e(776,"SOURCE_ALPHA_SATURATE"),validate:function(e){return e===t.ZERO||e===t.ONE||e===t.SOURCE_COLOR||e===t.ONE_MINUS_SOURCE_COLOR||e===t.DESTINATION_COLOR||e===t.ONE_MINUS_DESTINATION_COLOR||e===t.SOURCE_ALPHA||e===t.ONE_MINUS_SOURCE_ALPHA||e===t.DESTINATION_ALPHA||e===t.ONE_MINUS_DESTINATION_ALPHA||e===t.CONSTANT_COLOR||e===t.ONE_MINUS_CONSTANT_COLOR||e===t.CONSTANT_ALPHA||e===t.ONE_MINUS_CONSTANT_ALPHA||e===t.SOURCE_ALPHA_SATURATE}};return t}),i("Renderer/BlendingState",["./BlendEquation","./BlendFunction"],function(e,t){var i={DISABLED:{enabled:!1},ALPHA_BLEND:{enabled:!0,equationRgb:e.ADD,equationAlpha:e.ADD,functionSourceRgb:t.SOURCE_ALPHA,functionSourceAlpha:t.SOURCE_ALPHA,functionDestinationRgb:t.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:t.ONE_MINUS_SOURCE_ALPHA},PRE_MULTIPLIED_ALPHA_BLEND:{enabled:!0,equationRgb:e.ADD,equationAlpha:e.ADD,functionSourceRgb:t.ONE,functionSourceAlpha:t.ONE,functionDestinationRgb:t.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:t.ONE_MINUS_SOURCE_ALPHA},ADDITIVE_BLEND:{enabled:!0,equationRgb:e.ADD,equationAlpha:e.ADD,functionSourceRgb:t.SOURCE_ALPHA,functionSourceAlpha:t.SOURCE_ALPHA,functionDestinationRgb:t.ONE,functionDestinationAlpha:t.ONE}};return i}),i("Renderer/BufferUsage",["../Core/Enumeration"],function(e){var t={STREAM_DRAW:new e(35040,"STREAM_DRAW"),STATIC_DRAW:new e(35044,"STATIC_DRAW"),DYNAMIC_DRAW:new e(35048,"DYNAMIC_DRAW"),validate:function(e){return e===t.STREAM_DRAW||e===t.STATIC_DRAW||e===t.DYNAMIC_DRAW}};return t}),i("Renderer/CommandLists",[],function(){var e=function(){this.colorList=[],this.pickList=[],this.overlayList=[]};return e.prototype.empty=function(){return 0===this.colorList.length&&0===this.pickList.length&&0===this.overlayList.length},e.prototype.removeAll=function(){this.colorList.length=0,this.pickList.length=0,this.overlayList.length=0},e}),i("Renderer/DrawCommand",["../Core/DeveloperError"],function(){var e=function(){this.boundingVolume=void 0,this.modelMatrix=void 0,this.primitiveType=void 0,this.vertexArray=void 0,this.count=void 0,this.offset=void 0,this.shaderProgram=void 0,this.uniformMap=void 0,this.renderState=void 0,this.framebuffer=void 0,this.executeInClosestFrustum=!1};return e.prototype.execute=function(e,t){e.draw(this,t)},e}),i("Renderer/VertexArrayFacade",["../Core/ComponentDatatype","../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","./BufferUsage"],function(e,t,i,r,n){var o=function(e,t,i){function a(e,t){return t.componentDatatype.sizeInBytes-e.componentDatatype.sizeInBytes}if(!e)throw new r("context is required.");if(!t||0===t.length)throw new r("At least one attribute is required.");var s=o._verifyAttributes(t);i=i||0;for(var l,u,c,h,d={},m=[],p=s.length,f=0;p>f;++f){var v=s[f];v.vertexBuffer?m.push(v):(c=v.purpose,l=d[c],l===void 0&&(l=d[c]={}),h=""+v.usage,u=l[h],u===void 0&&(u=l[h]=[]),u.push(v))}this._buffersByPurposeAndUsage={},this._allBuffers=[];for(c in d)if(d.hasOwnProperty(c)){l=d[c];var g=this._buffersByPurposeAndUsage[c];g===void 0&&(g=this._buffersByPurposeAndUsage[c]={});for(h in l)if(l.hasOwnProperty(h)){u=l[h],u.sort(a);var _,y=o._vertexSizeInBytes(u);switch(h){case""+n.STATIC_DRAW:_=n.STATIC_DRAW;break;case""+n.STREAM_DRAW:_=n.STREAM_DRAW;break;case""+n.DYNAMIC_DRAW:_=n.DYNAMIC_DRAW}var w={purpose:c,vertexSizeInBytes:y,vertexBuffer:void 0,usage:_,needsCommit:!1,arrayBuffer:void 0,arrayViews:o._createArrayViews(u,y)};g[h]=w,this._allBuffers.push(w)}}this._size=0,this._precreated=m,this._context=e,this.writers=void 0,this.vaByPurpose=void 0,this.resize(i)};o._verifyAttributes=function(i){for(var o=[],a=0;i.length>a;++a){var s=i[a],l={index:t(s.index,a),enabled:t(s.enabled,!0),componentsPerAttribute:s.componentsPerAttribute,componentDatatype:s.componentDatatype||e.FLOAT,normalize:s.normalize||!1,purpose:t(s.purpose,"all"),vertexBuffer:s.vertexBuffer,usage:s.usage||n.STATIC_DRAW};if(o.push(l),1!==l.componentsPerAttribute&&2!==l.componentsPerAttribute&&3!==l.componentsPerAttribute&&4!==l.componentsPerAttribute)throw new r("attribute.componentsPerAttribute must be in the range [1, 4].");var u=l.componentDatatype;if(!e.validate(u))throw new r("Attribute must have a valid componentDatatype or not specify it.");if(!n.validate(l.usage))throw new r("Attribute must have a valid usage or not specify it.")}for(var c=Array(o.length),h=0;o.length>h;++h){var d=o[h],m=d.index,p=d.purpose;if("all"!==p){var f=c[m];if(f===!0)throw new r("Index "+m+" is used by more than one attribute.");if(f!==void 0){if(f[p])throw new r("Index "+m+" is used by more than one attribute with the same purpose.")}else f=c[m]={};f[p]=!0}else{if(c[m])throw new r("Index "+m+" is used by more than one attribute.");c[m]=!0}}return o},o._vertexSizeInBytes=function(e){for(var t=0,i=e.length,r=0;i>r;++r){var n=e[r];t+=n.componentsPerAttribute*n.componentDatatype.sizeInBytes}var o=i>0?e[0].componentDatatype.sizeInBytes:0,a=o>0?t%o:0,s=0===a?0:o-a;return t+=s},o._createArrayViews=function(e,t){for(var i=[],r=0,n=e.length,o=0;n>o;++o){var a=e[o],s=a.componentDatatype;i.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:s,normalize:a.normalize,offsetInBytes:r,vertexSizeInComponentType:t/s.sizeInBytes,view:void 0}),r+=a.componentsPerAttribute*s.sizeInBytes}return i},o.prototype.resize=function(e){this._size=e;var t=this._allBuffers;this.writers={};for(var i=0,r=t.length;r>i;++i){var n=t[i];o._resize(n,this._size);var a=this.writers[n.purpose];a===void 0&&(a=this.writers[n.purpose]=[]),o._appendWriters(a,n)}this._destroyVA()},o._resize=function(e,t){if(e.vertexSizeInBytes>0){var i=new ArrayBuffer(t*e.vertexSizeInBytes);if(e.arrayBuffer)for(var r=new Uint8Array(i),n=new Uint8Array(e.arrayBuffer),o=n.length,a=0;o>a;++a)r[a]=n[a];for(var s=e.arrayViews,l=s.length,u=0;l>u;++u){var c=s[u];c.view=c.componentDatatype.createArrayBufferView(i,c.offsetInBytes)}e.arrayBuffer=i}};var a=[function(e,t,i){return function(r,n){t[r*i]=n,e.needsCommit=!0}},function(e,t,i){return function(r,n,o){var a=r*i;t[a]=n,t[a+1]=o,e.needsCommit=!0}},function(e,t,i){return function(r,n,o,a){var s=r*i;t[s]=n,t[s+1]=o,t[s+2]=a,e.needsCommit=!0}},function(e,t,i){return function(r,n,o,a,s){var l=r*i;t[l]=n,t[l+1]=o,t[l+2]=a,t[l+3]=s,e.needsCommit=!0}}];o._appendWriters=function(e,t){for(var i=t.arrayViews,r=i.length,n=0;r>n;++n){var o=i[n];e[o.index]=a[o.componentsPerAttribute-1](t,o.view,o.vertexSizeInComponentType)}};var s=65536;return o.prototype.commit=function(e){for(var t,i=!1,r=this._allBuffers,n=0,a=r.length;a>n;++n)t=r[n],i=this._commit(t)||i;if(i||this.vaByPurpose===void 0){var l=this._buffersByPurposeAndUsage;this._destroyVA(),this.vaByPurpose={};for(var u in l)if(l.hasOwnProperty(u)){for(var c=l[u],h=[],d=Math.ceil(this._size/s),m=0;d>m;++m){var p=[],f=l.all;if(f!==c)for(var v in f)if(f.hasOwnProperty(v)){var g=f[v];o._appendAttributes(p,g,m*g.vertexSizeInBytes*s)}for(var _ in c)c.hasOwnProperty(_)&&(t=c[_],o._appendAttributes(p,t,m*t.vertexSizeInBytes*s));p=p.concat(this._precreated),h.push({va:this._context.createVertexArray(p,e),indicesCount:1.5*(m!==d-1?s:this._size%s)})}this.vaByPurpose[u]=h}}},o.prototype._commit=function(e){if(e.needsCommit&&e.vertexSizeInBytes>0){e.needsCommit=!1;var t=e.vertexBuffer,i=this._size*e.vertexSizeInBytes,r=t!==void 0;if(!r||i>t.getSizeInBytes())return r&&t.destroy(),e.vertexBuffer=this._context.createVertexBuffer(e.arrayBuffer,e.usage),e.vertexBuffer.setVertexArrayDestroyable(!1),!0;e.vertexBuffer.copyFromArrayView(e.arrayBuffer)}return!1},o._appendAttributes=function(e,t,i){for(var r=t.arrayViews,n=r.length,o=0;n>o;++o){var a=r[o];e.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:a.componentDatatype,normalize:a.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:i+a.offsetInBytes,strideInBytes:t.vertexSizeInBytes})}},o.prototype.subCommit=function(e,t){if(0>e||e>=this._size)throw new r("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(e+t>this._size)throw new r("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");for(var i=this._allBuffers,n=0,o=i.length;o>n;++n)this._subCommit(i[n],e,t)},o.prototype._subCommit=function(e,t,i){if(e.needsCommit&&e.vertexSizeInBytes>0){var r=e.vertexSizeInBytes*t,n=e.vertexSizeInBytes*i;e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,r,n),r)}},o.prototype.endSubCommits=function(){for(var e=this._allBuffers,t=0,i=e.length;i>t;++t)e[t].needsCommit=!1},o.prototype._destroyVA=function(){var e=this.vaByPurpose;if(void 0!==e){for(var t in e)if(e.hasOwnProperty(t))for(var i=e[t],r=i.length,n=0;r>n;++n)i[n].va.destroy();this.vaByPurpose=void 0}},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){for(var e=this._allBuffers,t=0,r=e.length;r>t;++t){var n=e[t];n.vertexBuffer=n.vertexBuffer&&n.vertexBuffer.destroy()}return this._destroyVA(),i(this)},o}),i("Scene/SceneMode",["../Core/Enumeration"],function(e){var t={SCENE2D:new e(0,"SCENE2D",{morphTime:0}),COLUMBUS_VIEW:new e(1,"COLUMBUS_VIEW",{morphTime:0}),SCENE3D:new e(2,"SCENE3D",{morphTime:1}),MORPHING:new e(3,"MORPHING")};return t}),i("Scene/Billboard",["../Core/defaultValue","../Core/DeveloperError","../Core/BoundingRectangle","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Math","../Core/Matrix4","./HorizontalOrigin","./VerticalOrigin","./SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){function m(e,t){var i=e._billboardCollection;
i!==void 0&&(i._updateBillboard(e,t),e._dirty=!0)}var p={},f=function(t,i){t=e(t,p),this._show=e(t.show,!0),this._position=o.clone(e(t.position,o.ZERO)),this._actualPosition=this._position.clone(),this._pixelOffset=n.clone(e(t.pixelOffset,n.ZERO)),this._eyeOffset=o.clone(e(t.eyeOffset,o.ZERO)),this._verticalOrigin=e(t.verticalOrigin,h.CENTER),this._horizontalOrigin=e(t.horizontalOrigin,c.CENTER),this._scale=e(t.scale,1),this._imageIndex=e(t.imageIndex,-1),this._color=r.clone(e(t.color,r.WHITE)),this._pickId=void 0,this._pickIdThis=t._pickIdThis,this._billboardCollection=i,this._dirty=!1,this._index=-1},v=f.SHOW_INDEX=0,g=f.POSITION_INDEX=1,_=f.PIXEL_OFFSET_INDEX=2,y=f.EYE_OFFSET_INDEX=3,w=f.HORIZONTAL_ORIGIN_INDEX=4,C=f.VERTICAL_ORIGIN_INDEX=5,x=f.SCALE_INDEX=6,T=f.IMAGE_INDEX_INDEX=7,S=f.COLOR_INDEX=8;f.NUMBER_OF_PROPERTIES=9,f.prototype.getPickId=function(t){return this._pickId===void 0&&(this._pickId=t.createPickId(e(this._pickIdThis,this))),this._pickId},f.prototype.getShow=function(){return this._show},f.prototype.setShow=function(e){if(e===void 0)throw new t("value is required.");e!==this._show&&(this._show=e,m(this,v))},f.prototype.getPosition=function(){return this._position},f.prototype.setPosition=function(e){if(e===void 0)throw new t("value is required.");var i=this._position;o.equals(i,e)||(o.clone(e,i),o.clone(e,this._actualPosition),m(this,g))},f.prototype._getActualPosition=function(){return this._actualPosition},f.prototype._setActualPosition=function(e){o.clone(e,this._actualPosition),m(this,g)},f.prototype.getPixelOffset=function(){return this._pixelOffset},f.prototype.setPixelOffset=function(e){if(e===void 0)throw new t("value is required.");var i=this._pixelOffset;n.equals(i,e)||(n.clone(e,i),m(this,_))},f.prototype.getEyeOffset=function(){return this._eyeOffset},f.prototype.setEyeOffset=function(e){if(e===void 0)throw new t("value is required.");var i=this._eyeOffset;o.equals(i,e)||(o.clone(e,i),m(this,y))},f.prototype.getHorizontalOrigin=function(){return this._horizontalOrigin},f.prototype.setHorizontalOrigin=function(e){if(e===void 0)throw new t("value is required.");this._horizontalOrigin!==e&&(this._horizontalOrigin=e,m(this,w))},f.prototype.getVerticalOrigin=function(){return this._verticalOrigin},f.prototype.setVerticalOrigin=function(e){if(e===void 0)throw new t("value is required.");this._verticalOrigin!==e&&(this._verticalOrigin=e,m(this,C))},f.prototype.getScale=function(){return this._scale},f.prototype.setScale=function(e){if(e===void 0)throw new t("value is required.");this._scale!==e&&(this._scale=e,m(this,x))},f.prototype.getImageIndex=function(){return this._imageIndex},f.prototype.setImageIndex=function(e){if("number"!=typeof e)throw new t("value is required and must be a number.");this._imageIndex!==e&&(this._imageIndex=e,m(this,T))},f.prototype.getColor=function(){return this._color},f.prototype.setColor=function(e){if(e===void 0)throw new t("value is required.");var i=this._color;r.equals(i,e)||(r.clone(e,i),m(this,S))};var E=new a,b=new s;f._computeActualPosition=function(e,t,i,r){var n=t.mode;if(n===d.SCENE3D)return e;r.multiplyByPoint(e,E);var a=t.scene2D.projection,s=a.getEllipsoid().cartesianToCartographic(E,b);if(s===void 0)return void 0;var u=a.project(s);if(n===d.MORPHING){var c=l.lerp(u.z,E.x,i),h=l.lerp(u.x,E.y,i),m=l.lerp(u.y,E.z,i);return new o(c,h,m)}return n===d.SCENE2D?new o(0,u.x,u.y):n===d.COLUMBUS_VIEW?new o(u.z,u.x,u.y):void 0};var M=new i,I=new u;return f._computeScreenSpacePosition=function(e,t,i,r,o,a){var s=a.camera,l=s.getViewMatrix(),c=s.frustum.getProjectionMatrix(),h=o.getCanvas();M.width=h.clientWidth,M.height=h.clientHeight;var d=u.computeViewportTransformation(M,0,1,I),m=l.multiply(e),p=m.multiplyByPoint(t),f=i.multiplyComponents(p.normalize());p.x+=i.x+f.x,p.y+=i.y+f.y,p.z+=f.z;var v=c.multiplyByVector(p);v.x/=v.w,v.y/=v.w,v.z/=v.w;var g=d.multiplyByPoint(v),_=o.getUniformState(),y=r.multiplyByScalar(_.getHighResolutionSnapScale());return g.x+=y.x,g.y+=y.y,new n(g.x,g.y)},f.prototype.computeScreenSpacePosition=function(e,i){var r=this._billboardCollection;if(r===void 0)throw new t("Billboard must be in a collection.  Was it removed?");if(e===void 0)throw new t("context is required.");if(i===void 0)throw new t("frameState is required.");var n=r.modelMatrix;return f._computeScreenSpacePosition(n,this._actualPosition,this._eyeOffset,this._pixelOffset,e,i)},f.prototype.equals=function(e){return this===e||e!==void 0&&this._show===e._show&&this._imageIndex===e._imageIndex&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&o.equals(this._position,e._position)&&r.equals(this._color,e._color)&&n.equals(this._pixelOffset,e._pixelOffset)&&o.equals(this._eyeOffset,e._eyeOffset)},f.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0},f}),i("Shaders/BillboardCollectionVS",[],function(){return"attribute vec3 positionHigh;\nattribute vec3 positionLow;\nattribute vec2 direction;\nattribute vec4 textureCoordinatesAndImageSize;\nattribute vec3 originAndShow;\nattribute vec2 pixelOffset;\nattribute vec4 eyeOffsetAndScale;\n#ifdef RENDER_FOR_PICK\nattribute vec4 pickColor;\n#else\nattribute vec4 color;\n#endif\nuniform vec2 u_atlasSize;\nuniform float u_morphTime;\nconst vec2 czm_highResolutionSnapScale = vec2(1.0, 1.0);\nvarying vec2 v_textureCoordinates;\n#ifdef RENDER_FOR_PICK\nvarying vec4 v_pickColor;\n#else\nvarying vec4 v_color;\n#endif\nvoid main()\n{\nvec3 eyeOffset = eyeOffsetAndScale.xyz;\nfloat scale = eyeOffsetAndScale.w;\nvec2 textureCoordinates = textureCoordinatesAndImageSize.xy;\nvec2 imageSize = textureCoordinatesAndImageSize.zw;\nvec2 origin = originAndShow.xy;\nfloat show = originAndShow.z;\nvec4 p = vec4(czm_translateRelativeToEye(positionHigh, positionLow), 1.0);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\npositionEC = czm_eyeOffset(positionEC, eyeOffset);\npositionEC.xyz *= show;\nvec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\nvec2 halfSize = u_atlasSize * imageSize * 0.5 * scale * czm_highResolutionSnapScale;\nhalfSize *= ((direction * 2.0) - 1.0);\npositionWC.xy += (origin * abs(halfSize)) + halfSize;\npositionWC.xy += (pixelOffset * czm_highResolutionSnapScale);\ngl_Position = czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\nv_textureCoordinates = textureCoordinates;\n#ifdef RENDER_FOR_PICK\nv_pickColor = pickColor;\n#else\nv_color = color;\n#endif\n}\n"}),i("Shaders/BillboardCollectionFS",[],function(){return"uniform sampler2D u_atlas;\nvarying vec2 v_textureCoordinates;\n#ifdef RENDER_FOR_PICK\nvarying vec4 v_pickColor;\n#else\nvarying vec4 v_color;\n#endif\nvoid main()\n{\n#ifdef RENDER_FOR_PICK\nvec4 vertexColor = vec4(1.0, 1.0, 1.0, 1.0);\n#else\nvec4 vertexColor = v_color;\n#endif\nvec4 color = texture2D(u_atlas, v_textureCoordinates) * vertexColor;\nif (color.a == 0.0)\n{\ndiscard;\n}\n#ifdef RENDER_FOR_PICK\ngl_FragColor = v_pickColor;\n#else\ngl_FragColor = color;\n#endif\n}\n"}),i("Scene/BillboardCollection",["../Core/DeveloperError","../Core/Color","../Core/combine","../Core/destroyObject","../Core/Math","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/EncodedCartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/IndexDatatype","../Core/PrimitiveType","../Core/BoundingSphere","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","../Renderer/VertexArrayFacade","./SceneMode","./Billboard","./HorizontalOrigin","../Shaders/BillboardCollectionVS","../Shaders/BillboardCollectionFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T){function S(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],i=e._billboards,r=i.length,n=0,o=0;r>n;++n){var a=i[n];a&&(a._index=o++,t.push(a))}e._billboards=t}}function E(e){var t=16384,i=e.cache.billboardCollection_directionsVertexBuffer;if(i!==void 0)return i;for(var r=new Uint8Array(2*4*t),n=0,o=0;t>n;++n)r[o++]=0,r[o++]=0,r[o++]=255,r[o++]=0,r[o++]=255,r[o++]=255,r[o++]=0,r[o++]=255;return i=e.createVertexBuffer(r,f.STATIC_DRAW),i.setVertexArrayDestroyable(!1),e.cache.billboardCollection_directionsVertexBuffer=i,i}function b(e){var t=16384,i=e.cache.billboardCollection_indexBuffer;if(i!==void 0)return i;for(var r=6*t,n=new Uint16Array(r),o=0,a=0;r>o;o+=6,a+=4)n[o+0]=a+0,n[o+1]=a+1,n[o+2]=a+2,n[o+3]=a+0,n[o+4]=a+2,n[o+5]=a+3;return i=e.createIndexBuffer(n,f.STATIC_DRAW,h.UNSIGNED_SHORT),i.setVertexArrayDestroyable(!1),e.cache.billboardCollection_indexBuffer=i,i}function M(e,t,i){var r=E(e);return new _(e,[{index:Z.positionHigh,componentsPerAttribute:3,componentDatatype:c.FLOAT,usage:i[q]},{index:Z.positionLow,componentsPerAttribute:3,componentDatatype:c.FLOAT,usage:i[q]},{index:Z.pixelOffset,componentsPerAttribute:2,componentDatatype:c.FLOAT,usage:i[U]},{index:Z.eyeOffsetAndScale,componentsPerAttribute:4,componentDatatype:c.FLOAT,usage:i[j]},{index:Z.textureCoordinatesAndImageSize,componentsPerAttribute:4,normalize:!0,componentDatatype:c.UNSIGNED_SHORT,usage:i[G]},{index:Z.pickColor,componentsPerAttribute:4,normalize:!0,componentDatatype:c.UNSIGNED_BYTE,usage:f.STATIC_DRAW,purpose:Q},{index:Z.color,componentsPerAttribute:4,normalize:!0,componentDatatype:c.UNSIGNED_BYTE,usage:i[Y],purpose:J},{index:Z.originAndShow,componentsPerAttribute:3,componentDatatype:c.BYTE,usage:i[F]},{index:Z.direction,vertexBuffer:r,componentsPerAttribute:2,normalize:!0,componentDatatype:c.UNSIGNED_BYTE}],4*t)}function I(e,t,i,r,n){var o=4*n._index,a=n._getActualPosition();e._mode===y.SCENE3D&&e._baseVolume.expand(a,e._baseVolume),l.fromCartesian(a,tt);var s=r[K],u=s[Z.positionHigh],c=tt.high;u(o+0,c.x,c.y,c.z),u(o+1,c.x,c.y,c.z),u(o+2,c.x,c.y,c.z),u(o+3,c.x,c.y,c.z);var h=s[Z.positionLow],d=tt.low;h(o+0,d.x,d.y,d.z),h(o+1,d.x,d.y,d.z),h(o+2,d.x,d.y,d.z),h(o+3,d.x,d.y,d.z)}function D(e,t,i,r,n){var o=4*n._index,a=n.getPixelOffset();e._maxPixelOffset=Math.max(e._maxPixelOffset,a.x,a.y);var s=r[K],l=s[Z.pixelOffset];l(o+0,a.x,a.y),l(o+1,a.x,a.y),l(o+2,a.x,a.y),l(o+3,a.x,a.y)}function A(e,t,i,r,n){var o=4*n._index,a=n.getEyeOffset(),s=n.getScale();e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)),e._maxScale=Math.max(e._maxScale,s);var l=r[K],u=l[Z.eyeOffsetAndScale];u(o+0,a.x,a.y,a.z,s),u(o+1,a.x,a.y,a.z,s),u(o+2,a.x,a.y,a.z,s),u(o+3,a.x,a.y,a.z,s)}function P(e,i,r,n,o){var a=4*o._index,s=n[Q],l=s[Z.pickColor],u=o.getPickId(i).color,c=t.floatToByte(u.red),h=t.floatToByte(u.green),d=t.floatToByte(u.blue),m=t.floatToByte(u.alpha);l(a+0,c,h,d,m),l(a+1,c,h,d,m),l(a+2,c,h,d,m),l(a+3,c,h,d,m)}function R(e,i,r,n,o){var a=4*o._index,s=n[J],l=s[Z.color],u=o.getColor(),c=t.floatToByte(u.red),h=t.floatToByte(u.green),d=t.floatToByte(u.blue),m=t.floatToByte(u.alpha);l(a+0,c,h,d,m),l(a+1,c,h,d,m),l(a+2,c,h,d,m),l(a+3,c,h,d,m)}function O(e,t,i,r,n){var o=4*n._index,a=n.getHorizontalOrigin().value,s=n.getVerticalOrigin().value,l=n.getShow();0===n.getColor().alpha&&(l=!1),e._allHorizontalCenter=e._allHorizontalCenter&&a===C.CENTER.value;var u=r[K],c=u[Z.originAndShow];c(o+0,a,s,l),c(o+1,a,s,l),c(o+2,a,s,l),c(o+3,a,s,l)}function z(t,i,r,n,o){var a=4*o._index,s=0,l=0,u=0,c=0,h=o.getImageIndex();if(-1!==h){var d=r[h];if(d===void 0)throw new e("Invalid billboard image index: "+h);s=d.x,l=d.y,u=d.width,c=d.height}var m=s+u,p=l+c;t._maxSize=Math.max(t._maxSize,u,c);var f=n[K],v=f[Z.textureCoordinatesAndImageSize];v(a+0,65535*s,65535*l,65535*u,65535*c),v(a+1,65535*m,65535*l,65535*u,65535*c),v(a+2,65535*m,65535*p,65535*u,65535*c),v(a+3,65535*s,65535*p,65535*u,65535*c)}function L(e,t,i,r,n){I(e,t,i,r,n),D(e,t,i,r,n),A(e,t,i,r,n),P(e,t,i,r,n),R(e,t,i,r,n),O(e,t,i,r,n),z(e,t,i,r,n)}function N(e,t,i,r,n,o,a){var s;s=r.mode===y.SCENE3D?e._baseVolume:e._baseVolume2D;for(var l=[],u=0;i>u;++u){var c=t[u],h=c.getPosition(),d=w._computeActualPosition(h,r,n,o);d!==void 0&&(c._setActualPosition(d),a?l.push(d):s.expand(d,s))}a&&m.fromPoints(l,s)}function V(e,t){var i=t.mode,r=t.scene2D.projection,n=e._billboards,o=e._billboardsToUpdate,a=e.morphTime,s=e._modelMatrix;e._mode!==i||e._projection!==r||i!==y.SCENE3D&&!s.equals(e.modelMatrix)?(e._mode=i,e._projection=r,e.modelMatrix.clone(s),e._createVertexArray=!0,(i===y.SCENE3D||i===y.SCENE2D||i===y.COLUMBUS_VIEW)&&N(e,n,n.length,t,a,s,!0)):i===y.MORPHING?N(e,n,n.length,t,a,s,!0):(i===y.SCENE2D||i===y.COLUMBUS_VIEW)&&N(e,o,e._billboardsToUpdateIndex,t,a,s,!1)}function B(e,t,i,r){var n,o,a,s=i.camera,l=s.frustum,u=e._textureAtlas.getTexture().getDimensions(),c=Math.max(u.x,u.y),h=s.getPositionWC().subtract(r.center,rt),d=s.getDirectionWC().multiplyByScalar(h.dot(s.getDirectionWC()),nt),m=Math.max(0,d.magnitude()-r.radius),p=t.getCanvas();it.x=p.clientWidth,it.y=p.clientHeight;var f=l.getPixelSize(it,m);n=Math.max(f.x,f.y),o=n*e._maxScale*e._maxSize*c,e._allHorizontalCenter&&(o*=.5),a=n*e._maxPixelOffset+e._maxEyeOffset,r.radius+=o+a}var F=w.SHOW_INDEX,q=w.POSITION_INDEX,U=w.PIXEL_OFFSET_INDEX,k=w.EYE_OFFSET_INDEX,W=w.HORIZONTAL_ORIGIN_INDEX,H=w.VERTICAL_ORIGIN_INDEX,j=w.SCALE_INDEX,G=w.IMAGE_INDEX_INDEX,Y=w.COLOR_INDEX,X=w.NUMBER_OF_PROPERTIES,Z={positionHigh:0,positionLow:1,pixelOffset:2,eyeOffsetAndScale:3,textureCoordinatesAndImageSize:4,originAndShow:5,direction:6,pickColor:7,color:7},K="all",J="color",Q="pick",$=[],et=function(){this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._rs=void 0,this._vaf=void 0,this._spPick=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(X),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._baseVolume=new m,this._baseVolume2D=new m,this._boundingVolume=new m,this._colorCommands=[],this._pickCommands=[],this._commandLists=new v,this.modelMatrix=u.IDENTITY.clone(),this._modelMatrix=u.IDENTITY.clone(),this._mode=y.SCENE3D,this._projection=void 0,this.morphTime=this._mode.morphTime,this._buffersUsage=[f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW,f.STATIC_DRAW];var e=this;this._uniforms={u_atlas:function(){return e._textureAtlas.getTexture()},u_atlasSize:function(){return e._textureAtlas.getTexture().getDimensions()},u_morphTime:function(){return e.morphTime}}};et.prototype.add=function(e){var t=new w(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},et.prototype.remove=function(e){return this.contains(e)?(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1},et.prototype.removeAll=function(){this._destroyBillboards(),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},et.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},et.prototype.contains=function(e){return e!==void 0&&e._billboardCollection===this},et.prototype.get=function(t){if(t===void 0)throw new e("index is required.");return S(this),this._billboards[t]},et.prototype.getLength=function(){return S(this),this._billboards.length},et.prototype.getTextureAtlas=function(){return this._textureAtlas},et.prototype.setTextureAtlas=function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)},et.prototype.getDestroyTextureAtlas=function(){return this._destroyTextureAtlas},et.prototype.setDestroyTextureAtlas=function(e){this._destroyTextureAtlas=e},et.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,i=this._propertiesChanged,r=0;X>r;++r){var n=0===i[r]?f.STATIC_DRAW:f.STREAM_DRAW;t=t||e[r]!==n,e[r]=n}return t};var tt=new l,it=new o,rt=new a,nt=new a;return et.prototype.update=function(e,t,i){var r=this._textureAtlas;if(void 0!==r){var n=r.getTextureCoordinates();if(0!==n.length){S(this),V(this,t);var o=this._billboards,a=o.length,s=this._billboardsToUpdate,l=this._billboardsToUpdateIndex,c=this._propertiesChanged,h=r.getGUID(),f=this._createVertexArray||this._textureAtlasGUID!==h;this._textureAtlasGUID=h;var v,_=t.passes,w=_.pick;if(f||!w&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var C=0;X>C;++C)c[C]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),a>0){this._vaf=M(e,a,this._buffersUsage),v=this._vaf.writers;for(var E=0;a>E;++E){var P=this._billboards[E];P._dirty=!1,L(this,e,n,v,P)}this._vaf.commit(b(e))}this._billboardsToUpdateIndex=0}else if(l>0){var N=[];if(c[q]&&N.push(I),c[U]&&N.push(D),(c[k]||c[j])&&N.push(A),c[G]&&N.push(z),c[Y]&&N.push(R),(c[W]||c[H]||c[F])&&N.push(O),v=this._vaf.writers,l/a>.1){for(var K=0;l>K;++K){var et=s[K];et._dirty=!1;for(var tt=0;N.length>tt;++tt)N[tt](this,e,n,v,et)}this._vaf.commit(b(e))}else{for(var it=0;l>it;++it){var rt=s[it];rt._dirty=!1;for(var nt=0;N.length>nt;++nt)N[nt](this,e,n,v,rt);this._vaf.subCommit(4*rt._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(l>1.5*a&&(s.length=a),void 0!==this._vaf&&void 0!==this._vaf.vaByPurpose){var ot,at=u.IDENTITY;t.mode===y.SCENE3D?(at=this.modelMatrix,ot=m.clone(this._baseVolume,this._boundingVolume)):this._baseVolume2D!==void 0&&(ot=m.clone(this._baseVolume2D,this._boundingVolume)),B(this,e,t,ot);var st,lt,ut,ct,ht=this._commandLists;if(ht.colorList=$,ht.pickList=$,_.color){var dt=this._colorCommands;for(ht.colorList=dt,this._sp===void 0&&(this._rs=e.createRenderState({depthTest:{enabled:!0},blending:p.ALPHA_BLEND}),this._sp=e.getShaderCache().getShaderProgram(x,T,Z)),st=this._vaf.vaByPurpose[J],lt=st.length,dt.length=lt,ct=0;lt>ct;++ct)ut=dt[ct],ut===void 0&&(ut=dt[ct]=new g),ut.boundingVolume=ot,ut.modelMatrix=at,ut.primitiveType=d.TRIANGLES,ut.count=st[ct].indicesCount,ut.shaderProgram=this._sp,ut.uniformMap=this._uniforms,ut.vertexArray=st[ct].va,ut.renderState=this._rs}if(w){var mt=this._pickCommands;for(ht.pickList=mt,this._spPick===void 0&&(this._spPick=e.getShaderCache().getShaderProgram("#define RENDER_FOR_PICK 1\n"+x,"#define RENDER_FOR_PICK 1\n"+T,Z)),st=this._vaf.vaByPurpose[Q],lt=st.length,mt.length=lt,ct=0;lt>ct;++ct)ut=mt[ct],ut===void 0&&(ut=mt[ct]=new g),ut.boundingVolume=ot,ut.modelMatrix=at,ut.primitiveType=d.TRIANGLES,ut.count=st[ct].indicesCount,ut.shaderProgram=this._spPick,ut.uniformMap=this._uniforms,ut.vertexArray=st[ct].va,ut.renderState=this._rs}ht.empty()||i.push(ht)}}}},et.prototype.isDestroyed=function(){return!1},et.prototype.destroy=function(){return this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.release(),this._spPick=this._spPick&&this._spPick.release(),this._vaf=this._vaf&&this._vaf.destroy(),this._destroyBillboards(),r(this)},et.prototype._destroyBillboards=function(){for(var e=this._billboards,t=e.length,i=0;t>i;++i)e[i]&&e[i]._destroy()},et}),i("Renderer/TextureAtlasBuilder",["../Core/Event","../Core/DeveloperError","../Core/loadImage"],function(e,t,i){function r(){this.imageLoaded=new e,this.index=-1,this.loaded=!1}var n=function(e){if(e===void 0)throw new t("textureAtlas is required.");this.textureAtlas=e,this._idHash={}};return n.prototype.addTextureFromUrl=function(e,r){if(e===void 0)throw new t("url is required.");if(r===void 0)throw new t("textureAvailableCallback is required.");this.addTextureFromFunction(e,function(e,t){i(e).then(t)},r)},n.prototype.addTextureFromFunction=function(e,i,n){if(e===void 0)throw new t("id is required.");if(i===void 0)throw new t("getImageCallback is required.");if(n===void 0)throw new t("textureAvailableCallback is required.");var o=this._idHash[e];if(o!==void 0)return o.loaded?n(o.index):o.imageLoaded.addEventListener(n),void 0;this._idHash[e]=o=new r,o.imageLoaded.addEventListener(n);var a=this;i(e,function(t){if(!a.textureAtlas.isDestroyed()){var i=o.index=a.textureAtlas.addImage(t);o.loaded=!0,o.imageLoaded.raiseEvent(i,e),o.imageLoaded=void 0}})},n}),i("DynamicScene/DynamicBillboardVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Scene/BillboardCollection","../Scene/HorizontalOrigin","../Scene/VerticalOrigin","../Renderer/TextureAtlasBuilder"],function(e,t,i,r,n,o,a,s,l){function u(e,t,i){return function(r){var n=e._billboardVisualizerIndex;if(n!==void 0){var o=t.get(n);o._visualizerUrl===i&&(o._visualizerTextureAvailable=!0,o.setImageIndex(r))}}}var c=function(t,i){if(t===void 0)throw new e("scene is required.");this._scene=t,this._unusedIndexes=[],this._dynamicObjectCollection=void 0;var r=this._billboardCollection=new o,n=this._textureAtlas=t.getContext().createTextureAtlas();this._textureAtlasBuilder=new l(n),r.setTextureAtlas(n),t.getPrimitives().add(r),this.setDynamicObjectCollection(i)};c.prototype.getScene=function(){return this._scene},c.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},c.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(c.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(c.prototype._onObjectsRemoved,this))},c.prototype.update=function(t){if(t===void 0)throw new e("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(t,i[r])},c.prototype.removeAllPrimitives=function(){if(this._dynamicObjectCollection!==void 0){this._unusedIndexes=[],this._billboardCollection.removeAll();for(var e=this._dynamicObjectCollection.getObjects(),t=e.length-1;t>-1;t--)e[t]._billboardVisualizerIndex=void 0}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._billboardCollection),t(this)};var h,d,m,p;return c.prototype._updateObject=function(e,t){var o=t.billboard;if(void 0!==o){var l=t.position;if(void 0!==l){var c=o.image;if(void 0!==c){var f,v=o.show,g=t._billboardVisualizerIndex,_=t.isAvailable(e)&&(v===void 0||v.getValue(e));if(!_)return g!==void 0&&(f=this._billboardCollection.get(g),f.setShow(!1),f.setImageIndex(-1),f._visualizerUrl=void 0,f._visualizerTextureAvailable=!1,t._billboardVisualizerIndex=void 0,this._unusedIndexes.push(g)),void 0;if(g===void 0){var y=this._unusedIndexes,w=y.length;w>0?(g=y.pop(),f=this._billboardCollection.get(g)):(g=this._billboardCollection.getLength(),f=this._billboardCollection.add()),t._billboardVisualizerIndex=g,f.dynamicObject=t,f._visualizerUrl=void 0,f._visualizerTextureAvailable=!1,f.setColor(i.WHITE),f.setEyeOffset(n.ZERO),f.setPixelOffset(r.ZERO),f.setScale(1),f.setHorizontalOrigin(a.CENTER),f.setVerticalOrigin(s.CENTER)}else f=this._billboardCollection.get(g);var C=c.getValue(e);if(C!==f._visualizerUrl&&(f._visualizerUrl=C,f._visualizerTextureAvailable=!1,this._textureAtlasBuilder.addTextureFromUrl(C,u(t,this._billboardCollection,C))),f.setShow(f._visualizerTextureAvailable),f._visualizerTextureAvailable){h=l.getValueCartesian(e,h),h!==void 0&&f.setPosition(h);var x=o.color;if(x!==void 0&&(d=x.getValue(e,d),d!==void 0&&f.setColor(d)),x=o.eyeOffset,x!==void 0&&(m=x.getValue(e,m),m!==void 0&&f.setEyeOffset(m)),x=o.pixelOffset,x!==void 0&&(p=x.getValue(e,p),p!==void 0&&f.setPixelOffset(p)),x=o.scale,x!==void 0){var T=x.getValue(e);T!==void 0&&f.setScale(T)}if(x=o.horizontalOrigin,x!==void 0){var S=x.getValue(e);S!==void 0&&f.setHorizontalOrigin(S)}if(x=o.verticalOrigin,x!==void 0){var E=x.getValue(e);E!==void 0&&f.setVerticalOrigin(E)}}}}}},c.prototype._onObjectsRemoved=function(e,t){for(var i=this._billboardCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._billboardVisualizerIndex;if(a!==void 0){var s=i.get(a);s.setShow(!1),s.setImageIndex(-1),s._visualizerUrl=void 0,s._visualizerTextureAvailable=!1,o._billboardVisualizerIndex=void 0,r.push(a)}}},c}),i("Renderer/CullFace",["../Core/Enumeration"],function(e){var t={FRONT:new e(1028,"FRONT"),BACK:new e(1029,"BACK"),FRONT_AND_BACK:new e(1032,"FRONT_AND_BACK"),validate:function(e){return e===t.FRONT||e===t.BACK||e===t.FRONT_AND_BACK}};return t}),i("Renderer/createPickFragmentShaderSource",["../Core/defaultValue","../Core/DeveloperError"],function(e,t){function i(e,i){if(e===void 0)throw new t("fragmentShaderSource is required.");if("uniform"!==i&&"varying"!==i)throw new t("qualifier must be 'uniform' or 'varying'.");var r=e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,"void czm_old_main()"),n=i+" vec4 czm_pickColor; \n"+"void main() \n"+"{ \n"+"    czm_old_main(); \n"+"    if (gl_FragColor.a == 0.0) { \n"+"        discard; \n"+"    } \n"+"    gl_FragColor = czm_pickColor; \n"+"}";return r+"\n"+n}return i}),i("Shaders/EllipsoidVS",[],function(){return"attribute vec3 position;\nuniform vec3 u_radii;\nvarying vec3 v_positionEC;\nvoid main()\n{\nvec4 p = vec4(u_radii * position, 1.0);\nv_positionEC = (czm_modelView * p).xyz;\ngl_Position = czm_modelViewProjection * p;\ngl_Position.z = clamp(gl_Position.z, gl_DepthRange.near, gl_DepthRange.far);\n}\n"}),i("Shaders/EllipsoidFS",[],function(){return"uniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\nvarying vec3 v_positionEC;\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\nvec3 positionEC = czm_pointAlongRay(ray, intersection);\nvec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\nvec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\nvec3 sphericalNormal = normalize(positionMC / u_radii);\nvec3 normalMC = geodeticNormal * side;\nvec3 normalEC = normalize(czm_normal * normalMC);\nvec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\nvec3 positionToEyeEC = -positionEC;\nczm_materialInput materialInput;\nmaterialInput.s = st.s;\nmaterialInput.st = st;\nmaterialInput.str = (positionMC + u_radii) / u_radii;\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\nreturn czm_phong(normalize(positionToEyeEC), material);\n}\nvoid main()\n{\nczm_ellipsoid ellipsoid = czm_ellipsoidNew(czm_modelView[3].xyz, u_radii);\nvec3 direction = normalize(v_positionEC);\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (czm_isEmpty(intersection))\n{\ndiscard;\n}\nvec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\nvec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\ngl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\ngl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n}\n"}),i("Scene/EllipsoidPrimitive",["../Core/BoxTessellator","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/DeveloperError","../Core/destroyObject","../Core/Ellipsoid","../Core/Matrix4","../Core/MeshFilters","../Core/BoundingSphere","../Core/PrimitiveType","../Renderer/CullFace","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","../Renderer/createPickFragmentShaderSource","./Material","./SceneMode","../Shaders/EllipsoidVS","../Shaders/EllipsoidFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x){function T(i){var r=i.cache.ellipsoidPrimitive_vertexArray;if(r!==void 0)return r;var n=e.compute({dimensions:new t(2,2,2)});return r=i.createVertexArrayFromMesh({mesh:n,attributeIndices:S,bufferUsage:f.STATIC_DRAW}),i.cache.ellipsoidPrimitive_vertexArray=r,r}var S={position:0},E=function(){this.center=t.ZERO.clone(),this.radii=void 0,this._radii=new t,this._oneOverEllipsoidRadiiSquared=new t,this._boundingSphere=new h,this.modelMatrix=u.IDENTITY.clone(),this._computedModelMatrix=u.IDENTITY.clone(),this.show=!0,this.material=y.fromType(void 0,y.ColorType),this._material=void 0,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new g,this._pickCommand=new g,this._commandLists=new v;var e=this;this._uniforms={u_radii:function(){return e.radii},u_oneOverEllipsoidRadiiSquared:function(){return e._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return e._pickId.color}}};return E.prototype.update=function(e,i,r){if(this.show&&i.mode===w.SCENE3D&&void 0!==this.center&&void 0!==this.radii){if(this.material===void 0)throw new a("this.material must be defined.");this._rs===void 0&&(this._rs=e.createRenderState({cull:{enabled:!0,face:m.FRONT},depthTest:{enabled:!0},depthMask:!1,blending:p.ALPHA_BLEND})),this._va===void 0&&(this._va=T(e));var o=this.radii;if(!t.equals(this._radii,o)){t.clone(o,this._radii);var s=this._oneOverEllipsoidRadiiSquared;s.x=1/(o.x*o.x),s.y=1/(o.y*o.y),s.z=1/(o.z*o.z),this._boundingSphere.radius=t.getMaximumComponent(o)}u.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix);var l=this._commandLists;l.removeAll();var c=this._material!==this.material;if(this._material=this.material,i.passes.color){var h=this._colorCommand;if(c){var f="#line 0\n"+this.material.shaderSource+"#line 0\n"+x;this._sp=e.getShaderCache().replaceShaderProgram(this._sp,C,f,S),h.primitiveType=d.TRIANGLES,h.vertexArray=this._va,h.renderState=this._rs,h.shaderProgram=this._sp,h.uniformMap=n([this._uniforms,this.material._uniforms],!1,!1),h.executeInClosestFrustum=!0}h.boundingVolume=this._boundingSphere,h.modelMatrix=this._computedModelMatrix,l.colorList.push(h)}if(i.passes.pick){var v=this._pickCommand;if(this._pickId===void 0&&(this._pickId=e.createPickId(this)),c||this._pickSP===void 0){var g=_("#line 0\n"+this.material.shaderSource+"#line 0\n"+x,"uniform");this._pickSP=e.getShaderCache().replaceShaderProgram(this._pickSP,C,g,S),v.primitiveType=d.TRIANGLES,v.vertexArray=this._va,v.renderState=this._rs,v.shaderProgram=this._pickSP,v.uniformMap=n([this._uniforms,this._pickUniforms,this.material._uniforms],!1,!1),v.executeInClosestFrustum=!0}v.boundingVolume=this._boundingSphere,v.modelMatrix=this._computedModelMatrix,l.pickList.push(v)}r.push(l)}},E.prototype.isDestroyed=function(){return!1},E.prototype.destroy=function(){return this._sp=this._sp&&this._sp.release(),this._pickSP=this._pickSP&&this._pickSP.release(),this._pickId=this._pickId&&this._pickId.destroy(),s(this)},E}),i("DynamicScene/DynamicEllipsoidVisualizer",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Matrix3","../Core/Matrix4","../Scene/EllipsoidPrimitive","../Scene/Material"],function(e,t,i,r,n,o,a,s){var l=new n,u=function(e,i){if(e===void 0)throw new t("scene is required.");this._scene=e,this._unusedIndexes=[],this._primitives=e.getPrimitives(),this._ellipsoidCollection=[],this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};u.prototype.getScene=function(){return this._scene},u.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},u.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(u.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(u.prototype._onObjectsRemoved,this))},u.prototype.update=function(e){if(e===void 0)throw new t("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(e,i[r])
},u.prototype.removeAllPrimitives=function(){var e,t;for(e=0,t=this._ellipsoidCollection.length;t>e;e++)this._primitives.remove(this._ellipsoidCollection[e]);if(this._dynamicObjectCollection!==void 0){var i=this._dynamicObjectCollection.getObjects();for(e=i.length-1;e>-1;e--)i[e]._ellipsoidVisualizerIndex=void 0}this._unusedIndexes=[],this._ellipsoidCollection=[]},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this.removeAllPrimitives(),i(this)};var c,h;return u.prototype._updateObject=function(t,i){var r=this._scene.getContext(),u=i.ellipsoid;if(void 0!==u){var d=u.radii;if(void 0!==d){var m=i.position;if(void 0!==m){var p=i.orientation;if(void 0!==p){var f,v=u.show,g=i._ellipsoidVisualizerIndex,_=i.isAvailable(t)&&(v===void 0||v.getValue(t));if(!_)return g!==void 0&&(f=this._ellipsoidCollection[g],f.show=!1,i._ellipsoidVisualizerIndex=void 0,this._unusedIndexes.push(g)),void 0;if(g===void 0){var y=this._unusedIndexes,w=y.length;w>0?(g=y.pop(),f=this._ellipsoidCollection[g]):(g=this._ellipsoidCollection.length,f=new a,this._ellipsoidCollection.push(f),this._primitives.add(f)),i._ellipsoidVisualizerIndex=g,f.dynamicObject=i,f.material=s.fromType(r,s.ColorType)}else f=this._ellipsoidCollection[g];f.show=!0,f.radii=d.getValue(t,f.radii),c=e(m.getValueCartesian(t,c),f._visualizerPosition),h=e(p.getValue(t,h),f._visualizerOrientation),void 0===c||void 0===h||c.equals(f._visualizerPosition)&&h.equals(f._visualizerOrientation)||(o.fromRotationTranslation(n.fromQuaternion(h,l),c,f.modelMatrix),f._visualizerPosition=c.clone(f._visualizerPosition),f._visualizerOrientation=h.clone(f._visualizerOrientation));var C=u.material;C!==void 0&&(f.material=C.getValue(t,r,f.material))}}}}},u.prototype._onObjectsRemoved=function(e,t){for(var i=this._ellipsoidCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._ellipsoidVisualizerIndex;if(a!==void 0){var s=i[a];s.show=!1,r.push(a),o._ellipsoidVisualizerIndex=void 0}}},u}),i("Shaders/SensorVolume",[],function(){return"uniform vec4 u_intersectionColor;\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointEC)\n{\nvec3 D = ellipsoidEC.inverseRadii;\nvec3 q = D * coneVertexWC;\nfloat qMagnitudeSquared = dot(q, q);\nfloat test = qMagnitudeSquared - 1.0;\nvec3 t = (czm_inverseView * vec4(pointEC, 1.0)).xyz;\nvec3 temp = D * t - q;\nfloat d = dot(temp, q);\nreturn (d < -test) && (d / length(temp) < -sqrt(test));\n}\n#ifndef RENDER_FOR_PICK\nvec4 getIntersectionColor(float sensorRadius, vec3 pointEC)\n{\nreturn u_intersectionColor;\n}\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\nfloat t = pointMC.z / sensorRadius;\nfloat s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\ns = s - floor(s);\nreturn vec2(s, t);\n}\n#endif\n"}),i("Shaders/CustomSensorVolumeVS",[],function(){return"attribute vec4 position;\nattribute vec3 normal;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\ngl_Position = czm_modelViewProjection * position;\nv_positionWC = (czm_model * position).xyz;\nv_positionEC = (czm_modelView * position).xyz;\nv_normalEC = czm_normal * normal;\n}\n"}),i("Shaders/CustomSensorVolumeFS",[],function(){return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\nuniform float u_sensorRadius;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\nczm_materialInput materialInput;\nvec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\nmaterialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\nmaterialInput.str = pointMC / sensorRadius;\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nvec3 normalEC = normalize(v_normalEC);\nnormalEC = mix(normalEC, -normalEC, step(normalEC.z, 0.0));\nmaterialInput.normalEC = normalEC;\nczm_material material = czm_getMaterial(materialInput);\nreturn czm_phong(normalize(positionToEyeEC), material);\n}\nbool ellipsoidSensorIntersection(czm_raySegment ellipsoidInterval, float pointInEllipsoid)\n{\nif (czm_isEmpty(ellipsoidInterval)) {\nreturn false;\n}\nfloat t = pointInEllipsoid;\n#ifdef GL_OES_standard_derivatives\nfloat epsilon = max(abs(dFdx(t)), abs(dFdy(t)));\n#else\nfloat epsilon = 1.0 / 500.0;\n#endif\nfloat width = 2.0;\nepsilon *= width;\nreturn czm_equalsEpsilon(t, 1.0, epsilon);\n}\nvec4 shade(czm_raySegment ellipsoidInterval, float pointInEllipsoid)\n{\nif (u_showIntersection && ellipsoidSensorIntersection(ellipsoidInterval, pointInEllipsoid))\n{\nreturn getIntersectionColor(u_sensorRadius, v_positionEC);\n}\nreturn getColor(u_sensorRadius, v_positionEC);\n}\nfloat czm_pointInEllipsoid(czm_ellipsoid ellipsoid, vec3 point)\n{\nreturn (((point.x * point.x) / (ellipsoid.radii.x * ellipsoid.radii.x)) +\n((point.y * point.y) / (ellipsoid.radii.y * ellipsoid.radii.y)) +\n((point.z * point.z) / (ellipsoid.radii.z * ellipsoid.radii.z)));\n}\nvoid main()\n{\nvec3 sensorVertexWC = czm_model[3].xyz;\nvec3 sensorVertexEC = czm_modelView[3].xyz;\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nfloat pointInEllipsoid = czm_pointInEllipsoid(ellipsoid, v_positionWC);\nif (!u_showThroughEllipsoid)\n{\nif (pointInEllipsoid < 1.0)\n{\ndiscard;\n}\nif (inSensorShadow(sensorVertexWC, ellipsoid, v_positionEC))\n{\ndiscard;\n}\n}\nif (distance(v_positionEC, sensorVertexEC) > u_sensorRadius)\n{\ndiscard;\n}\nczm_ray ray = czm_ray(vec3(0.0), normalize(v_positionEC));\nczm_raySegment ellipsoidInterval = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\ngl_FragColor = shade(ellipsoidInterval, pointInEllipsoid);\n}\n"}),i("Scene/CustomSensorVolume",["../Core/defaultValue","../Core/DeveloperError","../Core/Color","../Core/combine","../Core/destroyObject","../Core/FAR","../Core/Math","../Core/Cartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/PrimitiveType","../Core/BoundingSphere","../Renderer/BufferUsage","../Renderer/BlendingState","../Renderer/CommandLists","../Renderer/DrawCommand","../Renderer/createPickFragmentShaderSource","./Material","../Shaders/SensorVolume","../Shaders/CustomSensorVolumeVS","../Shaders/CustomSensorVolumeFS","./SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C){var x={position:0,normal:1},T=function(t){t=e(t,e.EMPTY_OBJECT),this._pickId=void 0,this._pickIdThis=e(t._pickIdThis,this),this._colorCommand=new f,this._pickCommand=new f,this._commandLists=new p,this._colorCommand.primitiveType=this._pickCommand.primitiveType=c.TRIANGLES,this._colorCommand.boundingVolume=this._pickCommand.boundingVolume=new h,this.show=e(t.show,!0),this.showIntersection=e(t.showIntersection,!0),this.showThroughEllipsoid=e(t.showThroughEllipsoid,!1),this._showThroughEllipsoid=this.showThroughEllipsoid,this.modelMatrix=l.clone(e(t.modelMatrix,l.IDENTITY)),this.bufferUsage=e(t.bufferUsage,d.STATIC_DRAW),this._bufferUsage=this.bufferUsage,this.radius=e(t.radius,Number.POSITIVE_INFINITY),this._directions=void 0,this._directionsDirty=!1,this.setDirections(t.directions),this.material=t.material!==void 0?t.material:g.fromType(void 0,g.ColorType),this._material=void 0,this.intersectionColor=i.clone(e(t.intersectionColor,i.WHITE));var r=this;this._uniforms={u_showThroughEllipsoid:function(){return r.showThroughEllipsoid},u_showIntersection:function(){return r.showIntersection},u_sensorRadius:function(){return isFinite(r.radius)?r.radius:o},u_intersectionColor:function(){return r.intersectionColor}},this._mode=C.SCENE3D};return T.prototype.setDirections=function(e){this._directions=e,this._directionsDirty=!0},T.prototype.getDirections=function(){return this._directions},T.prototype._computePositions=function(){for(var e=this._directions,t=e.length,i=new Float32Array(3*t),r=isFinite(this.radius)?this.radius:o,n=[s.ZERO],a=t-2,l=t-1,u=0;t>u;a=l++,l=u++){var c=s.fromSpherical(e[a]),d=s.fromSpherical(e[l]),m=s.fromSpherical(e[u]),p=Math.max(s.angleBetween(c,d),s.angleBetween(d,m)),f=r/Math.cos(.5*p),v=d.multiplyByScalar(f);i[3*l+0]=v.x,i[3*l+1]=v.y,i[3*l+2]=v.z,n.push(v)}return h.fromPoints(n,this._colorCommand.boundingVolume),i},T.prototype._createVertexArray=function(e){for(var t=this._computePositions(),i=this._directions.length,r=new Float32Array(18*i),n=0,o=i-1,a=0;i>a;o=a++){var l=new s(t[3*o+0],t[3*o+1],t[3*o+2]),c=new s(t[3*a+0],t[3*a+1],t[3*a+2]),h=c.cross(l).normalize();r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=h.x,r[n++]=h.y,r[n++]=h.z,r[n++]=c.x,r[n++]=c.y,r[n++]=c.z,r[n++]=h.x,r[n++]=h.y,r[n++]=h.z,r[n++]=l.x,r[n++]=l.y,r[n++]=l.z,r[n++]=h.x,r[n++]=h.y,r[n++]=h.z}var d=e.createVertexBuffer(new Float32Array(r),this.bufferUsage),m=6*Float32Array.BYTES_PER_ELEMENT,p=[{index:x.position,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:u.FLOAT,offsetInBytes:0,strideInBytes:m},{index:x.normal,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:u.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:m}];return e.createVertexArray(p)},T.prototype.update=function(e,i,n){if(this._mode=i.mode,this.show&&this._mode===C.SCENE3D){if(0>this.radius)throw new t("this.radius must be greater than or equal to zero.");if(this.material===void 0)throw new t("this.material must be defined.");if(this._showThroughEllipsoid!==this.showThroughEllipsoid||this._colorCommand.renderState===void 0){this._showThroughEllipsoid=this.showThroughEllipsoid;var o=e.createRenderState({depthTest:{enabled:!this.showThroughEllipsoid},depthMask:!1,blending:m.ALPHA_BLEND});this._colorCommand.renderState=o,this._pickCommand.renderState=o}if(this._directionsDirty||this._bufferUsage!==this.bufferUsage){this._directionsDirty=!1,this._bufferUsage=this.bufferUsage,this._va=this._va&&this._va.destroy();var a=this._directions;a&&a.length>=3&&(this._colorCommand.vertexArray=this._pickCommand.vertexArray=this._createVertexArray(e))}if(void 0!==this._colorCommand.vertexArray){var s=i.passes;this._colorCommand.modelMatrix=this._pickCommand.modelMatrix=this.modelMatrix,this._commandLists.removeAll();var l=this._material!==this.material;if(this._material=this.material,s.color){var u=this._colorCommand;if(l||u.shaderProgram===void 0){var c="#line 0\n"+_+"#line 0\n"+this._material.shaderSource+"#line 0\n"+w;u.shaderProgram=e.getShaderCache().replaceShaderProgram(u.shaderProgram,y,c,x),u.uniformMap=r([this._uniforms,this._material._uniforms],!1,!1)}this._commandLists.colorList.push(u)}if(s.pick){var h=this._pickCommand;if(this._pickId===void 0&&(this._pickId=e.createPickId(this._pickIdThis)),l||h.shaderProgram===void 0){var d=v("#line 0\n"+_+"#line 0\n"+this._material.shaderSource+"#line 0\n"+w,"uniform");h.shaderProgram=e.getShaderCache().replaceShaderProgram(h.shaderProgram,y,d,x);var p=this;h.uniformMap=r([this._uniforms,this._material._uniforms,{czm_pickColor:function(){return p._pickId.color}}],!1,!1)}this._commandLists.pickList.push(h)}this._commandLists.empty()||n.push(this._commandLists)}}},T.prototype.isDestroyed=function(){return!1},T.prototype.destroy=function(){return this._colorCommand.vertexArray=this._colorCommand.vertexArray&&this._colorCommand.vertexArray.destroy(),this._colorCommand.shaderProgram=this._colorCommand.shaderProgram&&this._colorCommand.shaderProgram.release(),this._pickCommand.shaderProgram=this._pickCommand.shaderProgram&&this._pickCommand.shaderProgram.release(),this._pickId=this._pickId&&this._pickId.destroy(),n(this)},T}),i("DynamicScene/DynamicConeVisualizerUsingCustomSensor",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Spherical","../Scene/CustomSensorVolume","../Scene/Material"],function(e,t,i,r,n,o,a,s,l,u){function c(e,t,i,r){var n=t[e];n===void 0&&(t[e]=n=new s),n.clock=i,n.cone=r,n.magnitude=1}function h(e,t,i,r,o){var a,s=0,l=n.toRadians(2);if(0===e&&t===n.TWO_PI)for(a=0;n.TWO_PI>a;a+=l)c(s++,o,a,r);else{for(a=e;t>a;a+=l)c(s++,o,a,r);if(c(s++,o,t,r),i){for(a=t;a>e;a-=l)c(s++,o,a,i);c(s++,o,e,i)}else c(s++,o,t,0)}return o.length=s,o}var d=new o,m=function(e,i){if(e===void 0)throw new t("scene is required.");this._scene=e,this._unusedIndexes=[],this._primitives=e.getPrimitives(),this._coneCollection=[],this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};m.prototype.getScene=function(){return this._scene},m.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},m.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(m.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(m.prototype._onObjectsRemoved,this))},m.prototype.update=function(e){if(e===void 0)throw new t("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(e,i[r])},m.prototype.removeAllPrimitives=function(){var e,t;for(e=0,t=this._coneCollection.length;t>e;e++)this._primitives.remove(this._coneCollection[e]);if(this._dynamicObjectCollection!==void 0){var i=this._dynamicObjectCollection.getObjects();for(e=i.length-1;e>-1;e--)i[e]._coneVisualizerIndex=void 0}this._unusedIndexes=[],this._coneCollection=[]},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this.removeAllPrimitives(),i(this)};var p,f,v;return m.prototype._updateObject=function(t,i){var s=this._scene.getContext(),c=i.cone;if(void 0!==c){var m=i.position;if(void 0!==m){var g=i.orientation;if(void 0!==g){var _,y=c.show,w=i._coneVisualizerIndex,C=i.isAvailable(t)&&(y===void 0||y.getValue(t));if(!C)return w!==void 0&&(_=this._coneCollection[w],_.show=!1,i._coneVisualizerIndex=void 0,this._unusedIndexes.push(w)),void 0;if(w===void 0){var x=this._unusedIndexes,T=x.length;T>0?(w=x.pop(),_=this._coneCollection[w]):(w=this._coneCollection.length,_=new l,_._directionsScratch=[],this._coneCollection.push(_),this._primitives.add(_)),i._coneVisualizerIndex=w,_.dynamicObject=i,_.material=u.fromType(s,u.ColorType),_.intersectionColor=r.YELLOW,_.radius=Number.POSITIVE_INFINITY,_.showIntersection=!0}else _=this._coneCollection[w];_.show=!0;var S,E=c.minimumClockAngle;E!==void 0&&(S=E.getValue(t)),S===void 0&&(S=0);var b;E=c.maximumClockAngle,E!==void 0&&(b=E.getValue(t)),b===void 0&&(b=n.TWO_PI);var M;E=c.innerHalfAngle,E!==void 0&&(M=E.getValue(t)),M===void 0&&(M=0);var I;if(E=c.outerHalfAngle,E!==void 0&&(I=E.getValue(t)),I===void 0&&(I=Math.PI),(S!==_.minimumClockAngle||b!==_.maximumClockAngle||M!==_.innerHalfAngle||I!==_.outerHalfAngle)&&(_.setDirections(h(S,b,M,I,_._directionsScratch)),_.innerHalfAngle=M,_.maximumClockAngle=b,_.outerHalfAngle=I,_.minimumClockAngle=S),E=c.radius,E!==void 0){var D=E.getValue(t);D!==void 0&&(_.radius=D)}p=e(m.getValueCartesian(t,p),_._visualizerPosition),f=e(g.getValue(t,f),_._visualizerOrientation),void 0===p||void 0===f||p.equals(_._visualizerPosition)&&f.equals(_._visualizerOrientation)||(a.fromRotationTranslation(o.fromQuaternion(f,d),p,_.modelMatrix),p.clone(_._visualizerPosition),f.clone(_._visualizerOrientation));var A=c.outerMaterial;A!==void 0&&(_.material=A.getValue(t,s,_.material)),E=c.intersectionColor,E!==void 0&&(v=E.getValue(t,v),v!==void 0&&(_.intersectionColor=v))}}}},m.prototype._onObjectsRemoved=function(e,t){for(var i=this._coneCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._coneVisualizerIndex;if(a!==void 0){var s=i[a];s.show=!1,r.push(a),o._coneVisualizerIndex=void 0}}},m}),i("Scene/Label",["../Core/defaultValue","../Core/DeveloperError","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","./Billboard","./LabelStyle","./HorizontalOrigin","./VerticalOrigin"],function(e,t,i,r,n,o,a,s,l){function u(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function c(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}var h=function(t,o){t=e(t,e.EMPTY_OBJECT),this._text=e(t.text,""),this._show=e(t.show,!0),this._font=e(t.font,"30px sans-serif"),this._fillColor=n.clone(e(t.fillColor,n.WHITE)),this._outlineColor=n.clone(e(t.outlineColor,n.BLACK)),this._outlineWidth=e(t.outlineWidth,1),this._style=e(t.style,a.FILL),this._verticalOrigin=e(t.verticalOrigin,l.BOTTOM),this._horizontalOrigin=e(t.horizontalOrigin,s.LEFT),this._pixelOffset=i.clone(e(t.pixelOffset,i.ZERO)),this._eyeOffset=r.clone(e(t.eyeOffset,r.ZERO)),this._position=r.clone(e(t.position,r.ZERO)),this._scale=e(t.scale,1),this._labelCollection=o,this._glyphs=[],this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0};return h.prototype.getShow=function(){return this._show},h.prototype.setShow=function(e){if(e===void 0)throw new t("value is required.");if(e!==this._show){this._show=e;for(var i=this._glyphs,r=0,n=i.length;n>r;r++){var o=i[r];o.billboard!==void 0&&o.billboard.setShow(e)}}},h.prototype.getPosition=function(){return this._position},h.prototype.setPosition=function(e){if(e===void 0)throw new t("value is required.");var i=this._position;if(!r.equals(i,e)){r.clone(e,i);for(var n=this._glyphs,o=0,a=n.length;a>o;o++){var s=n[o];s.billboard!==void 0&&s.billboard.setPosition(e)}}},h.prototype.getText=function(){return this._text},h.prototype.setText=function(e){if(e===void 0)throw new t("value is required.");e!==this._text&&(this._text=e,u(this))},h.prototype.getFont=function(){return this._font},h.prototype.setFont=function(e){if(e===void 0)throw new t("value is required.");this._font!==e&&(this._font=e,u(this))},h.prototype.getFillColor=function(){return this._fillColor},h.prototype.setFillColor=function(e){if(e===void 0)throw new t("value is required.");var i=this._fillColor;n.equals(i,e)||(n.clone(e,i),u(this))},h.prototype.getOutlineColor=function(){return this._outlineColor},h.prototype.setOutlineColor=function(e){if(e===void 0)throw new t("value is required.");var i=this._outlineColor;n.equals(i,e)||(n.clone(e,i),u(this))},h.prototype.getOutlineWidth=function(){return this._outlineWidth},h.prototype.setOutlineWidth=function(e){if(e===void 0)throw new t("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,u(this))},h.prototype.getStyle=function(){return this._style},h.prototype.setStyle=function(e){if(e===void 0)throw new t("value is required.");this._style!==e&&(this._style=e,u(this))},h.prototype.getPixelOffset=function(){return this._pixelOffset},h.prototype.setPixelOffset=function(e){if(e===void 0)throw new t("value is required.");var r=this._pixelOffset;i.equals(r,e)||(i.clone(e,r),c(this))},h.prototype.getEyeOffset=function(){return this._eyeOffset},h.prototype.setEyeOffset=function(e){if(e===void 0)throw new t("value is required.");var i=this._eyeOffset;if(!r.equals(i,e)){r.clone(e,i);for(var n=this._glyphs,o=0,a=n.length;a>o;o++){var s=n[o];s.billboard!==void 0&&s.billboard.setEyeOffset(e)}}},h.prototype.getHorizontalOrigin=function(){return this._horizontalOrigin},h.prototype.setHorizontalOrigin=function(e){if(e===void 0)throw new t("value is required.");this._horizontalOrigin!==e&&(this._horizontalOrigin=e,c(this))},h.prototype.getVerticalOrigin=function(){return this._verticalOrigin},h.prototype.setVerticalOrigin=function(e){if(e===void 0)throw new t("value is required.");this._verticalOrigin!==e&&(this._verticalOrigin=e,c(this))},h.prototype.getScale=function(){return this._scale},h.prototype.setScale=function(e){if(e===void 0)throw new t("value is required.");if(this._scale!==e){this._scale=e;for(var i=this._glyphs,r=0,n=i.length;n>r;r++){var o=i[r];o.billboard!==void 0&&o.billboard.setScale(e)}c(this)}},h.prototype.computeScreenSpacePosition=function(e,i){if(e===void 0)throw new t("context is required.");if(i===void 0)throw new t("frameState is required.");var r=this._labelCollection,n=r.modelMatrix,a=o._computeActualPosition(this._position,i,r.morphTime,n);return o._computeScreenSpacePosition(n,a,this._eyeOffset,this._pixelOffset,e,i)},h.prototype.equals=function(e){return this===e||e!==void 0&&this._show===e._show&&this._scale===e._scale&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._text===e._text&&this._font===e._font&&r.equals(this._position,e._position)&&n.equals(this._fillColor,e._fillColor)&&n.equals(this._outlineColor,e._outlineColor)&&i.equals(this._pixelOffset,e._pixelOffset)&&r.equals(this._eyeOffset,e._eyeOffset)},h.prototype.isDestroyed=function(){return!1},h}),i("Scene/LabelCollection",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/Matrix4","../Core/writeTextToCanvas","../Renderer/BufferUsage","./BillboardCollection","./Label","./LabelStyle","./HorizontalOrigin","./VerticalOrigin"],function(e,t,i,r,n,o,a,s,l,u,c){function h(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function d(e,t,i){this.labelCollection=e,this.index=t,this.dimensions=i,this.referenceCount=1,++e._textureCount}function m(e,t,i,r,o,a,s){return _.font=t,_.fillColor=i,_.strokeColor=r,_.strokeWidth=o,_.textBaseline=s===c.BOTTOM?"bottom":s===c.TOP?"top":"middle",_.fill=a===l.FILL||a===l.FILL_AND_OUTLINE,_.stroke=a===l.OUTLINE||a===l.FILL_AND_OUTLINE,n(e,_)}function p(e,t){t.textureInfo!==void 0&&t.textureInfo.releaseReference(),t.textureInfo=void 0,t.dimensions=void 0;var i=t.billboard;i!==void 0&&(i.setShow(!1),i.setImageIndex(-1),e._spareBillboards.push(i),t.billboard=void 0)}function f(e,t){var i,r,n,o=t._text,a=o.length,s=t._glyphs,l=s.length;if(l>a)for(r=a;l>r;++r)p(e,s[r]);s.length=a;var c=e._glyphTextureCache,f=e._textureAtlas;for(n=0;a>n;++n){var v=o.charAt(n),g=t._font,_=t._fillColor,y=t._outlineColor,w=t._outlineWidth,C=t._style,x=t._verticalOrigin,T=JSON.stringify([v,g,""+_,""+y,w,""+C,""+x]),S=c[T];if(S===void 0){var E=m(v,g,_,y,w,C,x),b=-1;E.width>0&&E.height>0&&(b=f.addImage(E)),S=new d(e,b,E.dimensions),c[T]=S}else S.addReference();if(i=s[n],i!==void 0?-1===S.index?p(e,i):i.textureInfo!==void 0&&(i.textureInfo.releaseReference(),i.textureInfo=void 0):(i=new h,s[n]=i),i.textureInfo=S,i.dimensions=S.dimensions,-1!==S.index){var M=i.billboard;M===void 0&&(i.billboard=M=e._spareBillboards.length>0?e._spareBillboards.pop():e._billboardCollection.add(),M.setShow(t._show),M.setPosition(t._position),M.setEyeOffset(t._eyeOffset),M.setHorizontalOrigin(u.LEFT),M.setVerticalOrigin(t._verticalOrigin),M.setScale(t._scale),M._pickIdThis=t),i.billboard.setImageIndex(S.index)}}t._repositionAllGlyphs=!0}function v(e){var t,i,r=e._glyphs,n=0,o=0,a=0,s=r.length;for(a=0;s>a;++a)t=r[a],i=t.dimensions,n+=i.width,o=Math.max(o,i.height);var l=e._scale,h=e._horizontalOrigin,d=0;h===u.CENTER?d-=n/2*l:h===u.RIGHT&&(d-=n*l);var m=e._pixelOffset;y.x=m.x+d,y.y=0;var p=e._verticalOrigin;for(a=0;s>a;++a)t=r[a],i=t.dimensions,p===c.BOTTOM||i.height===o?y.y=m.y-i.descent*l:p===c.TOP?y.y=m.y-(o-i.height)*l-i.descent*l:p===c.CENTER&&(y.y=m.y-(o-i.height)/2*l-i.descent*l),t.billboard!==void 0&&t.billboard.setPixelOffset(y),y.x+=i.width*l}function g(e,i){for(var r=i._glyphs,n=0,o=r.length;o>n;++n)p(e,r[n]);i._labelCollection=void 0,t(i)}d.prototype.addReference=function(){0===this.referenceCount&&--this.labelCollection._unusedTextureCount,++this.referenceCount},d.prototype.releaseReference=function(){--this.referenceCount,0===this.referenceCount&&++this.labelCollection._unusedTextureCount};var _={},y=new i,w=function(){this._textureAtlas=void 0,this._billboardCollection=new a,this._billboardCollection.setDestroyTextureAtlas(!1),this._spareBillboards=[],this._glyphTextureCache={},this._textureCount=0,this._unusedTextureCount=0,this._labels=[],this._labelsToUpdate=[],this._frameCount=0,this._totalGlyphCount=0,this.modelMatrix=r.IDENTITY.clone(),this.morphTime=1};return w.prototype.add=function(e){var t=new s(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t},w.prototype.remove=function(e){if(e!==void 0&&e._labelCollection===this){var t=this._labels.indexOf(e);if(-1!==t)return this._labels.splice(t,1),g(this,e),!0}return!1},w.prototype.removeAll=function(){for(var e=this._labels,t=0,i=e.length;i>t;++t)g(this,e[t]);e.length=0},w.prototype.contains=function(e){return e!==void 0&&e._labelCollection===this},w.prototype.get=function(t){if(t===void 0)throw new e("index is required.");return this._labels[t]},w.prototype.getLength=function(){return this._labels.length},w.prototype.update=function(e,t,i){var r=this._billboardCollection;r.modelMatrix=this.modelMatrix,r.morphTime=this.morphTime;var n=!1;if(0===++this._frameCount%100)for(this._frameCount=0,this._unusedTextureCount>.25*this._textureCount&&(this._textureAtlas=this._textureAtlas.destroy(),this._glyphTextureCache={},this._textureCount=0,this._unusedTextureCount=0,n=!0,this._labelsToUpdate=this._labels.slice(0));this._spareBillboards.length>.1*this._totalGlyphCount;)r.remove(this._spareBillboards.pop());this._textureAtlas===void 0&&(this._textureAtlas=e.createTextureAtlas(),r.setTextureAtlas(this._textureAtlas));for(var o=this._labelsToUpdate,a=0,s=o.length;s>a;++a){var l=o[a];if(!l.isDestroyed()){var u=l._glyphs.length;(n||l._rebindAllGlyphs)&&(f(this,l),l._rebindAllGlyphs=!1),l._repositionAllGlyphs&&(v(l),l._repositionAllGlyphs=!1);var c=l._glyphs.length-u;this._totalGlyphCount+=c}}o.length=0,this._billboardCollection.update(e,t,i)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return this.removeAll(),this._billboardCollection.destroy(),t(this)},w}),i("DynamicScene/DynamicLabelVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Cartesian2","../Core/Cartesian3","../Scene/LabelCollection","../Scene/LabelStyle","../Scene/HorizontalOrigin","../Scene/VerticalOrigin"],function(e,t,i,r,n,o,a,s,l){var u=function(t,i){if(t===void 0)throw new e("scene is required.");this._scene=t,this._unusedIndexes=[],this._dynamicObjectCollection=void 0;var r=this._labelCollection=new o;t.getPrimitives().add(r),this.setDynamicObjectCollection(i)};u.prototype.getScene=function(){return this._scene},u.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},u.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(u.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(u.prototype._onObjectsRemoved,this))},u.prototype.update=function(t){if(t===void 0)throw new e("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(t,i[r])},u.prototype.removeAllPrimitives=function(){if(this._unusedIndexes=[],this._labelCollection.removeAll(),this._dynamicObjectCollection!==void 0)for(var e=this._dynamicObjectCollection.getObjects(),t=e.length-1;t>-1;t--)e[t]._labelVisualizerIndex=void 0},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._labelCollection),t(this)};var c,h,d,m,p;return u.prototype._updateObject=function(e,t){var o=t.label;if(void 0!==o){var u=o.text;if(void 0!==u){var f=t.position;if(void 0!==f){var v,g=o.show,_=t._labelVisualizerIndex,y=t.isAvailable(e)&&(g===void 0||g.getValue(e));if(!y)return _!==void 0&&(v=this._labelCollection.get(_),v.setShow(!1),this._unusedIndexes.push(_),t._labelVisualizerIndex=void 0),void 0;if(_===void 0){var w=this._unusedIndexes,C=w.length;C>0?(_=w.pop(),v=this._labelCollection.get(_)):(_=this._labelCollection.getLength(),v=this._labelCollection.add()),t._labelVisualizerIndex=_,v.dynamicObject=t,v.setText(""),v.setScale(1),v.setFont("30px sans-serif"),v.setFillColor(i.WHITE),v.setOutlineColor(i.BLACK),v.setOutlineWidth(1),v.setStyle(a.FILL),v.setPixelOffset(r.ZERO),v.setEyeOffset(n.ZERO),v.setHorizontalOrigin(s.CENTER),v.setVerticalOrigin(l.CENTER)}else v=this._labelCollection.get(_);v.setShow(y);var x=u.getValue(e);x!==void 0&&v.setText(x),c=f.getValueCartesian(e,c),c!==void 0&&v.setPosition(c);var T=o.scale;if(T!==void 0){var S=T.getValue(e);S!==void 0&&v.setScale(S)}if(T=o.font,T!==void 0){var E=T.getValue(e);E!==void 0&&v.setFont(E)}if(T=o.fillColor,T!==void 0&&(h=T.getValue(e,h),h!==void 0&&v.setFillColor(h)),T=o.outlineColor,T!==void 0&&(d=T.getValue(e,d),d!==void 0&&v.setOutlineColor(d)),T=o.outlineWidth,T!==void 0){var b=T.getValue(e);b!==void 0&&v.setOutlineWidth(b)}if(T=o.style,T!==void 0){var M=T.getValue(e);M!==void 0&&v.setStyle(M)}if(T=o.pixelOffset,T!==void 0&&(p=T.getValue(e,p),p!==void 0&&v.setPixelOffset(p)),T=o.eyeOffset,T!==void 0&&(m=T.getValue(e,m),m!==void 0&&v.setEyeOffset(m)),T=o.horizontalOrigin,T!==void 0){var I=T.getValue(e);I!==void 0&&v.setHorizontalOrigin(I)}if(T=o.verticalOrigin,T!==void 0){var D=T.getValue(e);D!==void 0&&v.setVerticalOrigin(D)}}}}},u.prototype._onObjectsRemoved=function(e,t){for(var i=this._labelCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._labelVisualizerIndex;if(a!==void 0){var s=i.get(a);s.setShow(!1),r.push(a),o._labelVisualizerIndex=void 0}}},u}),i("Scene/Polyline",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/BoundingSphere","../Core/Cartesian3","../Core/Color","../Core/PolylinePipeline","../Core/Matrix4","./Material"],function(e,t,i,r,n,o,a,s,l){function u(e,t){++e._propertiesChanged[t];var i=e._polylineCollection;i!==void 0&&(i._updatePolyline(e,t),e._dirty=!0)}var c={},h=function(t,i){t=e(t,c),this._show=e(t.show,!0),this._width=e(t.width,1),this._material=t.material,this._material===void 0&&(this._material=l.fromType(void 0,l.ColorType),this._material.uniforms.color=new o(1,1,1,1));var n=t.positions;n===void 0&&(n=[]),this._positions=n;var u;this._polylineCollection!==void 0&&(u=s.clone(this._polylineCollection.modelMatrix)),this._modelMatrix=u,this._segments=a.wrapLongitude(n,u),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(g),this._polylineCollection=i,this._dirty=!1,this._pickId=void 0,this._pickIdThis=t._pickIdThis,this._boundingVolume=r.fromPoints(this._positions),this._boundingVolume2D=new r},d=h.SHOW_INDEX=0,m=h.WIDTH_INDEX=1,p=h.POSITION_INDEX=2,f=h.MATERIAL_INDEX=3,v=h.POSITION_SIZE_INDEX=4,g=h.NUMBER_OF_PROPERTIES=5;return h.prototype.getShow=function(){return this._show},h.prototype.setShow=function(e){if(e===void 0)throw new t("value is required.");e!==this._show&&(this._show=e,u(this,d))},h.prototype.getPositions=function(){return this._positions},h.prototype.setPositions=function(e){if(e===void 0)throw new t("value is required.");this._positions.length!==e.length&&u(this,v),this._positions=e,this._boundingVolume=r.fromPoints(this._positions,this._boundingVolume),u(this,p),this.update()},h.prototype.update=function(){var e=s.IDENTITY;this._polylineCollection!==void 0&&(e=this._polylineCollection.modelMatrix);var t=this._segments.positions.length,i=this._segments.lengths,r=this._propertiesChanged[p]>0||this._propertiesChanged[v]>0;if((!e.equals(this._modelMatrix)||r)&&(this._segments=a.wrapLongitude(this._positions,e)),this._modelMatrix=e,this._segments.positions.length!==t)u(this,v);else for(var n=i.length,o=0;n>o;++o)if(i[o]!==this._segments.lengths[o]){u(this,v);break}},h.prototype.getMaterial=function(){return this._material},h.prototype.setMaterial=function(e){if(e===void 0)throw new t("material is required.");this._material=e,u(this,f)},h.prototype.getWidth=function(){return this._width},h.prototype.setWidth=function(e){if(e===void 0)throw new t("value is required.");var i=this._width;e!==i&&(this._width=e,u(this,m))},h.prototype.getPickId=function(t){return this._pickId===void 0&&(this._pickId=t.createPickId(e(this._pickIdThis,this))),this._pickId},h.prototype._clean=function(){this._dirty=!1;
for(var e=this._propertiesChanged,t=0;g-1>t;++t)e[t]=0},h.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0},h}),i("Shaders/PolylineVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandWidthAndShow;\nattribute vec4 pickColor;\nvarying vec2  v_textureCoordinates;\nvarying float v_width;\nvarying vec4  czm_pickColor;\nuniform float u_morphTime;\nconst vec2 czm_highResolutionSnapScale = vec2(1.0, 1.0);\nvoid clipLineSegmentToNearPlane(\nvec3 p0,\nvec3 p1,\nout vec4 positionWC,\nout bool culledByNearPlane)\n{\nculledByNearPlane = false;\nvec3 p1ToP0 = p1 - p0;\nfloat magnitude = length(p1ToP0);\nvec3 direction = normalize(p1ToP0);\nfloat endPoint0Distance =  -(czm_currentFrustum.x + p0.z);\nfloat denominator = -direction.z;\nif (endPoint0Distance < 0.0 && abs(denominator) < czm_epsilon7)\n{\nculledByNearPlane = true;\n}\nelse if (endPoint0Distance < 0.0 && abs(denominator) > czm_epsilon7)\n{\nfloat t = (czm_currentFrustum.x + p0.z) / denominator;\nif (t < 0.0 || t > magnitude)\n{\nculledByNearPlane = true;\n}\nelse\n{\np0 = p0 + t * direction;\n}\n}\npositionWC = czm_eyeToWindowCoordinates(vec4(p0, 1.0));\n}\nvoid main()\n{\nfloat texCoord = texCoordExpandWidthAndShow.x;\nfloat expandDir = texCoordExpandWidthAndShow.y;\nfloat width = abs(texCoordExpandWidthAndShow.z) + 0.5;\nbool usePrev = texCoordExpandWidthAndShow.z < 0.0;\nfloat show = texCoordExpandWidthAndShow.w;\nvec4 p, prev, next;\nif (u_morphTime == 1.0)\n{\np = vec4(czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz), 1.0);\nprev = vec4(czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz), 1.0);\nnext = vec4(czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz), 1.0);\n}\nelse if (u_morphTime == 0.0)\n{\np = vec4(czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy), 1.0);\nprev = vec4(czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy), 1.0);\nnext = vec4(czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy), 1.0);\n}\nelse\n{\np = czm_columbusViewMorph(\nczm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\nczm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\nu_morphTime);\nprev = czm_columbusViewMorph(\nczm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\nczm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\nu_morphTime);\nnext = czm_columbusViewMorph(\nczm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\nczm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\nu_morphTime);\n}\nvec4 endPointWC, p0, p1;\nbool culledByNearPlane;\nvec4 positionEC = czm_modelViewRelativeToEye * p;\nvec4 prevEC = czm_modelViewRelativeToEye * prev;\nvec4 nextEC = czm_modelViewRelativeToEye * next;\nclipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, p0, culledByNearPlane);\nclipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, p1, culledByNearPlane);\nclipLineSegmentToNearPlane(positionEC.xyz, usePrev ? prevEC.xyz : nextEC.xyz, endPointWC, culledByNearPlane);\nif (culledByNearPlane)\n{\ngl_Position = czm_projection * vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec2 prevWC = normalize(p0.xy - endPointWC.xy);\nvec2 nextWC = normalize(p1.xy - endPointWC.xy);\nfloat expandWidth = width * 0.5;\nvec2 direction;\nif (czm_equalsEpsilon(normalize(prev.xyz - p.xyz), vec3(0.0), czm_epsilon1) || czm_equalsEpsilon(prevWC, -nextWC, czm_epsilon1))\n{\ndirection = vec2(-nextWC.y, nextWC.x);\n}\nelse if (czm_equalsEpsilon(normalize(next.xyz - p.xyz), vec3(0.0), czm_epsilon1))\n{\ndirection = vec2(prevWC.y, -prevWC.x);\n}\nelse\n{\nvec2 normal = vec2(-nextWC.y, nextWC.x);\ndirection = normalize((nextWC + prevWC) * 0.5);\nif (dot(direction, normal) < 0.0)\n{\ndirection = -direction;\n}\nfloat sinAngle = abs(direction.x * nextWC.y - direction.y * nextWC.x);\nexpandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n}\nvec2 offset = direction * expandDir * expandWidth * czm_highResolutionSnapScale;\nvec4 positionWC = vec4(endPointWC.xy + offset, -endPointWC.z, 1.0);\ngl_Position = czm_viewportOrthographic * positionWC * show;\nv_textureCoordinates = vec2(texCoord, clamp(expandDir, 0.0, 1.0));\nv_width = width;\nczm_pickColor = pickColor;\n}\n"}),i("Shaders/PolylineFS",[],function(){return"varying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s = v_textureCoordinates.s;\nmaterialInput.st = v_textureCoordinates;\nmaterialInput.str = vec3(v_textureCoordinates, 0.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n}\n"}),i("Scene/PolylineCollection",["../Core/DeveloperError","../Core/Color","../Core/combine","../Core/destroyObject","../Core/Cartesian3","../Core/Cartesian4","../Core/EncodedCartesian3","../Core/Matrix4","../Core/ComponentDatatype","../Core/IndexDatatype","../Core/PrimitiveType","../Core/BoundingSphere","../Core/Intersect","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/DrawCommand","../Renderer/createPickFragmentShaderSource","./Material","./SceneMode","./Polyline","../Shaders/PolylineVS","../Shaders/PolylineFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x){function T(e,t,r,n,o,a,s){for(var l=n.length,u=e.length,h=0,d=0;l>d;++d)for(var m=n[d],p=m.buckets,f=p.length,g=0;f>g;++g){for(var _,y,w,C=p[g],x=C.offset,T=s?C.bucket.shaderProgram:C.bucket.pickShaderProgram,S=C.bucket.polylines,E=S.length,M=0,I=0;E>I;++I){var D=S[I],A=b(D._material);A!==_&&(_!==void 0&&(h>=u?(w=new v,e.push(w)):w=e[h],++h,w.boundingVolume=t,w.modelMatrix=r,w.primitiveType=c.TRIANGLES,w.shaderProgram=T,w.vertexArray=m.va,w.renderState=o,w.uniformMap=i([a,y._uniforms],!1,!1),w.count=M,w.offset=x,x+=M,M=0),y=D._material,_=A);for(var P=D._locatorBuckets,R=P.length,O=0;R>O;++O){var z=P[O];z.locator===C&&(M+=z.count)}}_!==void 0&&M>0&&(h>=u?(w=new v,e.push(w)):w=e[h],++h,w.boundingVolume=t,w.modelMatrix=r,w.primitiveType=c.TRIANGLES,w.shaderProgram=T,w.vertexArray=m.va,w.renderState=o,w.uniformMap=i([a,y._uniforms],!1,!1),w.count=M,w.offset=x),_=void 0}e.length=h}function S(e){for(var t=e._buffersUsage,i=!1,r=e._propertiesChanged,n=0;q-2>n;++n){var o=t[n];r[n]?o.bufferUsage!==p.STREAM_DRAW?(i=!0,o.bufferUsage=p.STREAM_DRAW,o.frameCount=100):o.frameCount=100:o.bufferUsage!==p.STATIC_DRAW&&(0===o.frameCount?(i=!0,o.bufferUsage=p.STATIC_DRAW):o.frameCount--)}return i}function E(e,t){e._createVertexArray=!1,A(e),P(e),M(e);var i,r,n=[[]],o=n[0],a=[0],s=0,c=[[]],h=0,d=e._polylineBuckets;for(i in d)d.hasOwnProperty(i)&&(r=d[i],r.updateShader(t),h+=r.lengthOfPositions);if(h>0){var m,f=e._mode,v=new Float32Array(3*6*h),g=new Uint8Array(4*h),_=new Float32Array(4*h),w=0,C=0,x=0;for(i in d)if(d.hasOwnProperty(i)){r=d[i],r.write(v,g,_,w,C,x,t),f===y.MORPHING&&(m===void 0&&(m=new Float32Array(3*6*h)),r.writeForMorph(m,w));var T=r.lengthOfPositions;w+=3*6*T,C+=4*T,x+=4*T,s=r.updateIndices(n,a,c,s)}var S=e._buffersUsage[V].bufferUsage,E=e._buffersUsage[L].bufferUsage,b=e._buffersUsage[N].bufferUsage,I=E===p.STREAM_DRAW||b===p.STREAM_DRAW?p.STREAM_DRAW:p.STATIC_DRAW;e._positionBuffer=t.createVertexBuffer(v,S);var D;m!==void 0&&(D=t.createVertexBuffer(m,S)),e._pickColorBuffer=t.createVertexBuffer(g,p.STATIC_DRAW),e._texCoordExpandWidthAndShowBuffer=t.createVertexBuffer(_,I);for(var R=4*Uint8Array.BYTES_PER_ELEMENT,O=3*Float32Array.BYTES_PER_ELEMENT,z=4*Float32Array.BYTES_PER_ELEMENT,B=0,F=n.length,q=0;F>q;++q)if(o=n[q],o.length>0){var W=new Uint16Array(o),H=t.createIndexBuffer(W,p.STATIC_DRAW,u.UNSIGNED_SHORT);B+=a[q];var j,Y,X,Z,K=6*(q*O*U-B*O),J=O+K,Q=O+J,$=O+Q,et=O+$,tt=O+et,it=q*R*U-B*R,rt=q*z*U-B*z,nt=[{index:k.position3DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:K,strideInBytes:6*O},{index:k.position3DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:J,strideInBytes:6*O},{index:k.position2DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:K,strideInBytes:6*O},{index:k.position2DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:J,strideInBytes:6*O},{index:k.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:Q,strideInBytes:6*O},{index:k.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:$,strideInBytes:6*O},{index:k.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:Q,strideInBytes:6*O},{index:k.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:$,strideInBytes:6*O},{index:k.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:et,strideInBytes:6*O},{index:k.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:tt,strideInBytes:6*O},{index:k.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:et,strideInBytes:6*O},{index:k.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:l.FLOAT,offsetInBytes:tt,strideInBytes:6*O},{index:k.texCoordExpandWidthAndShow,componentsPerAttribute:4,componentDatatype:l.FLOAT,vertexBuffer:e._texCoordExpandWidthAndShowBuffer,offsetInBytes:rt},{index:k.pickColor,componentsPerAttribute:4,componentDatatype:l.UNSIGNED_BYTE,vertexBuffer:e._pickColorBuffer,offsetInBytes:it,normalize:!0}];f===y.SCENE3D?(j=e._positionBuffer,Y="vertexBuffer",X=G,Z="value"):f===y.SCENE2D||f===y.COLUMBUS_VIEW?(j=G,Y="value",X=e._positionBuffer,Z="vertexBuffer"):(j=D,Y="vertexBuffer",X=e._positionBuffer,Z="vertexBuffer"),nt[0][Y]=j,nt[1][Y]=j,nt[2][Z]=X,nt[3][Z]=X,nt[4][Y]=j,nt[5][Y]=j,nt[6][Z]=X,nt[7][Z]=X,nt[8][Y]=j,nt[9][Y]=j,nt[10][Z]=X,nt[11][Z]=X;var ot=t.createVertexArray(nt,H);e._vertexArrays.push({va:ot,buckets:c[q]})}}}function b(e){var t=_._uniformList[e.type],i=t.length;Y.length=2*i;for(var r=0,n=0;i>n;++n){var o=t[n];Y[r]=o,Y[r+1]=e._uniforms[o](),r+=2}return e.type+":"+JSON.stringify(Y)}function M(e){for(var t=e._mode,i=e._projection,r=e._modelMatrix,n=e._polylineBuckets={},o=e._polylines,a=o.length,s=0;a>s;++s){var l=o[s];if(l.getPositions().length>1){l.update();var u=l.getMaterial(),c=n[u.type];c===void 0&&(c=n[u.type]=new X(u,t,i,r)),c.addPolyline(l)}}}function I(e,t){var i=t.mode,r=t.scene2D.projection;e._mode!==i&&i.morphTime!==void 0&&(e.morphTime=i.morphTime),e._mode===i&&e._projection===r&&e._modelMatrix.equals(e.modelMatrix)||(e._mode=i,e._projection=r,e._modelMatrix=e.modelMatrix.clone(),e._createVertexArray=!0)}function D(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;for(var t=[],i=e._polylines.length,r=0,n=0;i>r;++r){var o=e._polylines[r];o&&(o._index=n++,t.push(o))}e._polylines=t}}function A(e){for(var t=e._polylines,i=t.length,r=0;i>r;++r){var n=t[r]._bucket;n!==void 0&&(n.shaderProgram=n.shaderProgram&&n.shaderProgram.release())}}function P(e){for(var t=e._vertexArrays.length,i=0;t>i;++i)e._vertexArrays[i].va.destroy();e._vertexArrays.length=0}function R(e){for(var t=e._polylines,i=t.length,r=0;i>r;++r)t[r]&&t[r]._destroy()}function O(e,t,i){this.count=e,this.offset=t,this.bucket=i}function z(e){return 0>n.dot(n.UNIT_X,e._boundingVolume.center)||e._boundingVolume.intersect(o.UNIT_Y)===d.INTERSECTING}var L=w.SHOW_INDEX,N=w.WIDTH_INDEX,V=w.POSITION_INDEX,B=w.MATERIAL_INDEX,F=w.POSITION_SIZE_INDEX,q=w.NUMBER_OF_PROPERTIES,U=65536,k={position3DHigh:0,position3DLow:1,position2DHigh:2,position2DLow:3,prevPosition3DHigh:4,prevPosition3DLow:5,prevPosition2DHigh:6,prevPosition2DLow:7,nextPosition3DHigh:8,nextPosition3DLow:9,nextPosition2DHigh:10,nextPosition2DLow:11,texCoordExpandWidthAndShow:12,pickColor:13},W=function(){this.morphTime=1,this.modelMatrix=s.IDENTITY.clone(),this._modelMatrix=s.IDENTITY.clone(),this._rs=void 0,this._boundingVolume=void 0,this._boundingVolume2D=void 0,this._commandLists=new f,this._colorCommands=[],this._pickCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(q),this._polylines=[],this._polylineBuckets={},this._buffersUsage=[{bufferUsage:p.STATIC_DRAW,frameCount:0},{bufferUsage:p.STATIC_DRAW,frameCount:0},{bufferUsage:p.STATIC_DRAW,frameCount:0}],this._mode=void 0;var e=this;this._uniforms={u_morphTime:function(){return e.morphTime}},this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._pickColorBuffer=void 0,this._texCoordExpandWidthAndShowBuffer=void 0};W.prototype.add=function(e){var t=new w(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,t},W.prototype.remove=function(e){if(this.contains(e)){if(this._polylines[e._index]=null,this._polylinesRemoved=!0,this._createVertexArray=!0,e._bucket!==void 0){var t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.release(),t.pickShaderProgram=t.pickShaderProgram&&t.pickShaderProgram.release()}return e._destroy(),!0}return!1},W.prototype.removeAll=function(){A(this),R(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},W.prototype.contains=function(e){return e!==void 0&&e._polylineCollection===this},W.prototype.get=function(t){if(t===void 0)throw new e("index is required.");return D(this),this._polylines[t]},W.prototype.getLength=function(){return D(this),this._polylines.length};var H=[],j=new h;W.prototype.update=function(e,t,i){if(D(this),0!==this._polylines.length){I(this,t);var r,n=this._propertiesChanged;if(this._createVertexArray||S(this))E(this,e);else if(this._polylinesUpdated){var o=this._polylinesToUpdate;if(this._mode!==y.SCENE3D)for(var a=o.length,l=0;a>l;++l)r=o[l],r.update();if(n[F]||n[B])E(this,e);else for(var u=o.length,c=this._polylineBuckets,d=0;u>d;++d){r=o[d],n=r._propertiesChanged;var p=r._bucket,f=0;for(var v in c)if(c.hasOwnProperty(v)){if(c[v]===p){(n[V]||n[L]||n[N])&&p.writeUpdate(f,r,this._positionBuffer,this._texCoordExpandWidthAndShowBuffer);break}f+=c[v].lengthOfPositions}r._clean()}o.length=0,this._polylinesUpdated=!1}for(var g=0;q>g;++g)n[g]=0;var _,w=s.IDENTITY;t.mode===y.SCENE3D?(_=this._boundingVolume,w=this.modelMatrix):t.mode===y.COLUMBUS_VIEW?_=this._boundingVolume2D:t.mode===y.SCENE2D?(_=h.clone(this._boundingVolume2D,j),_.center.x=0):this._boundingVolume!==void 0&&this._boundingVolume2D!==void 0&&(_=h.union(this._boundingVolume,this._boundingVolume2D,j));var C=t.passes,x=0!==this.morphTime,b=this._commandLists;if(b.colorList=H,b.pickList=H,(this._rs===void 0||this._rs.depthTest.enabled!==x)&&(this._rs=e.createRenderState({blending:m.ALPHA_BLEND,depthMask:!x,depthTest:{enabled:x}})),C.color){var M=this._colorCommands;b.colorList=M,T(M,_,w,this._vertexArrays,this._rs,this._uniforms,!0)}if(C.pick){var A=this._pickCommands;b.pickList=A,T(A,_,w,this._vertexArrays,this._rs,this._uniforms,!1)}this._commandLists.empty()||i.push(this._commandLists)}},W.prototype.isDestroyed=function(){return!1},W.prototype.destroy=function(){return P(this),A(this),R(this),r(this)};var G=[0,0,0],Y=[];W.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,this._polylinesToUpdate.push(e),++this._propertiesChanged[t]};var X=function(e,t,i,r){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.pickShaderProgram=void 0,this.mode=t,this.projection=i,this.ellipsoid=i.getEllipsoid(),this.modelMatrix=r};X.prototype.addPolyline=function(e){var t=this.polylines;t.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},X.prototype.updateShader=function(e){if(void 0===this.shaderProgram){var t="#line 0\n"+this.material.shaderSource+"#line 0\n"+x;this.shaderProgram=e.getShaderCache().getShaderProgram(C,t,k),this.pickShaderProgram=e.getShaderCache().getShaderProgram(C,g(t,"varying"),k)}},X.prototype.getPolylinePositionsLength=function(e){var t;if(this.mode===y.SCENE3D||!z(e))return t=e.getPositions().length,4*t-4;var i=0,r=e._segments.lengths;t=r.length;for(var n=0;t>n;++n)i+=4*r[n]-4;return i};var Z=new n,K=new n,J=new n,Q=new n;X.prototype.write=function(e,i,r,o,s,l,u){for(var c=this.mode,h=this.polylines,d=h.length,m=0;d>m;++m)for(var p,f=h[m],v=f.getWidth(),g=f.getShow()&&v>0,_=this.getSegments(f),w=_.positions,C=_.lengths,x=w.length,T=f.getPickId(u).color,S=0,E=0,b=0;x>b;++b){0===b?(p=Q,n.subtract(w[0],w[1],p),n.add(w[0],p,p)):p=w[b-1],K.x=p.x,K.y=p.y,K.z=c!==y.SCENE2D?p.z:0,p=w[b],Z.x=p.x,Z.y=p.y,Z.z=c!==y.SCENE2D?p.z:0,b===x-1?(p=Q,n.subtract(w[x-1],w[x-2],p),n.add(w[x-1],p,p)):p=w[b+1],J.x=p.x,J.y=p.y,J.z=c!==y.SCENE2D?p.z:0;var M=C[S];b===E+M&&(E+=M,++S);for(var I=0===b-E,D=b===E+C[S]-1,A=I?2:0,P=D?2:4,R=A;P>R;++R){a.writeElements(Z,e,o),a.writeElements(K,e,o+6),a.writeElements(J,e,o+12),i[s]=t.floatToByte(T.red),i[s+1]=t.floatToByte(T.green),i[s+2]=t.floatToByte(T.blue),i[s+3]=t.floatToByte(T.alpha);var O=0>R-2?-1:1;r[l]=b/(x-1),r[l+1]=2*(R%2)-1,r[l+2]=O*v,r[l+3]=g,o+=18,s+=4,l+=4}}};var $=new n,et=new n,tt=new n,it=new n;X.prototype.writeForMorph=function(e,t){for(var i=this.modelMatrix,r=this.polylines,o=r.length,l=0;o>l;++l)for(var u=r[l],c=u._segments.positions,h=u._segments.lengths,d=c.length,m=0,p=0,f=0;d>f;++f){var v;0===f?(v=it,n.subtract(c[0],c[1],v),n.add(c[0],v,v)):v=c[f-1],v=s.multiplyByPoint(i,v,et);var g,_=s.multiplyByPoint(i,c[f],$);f===d-1?(g=it,n.subtract(c[d-1],c[d-2],g),n.add(c[d-1],g,g)):g=c[f+1],g=s.multiplyByPoint(i,g,tt);var y=h[m];f===p+y&&(p+=y,++m);for(var w=0===f-p,C=f===p+h[m]-1,x=w?2:0,T=C?2:4,S=x;T>S;++S)a.writeElements(_,e,t),a.writeElements(v,e,t+6),a.writeElements(g,e,t+12),t+=18}};var rt=Array(1);X.prototype.updateIndices=function(e,t,i,r){var n=i.length-1,o=new O(0,r,this);i[n].push(o);var a=0,s=e[e.length-1],l=0;s.length>0&&(l=s[s.length-1]+1);for(var u=this.polylines,c=u.length,h=0;c>h;++h){var d=u[h];d._locatorBuckets=[];var m;if(this.mode===y.SCENE3D){m=rt;var p=d.getPositions().length;if(!(p>0))continue;m[0]=p}else m=d._segments.lengths;var f=m.length;if(f>0){for(var v=0,g=0;f>g;++g)for(var _=m[g]-1,w=0;_>w;++w)l+4>=U-1&&(d._locatorBuckets.push({locator:o,count:v}),v=0,t.push(4),s=[],e.push(s),l=0,o.count=a,a=0,r=0,o=new O(0,0,this),i[++n]=[o]),s.push(l,l+2,l+1),s.push(l+1,l+2,l+3),v+=6,a+=6,r+=6,l+=4;d._locatorBuckets.push({locator:o,count:v}),l+4>=U-1&&(t.push(0),s=[],e.push(s),l=0,o.count=a,r=0,a=0,o=new O(0,0,this),i[++n]=[o])}d._clean()}return o.count=a,r},X.prototype.getPolylineStartIndex=function(e){for(var t=this.polylines,i=0,r=t.length,n=0;r>n;++n){var o=t[n];if(o===e)break;i+=o._actualLength}return i};var nt={positions:void 0,lengths:void 0},ot=Array(1);return X.prototype.getSegments=function(e){var t=e.getPositions();if(t.length>0&&(e._polylineCollection._boundingVolume=e._polylineCollection._boundingVolume===void 0?h.clone(e._boundingVolume):e._polylineCollection._boundingVolume.union(e._boundingVolume,e._polylineCollection._boundingVolume)),this.mode===y.SCENE3D)return ot[0]=t.length,nt.positions=t,nt.lengths=ot,nt;z(e)&&(t=e._segments.positions);for(var i,r,o=this.ellipsoid,a=this.projection,s=[],l=this.modelMatrix,u=t.length,c=0;u>c;++c)i=t[c],r=l.multiplyByPoint(i),s.push(a.project(o.cartesianToCartographic(n.fromCartesian4(r))));if(s.length>0){e._boundingVolume2D=h.fromPoints(s,e._boundingVolume2D);var d=e._boundingVolume2D.center;e._boundingVolume2D.center=new n(d.z,d.x,d.y),e._polylineCollection._boundingVolume2D=e._polylineCollection._boundingVolume2D===void 0?h.clone(e._boundingVolume2D):e._polylineCollection._boundingVolume2D.union(e._boundingVolume2D,e._polylineCollection._boundingVolume2D)}return nt.positions=s,nt.lengths=e._segments.lengths,nt},X.prototype.writeUpdate=function(e,t,i,r){var o=this.mode,s=t._actualLength;if(s){e+=this.getPolylineStartIndex(t);var l,u=new Float32Array(3*6*s),c=new Float32Array(4*s),h=0,d=0,m=this.getSegments(t),p=m.positions,f=m.lengths,v=0,g=0,_=t.getWidth(),w=t.getShow()&&_>0;s=p.length;for(var C=0;s>C;++C){0===C?(l=Q,n.subtract(p[0],p[1],l),n.add(p[0],l,l)):l=p[C-1],K.x=l.x,K.y=l.y,K.z=o!==y.SCENE2D?l.z:0,l=p[C],Z.x=l.x,Z.y=l.y,Z.z=o!==y.SCENE2D?l.z:0,C===s-1?(l=Q,n.subtract(p[s-1],p[s-2],l),n.add(p[s-1],l,l)):l=p[C+1],J.x=l.x,J.y=l.y,J.z=o!==y.SCENE2D?l.z:0;var x=f[v];C===g+x&&(g+=x,++v);for(var T=0===C-g,S=C===g+f[v]-1,E=T?2:0,b=S?2:4,M=E;b>M;++M){a.writeElements(Z,u,h),a.writeElements(K,u,h+6),a.writeElements(J,u,h+12);var I=0>M-2?-1:1;c[d]=C/(s-1),c[d+1]=2*(M%2)-1,c[d+2]=I*_,c[d+3]=w,h+=18,d+=4}}i.copyFromArrayView(u,18*Float32Array.BYTES_PER_ELEMENT*e),r.copyFromArrayView(c,4*Float32Array.BYTES_PER_ELEMENT*e)}},W}),i("DynamicScene/DynamicPathVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian3","../Core/Matrix4","../Core/Color","../Core/Transforms","../Core/ReferenceFrame","../Scene/Material","../Scene/SceneMode","../Scene/PolylineCollection"],function(e,t,i,r,n,o,a,s,l,u){var c=function(e,t){this._unusedIndexes=[],this._polylineCollection=new u,this._scene=e,this._referenceFrame=t;var i;t===a.INERTIAL&&(i=o.computeIcrfToFixedMatrix),e.getPrimitives().add(this._polylineCollection),this._transformFunction=i};c.prototype.update=function(e){var t=this._transformFunction;if(t!==void 0){var n=t(e);n!==void 0&&r.fromRotationTranslation(n,i.ZERO,this._polylineCollection.modelMatrix)}},c.prototype.updateObject=function(e,t){var i=t.path;if(void 0!==i){var r=t.position;if(void 0!==r){var o,a,l,u,c=i.show,h=t._pathVisualizerIndex,d=c===void 0||c.getValue(e);if(d){a=i.leadTime;var m;a!==void 0&&(m=a.getValue(e)),a=i.trailTime;var p;a!==void 0&&(p=a.getValue(e));var f=t.availability,v=f!==void 0,g=m!==void 0,_=p!==void 0;d=v||g&&_,d&&(_&&(l=e.addSeconds(-p)),!v||_&&!f.start.greaterThan(l)||(l=f.start),g&&(u=e.addSeconds(m)),!v||g&&!f.stop.lessThan(u)||(u=f.stop),d=l.lessThan(u))}if(!d)return h!==void 0&&(o=this._polylineCollection.get(h),o.setShow(!1),t._pathVisualizerIndex=void 0,this._unusedIndexes.push(h)),void 0;var y;if(h===void 0){var w=this._unusedIndexes,C=w.length;C>0?(h=w.pop(),o=this._polylineCollection.get(h)):(h=this._polylineCollection.getLength(),o=this._polylineCollection.add()),t._pathVisualizerIndex=h,o.dynamicObject=t,o.setWidth(1);var x=o.getMaterial();(x===void 0||x.type!==s.PolylineOutlineType)&&(x=s.fromType(this._scene.getContext(),s.PolylineOutlineType),o.setMaterial(x)),y=x.uniforms,n.clone(n.WHITE,y.color),n.clone(n.BLACK,y.outlineColor),y.outlineWidth=0}else o=this._polylineCollection.get(h),y=o.getMaterial().uniforms;o.setShow(!0);var T=60;if(a=i.resolution,a!==void 0&&(T=a.getValue(e)),o.setPositions(r._getValueRangeInReferenceFrame(l,u,e,this._referenceFrame,T,o.getPositions())),a=i.color,a!==void 0&&(y.color=a.getValue(e,y.color)),a=i.outlineColor,a!==void 0&&(y.outlineColor=a.getValue(e,y.outlineColor)),a=i.outlineWidth,a!==void 0&&(y.outlineWidth=a.getValue(e,y.outlineWidth)),a=i.width,a!==void 0){var S=a.getValue(e);S!==void 0&&o.setWidth(S)}}}},c.prototype.removeObject=function(e){var t=e._pathVisualizerIndex;if(t!==void 0){var i=this._polylineCollection.get(t);i.setShow(!1),this._unusedIndexes.push(t),e._pathVisualizerIndex=void 0}},c.prototype.destroy=function(){return this._scene.getPrimitives().remove(this._polylineCollection),t(this)};var h=function(t,i){if(t===void 0)throw new e("scene is required.");this._scene=t,this._updaters={FIXED:new c(t,a.FIXED),INERTIAL:new c(t,a.INERTIAL)},this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};return h.prototype.getScene=function(){return this._scene},h.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},h.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(h.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(h.prototype._onObjectsRemoved,this))},h.prototype.update=function(t){if(t===void 0)throw new e("time is requied.");if(this._dynamicObjectCollection!==void 0){var i=this._updaters;for(var r in i)i.hasOwnProperty(r)&&i[r].update(t);for(var n=this._dynamicObjectCollection.getObjects(),o=0,s=n.length;s>o;o++){var u=n[o];if(void 0!==u.path){var h=u.position;if(void 0!==h){var d=u._pathUpdater,m=a.FIXED;this._scene.mode===l.SCENE3D&&(m=h._getReferenceFrame());var p=this._updaters[m];d!==p||void 0===p?(d!==void 0&&d.removeObject(u),p===void 0&&(p=new c(this._scene,m),p.update(t),this._updaters[m]=p),u._pathUpdater=p,p!==void 0&&p.updateObject(t,u)):p.updateObject(t,u)}}}}},h.prototype.removeAllPrimitives=function(){var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();if(this._updaters={},this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=i.length-1;r>-1;r--)i[r]._pathUpdater=void 0,i[r]._pathVisualizerIndex=void 0},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this.removeAllPrimitives(),t(this)},h.prototype._onObjectsRemoved=function(e,t){for(var i=t.length-1;i>-1;i--){var r=t[i],n=r._pathUpdater;n!==void 0&&n.removeObject(r)}},h}),i("DynamicScene/DynamicPointVisualizer",["../Core/Color","../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Scene/BillboardCollection","../Renderer/TextureAtlasBuilder"],function(e,t,i,r,n,o,a){var s=function(e,t){if(e===void 0)throw new r("scene is required.");this._scene=e,this._unusedIndexes=[],this._dynamicObjectCollection=void 0;var i=this._billboardCollection=new o,n=this._textureAtlas=e.getContext().createTextureAtlas();this._textureAtlasBuilder=new a(n),i.setTextureAtlas(n),e.getPrimitives().add(i),this.setDynamicObjectCollection(t)};s.prototype.getScene=function(){return this._scene},s.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},s.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(s.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(s.prototype._onObjectsRemoved,this))},s.prototype.update=function(e){if(e===void 0)throw new r("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var t=this._dynamicObjectCollection.getObjects(),i=0,n=t.length;n>i;i++)this._updateObject(e,t[i])},s.prototype.removeAllPrimitives=function(){if(this._unusedIndexes=[],this._billboardCollection.removeAll(),this._dynamicObjectCollection!==void 0)for(var e=this._dynamicObjectCollection.getObjects(),t=e.length-1;t>-1;t--)e[t]._pointVisualizerIndex=void 0},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._billboardCollection),i(this)};var l,u,c;return s.prototype._updateObject=function(i,r){var n=r.point;if(void 0!==n){var o=r.position;if(void 0!==o){var a,s=n.show,h=r._pointVisualizerIndex,d=r.isAvailable(i)&&(s===void 0||s.getValue(i));if(!d)return h!==void 0&&(a=this._billboardCollection.get(h),a.setShow(!1),a.setImageIndex(-1),r._pointVisualizerIndex=void 0,this._unusedIndexes.push(h)),void 0;var m=!1;if(h===void 0){var p=this._unusedIndexes,f=p.length;f>0?(h=p.pop(),a=this._billboardCollection.get(h)):(h=this._billboardCollection.getLength(),a=this._billboardCollection.add()),r._pointVisualizerIndex=h,a.dynamicObject=r,a._visualizerColor=e.WHITE.clone(a._visualizerColor),a._visualizerOutlineColor=e.BLACK.clone(a._visualizerOutlineColor),a._visualizerOutlineWidth=0,a._visualizerPixelSize=1,m=!0}else a=this._billboardCollection.get(h);a.setShow(!0),u=o.getValueCartesian(i,u),u!==void 0&&a.setPosition(u);var v=n.color;if(v!==void 0&&(l=v.getValue(i,l),e.equals(a._visualizerColor,l)||(e.clone(l,a._visualizerColor),m=!0)),v=n.outlineColor,v!==void 0&&(c=v.getValue(i,c),e.equals(a._visualizerOutlineColor,c)||(e.clone(c,a._visualizerOutlineColor),m=!0)),v=n.outlineWidth,v!==void 0){var g=v.getValue(i);a._visualizerOutlineWidth!==g&&(a._visualizerOutlineWidth=g,m=!0)}if(v=n.pixelSize,v!==void 0){var _=v.getValue(i);a._visualizerPixelSize!==_&&(a._visualizerPixelSize=_,m=!0)}if(m){var y=t(a._visualizerColor,e.WHITE).toCssColorString(),w=t(a._visualizerOutlineColor,e.BLACK).toCssColorString(),C=t(a._visualizerPixelSize,3),x=t(a._visualizerOutlineWidth,2),T=JSON.stringify([y,C,w,x]);this._textureAtlasBuilder.addTextureFromFunction(T,function(e,t){var i=document.createElement("canvas"),r=C+2*x;i.height=i.width=r;var n=i.getContext("2d");n.clearRect(0,0,r,r),0!==x&&(n.beginPath(),n.arc(r/2,r/2,r/2,0,2*Math.PI,!0),n.closePath(),n.fillStyle=w,n.fill()),n.beginPath(),n.arc(r/2,r/2,C/2,0,2*Math.PI,!0),n.closePath(),n.fillStyle=y,n.fill(),t(i)},function(e){a.setImageIndex(e)})}}}},s.prototype._onObjectsRemoved=function(e,t){for(var i=this._billboardCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._pointVisualizerIndex;if(a!==void 0){var s=i.get(a);s.setShow(!1),s.setImageIndex(-1),o._pointVisualizerIndex=void 0,r.push(a)}}},s}),i("Renderer/VertexLayout",["../Core/Enumeration"],function(e){var t={SEPARATE:new e(0,"SEPARATE"),INTERLEAVED:new e(1,"INTERLEAVED"),validate:function(e){return e===t.SEPARATE||e===t.INTERLEAVED}};return t}),i("Shaders/PolygonVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 position2DHigh;\nattribute vec2 position2DLow;\nattribute vec2 textureCoordinates;\nuniform float u_morphTime;\nuniform float u_height;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 p;\nif (u_morphTime == 1.0)\n{\np = vec4(czm_translateRelativeToEye(position3DHigh, position3DLow), 1.0);\n}\nelse if (u_morphTime == 0.0)\n{\np = vec4(czm_translateRelativeToEye(vec3(u_height, position2DHigh), vec3(u_height, position2DLow)), 1.0);\n}\nelse\n{\np = czm_columbusViewMorph(\nczm_translateRelativeToEye(vec3(u_height, position2DHigh), vec3(u_height, position2DLow)),\nczm_translateRelativeToEye(position3DHigh, position3DLow),\nu_morphTime);\n}\nv_positionMC = position3DHigh + position3DLow;\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_textureCoordinates = textureCoordinates;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"}),i("Shaders/PolygonFS",[],function(){return"uniform float u_morphTime;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.st = v_textureCoordinates;\nmaterialInput.str = vec3(v_textureCoordinates, 0.0);\nmaterialInput.normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n}\n"}),i("Scene/Polygon",["../Core/DeveloperError","../Core/defaultValue","../Core/Color","../Core/combine","../Core/destroyObject","../Core/Cartesian2","../Core/Math","../Core/Ellipsoid","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartographic","../Core/ComponentDatatype","../Core/MeshFilters","../Core/PrimitiveType","../Core/EllipsoidTangentPlane","../Core/PolygonPipeline","../Core/WindingOrder","../Core/ExtentTessellator","../Core/Queue","../Core/Matrix3","../Core/Quaternion","../Renderer/BlendingState","../Renderer/BufferUsage","../Renderer/CommandLists","../Renderer/CullFace","../Renderer/DrawCommand","../Renderer/VertexLayout","../Renderer/createPickFragmentShaderSource","./Material","./SceneMode","../Shaders/PolygonVS","../Shaders/PolygonFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P,R){function O(){this._va=void 0
}function z(e,t,i,r){for(var n=new o(t.x,t.y),a=i.attributes.position.values,s=a.length,l=new Float32Array(2*(s/3)),u=0,c=C.fromAxisAngle(e._plane.normal,r,W),h=w.fromQuaternion(c,H),m=0;s>m;m+=3){var p=k;p.x=a[m],p.y=a[m+1],p.z=a[m+2],w.multiplyByVector(h,p,p);var f=e.projectPointOntoPlane(p,U);f.subtract(n,f),l[u++]=f.x/t.width,l[u++]=f.y/t.height}return i.attributes.textureCoordinates={componentDatatype:d.FLOAT,componentsPerAttribute:2,values:l},i}function L(e,t,i,r){for(var n=C.fromAxisAngle(e._plane.normal,i,Y),o=w.fromQuaternion(n,X),a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,d=t.length,m=0;d>m;++m){var p=c.clone(t[m],G);w.multiplyByVector(o,p,p);var f=e.projectPointOntoPlane(p,j);f!==void 0&&(a=Math.min(a,f.x),s=Math.max(s,f.x),u=Math.min(u,f.y),h=Math.max(h,f.y))}return r===void 0&&(r=new l),r.x=a,r.y=u,r.width=s-a,r.height=h-u,r}function N(e,t,i,r){var n=v.cleanUp(t);if(3>n.length)return void 0;var o=f.fromPoints(n,e.ellipsoid),a=o.projectPointsOntoPlane(n,Z),s=v.computeWindingOrder2D(a);s===g.CLOCKWISE&&(a.reverse(),n.reverse());var l=v.earClip2D(a),u=v.computeSubdivision(n,l,e._granularity),c=r||n,h=L(o,c,i,K);return u=z(o,h,u,i)}function V(e){var t,i,r=[];if(e._extent===void 0||e._extent.isEmpty()){if(e._positions!==void 0)i=N(e,e._positions,e._textureRotationAngle),i!==void 0&&(r.push(i),e._boundingVolume=u.fromPoints(e._positions,e._boundingVolume));else if(e._polygonHierarchy!==void 0){var n=e._polygonHierarchy[0];for(t=0;e._polygonHierarchy.length>t;t++)i=N(e,e._polygonHierarchy[t],e._textureRotationAngle,n),i!==void 0&&r.push(i);r.length>0&&(e._boundingVolume=u.fromPoints(n,e._boundingVolume))}}else if(r.push(_.compute({extent:e._extent,generateTextureCoordinates:!0})),e._boundingVolume=u.fromExtent3D(e._extent,e._ellipsoid,e._boundingVolume),e._mode!==A.SCENE3D){e._boundingVolume2D=u.fromExtent2D(e._extent,e._projection,e._boundingVolume2D);var o=e._boundingVolume2D.center;e._boundingVolume2D.center=new c(0,o.x,o.y)}if(0===r.length)return void 0;var a=[];for(t=0;r.length>t;t++){if(i=r[t],i=v.scaleToGeodeticHeight(i,e.height,e.ellipsoid),i=m.reorderForPostVertexCache(i),i=m.reorderForPreVertexCache(i),e._mode===A.SCENE3D)i.attributes.position2DHigh={value:[0,0]},i.attributes.position2DLow={value:[0,0]},i=m.encodeAttribute(i,"position","position3DHigh","position3DLow");else{if(i=m.projectTo2D(i,e._projection),0===t&&e._mode!==A.SCENE3D){for(var s=i.attributes.position2D.values,l=[],h=0;s.length>h;h+=2)l.push(new c(s[h],s[h+1],0));e._boundingVolume2D=u.fromPoints(l,e._boundingVolume2D);var d=e._boundingVolume2D.center;e._boundingVolume2D.center=new c(0,d.x,d.y)}i=m.encodeAttribute(i,"position3D","position3DHigh","position3DLow"),i=m.encodeAttribute(i,"position2D","position2DHigh","position2DLow")}a=a.concat(m.fitToUnsignedShortIndices(i))}return a}function B(e,t){return t===A.SCENE3D?e.scene3D.granularity||e.granularity:e.scene2D.granularity||e.granularity}var F={position3DHigh:0,position3DLow:1,position2DHigh:2,position2DLow:3,textureCoordinates:4};O.prototype.getVertexArrays=function(){return this._va},O.prototype.update=function(e,t,i){if(t!==void 0){this._destroyVA();for(var r=[],n=t.length,o=0;n>o;++o)r.push(e.createVertexArrayFromMesh({mesh:t[o],attributeIndices:F,bufferUsage:i,vertexLayout:M.INTERLEAVED}));this._va=r}else this._destroyVA()},O.prototype._destroyVA=function(){var e=this._va;if(e!==void 0){this._va=void 0;for(var t=e.length,i=0;t>i;++i)e[i].destroy()}},O.prototype.isDestroyed=function(){return!1},O.prototype.destroy=function(){return this._destroyVA(),n(this)};var q=function(){this._sp=void 0,this._rs=void 0,this._spPick=void 0,this._vertices=new O,this._pickId=void 0,this._boundingVolume=new u,this._boundingVolume2D=new u,this._commandLists=new S,this.ellipsoid=s.WGS84,this._ellipsoid=void 0,this.height=0,this._height=void 0,this.granularity=a.toRadians(1),this._granularity=void 0,this.scene2D={granularity:a.toRadians(30)},this.scene3D={},this._positions=void 0,this._textureRotationAngle=void 0,this._extent=void 0,this._polygonHierarchy=void 0,this._createVertexArray=!1,this.show=!0,this.bufferUsage=T.STATIC_DRAW,this._bufferUsage=T.STATIC_DRAW,this.material=D.fromType(void 0,D.ColorType),this.material.uniforms.color=new i(1,1,0,.5),this._material=void 0,this._mode=A.SCENE3D,this._projection=void 0,this.morphTime=this._mode.morphTime;var e=this;this._uniforms={u_morphTime:function(){return e.morphTime},u_height:function(){return e._mode!==A.SCENE2D?e.height:0}},this._pickColorUniform={czm_pickColor:function(){return e._pickId.color}},this._pickUniforms=void 0,this._drawUniforms=void 0};q.prototype.getPositions=function(){return this._positions},q.prototype.setPositions=function(i,r,n){if(i!==void 0&&3>i.length)throw new e("At least three positions are required.");this.height=t(r,0),this._textureRotationAngle=t(n,0),this._extent=void 0,this._polygonHierarchy=void 0,this._positions=i,this._createVertexArray=!0},q.prototype.configureFromPolygonHierarchy=function(i,r,n){var o=[],a=new y;for(a.enqueue(i);0!==a.length;){var s=a.dequeue(),l=s.positions;if(3>l.length)throw new e("At least three positions are required.");var u=s.holes?s.holes.length:0;if(0===u)o.push(s.positions);else{for(var c=[],h=0;u>h;h++){var d=s.holes[h];c.push(d.positions);var m=0;d.holes&&(m=d.holes.length);for(var p=0;m>p;p++)a.enqueue(d.holes[p])}var f=v.eliminateHoles(l,c);o.push(f)}}this.height=t(r,0),this._textureRotationAngle=t(n,0),this._positions=void 0,this._extent=void 0,this._polygonHierarchy=o,this._createVertexArray=!0},q.prototype.configureExtent=function(e,i){this._extent=e,this.height=t(i,0),this._textureRotationAngle=void 0,this._positions=void 0,this._polygonHierarchy=void 0,this._createVertexArray=!0};var U=new o,k=new c,W=new C,H=new w,j=new o,G=new c,Y=new C,X=new w,Z=[],K=new l;return q.prototype.update=function(t,i,n){if(this.ellipsoid===void 0)throw new e("this.ellipsoid must be defined.");if(this.material===void 0)throw new e("this.material must be defined.");var o=i.mode,a=B(this,o);if(0>a)throw new e("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show){this._ellipsoid!==this.ellipsoid&&(this._createVertexArray=!0,this._ellipsoid=this.ellipsoid),this._height!==this.height&&(this._createVertexArray=!0,this._height=this.height),this._granularity!==a&&(this._createVertexArray=!0,this._granularity=a),this._bufferUsage!==this.bufferUsage&&(this._createVertexArray=!0,this._bufferUsage=this.bufferUsage);var s=i.scene2D.projection;if(this._projection!==s&&(this._createVertexArray=!0,this._projection=s),this._mode!==o&&(this._createVertexArray=this._mode===A.SCENE3D||o===A.SCENE3D,this._mode=o,o.morphTime!==void 0&&(this.morphTime=o.morphTime)),this._createVertexArray&&(this._createVertexArray=!1,this._vertices.update(t,V(this),this.bufferUsage)),void 0!==this._vertices.getVertexArrays()){var l;l=o===A.SCENE3D?this._boundingVolume:o===A.COLUMBUS_VIEW||o===A.SCENE2D?this._boundingVolume2D:this._boundingVolume.union(this._boundingVolume2D);var u,c,h=i.passes,d=this._vertices.getVertexArrays(),m=d.length,f=this._material!==this.material;if(this._commandLists.removeAll(),h.color){if(this._rs===void 0&&(this._rs=t.createRenderState({cull:{enabled:!0,face:E.BACK},blending:x.ALPHA_BLEND})),f){this._material=this.material;var v="#line 0\n"+this.material.shaderSource+"#line 0\n"+R;this._sp=t.getShaderCache().replaceShaderProgram(this._sp,P,v,F),this._drawUniforms=r([this._uniforms,this.material._uniforms],!1,!1)}u=this._commandLists.colorList,u.length=m;for(var g=0;m>g;++g)c=u[g],c===void 0&&(c=u[g]=new b),c.boundingVolume=l,c.primitiveType=p.TRIANGLES,c.shaderProgram=this._sp,c.uniformMap=this._drawUniforms,c.vertexArray=d[g],c.renderState=this._rs}if(h.pick){if(this._pickId===void 0&&(this._pickId=t.createPickId(this)),f||this._spPick===void 0){var _=I("#line 0\n"+this.material.shaderSource+"#line 0\n"+R,"uniform");this._spPick=t.getShaderCache().replaceShaderProgram(this._spPick,P,_,F),this._pickUniforms=r([this._uniforms,this._pickColorUniform,this.material._uniforms],!1,!1)}u=this._commandLists.pickList,u.length=m;for(var y=0;m>y;++y)c=u[y],c===void 0&&(c=u[y]=new b),c.boundingVolume=l,c.primitiveType=p.TRIANGLES,c.shaderProgram=this._spPick,c.uniformMap=this._pickUniforms,c.vertexArray=d[y],c.renderState=this._rs}this._commandLists.empty()||n.push(this._commandLists)}}},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){return this._sp=this._sp&&this._sp.release(),this._spPick=this._spPick&&this._spPick.release(),this._vertices=this._vertices.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),n(this)},q}),i("DynamicScene/DynamicPolygonVisualizer",["../Core/Cartesian3","../Core/DeveloperError","../Core/destroyObject","../Scene/Polygon","../Scene/Material"],function(e,t,i,r,n){var o=function(e,i){if(e===void 0)throw new t("scene is required.");this._scene=e,this._unusedIndexes=[],this._primitives=e.getPrimitives(),this._polygonCollection=[],this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};o.prototype.getScene=function(){return this._scene},o.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},o.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(o.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(o.prototype._onObjectsRemoved,this))},o.prototype.update=function(e){if(e===void 0)throw new t("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(e,i[r])},o.prototype.removeAllPrimitives=function(){var e,t;for(e=0,t=this._polygonCollection.length;t>e;e++)this._primitives.remove(this._polygonCollection[e]);if(this._dynamicObjectCollection!==void 0){var i=this._dynamicObjectCollection.getObjects();for(e=i.length-1;e>-1;e--)i[e]._polygonVisualizerIndex=void 0}this._unusedIndexes=[],this._polygonCollection=[]},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this.removeAllPrimitives(),i(this)};var a=new e;return o.prototype._updateObject=function(e,t){var i=t.polygon;if(void 0!==i){var o,s=i.show,l=t.ellipse,u=t.position,c=t.vertexPositions,h=t._polygonVisualizerIndex,d=t.isAvailable(e)&&(s===void 0||s.getValue(e)),m=c!==void 0;if(!d||!m&&(l===void 0||u===void 0))return h!==void 0&&(o=this._polygonCollection[h],o.show=!1,t._polygonVisualizerIndex=void 0,this._unusedIndexes.push(h)),void 0;var p=this._scene.getContext();if(h===void 0){var f=this._unusedIndexes,v=f.length;v>0?(h=f.pop(),o=this._polygonCollection[h]):(h=this._polygonCollection.length,o=new r,this._polygonCollection.push(o),this._primitives.add(o)),t._polygonVisualizerIndex=h,o.dynamicObject=t,o.material=n.fromType(p,n.ColorType)}else o=this._polygonCollection[h];o.show=!0;var g;g=m?c.getValueCartesian(e):l.getValue(e,u.getValueCartesian(e,a)),o._visualizerPositions!==g&&g!==void 0&&g.length>3&&(o.setPositions(g),o._visualizerPositions=g);var _=i.material;_!==void 0&&(o.material=_.getValue(e,p,o.material))}},o.prototype._onObjectsRemoved=function(e,t){for(var i=this._polygonCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._polygonVisualizerIndex;if(a!==void 0){var s=i[a];s.show=!1,r.push(a),o._polygonVisualizerIndex=void 0}}},o}),i("DynamicScene/DynamicPolylineVisualizer",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian3","../Core/Color","../Scene/Material","../Scene/PolylineCollection"],function(e,t,i,r,n,o){var a=function(t,i){if(t===void 0)throw new e("scene is required.");this._scene=t,this._unusedIndexes=[],this._primitives=t.getPrimitives();var r=this._polylineCollection=new o;t.getPrimitives().add(r),this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};a.prototype.getScene=function(){return this._scene},a.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},a.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(a.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(a.prototype._onObjectsRemoved,this))},a.prototype.update=function(t){if(t===void 0)throw new e("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(t,i[r])},a.prototype.removeAllPrimitives=function(){var e;if(this._polylineCollection.removeAll(),this._dynamicObjectCollection!==void 0){var t=this._dynamicObjectCollection.getObjects();for(e=t.length-1;e>-1;e--)t[e]._polylineVisualizerIndex=void 0}this._unusedIndexes=[]},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this.removeAllPrimitives(),this._scene.getPrimitives().remove(this._polylineCollection),t(this)};var s=new i;return a.prototype._updateObject=function(e,t){var i=t.polyline;if(void 0!==i){var o,a=i.show,l=t.ellipse,u=t.position,c=t.vertexPositions,h=t._polylineVisualizerIndex,d=t.isAvailable(e)&&(a===void 0||a.getValue(e));if(!d||c===void 0&&(l===void 0||u===void 0))return h!==void 0&&(o=this._polylineCollection.get(h),o.setShow(!1),t._polylineVisualizerIndex=void 0,this._unusedIndexes.push(h)),void 0;var m;if(h===void 0){var p=this._unusedIndexes,f=p.length;f>0?(h=p.pop(),o=this._polylineCollection.get(h)):(h=this._polylineCollection.getLength(),o=this._polylineCollection.add()),t._polylineVisualizerIndex=h,o.dynamicObject=t,o.setWidth(1);var v=o.getMaterial();(v===void 0||v.type!==n.PolylineOutlineType)&&(v=n.fromType(this._scene.getContext(),n.PolylineOutlineType),o.setMaterial(v)),m=v.uniforms,r.clone(r.WHITE,m.color),r.clone(r.BLACK,m.outlineColor),m.outlineWidth=0}else o=this._polylineCollection.get(h),m=o.getMaterial().uniforms;o.setShow(!0);var g;g=l!==void 0?l.getValue(e,u.getValueCartesian(e,s)):c.getValueCartesian(e),g!==void 0&&o._visualizerPositions!==g&&(o.setPositions(g),o._visualizerPositions=g);var _=i.color;if(_!==void 0&&(m.color=_.getValue(e,m.color)),_=i.outlineColor,_!==void 0&&(m.outlineColor=_.getValue(e,m.outlineColor)),_=i.outlineWidth,_!==void 0&&(m.outlineWidth=_.getValue(e,m.outlineWidth)),_=i.width,_!==void 0){var y=_.getValue(e);y!==void 0&&o.setWidth(y)}}},a.prototype._onObjectsRemoved=function(e,t){for(var i=this._polylineCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._polylineVisualizerIndex;if(a!==void 0){var s=i.get(a);s.setShow(!1),r.push(a),o._polylineVisualizerIndex=void 0}}},a}),i("DynamicScene/DynamicPyramidVisualizer",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/Matrix3","../Core/Matrix4","../Scene/CustomSensorVolume","../Scene/Material"],function(e,t,i,r,n,o,a,s){var l=new n,u=function(e,i){if(e===void 0)throw new t("scene is required.");this._scene=e,this._unusedIndexes=[],this._primitives=e.getPrimitives(),this._pyramidCollection=[],this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(i)};u.prototype.getScene=function(){return this._scene},u.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},u.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;t!==e&&(t!==void 0&&(t.objectsRemoved.removeEventListener(u.prototype._onObjectsRemoved,this),this.removeAllPrimitives()),this._dynamicObjectCollection=e,e!==void 0&&e.objectsRemoved.addEventListener(u.prototype._onObjectsRemoved,this))},u.prototype.update=function(e){if(e===void 0)throw new t("time is requied.");if(this._dynamicObjectCollection!==void 0)for(var i=this._dynamicObjectCollection.getObjects(),r=0,n=i.length;n>r;r++)this._updateObject(e,i[r])},u.prototype.removeAllPrimitives=function(){var e,t;for(e=0,t=this._pyramidCollection.length;t>e;e++)this._primitives.remove(this._pyramidCollection[e]);if(this._dynamicObjectCollection!==void 0){var i=this._dynamicObjectCollection.getObjects();for(e=i.length-1;e>-1;e--)i[e]._pyramidVisualizerIndex=void 0}this._unusedIndexes=[],this._pyramidCollection=[]},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this.removeAllPrimitives(),i(this)};var c,h;return u.prototype._updateObject=function(t,i){var u=this._scene.getContext(),d=i.pyramid;if(void 0!==d){var m=d.directions;if(void 0!==m){var p=i.position;if(void 0!==p){var f=i.orientation;if(void 0!==f){var v,g=d.show,_=i._pyramidVisualizerIndex,y=i.isAvailable(t)&&(g===void 0||g.getValue(t));if(!y)return _!==void 0&&(v=this._pyramidCollection[_],v.show=!1,i._pyramidVisualizerIndex=void 0,this._unusedIndexes.push(_)),void 0;if(_===void 0){var w=this._unusedIndexes,C=w.length;C>0?(_=w.pop(),v=this._pyramidCollection[_]):(_=this._pyramidCollection.length,v=new a,this._pyramidCollection.push(v),this._primitives.add(v)),i._pyramidVisualizerIndex=_,v.dynamicObject=i,v.radius=Number.POSITIVE_INFINITY,v.showIntersection=!0,v.intersectionColor=r.YELLOW,v.material=s.fromType(u,s.ColorType)}else v=this._pyramidCollection[_];v.show=!0;var x=m.getValueSpherical(t);x!==void 0&&v._visualizerDirections!==x&&(v.setDirections(x),v._visualizerDirections=x),c=e(p.getValueCartesian(t,c),v._visualizerPosition),h=e(f.getValue(t,h),v._visualizerOrientation),void 0===c||void 0===h||c.equals(v._visualizerPosition)&&h.equals(v._visualizerOrientation)||(o.fromRotationTranslation(n.fromQuaternion(h,l),c,v.modelMatrix),c.clone(v._visualizerPosition),h.clone(v._visualizerOrientation));var T=d.material;T!==void 0&&(v.material=T.getValue(t,u,v.material));var S=d.intersectionColor;if(S!==void 0){var E=S.getValue(t,E);E!==void 0&&(v.intersectionColor=E)}if(S=d.radius,S!==void 0){var b=S.getValue(t,b);b!==void 0&&(v.radius=b)}}}}}},u.prototype._onObjectsRemoved=function(e,t){for(var i=this._pyramidCollection,r=this._unusedIndexes,n=t.length-1;n>-1;n--){var o=t[n],a=o._pyramidVisualizerIndex;if(a!==void 0){var s=i[a];s.show=!1,r.push(a),o._pyramidVisualizerIndex=void 0}}},u}),i("DynamicScene/CzmlDefaults",["./DynamicObject","./DynamicBillboard","./DynamicClock","./DynamicEllipse","./DynamicEllipsoid","./DynamicCone","./DynamicLabel","./DynamicPath","./DynamicPoint","./DynamicPolygon","./DynamicPolyline","./DynamicPyramid","./DynamicBillboardVisualizer","./DynamicEllipsoidVisualizer","./DynamicConeVisualizerUsingCustomSensor","./DynamicLabelVisualizer","./DynamicPathVisualizer","./DynamicPointVisualizer","./DynamicPolygonVisualizer","./DynamicPolylineVisualizer","./DynamicPyramidVisualizer"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w){var C={updaters:[i.processCzmlPacket,t.processCzmlPacket,r.processCzmlPacket,n.processCzmlPacket,o.processCzmlPacket,a.processCzmlPacket,s.processCzmlPacket,l.processCzmlPacket,u.processCzmlPacket,c.processCzmlPacket,h.processCzmlPacket,e.processCzmlPacketPosition,e.processCzmlPacketViewFrom,e.processCzmlPacketOrientation,e.processCzmlPacketVertexPositions,e.processCzmlPacketAvailability],mergers:[i.mergeProperties,t.mergeProperties,r.mergeProperties,n.mergeProperties,o.mergeProperties,a.mergeProperties,s.mergeProperties,l.mergeProperties,u.mergeProperties,c.mergeProperties,h.mergeProperties,e.mergeProperties],cleaners:[t.undefineProperties,r.undefineProperties,n.undefineProperties,o.undefineProperties,a.undefineProperties,s.undefineProperties,l.undefineProperties,u.undefineProperties,c.undefineProperties,h.undefineProperties,e.undefineProperties,i.undefineProperties],createVisualizers:function(e){return[new d(e),new m(e),new p(e),new f(e),new g(e),new _(e),new y(e),new w(e),new v(e)]}};return C}),i("DynamicScene/CompositeDynamicObjectCollection",["../Core/defaultValue","../Core/Event","../Core/Iso8601","../Core/TimeInterval","../Core/DeveloperError","./DynamicObject","./DynamicObjectCollection","./CzmlDefaults"],function(e,t,i,r,n,o,a,s){var l=function(i,r,n){this._hash={},this._array=[],this._collections=[],this.mergeFunctions=e(r,s.mergers),this.cleanFunctions=e(n,s.cleaners),this.objectPropertiesChanged=new t,this.objectsRemoved=new t,this.setCollections(i)};return l.prototype.computeAvailability=function(){for(var e=i.MAXIMUM_VALUE,t=i.MINIMUM_VALUE,n=this._collections,o=0,a=n.length;a>o;++o){var s=n[o],l=s.computeAvailability(),u=l.start,c=l.stop;u.lessThan(e)&&!u.equals(i.MINIMUM_VALUE)&&(e=l.start),c.greaterThan(t)&&!c.equals(i.MAXIMUM_VALUE)&&(t=l.stop)}return i.MAXIMUM_VALUE.equals(e)&&(e=i.MINIMUM_VALUE),i.MINIMUM_VALUE.equals(t)&&(t=i.MAXIMUM_VALUE),new r(e,t,!0,!0)},l.prototype.getCollections=function(){return this._collections.slice(0)},l.prototype.setCollections=function(e){e=e!==void 0?e:[];var t=this._collections;if(e!==t){var i,r;for(r=t.length-1;r>-1;r--)i=t[r],i.compositeCollection=void 0,i.objectPropertiesChanged.removeEventListener(l.prototype._onObjectPropertiesChanged,this);t=this._collections=e,this._clearObjects();var n=this.mergeFunctions;for(r=t.length-1;r>-1;r--){i=t[r],i.compositeCollection=this,i.objectPropertiesChanged.addEventListener(l.prototype._onObjectPropertiesChanged,this);for(var o=i.getObjects(),a=o.length-1;a>-1;a--)for(var s=o[a],u=this._getOrCreateObject(s.id),c=n.length-1;c>-1;c--){var h=n[c];h(u,s)}}}},l.prototype.getObject=function(e){if(e===void 0)throw new n("id is required.");return this._hash[e]},l.prototype.getObjects=function(){return this._array},l.prototype.clear=function(){this.setCollections([])},l.prototype._getOrCreateObject=function(e){var t=this._hash[e];return t||(t=new o(e),this._hash[e]=t,this._array.push(t)),t},l.prototype._clearObjects=function(){var e=this._array;this._hash={},this._array=[],e.length>0&&this.objectsRemoved.raiseEvent(this,e)},l.prototype._onObjectPropertiesChanged=function(e,t){for(var i,r,n=this.mergeFunctions,o=this.cleanFunctions,a=this._collections,s=[],l=t.length-1;l>-1;l--){if(i=t[l],r=this.getObject(i.id),r!==void 0)for(var u=o.length-1;u>-1;u--){var c=o[u];c(r)}else r=this._getOrCreateObject(i.id);s.push(r);for(var h=a.length-1;h>-1;h--){var d=a[h],m=d.getObject(i.id);if(m!==void 0)for(var p=n.length-1;p>-1;p--){var f=n[p];f(r,m)}}}s.length>0&&this.objectPropertiesChanged.raiseEvent(this,s)},l}),i("DynamicScene/CzmlUnitCartesian3",["../Core/Cartesian3"],function(e){var t=3,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(e){return e.unitCartesian},isSampled:function(e){return Array.isArray(e)&&e.length>t},getValue:function(t,i){return i===void 0&&(i=new e),i.x=t[0],i.y=t[1],i.z=t[2],i.normalize(i)},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.x=t[i],r.y=t[i+1],r.z=t[i+2],r.normalize(r)}};return i}),i("DynamicScene/CzmlUnitSpherical",["../Core/Spherical"],function(e){var t=2,i={doublesPerValue:t,doublesPerInterpolationValue:t,unwrapInterval:function(e){return e.unitSpherical},isSampled:function(e){return Array.isArray(e)&&e.length>t},getValue:function(t,i){return i===void 0&&(i=new e),i.clock=t[0],i.cone=t[1],i.magnitude=1,i},getValueFromArray:function(t,i,r){return r===void 0&&(r=new e),r.clock=t[i],r.cone=t[i+1],r.magnitude=1,r}};return i}),i("Scene/CameraColumbusViewMode",["../Core/Enumeration"],function(e){var t={FREE:new e(0,"FREE"),LOCKED:new e(1,"LOCKED")};return t}),i("DynamicScene/DynamicObjectView",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Quaternion","../Core/Matrix3","../Core/Ellipsoid","../Core/Transforms","../Scene/CameraColumbusViewMode","../Scene/SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){function m(e,t,i,o,a,s,l){var u,c=e.scene,h=c.mode!==e._mode;h?(e._mode=c.mode,e._screenSpaceCameraController.enableTranslate=!1,u=o.magnitude()):u=i?o.magnitude():t.position.z;var d=a.getValueCartographic(s,e._lastCartographic);d!==void 0&&(d.height=u,i||h?(t.controller.setPositionCartographic(d),n.normalize(o,t.up),n.negate(t.up,t.up),n.cross(t.direction,t.up,t.right),t.up.z=0,n.normalize(t.up,t.up),t.right.z=0,n.normalize(t.right,t.right),r.clone(t.right,e._first2dUp)):t.position=l.project(d),e._lastDistance=t.frustum.right-t.frustum.left,r.clone(t.right,e._last2dUp))}function p(e,t,i,r,o,a,s){v(e,t,i,r);var l=o.getValueCartesian(a,e._lastCartesian);if(l!==void 0){t.transform=c.eastNorthUpToFixedFrame(l,s,g),e._screenSpaceCameraController.setEllipsoid(u.UNIT_SPHERE);var h=t.position;n.clone(h,e._lastOffset),e._lastDistance=n.magnitude(h)}}function f(e,t,i,r,o,a,s,l){v(e,t,i,r);var c=o.getValueCartographic(a,e._lastCartographic);if(c!==void 0){var d=l.project(c);_.x=d.z,_.y=d.x,_.z=d.y;var m=t.transform;m.setColumn(3,_,m);var p=e._screenSpaceCameraController;p.enableTranslate=!1,p.setEllipsoid(u.UNIT_SPHERE),p.columbusViewMode=h.LOCKED,t.controller.constrainedAxis=n.UNIT_Z;var f=t.position;n.clone(f,e._lastOffset),e._lastDistance=n.magnitude(f)}}function v(e,t,o,a){var u=e.scene;if(e._screenSpaceCameraController.enableTilt=!1,t.controller.constrainedAxis=n.UNIT_Z,o)t.controller.lookAt(a,n.ZERO,n.UNIT_Z);else if(u.mode!==e._mode){e._mode=u.mode;var c=e._first2dUp,h=e._last2dUp;if(!r.equals(c,h)){var d=Math.acos(c.x);0>c.y&&(d=i.TWO_PI-d);var m=Math.acos(h.x);0>h.y&&(m=i.TWO_PI-m),h.x=0,h.y=0,c.x=0,c.y=0;var p=d-m,f=s.fromAxisAngle(n.UNIT_Z,p,y);l.fromQuaternion(f,w).multiplyByVector(a,a)}a.normalize(a).multiplyByScalar(e._lastDistance,a),t.controller.lookAt(a,n.ZERO,n.UNIT_Z)}}var g,_=new o(0,0,0,1),y=new s,w=new l,C=new n(1e4,-1e4,1e4),x=new n,T=function(t,i,o){this.dynamicObject=t,this.scene=i,this._lastScene=void 0,this.ellipsoid=e(o,u.WGS84),this._lastDynamicObject=void 0,this._mode=void 0,this._lastCartesian=new n,this._lastCartographic=new a,this._lastDistance=void 0,this._lastOffset=new n,this._offsetScratch=new n,this._first2dUp=new r,this._last2dUp=new r};return T.prototype.update=function(e){if(e===void 0)throw new t("time is required.");var i=this.scene;if(i===void 0)throw new t("DynamicObjectView.scene is required.");i!==this._lastScene&&(this._lastScene=i,this._screenSpaceCameraController=i.getScreenSpaceCameraController());var r=this.dynamicObject;if(r===void 0)throw new t("DynamicObjectView.dynamicObject is required.");var o=this.ellipsoid;if(o===void 0)throw new t("DynamicObjectView.ellipsoid is required.");var a=this.dynamicObject.position;if(a===void 0)throw new t("dynamicObject.position is required.");var s=r!==this._lastDynamicObject,l=this._offsetScratch;if(s){this._lastDynamicObject=r;var u=this.dynamicObject.viewFrom;(u===void 0||u.getValue(e,l)===void 0)&&n.clone(C,l);var c=this._first2dUp,h=this._last2dUp;c.x=c.y=0,h.x=h.y=0,n.clone(l,this._lastOffset),this._lastDistance=l.magnitude(),n.equals(l.normalize(x),n.UNIT_Z)&&(l.y-=.01)}else this._lastOffset!==void 0?l=this._lastOffset:n.clone(C,l);var v=i.mode;v===d.SCENE2D?m(this,i.getCamera(),s,l,a,e,i.scene2D.projection):v===d.SCENE3D?p(this,i.getCamera(),s,l,a,e,o):v===d.COLUMBUS_VIEW&&f(this,i.getCamera(),s,l,a,e,o,i.scene2D.projection)},T}),i("DynamicScene/VisualizerCollection",["../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","./CzmlDefaults"],function(e,t,i,r){var n=function(e,t){this._visualizers=e!==void 0?e:[],this._dynamicObjectCollection=void 0,this.setDynamicObjectCollection(t)};return n.createCzmlStandardCollection=function(e,t){if(e===void 0)throw new i("scene is required.");return new n(r.createVisualizers(e),t)},n.prototype.getVisualizers=function(){return this._visualizers.slice(0)},n.prototype.setVisualizers=function(t,i){i=e(i,!0);var r,n=this._visualizers;if(i)for(r=n.length-1;r>-1;r--){var o=n[r];-1===t.indexOf(o)&&o.destroy()}t===void 0&&(t=[]),this._visualizers=t;var a=this._dynamicObjectCollection;for(r=t.length-1;r>-1;r--)t[r].setDynamicObjectCollection(a)},n.prototype.getDynamicObjectCollection=function(){return this._dynamicObjectCollection},n.prototype.setDynamicObjectCollection=function(e){var t=this._dynamicObjectCollection;if(t!==e){this._dynamicObjectCollection=e;for(var i=this._visualizers,r=i.length-1;r>-1;r--)i[r].setDynamicObjectCollection(e)}},n.prototype.update=function(e){for(var t=this._visualizers,i=t.length-1;i>-1;i--)t[i].update(e)},n.prototype.removeAllPrimitives=function(){for(var e=this._visualizers,t=e.length-1;t>-1;t--)e[t].removeAllPrimitives()},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(i){if(i=e(i,!0),this.removeAllPrimitives(),i)for(var r=this._visualizers,n=r.length-1;n>-1;n--)r[n].destroy();return t(this)},n}),i("DynamicScene/processCzml",["../Core/createGuid","../Core/defaultValue","../Core/DeveloperError","./CzmlDefaults"],function(e,t,i,r){function n(t,i,r,n,o,a){var s=t.id;if(s===void 0&&(s=e()),t["delete"]===!0)i.removeObject(s);else for(var l=i.getOrCreateObject(s),u=o.length-1;u>-1;u--)o[u](l,t,i,a)&&n[s]===void 0&&(n[s]=!0,r.push(l))}var o=function(e,t,o,a){if(e===void 0)throw new i("czml is required.");if(t===void 0)throw new i("dynamicObjectCollection is required.");var s=[],l={};if(a=a!==void 0?a:r.updaters,Array.isArray(e))for(var u=0,c=e.length;c>u;u++)n(e[u],t,s,l,a,o);else n(e,t,s,l,a,o);return s.length>0&&t.objectPropertiesChanged.raiseEvent(t,s),s};return o}),i("Renderer/Buffer",["../Core/DeveloperError","../Core/destroyObject"],function(e,t){var i=function(e,t,i,r,n){this._gl=e,this._bufferTarget=t,this._sizeInBytes=i,this._usage=r,this._buffer=n,this._vertexArrayDestroyable=!0};return i.prototype.copyFromArrayView=function(t,i){if(!t)throw new e("arrayView is required.");if(i=i||0,i+t.byteLength>this._sizeInBytes)throw new e("This buffer is not large enough.");var r=this._gl,n=this._bufferTarget;r.bindBuffer(n,this._buffer),r.bufferSubData(n,i,t),r.bindBuffer(n,null)},i.prototype._getBuffer=function(){return this._buffer},i.prototype.getSizeInBytes=function(){return this._sizeInBytes},i.prototype.getUsage=function(){return this._usage},i.prototype.getVertexArrayDestroyable=function(){return this._vertexArrayDestroyable},i.prototype.setVertexArrayDestroyable=function(e){this._vertexArrayDestroyable=e},i.prototype.isDestroyed=function(){return!1},i.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),t(this)},i}),i("Renderer/ClearCommand",["../Core/Color","../Core/freezeObject"],function(e,t){var i=function(){this.color=void 0,this.depth=void 0,this.stencil=void 0,this.renderState=void 0,this.framebuffer=void 0},r=new i;return r.color=new e(0,0,0,0),r.depth=1,r.stencil=0,i.ALL=t(r),i.prototype.execute=function(e,t){e.clear(this,t)},i}),i("Renderer/Framebuffer",["../Core/DeveloperError","../Core/destroyObject","./PixelFormat"],function(e,t,i){function r(e,t,i){e._bind();var r=e._gl;i?r.framebufferTexture2D(r.FRAMEBUFFER,t,i._getTarget(),i._getTexture(),0):r.framebufferTexture2D(r.FRAMEBUFFER,t,r.TEXTURE_2D,null,0),e._unBind()}function n(e,t,i){e._bind();var r=e._gl;i?r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,i._getRenderbuffer()):r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,null),e._unBind()}function o(e,t){e.destroyAttachments&&t&&t.destroy&&t.destroy()}var a=function(t,i){if(this._gl=t,this._framebuffer=t.createFramebuffer(),this._colorTexture=void 0,this._colorRenderbuffer=void 0,this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=!0,i){if(i.colorTexture&&i.colorRenderbuffer)throw new e("Cannot have both a color texture and color renderbuffer attachment.");if(i.depthTexture&&i.depthRenderbuffer)throw new e("Cannot have both a depth texture and depth renderbuffer attachment.");if(i.depthStencilTexture&&i.depthStencilRenderbuffer)throw new e("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");var r=i.depthTexture||i.depthRenderbuffer,n=i.depthStencilTexture||i.depthStencilRenderbuffer;
if(r&&n)throw new e("Cannot have both a depth and depth-stencil attachment.");if(i.stencilRenderbuffer&&n)throw new e("Cannot have both a stencil and depth-stencil attachment.");if(r&&i.stencilRenderbuffer)throw new e("Cannot have both a depth and stencil attachment.");i.colorTexture&&this.setColorTexture(i.colorTexture),i.colorRenderbuffer&&this.setColorRenderbuffer(i.colorRenderbuffer),i.depthTexture&&this.setDepthTexture(i.depthTexture),i.depthRenderbuffer&&this.setDepthRenderbuffer(i.depthRenderbuffer),i.stencilRenderbuffer&&this.setStencilRenderbuffer(i.stencilRenderbuffer),i.depthStencilTexture&&this.setDepthStencilTexture(i.depthStencilTexture),i.depthStencilRenderbuffer&&this.setDepthStencilRenderbuffer(i.depthStencilRenderbuffer)}};return a.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},a.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},a.prototype.setColorTexture=function(t){if(t&&!i.isColorFormat(t.getPixelFormat()))throw new e("The color-texture pixel-format must be a color format.");r(this,this._gl.COLOR_ATTACHMENT0,t),o(this,this._colorTexture),this._colorTexture=t},a.prototype.getColorTexture=function(){return this._colorTexture},a.prototype.setColorRenderbuffer=function(e){n(this,this._gl.COLOR_ATTACHMENT0,e),o(this,this._colorRenderbuffer),this._colorRenderbuffer=e},a.prototype.getColorRenderbuffer=function(){return this._colorRenderbuffer},a.prototype.setDepthTexture=function(t){if(t&&t.getPixelFormat()!==i.DEPTH_COMPONENT)throw new e("The depth-texture pixel-format must be DEPTH_COMPONENT.");r(this,this._gl.DEPTH_ATTACHMENT,t),o(this,this._depthTexture),this._depthTexture=t},a.prototype.getDepthTexture=function(){return this._depthTexture},a.prototype.setDepthRenderbuffer=function(e){n(this,this._gl.DEPTH_ATTACHMENT,e),o(this,this._depthRenderbuffer),this._depthRenderbuffer=e},a.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer},a.prototype.setStencilRenderbuffer=function(e){n(this,this._gl.STENCIL_ATTACHMENT,e),o(this,this._stencilRenderbuffer),this._stencilRenderbuffer=e},a.prototype.getStencilRenderbuffer=function(){return this._stencilRenderbuffer},a.prototype.setDepthStencilTexture=function(t){if(t&&t.getPixelFormat()!==i.DEPTH_STENCIL)throw new e("The depth-stencil pixel-format must be DEPTH_STENCIL.");r(this,this._gl.DEPTH_STENCIL_ATTACHMENT,t),o(this,this._depthStencilTexture),this._depthStencilTexture=t},a.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture},a.prototype.setDepthStencilRenderbuffer=function(e){n(this,this._gl.DEPTH_STENCIL_ATTACHMENT,e),o(this,this._depthStencilRenderbuffer),this._depthStencilRenderbuffer=e},a.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer},a.prototype.hasDepthAttachment=function(){return!!(this.getDepthTexture()||this.getDepthRenderbuffer()||this.getDepthStencilTexture()||this.getDepthStencilRenderbuffer())},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this.destroyAttachments&&(this._colorTexture=this._colorTexture&&this._colorTexture.destroy&&this._colorTexture.destroy(),this._colorRenderbuffer=this._colorRenderbuffer&&this._colorRenderbuffer.destroy(),this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),this._gl.deleteFramebuffer(this._framebuffer),t(this)},a}),i("Renderer/PixelDatatype",["../Core/Enumeration"],function(e){var t={UNSIGNED_BYTE:new e(5121,"UNSIGNED_BYTE"),UNSIGNED_SHORT:new e(5123,"UNSIGNED_SHORT"),UNSIGNED_INT:new e(5125,"UNSIGNED_INT"),UNSIGNED_INT_24_8_WEBGL:new e(34042,"UNSIGNED_INT_24_8_WEBGL"),UNSIGNED_SHORT_4_4_4_4:new e(32819,"UNSIGNED_SHORT_4_4_4_4"),UNSIGNED_SHORT_5_5_5_1:new e(32820,"UNSIGNED_SHORT_5_5_5_1"),UNSIGNED_SHORT_5_6_5:new e(33635,"UNSIGNED_SHORT_5_6_5"),validate:function(e){return e===t.UNSIGNED_BYTE||e===t.UNSIGNED_SHORT||e===t.UNSIGNED_INT||e===t.UNSIGNED_INT_24_8_WEBGL||e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5}};return t}),i("Renderer/PassState",[],function(){var e=function(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0};return e}),i("Renderer/RenderbufferFormat",["../Core/Enumeration"],function(e){var t={RGBA4:new e(32854,"RGBA4"),RGB5_A1:new e(32855,"RGB5_A1"),RGB565:new e(36194,"RGB565"),DEPTH_COMPONENT16:new e(33189,"DEPTH_COMPONENT16"),STENCIL_INDEX8:new e(36168,"STENCIL_INDEX8"),DEPTH_STENCIL:new e(34041,"DEPTH_STENCIL"),validate:function(e){return e===t.RGBA4||e===t.RGB5_A1||e===t.RGB565||e===t.DEPTH_COMPONENT16||e===t.STENCIL_INDEX8||e===t.DEPTH_STENCIL}};return t}),i("Renderer/PickFramebuffer",["../Core/defaultValue","../Core/destroyObject","../Core/Color","../Core/DeveloperError","../Core/BoundingRectangle","./ClearCommand","./PassState","./RenderbufferFormat"],function(e,t,i,r,n,o,a,s){var l=function(e){var t=new a(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new n};var r=new o;r.color=new i(0,0,0,0),r.depth=1,r.stencil=0,this._context=e,this._fb=void 0,this._passState=t,this._width=0,this._height=0,this._clearCommand=r};l.prototype.begin=function(e){var t=this._context,i=t.getCanvas().clientWidth,r=t.getCanvas().clientHeight;return n.clone(e,this._passState.scissorTest.rectangle),(this._fb===void 0||this._width!==i||this._height!==r)&&(this._width=i,this._height=r,this._fb=this._fb&&this._fb.destroy(),this._fb=t.createFramebuffer({colorTexture:t.createTexture2D({width:i,height:r}),depthRenderbuffer:t.createRenderbuffer({format:s.DEPTH_COMPONENT16})}),this._passState.framebuffer=this._fb),this._clearCommand.execute(t,this._passState),this._passState};var u=new i;return l.prototype.end=function(t){for(var r=e(t.width,1),n=e(t.height,1),o=this._context,a=o.readPixels({x:t.x,y:t.y,width:r,height:n,framebuffer:this._fb}),s=Math.max(r,n),l=s*s,c=Math.floor(.5*r),h=Math.floor(.5*n),d=0,m=0,p=0,f=-1,v=0;l>v;++v){if(d>=-c&&c>=d&&m>=-h&&h>=m){var g=4*((h-m)*r+d+c);u.red=i.byteToFloat(a[g]),u.green=i.byteToFloat(a[g+1]),u.blue=i.byteToFloat(a[g+2]),u.alpha=i.byteToFloat(a[g+3]);var _=o.getObjectByPickColor(u);if(_!==void 0)return _}if(d===m||0>d&&-d===m||d>0&&d===1-m){var y=p;p=-f,f=y}d+=p,m+=f}return void 0},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),t(this)},l}),i("Renderer/Renderbuffer",["../Core/DeveloperError","../Core/destroyObject"],function(e,t){function i(e,i,r,n){var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,i,r,n),e.bindRenderbuffer(e.RENDERBUFFER,null),this.getFormat=function(){return i},this.getWidth=function(){return r},this.getHeight=function(){return n},this._getRenderbuffer=function(){return o},this.isDestroyed=function(){return!1},this.destroy=function(){return e.deleteRenderbuffer(o),t(this)}}return i}),i("Renderer/DepthFunction",["../Core/Enumeration"],function(e){var t={NEVER:new e(512,"NEVER"),LESS:new e(513,"LESS"),EQUAL:new e(514,"EQUAL"),LESS_OR_EQUAL:new e(515,"LEQUAL"),GREATER:new e(516,"GREATER"),NOT_EQUAL:new e(517,"NOTEQUAL"),GREATER_OR_EQUAL:new e(518,"GEQUAL"),ALWAYS:new e(519,"ALWAYS"),validate:function(e){return e===t.NEVER||e===t.LESS||e===t.EQUAL||e===t.LESS_OR_EQUAL||e===t.GREATER||e===t.NOT_EQUAL||e===t.GREATER_OR_EQUAL||e===t.ALWAYS}};return t}),i("Renderer/StencilFunction",["../Core/Enumeration"],function(e){var t={NEVER:new e(512,"NEVER"),LESS:new e(513,"LESS"),EQUAL:new e(514,"EQUAL"),LESS_OR_EQUAL:new e(515,"LESS_OR_EQUAL"),GREATER:new e(516,"GREATER"),NOT_EQUAL:new e(517,"NOT_EQUAL"),GREATER_OR_EQUAL:new e(518,"GREATER_OR_EQUAL"),ALWAYS:new e(519,"ALWAYS"),validate:function(e){return e===t.NEVER||e===t.LESS||e===t.EQUAL||e===t.LESS_OR_EQUAL||e===t.GREATER||e===t.NOT_EQUAL||e===t.GREATER_OR_EQUAL||e===t.ALWAYS}};return t}),i("Renderer/StencilOperation",["../Core/Enumeration"],function(e){var t={ZERO:new e(0,"ZERO"),KEEP:new e(7680,"KEEP"),REPLACE:new e(7681,"REPLACE"),INCREMENT:new e(7682,"INCREMENT"),DECREMENT:new e(7683,"DECREMENT"),INVERT:new e(5386,"INVERT"),INCREMENT_WRAP:new e(34055,"INCREMENT_WRAP"),DECREMENT_WRAP:new e(34056,"DECREMENT_WRAP"),validate:function(e){return e===t.ZERO||e===t.KEEP||e===t.REPLACE||e===t.INCREMENT||e===t.DECREMENT||e===t.INVERT||e===t.INCREMENT_WRAP||e===t.DECREMENT_WRAP}};return t}),i("Renderer/RenderState",["../Core/Color","../Core/defaultValue","../Core/DeveloperError","../Core/BoundingRectangle","../Core/RuntimeError","../Core/WindingOrder","./CullFace","./DepthFunction","./BlendEquation","./BlendFunction","./StencilFunction","./StencilOperation"],function(e,t,i,r,n,o,a,s,l,u,c,h){function d(e,t,i){i?e.enable(t):e.disable(t)}function m(e,t){e.frontFace(t.frontFace)}function p(e,t){var i=t.cull,r=i.enabled;d(e,e.CULL_FACE,r),r&&e.cullFace(i.face)}function f(e,t){e.lineWidth(t.lineWidth)}function v(e,t){var i=t.polygonOffset,r=i.enabled;d(e,e.POLYGON_OFFSET_FILL,r),r&&e.polygonOffset(i.factor,i.units)}function g(e,t,i){var r=t.scissorTest,n=i.scissorTest!==void 0?i.scissorTest.enabled:r.enabled;if(d(e,e.SCISSOR_TEST,n),n){var o=i.scissorTest!==void 0?i.scissorTest.rectangle:r.rectangle;e.scissor(o.x,o.y,o.width,o.height)}}function _(e,t){var i=t.depthRange;e.depthRange(i.near,i.far)}function y(e,t){var i=t.depthTest,r=i.enabled;d(e,e.DEPTH_TEST,r),r&&e.depthFunc(i.func)}function w(e,t){var i=t.colorMask;e.colorMask(i.red,i.green,i.blue,i.alpha)}function C(e,t){e.depthMask(t.depthMask)}function x(e,t){e.stencilMask(t.stencilMask)}function T(e,t,i){var r=t.blending,n=i.blendingEnabled!==void 0?i.blendingEnabled:r.enabled;if(d(e,e.BLEND,n),n){var o=r.color,a=r.equationRgb,s=r.equationAlpha,l=r.functionSourceRgb,u=r.functionDestinationRgb,c=r.functionSourceAlpha,h=r.functionDestinationAlpha;e.blendColor(o.red,o.green,o.blue,o.alpha),e.blendEquationSeparate(a,s),e.blendFuncSeparate(l,u,c,h)}}function S(e,t){var i=t.stencilTest,r=i.enabled;if(d(e,e.STENCIL_TEST,r),r){var n=i.frontFunction,o=i.backFunction,a=i.reference,s=i.mask;e.stencilFunc(i.frontFunction,i.reference,i.mask),e.stencilFuncSeparate(e.BACK,o,a,s),e.stencilFuncSeparate(e.FRONT,n,a,s);var l=i.frontOperation,u=l.fail,c=l.zFail,h=l.zPass;e.stencilOpSeparate(e.FRONT,u,c,h);var m=i.backOperation,p=m.fail,f=m.zFail,v=m.zPass;e.stencilOpSeparate(e.BACK,p,f,v)}}function E(e,t){var i=t.sampleCoverage,r=i.enabled;d(e,e.SAMPLE_COVERAGE,r),r&&e.sampleCoverage(i.value,i.invert)}function b(e,t){d(e,e.DITHER,t.dither)}function M(e,t,i){var r=t.viewport;if(r===void 0){var n=i.context.getCanvas();r=A,r.width=n.clientWidth,r.height=n.clientHeight}i.context.getUniformState().setViewport(r),e.viewport(r.x,r.y,r.width,r.height)}function I(e,t){var i=[];return e.frontFace!==t.frontFace&&i.push(m),(e.cull.enabled!==t.cull.enabled||e.cull.face!==t.cull.face)&&i.push(p),e.lineWidth!==t.lineWidth&&i.push(f),(e.polygonOffset.enabled!==t.polygonOffset.enabled||e.polygonOffset.factor!==t.polygonOffset.factor||e.polygonOffset.units!==t.polygonOffset.units)&&i.push(v),i.push(g),(e.depthRange.near!==t.depthRange.near||e.depthRange.far!==t.depthRange.far)&&i.push(_),(e.depthTest.enabled!==t.depthTest.enabled||e.depthTest.func!==t.depthTest.func)&&i.push(y),(e.colorMask.red!==t.colorMask.red||e.colorMask.green!==t.colorMask.green||e.colorMask.blue!==t.colorMask.blue||e.colorMask.alpha!==t.colorMask.alpha)&&i.push(w),e.depthMask!==t.depthMask&&i.push(C),i.push(T),e.stencilMask!==t.stencilMask&&i.push(x),(e.stencilTest.enabled!==t.stencilTest.enabled||e.stencilTest.frontFunction!==t.stencilTest.frontFunction||e.stencilTest.backFunction!==t.stencilTest.backFunction||e.stencilTest.reference!==t.stencilTest.reference||e.stencilTest.mask!==t.stencilTest.mask||e.stencilTest.frontOperation.fail!==t.stencilTest.frontOperation.fail||e.stencilTest.frontOperation.zFail!==t.stencilTest.frontOperation.zFail||e.stencilTest.backOperation.fail!==t.stencilTest.backOperation.fail||e.stencilTest.backOperation.zFail!==t.stencilTest.backOperation.zFail||e.stencilTest.backOperation.zPass!==t.stencilTest.backOperation.zPass)&&i.push(S),(e.sampleCoverage.enabled!==t.sampleCoverage.enabled||e.sampleCoverage.value!==t.sampleCoverage.value||e.sampleCoverage.invert!==t.sampleCoverage.invert)&&i.push(E),e.dither!==t.dither&&i.push(b),i.push(M),i}var D=function(d,m){var p=t(m,{}),f=t(p.cull,{}),v=t(p.polygonOffset,{}),g=t(p.scissorTest,{}),_=t(g.rectangle,{}),y=t(p.depthRange,{}),w=t(p.depthTest,{}),C=t(p.colorMask,{}),x=t(p.blending,{}),T=t(x.color,{}),S=t(p.stencilTest,{}),E=t(S.frontOperation,{}),b=t(S.backOperation,{}),M=t(p.sampleCoverage,{}),I=p.viewport;if(this.frontFace=t(p.frontFace,o.COUNTER_CLOCKWISE),this.cull={enabled:t(f.enabled,!1),face:t(f.face,a.BACK)},this.lineWidth=t(p.lineWidth,1),this.polygonOffset={enabled:t(v.enabled,!1),factor:t(v.factor,0),units:t(v.units,0)},this.scissorTest={enabled:t(g.enabled,!1),rectangle:r.clone(_)},this.depthRange={near:t(y.near,0),far:t(y.far,1)},this.depthTest={enabled:t(w.enabled,!1),func:t(w.func,s.LESS)},this.colorMask={red:t(C.red,!0),green:t(C.green,!0),blue:t(C.blue,!0),alpha:t(C.alpha,!0)},this.depthMask=t(p.depthMask,!0),this.stencilMask=t(p.stencilMask,-1),this.blending={enabled:t(x.enabled,!1),color:new e(t(T.red,0),t(T.green,0),t(T.blue,0),t(T.alpha,0)),equationRgb:t(x.equationRgb,l.ADD),equationAlpha:t(x.equationAlpha,l.ADD),functionSourceRgb:t(x.functionSourceRgb,u.ONE),functionSourceAlpha:t(x.functionSourceAlpha,u.ONE),functionDestinationRgb:t(x.functionDestinationRgb,u.ZERO),functionDestinationAlpha:t(x.functionDestinationAlpha,u.ZERO)},this.stencilTest={enabled:t(S.enabled,!1),frontFunction:t(S.frontFunction,c.ALWAYS),backFunction:t(S.backFunction,c.ALWAYS),reference:t(S.reference,0),mask:t(S.mask,-1),frontOperation:{fail:t(E.fail,h.KEEP),zFail:t(E.zFail,h.KEEP),zPass:t(E.zPass,h.KEEP)},backOperation:{fail:t(b.fail,h.KEEP),zFail:t(b.zFail,h.KEEP),zPass:t(b.zPass,h.KEEP)}},this.sampleCoverage={enabled:t(M.enabled,!1),value:t(M.value,1),invert:t(M.invert,!1)},this.dither=t(p.dither,!0),this.viewport=I!==void 0?new r(I.x,I.y,I.width===void 0?d.getCanvas().clientWidth:I.width,I.height===void 0?d.getCanvas().clientHeight:I.height):void 0,!o.validate(this.frontFace))throw new i("Invalid renderState.frontFace.");if(!a.validate(this.cull.face))throw new i("Invalid renderState.cull.face.");if(d.getMinimumAliasedLineWidth()>this.lineWidth||this.lineWidth>d.getMaximumAliasedLineWidth())throw new n("renderState.lineWidth is out of range.  Check getMinimumAliasedLineWidth() and getMaximumAliasedLineWidth().");if(0>this.scissorTest.rectangle.width||0>this.scissorTest.rectangle.height)throw new i("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new i("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(0>this.depthRange.near)throw new i("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new i("renderState.depthRange.far must be less than or equal to one.");if(!s.validate(this.depthTest.func))throw new i("Invalid renderState.depthTest.func.");if(0>this.blending.color.red||this.blending.color.red>1||0>this.blending.color.green||this.blending.color.green>1||0>this.blending.color.blue||this.blending.color.blue>1||0>this.blending.color.alpha||this.blending.color.alpha>1)throw new i("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!l.validate(this.blending.equationRgb))throw new i("Invalid renderState.blending.equationRgb.");if(!l.validate(this.blending.equationAlpha))throw new i("Invalid renderState.blending.equationAlpha.");if(!u.validate(this.blending.functionSourceRgb))throw new i("Invalid renderState.blending.functionSourceRgb.");if(!u.validate(this.blending.functionSourceAlpha))throw new i("Invalid renderState.blending.functionSourceAlpha.");if(!u.validate(this.blending.functionDestinationRgb))throw new i("Invalid renderState.blending.functionDestinationRgb.");if(!u.validate(this.blending.functionDestinationAlpha))throw new i("Invalid renderState.blending.functionDestinationAlpha.");if(!c.validate(this.stencilTest.frontFunction))throw new i("Invalid renderState.stencilTest.frontFunction.");if(!c.validate(this.stencilTest.backFunction))throw new i("Invalid renderState.stencilTest.backFunction.");if(!h.validate(this.stencilTest.frontOperation.fail))throw new i("Invalid renderState.stencilTest.frontOperation.fail.");if(!h.validate(this.stencilTest.frontOperation.zFail))throw new i("Invalid renderState.stencilTest.frontOperation.zFail.");if(!h.validate(this.stencilTest.frontOperation.zPass))throw new i("Invalid renderState.stencilTest.frontOperation.zPass.");if(!h.validate(this.stencilTest.backOperation.fail))throw new i("Invalid renderState.stencilTest.backOperation.fail.");if(!h.validate(this.stencilTest.backOperation.zFail))throw new i("Invalid renderState.stencilTest.backOperation.zFail.");if(!h.validate(this.stencilTest.backOperation.zPass))throw new i("Invalid renderState.stencilTest.backOperation.zPass.");if(this.viewport!==void 0){if(0>this.viewport.width)throw new i("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.width>d.getMaximumViewportWidth())throw new n("renderState.viewport.width must be less than or equal to the maximum viewport width ("+(""+this.getMaximumViewportWidth())+").  Check getMaximumViewportWidth().");if(0>this.viewport.height)throw new i("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.height>d.getMaximumViewportHeight())throw new n("renderState.viewport.height must be less than or equal to the maximum viewport height ("+(""+this.getMaximumViewportHeight())+").  Check getMaximumViewportHeight().")}this.id=0,this._applyFunctions=[]},A=new r;return D.apply=function(e,t,i){m(e,t),p(e,t),f(e,t),v(e,t),g(e,t,i),_(e,t),y(e,t),w(e,t),C(e,t),x(e,t),T(e,t,i),S(e,t),E(e,t),b(e,t),M(e,t,i)},D.partialApply=function(e,t,i,r){var n=i._applyFunctions[t.id];n===void 0&&(n=I(t,i),i._applyFunctions[t.id]=n);for(var o=n.length,a=0;o>a;++a)n[a](e,i,r)},D}),i("Renderer/ShaderCache",["../Core/destroyObject"],function(e){var t=function(e){this._context=e,this._shaders={},this._shadersToRelease={}};return t.prototype.replaceShaderProgram=function(e,t,i,r){return e!==void 0&&e.release(),this.getShaderProgram(t,i,r)},t.prototype.getShaderProgram=function(e,t,i){var r,n=e+t;if(this._shaders[n])r=this._shaders[n];else{var o=this._context.createShaderProgram(e,t,i);r={cache:this,shaderProgram:o,keyword:n,count:0},o._cachedShader=r,this._shaders[n]=r}return++r.count,r.shaderProgram},t.prototype.destroyReleasedShaderPrograms=function(){var e=this._shadersToRelease;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];0===i.count&&(delete this._shaders[i.keyword],i.shaderProgram.destroy())}this._shadersToRelease={}},t.prototype.releaseShaderProgram=function(e){if(e){var t=e._cachedShader;t&&0===--t.count&&(this._shadersToRelease[t.keyword]=t)}return void 0},t.prototype.isDestroyed=function(){return!1},t.prototype.destroy=function(){var t=this._shaders;for(var i in t)t.hasOwnProperty(i)&&t[i].shaderProgram.destroy();return e(this)},t}),i("Renderer/UniformDatatype",["../Core/Enumeration"],function(e){var t={FLOAT:new e(5126,"FLOAT",{getGLSL:function(){return"float"}}),FLOAT_VECTOR2:new e(35664,"FLOAT_VECTOR2",{getGLSL:function(){return"vec2"}}),FLOAT_VECTOR3:new e(35665,"FLOAT_VECTOR3",{getGLSL:function(){return"vec3"}}),FLOAT_VECTOR4:new e(35666,"FLOAT_VECTOR4",{getGLSL:function(){return"vec4"}}),INT:new e(5124,"INT",{getGLSL:function(){return"int"}}),INT_VECTOR2:new e(35667,"INT_VECTOR2",{getGLSL:function(){return"ivec2"}}),INT_VECTOR3:new e(35668,"INT_VECTOR3",{getGLSL:function(){return"ivec3"}}),INT_VECTOR4:new e(35669,"INT_VECTOR4",{getGLSL:function(){return"ivec4"}}),BOOL:new e(35670,"BOOL",{getGLSL:function(){return"bool"}}),BOOL_VECTOR2:new e(35671,"BOOL_VECTOR2",{getGLSL:function(){return"bvec2"}}),BOOL_VECTOR3:new e(35672,"BOOL_VECTOR3",{getGLSL:function(){return"bvec3"}}),BOOL_VECTOR4:new e(35673,"BOOL_VECTOR4",{getGLSL:function(){return"bvec4"}}),FLOAT_MATRIX2:new e(35674,"FLOAT_MATRIX2",{getGLSL:function(){return"mat2"}}),FLOAT_MATRIX3:new e(35675,"FLOAT_MATRIX3",{getGLSL:function(){return"mat3"}}),FLOAT_MATRIX4:new e(35676,"FLOAT_MATRIX4",{getGLSL:function(){return"mat4"}}),SAMPLER_2D:new e(35678,"SAMPLER_2D",{getGLSL:function(){return"sampler2D"}}),SAMPLER_CUBE:new e(35680,"SAMPLER_CUBE",{getGLSL:function(){return"samplerCube"}})};return t}),i("Shaders/BuiltinFunctions",[],function(){return"const float czm_infinity = 5906376272000.0;\nconst float czm_epsilon1 = 0.1;\nconst float czm_epsilon2 = 0.01;\nconst float czm_epsilon3 = 0.001;\nconst float czm_epsilon4 = 0.0001;\nconst float czm_epsilon5 = 0.00001;\nconst float czm_epsilon6 = 0.000001;\nconst float czm_epsilon7 = 0.0000001;\nbool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) <= epsilon);\n}\nbool czm_equalsEpsilon(float left, float right) {\nreturn (abs(left - right) <= czm_epsilon7);\n}\nmat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\nvec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q = czm_modelViewProjection * position;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\nvec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q = czm_projection * positionEC;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q = vec4(x, y, z, 1.0);\nq /= fragmentCoordinate.w;\nq = czm_inverseProjection * q;\nreturn q;\n}\nvec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p = positionEC;\nvec4 zEyeOffset = normalize(p) * eyeOffset.z;\np.xy += eyeOffset.xy + zEyeOffset.xy;\np.z += zEyeOffset.z;\nreturn p;\n}\nvec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\nvec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\nmat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC = normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC = normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\nstruct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\n};\nstruct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\nczm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse = vec3(0.0);\nmaterial.specular = 0.0;\nmaterial.shininess = 1.0;\nmaterial.normal = materialInput.normalEC;\nmaterial.emission = vec3(0.0);\nmaterial.alpha = 1.0;\nreturn material;\n}\nfloat getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\nfloat getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\nfloat specular = max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, shininess);\n}\nfloat getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\nfloat diffuse = getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material) + getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\nfloat specular = getSpecularOfMaterial(czm_sunDirectionEC, toEye, material) + getSpecularOfMaterial(czm_moonDirectionEC, toEye, material);\nvec3 ambient = vec3(0.0);\nvec3 color = ambient + material.emission;\ncolor += material.diffuse * diffuse;\ncolor += material.specular * specular;\nreturn vec4(color, material.alpha);\n}\nfloat czm_luminance(vec3 rgb)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\nvec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq = toYIQ * rgb;\nfloat hue = atan(yiq.z, yiq.y) + adjustment;\nfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\nvec3 czm_saturation(vec3 rgb, float adjustment)\n{\nvec3 intensity = vec3(czm_luminance(rgb));\nreturn mix(intensity, rgb, adjustment);\n}\nvec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 target = left * right;\nfloat leftLuminance = dot(left, W);\nfloat rightLuminance = dot(right, W);\nfloat targetLuminance = dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 = val1 * (1.0 - val2);\nval1 = val1 * val1 * (3.0 - (2.0 * val1));\nval1 = pow(val1, 0.5);\nvec4 midColor = (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\nconst float czm_webMercatorMaxLatitude = 1.4844222297453323669610967939;\nconst int czm_scene2D = 0;\nconst int czm_columbusView = 1;\nconst int czm_scene3D = 2;\nconst int czm_morphing = 3;\nvec4 czm_columbusViewMorph(vec3 position2D, vec3 position3D, float time)\n{\nvec3 p = mix(position2D, position3D, time);\nreturn vec4(p, 1.0);\n}\nstruct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\nvec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\nstruct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\nbool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop < 0.0);\n}\nbool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start == 0.0 && interval.stop == czm_infinity);\n}\nstruct czm_ellipsoid\n{\nvec3 center;\nvec3 radii;\nvec3 inverseRadii;\nvec3 inverseRadiiSquared;\n};\nczm_ellipsoid czm_ellipsoidNew(vec3 center, vec3 radii)\n{\nvec3 inverseRadii = vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared = inverseRadii * inverseRadii;\nczm_ellipsoid temp = czm_ellipsoid(center, radii, inverseRadii, inverseRadiiSquared);\nreturn temp;\n}\nbool czm_ellipsoidContainsPoint(czm_ellipsoid ellipsoid, vec3 point)\n{\nvec3 scaled = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) <= 1.0);\n}\nczm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, czm_ellipsoid ellipsoid)\n{\nvec3 q = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq = q - ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ellipsoid.center, 1.0)).xyz;\nfloat q2 = dot(q, q);\nfloat qw = dot(q, w);\nif (q2 > 1.0)\n{\nif (qw >= 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 = qw * qw;\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nif (qw2 < product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 > product)\n{\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nfloat root0 = temp / w2;\nfloat root1 = difference / temp;\nif (root0 < root1)\n{\nczm_raySegment i = czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i = czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root = sqrt(difference / w2);\nczm_raySegment i = czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 < 1.0)\n{\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nczm_raySegment i = czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw < 0.0)\n{\nfloat w2 = dot(w, w);\nczm_raySegment i = czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\nczm_ellipsoid czm_getWgs84EllipsoidEC()\n{\nreturn czm_ellipsoidNew(\nczm_view[3].xyz,\nvec3(6378137.0, 6378137.0, 6356752.314245));\n}\nfloat czm_latitudeToWebMercatorFraction(float latitude, float southMercatorYLow, float southMercatorYHigh, float oneOverMercatorHeight)\n{\nfloat sinLatitude = sin(latitude);\nfloat mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nfloat t1 = 0.0 - southMercatorYLow;\nfloat e = t1 - 0.0;\nfloat t2 = ((-southMercatorYLow - e) + (0.0 - (t1 - e))) + mercatorY - southMercatorYHigh;\nfloat highDifference = t1 + t2;\nfloat lowDifference = t2 - (highDifference - t1);\nreturn highDifference * oneOverMercatorHeight + lowDifference * oneOverMercatorHeight;\n}\nvec3 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference = high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference = low - czm_encodedCameraPositionMCLow;\nreturn highDifference + lowDifference;\n}\nvec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle = cos(angleInRadians);\nfloat sinAngle = sin(angleInRadians);\nvec2 s0 = vec2(1.0/17.0, 0.0);\nvec2 s1 = vec2(-1.0/29.0, 0.0);\nvec2 s2 = vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\ns0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 = (uv/103.0) + (time * s0);\nvec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 = fract(uv0);\nuv1 = fract(uv1);\nuv2 = fract(uv2);\nuv3 = fract(uv3);\nvec4 noise = (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\nvec4 _czm_mod289(vec4 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 _czm_mod289(vec3 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 _czm_mod289(vec2 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfloat _czm_mod289(float x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 _czm_permute(vec4 x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nvec3 _czm_permute(vec3 x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nfloat _czm_permute(float x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nvec4 _czm_taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat _czm_taylorInvSqrt(float r)\n{\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nvec4 _czm_grad4(float j, vec4 ip)\n{\nconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\nvec4 p,s;\np.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\np.w = 1.5 - dot(abs(p.xyz), ones.xyz);\ns = vec4(lessThan(p, vec4(0.0)));\np.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\nreturn p;\n}\nfloat czm_snoise(vec2 v)\n{\nconst vec4 C = vec4(0.211324865405187,\n0.366025403784439,\n-0.577350269189626,\n0.024390243902439);\nvec2 i  = floor(v + dot(v, C.yy) );\nvec2 x0 = v -   i + dot(i, C.xx);\nvec2 i1;\ni1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\nvec4 x12 = x0.xyxy + C.xxzz;\nx12.xy -= i1;\ni = _czm_mod289(i);\nvec3 p = _czm_permute( _czm_permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\nvec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\nm = m*m ;\nm = m*m ;\nvec3 x = 2.0 * fract(p * C.www) - 1.0;\nvec3 h = abs(x) - 0.5;\nvec3 ox = floor(x + 0.5);\nvec3 a0 = x - ox;\nm *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\nvec3 g;\ng.x  = a0.x  * x0.x  + h.x  * x0.y;\ng.yz = a0.yz * x12.xz + h.yz * x12.yw;\nreturn 130.0 * dot(m, g);\n}\nfloat czm_snoise(vec3 v)\n{\nconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\nconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\nvec3 i  = floor(v + dot(v, C.yyy) );\nvec3 x0 =   v - i + dot(i, C.xxx) ;\nvec3 g = step(x0.yzx, x0.xyz);\nvec3 l = 1.0 - g;\nvec3 i1 = min( g.xyz, l.zxy );\nvec3 i2 = max( g.xyz, l.zxy );\nvec3 x1 = x0 - i1 + C.xxx;\nvec3 x2 = x0 - i2 + C.yyy;\nvec3 x3 = x0 - D.yyy;\ni = _czm_mod289(i);\nvec4 p = _czm_permute( _czm_permute( _czm_permute(\ni.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\nfloat n_ = 0.142857142857;\nvec3  ns = n_ * D.wyz - D.xzx;\nvec4 j = p - 49.0 * floor(p * ns.z * ns.z);\nvec4 x_ = floor(j * ns.z);\nvec4 y_ = floor(j - 7.0 * x_ );\nvec4 x = x_ *ns.x + ns.yyyy;\nvec4 y = y_ *ns.x + ns.yyyy;\nvec4 h = 1.0 - abs(x) - abs(y);\nvec4 b0 = vec4( x.xy, y.xy );\nvec4 b1 = vec4( x.zw, y.zw );\nvec4 s0 = floor(b0)*2.0 + 1.0;\nvec4 s1 = floor(b1)*2.0 + 1.0;\nvec4 sh = -step(h, vec4(0.0));\nvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\nvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\nvec3 p0 = vec3(a0.xy,h.x);\nvec3 p1 = vec3(a0.zw,h.y);\nvec3 p2 = vec3(a1.xy,h.z);\nvec3 p3 = vec3(a1.zw,h.w);\nvec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\nvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\nm = m * m;\nreturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\ndot(p2,x2), dot(p3,x3) ) );\n}\nfloat czm_snoise(vec4 v)\n{\nconst vec4  C = vec4( 0.138196601125011,\n0.276393202250021,\n0.414589803375032,\n-0.447213595499958);\n#define F4 0.309016994374947451\nvec4 i  = floor(v + dot(v, vec4(F4)) );\nvec4 x0 = v -   i + dot(i, C.xxxx);\nvec4 i0;\nvec3 isX = step( x0.yzw, x0.xxx );\nvec3 isYZ = step( x0.zww, x0.yyz );\ni0.x = isX.x + isX.y + isX.z;\ni0.yzw = 1.0 - isX;\ni0.y += isYZ.x + isYZ.y;\ni0.zw += 1.0 - isYZ.xy;\ni0.z += isYZ.z;\ni0.w += 1.0 - isYZ.z;\nvec4 i3 = clamp( i0, 0.0, 1.0 );\nvec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\nvec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\nvec4 x1 = x0 - i1 + C.xxxx;\nvec4 x2 = x0 - i2 + C.yyyy;\nvec4 x3 = x0 - i3 + C.zzzz;\nvec4 x4 = x0 + C.wwww;\ni = _czm_mod289(i);\nfloat j0 = _czm_permute( _czm_permute( _czm_permute( _czm_permute(i.w) + i.z) + i.y) + i.x);\nvec4 j1 = _czm_permute( _czm_permute( _czm_permute( _czm_permute (\ni.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n+ i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n+ i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n+ i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\nvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\nvec4 p0 = _czm_grad4(j0,   ip);\nvec4 p1 = _czm_grad4(j1.x, ip);\nvec4 p2 = _czm_grad4(j1.y, ip);\nvec4 p3 = _czm_grad4(j1.z, ip);\nvec4 p4 = _czm_grad4(j1.w, ip);\nvec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\np4 *= _czm_taylorInvSqrt(dot(p4,p4));\nvec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\nvec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\nm0 = m0 * m0;\nm1 = m1 * m1;\nreturn 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n+ dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\nvec3 _czm_permute289(vec3 x)\n{\nreturn mod((34.0 * x + 1.0) * x, 289.0);\n}\nvec2 czm_cellular(vec2 P)\n{\n#define K 0.142857142857\n#define Ko 0.428571428571\n#define jitter 1.0\nvec2 Pi = mod(floor(P), 289.0);\nvec2 Pf = fract(P);\nvec3 oi = vec3(-1.0, 0.0, 1.0);\nvec3 of = vec3(-0.5, 0.5, 1.5);\nvec3 px = _czm_permute289(Pi.x + oi);\nvec3 p = _czm_permute289(px.x + Pi.y + oi);\nvec3 ox = fract(p*K) - Ko;\nvec3 oy = mod(floor(p*K),7.0)*K - Ko;\nvec3 dx = Pf.x + 0.5 + jitter*ox;\nvec3 dy = Pf.y - of + jitter*oy;\nvec3 d1 = dx * dx + dy * dy;\np = _czm_permute289(px.y + Pi.y + oi);\nox = fract(p*K) - Ko;\noy = mod(floor(p*K),7.0)*K - Ko;\ndx = Pf.x - 0.5 + jitter*ox;\ndy = Pf.y - of + jitter*oy;\nvec3 d2 = dx * dx + dy * dy;\np = _czm_permute289(px.z + Pi.y + oi);\nox = fract(p*K) - Ko;\noy = mod(floor(p*K),7.0)*K - Ko;\ndx = Pf.x - 1.5 + jitter*ox;\ndy = Pf.y - of + jitter*oy;\nvec3 d3 = dx * dx + dy * dy;\nvec3 d1a = min(d1, d2);\nd2 = max(d1, d2);\nd2 = min(d2, d3);\nd1 = min(d1a, d2);\nd2 = max(d1a, d2);\nd1.xy = (d1.x < d1.y) ? d1.xy : d1.yx;\nd1.xz = (d1.x < d1.z) ? d1.xz : d1.zx;\nd1.yz = min(d1.yz, d2.yz);\nd1.y = min(d1.y, d1.z);\nd1.y = min(d1.y, d2.x);\nreturn sqrt(d1.xy);\n}\n"
}),i("Renderer/ShaderProgram",["../Core/DeveloperError","../Core/RuntimeError","../Core/destroyObject","../Core/Math","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","./UniformDatatype","../Shaders/BuiltinFunctions"],function(e,t,i,r,n,o,a,s,l){function u(e,i){switch(i){case e.FLOAT:return function(){return s.FLOAT};case e.FLOAT_VEC2:return function(){return s.FLOAT_VECTOR2};case e.FLOAT_VEC3:return function(){return s.FLOAT_VECTOR3};case e.FLOAT_VEC4:return function(){return s.FLOAT_VECTOR4};case e.INT:return function(){return s.INT};case e.INT_VEC2:return function(){return s.INT_VECTOR2};case e.INT_VEC3:return function(){return s.INT_VECTOR3};case e.INT_VEC4:return function(){return s.INT_VECTOR4};case e.BOOL:return function(){return s.BOOL};case e.BOOL_VEC2:return function(){return s.BOOL_VECTOR2};case e.BOOL_VEC3:return function(){return s.BOOL_VECTOR3};case e.BOOL_VEC4:return function(){return s.BOOL_VECTOR4};case e.FLOAT_MAT2:return function(){return s.FLOAT_MATRIX2};case e.FLOAT_MAT3:return function(){return s.FLOAT_MATRIX3};case e.FLOAT_MAT4:return function(){return s.FLOAT_MATRIX4};case e.SAMPLER_2D:return function(){return s.SAMPLER_2D};case e.SAMPLER_CUBE:return function(){return s.SAMPLER_CUBE};default:throw new t("Unrecognized uniform type: "+i)}}function c(e){var t=e.indexOf("#version");if(-1!==t){var i=e.indexOf("\n",t);if(-1!==t){var r=e.substring(t,i+1),n=e.substring(0,t)+"//"+e.substring(t);return{versionDirective:r,modifiedSource:n}}}return{versionDirective:"",modifiedSource:e}}function h(e,t){var i=e[t],r="uniform "+i.getDatatype().getGLSL()+" "+t,n=i.getSize();return r+=1===n?";":"["+(""+n)+"];"}function d(e){var t=e,i=T;for(var r in i)if(i.hasOwnProperty(r)){var n=h(i,r),o=t.indexOf(n);-1!==o&&(t=t.substring(0,o)+"/*"+t.substring(o,n.length)+"*/"+t.substring(o+n.length))}return t}function m(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH \n  precision highp float; \n#else \n  precision mediump float; \n#endif \n\n"}function p(){var e={czm_pi:""+Math.PI,czm_oneOverPi:""+r.ONE_OVER_PI,czm_piOverTwo:""+r.PI_OVER_TWO,czm_piOverThree:""+r.PI_OVER_THREE,czm_piOverFour:""+r.PI_OVER_FOUR,czm_piOverSix:""+r.PI_OVER_SIX,czm_threePiOver2:""+r.THREE_PI_OVER_TWO,czm_twoPi:""+r.TWO_PI,czm_oneOverTwoPi:""+r.ONE_OVER_TWO_PI,czm_radiansPerDegree:""+r.RADIANS_PER_DEGREE,czm_degreesPerRadian:""+r.DEGREES_PER_RADIAN},t="";for(var i in e)e.hasOwnProperty(i)&&(t+="const float "+i+" = "+e[i]+"; \n");return t+=" \n"}function f(){var e="",t=T;for(var i in t)t.hasOwnProperty(i)&&(e+=h(t,i)+" \n");return e+="\n"}function v(e,i,r,n,o){var a=c(r),s=c(n),l=a.versionDirective+M()+d(a.modifiedSource),u=s.versionDirective+m()+M()+d(s.modifiedSource),h=e.createShader(e.VERTEX_SHADER);e.shaderSource(h,l),e.compileShader(h);var p=e.getShaderInfoLog(h);if(i&&p&&p.length&&console.log("[GL] Vertex shader compile log: "+p),!e.getShaderParameter(h,e.COMPILE_STATUS))throw e.deleteShader(h),console.error("[GL] Vertex shader compile log: "+p),new t("Vertex shader failed to compile.  Compile log: "+p);var f=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(f,u),e.compileShader(f);var v=e.getShaderInfoLog(f);if(i&&v&&v.length&&console.log("[GL] Fragment shader compile log: "+v),!e.getShaderParameter(f,e.COMPILE_STATUS))throw e.deleteShader(h),e.deleteShader(f),console.error("[GL] Fragment shader compile log: "+v),new t("Fragment shader failed to compile.  Compile log: "+v);var g=e.createProgram();if(e.attachShader(g,h),e.attachShader(g,f),e.deleteShader(h),e.deleteShader(f),o)for(var _ in o)o.hasOwnProperty(_)&&e.bindAttribLocation(g,o[_],_);e.linkProgram(g);var y=e.getProgramInfoLog(g);if(i&&y&&y.length&&console.log("[GL] Shader program link log: "+y),!e.getProgramParameter(g,e.LINK_STATUS))throw e.deleteProgram(g),console.error("[GL] Shader program link log: "+y),new t("Program failed to link.  Link log: "+y);return g}function g(e,t,i){for(var r={},n=0;i>n;++n){var o=e.getActiveAttrib(t,n),a=e.getAttribLocation(t,o.name);r[o.name]={name:o.name,type:o.type,index:a}}return r}function _(e,t){for(var i={},r=[],n=[],o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;o>a;++a){var s=e.getActiveUniform(t,a),l="[0]",u=-1!==s.name.indexOf(l,s.name.length-l.length)?s.name.slice(0,s.name.length-3):s.name;if(0!==u.indexOf("gl_"))if(0>s.name.indexOf("[")){var c=e.getUniformLocation(t,u),h=e.getUniform(t,c),d=new S(e,s,u,c,h);i[u]=d,d._setSampler?n.push(d):r.push(d)}else{var m,p,f,v,g=u.indexOf("[");if(g>=0)m=i[u.slice(0,g)],p=m._getLocations(),1>=p.length&&(f=m.value,v=e.getUniformLocation(t,u),p.push(v),f.push(e.getUniform(t,v)));else{p=[],f=[];for(var _=0;s.size>_;++_)v=e.getUniformLocation(t,u+"["+_+"]"),p.push(v),f.push(e.getUniform(t,v));m=new E(e,s,u,p,f),i[u]=m,m._setSampler?n.push(m):r.push(m)}}}return{allUniforms:i,uniforms:r,samplerUniforms:n}}function y(e){var t=[],i={};for(var r in e)if(e.hasOwnProperty(r)){var n=T[r];n?t.push({uniform:e[r],automaticUniform:n}):i[r]=e[r]}return{automaticUniforms:t,manualUniforms:i}}var w,C,x,T={czm_viewport:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR4},getValue:function(e){var t=e.getViewport();return{x:t.x,y:t.y,z:t.width,w:t.height}}},czm_viewportOrthographic:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getViewportOrthographic()}},czm_viewportTransformation:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getViewportTransformation()}},czm_model:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModel()}},czm_inverseModel:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseModel()}},czm_view:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getView()}},czm_view3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getView3D()}},czm_viewRotation:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getViewRotation()}},czm_viewRotation3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getViewRotation3D()}},czm_inverseView:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseView()}},czm_inverseView3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseView3D()}},czm_inverseViewRotation:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getInverseViewRotation()}},czm_inverseViewRotation3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getInverseViewRotation3D()}},czm_projection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getProjection()}},czm_inverseProjection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseProjection()}},czm_infiniteProjection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInfiniteProjection()}},czm_modelView:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelView()}},czm_modelView3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelView3D()}},czm_modelViewRelativeToEye:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelViewRelativeToEye()}},czm_inverseModelView:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseModelView()}},czm_inverseModelView3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getInverseModelView3D()}},czm_viewProjection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getViewProjection()}},czm_modelViewProjection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelViewProjection()}},czm_modelViewProjectionRelativeToEye:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelViewProjectionRelativeToEye()}},czm_modelViewInfiniteProjection:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX4},getValue:function(e){return e.getModelViewInfiniteProjection()}},czm_normal:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getNormal()}},czm_normal3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getNormal3D()}},czm_inverseNormal:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getInverseNormal()}},czm_inverseNormal3D:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getInverseNormal3D()}},czm_entireFrustum:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR2},getValue:function(e){return e.getEntireFrustum()}},czm_currentFrustum:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR2},getValue:function(e){return e.getCurrentFrustum()}},czm_pixelSizeInMeters:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT},getValue:function(e){return e.getPixelSize()}},czm_sunDirectionEC:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getSunDirectionEC()}},czm_sunDirectionWC:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getSunDirectionWC()}},czm_moonDirectionEC:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getMoonDirectionEC()}},czm_encodedCameraPositionMCHigh:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getEncodedCameraPositionMCHigh()}},czm_encodedCameraPositionMCLow:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getEncodedCameraPositionMCLow()}},czm_viewerPositionWC:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_VECTOR3},getValue:function(e){return e.getInverseView().getTranslation()}},czm_frameNumber:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT},getValue:function(e){return e.getFrameNumber()}},czm_temeToPseudoFixed:{getSize:function(){return 1},getDatatype:function(){return s.FLOAT_MATRIX3},getValue:function(e){return e.getTemeToPseudoFixedMatrix()}}};"undefined"!=typeof Float32Array&&(w=new Float32Array(4),C=new Float32Array(9),x=new Float32Array(16));var S=function(i,r,s,l,c){this.value=c,this.getName=function(){return s},this.getDatatype=u(i,r.type),this._getLocation=function(){return l},this._set=function(){switch(r.type){case i.FLOAT:return function(){i.uniform1f(l,this.value)};case i.FLOAT_VEC2:return function(){var e=this.value;i.uniform2f(l,e.x,e.y)};case i.FLOAT_VEC3:return function(){var e=this.value;i.uniform3f(l,e.x,e.y,e.z)};case i.FLOAT_VEC4:return function(){var t=this.value;if(t.red!==void 0)i.uniform4f(l,t.red,t.green,t.blue,t.alpha);else{if(void 0===t.x)throw new e('Invalid vec4 value for uniform "'+r.name+'".');i.uniform4f(l,t.x,t.y,t.z,t.w)}};case i.SAMPLER_2D:case i.SAMPLER_CUBE:return void 0;case i.INT:case i.BOOL:return function(){i.uniform1i(l,this.value)};case i.INT_VEC2:case i.BOOL_VEC2:return function(){var e=this.value;i.uniform2i(l,e.x,e.y)};case i.INT_VEC3:case i.BOOL_VEC3:return function(){var e=this.value;i.uniform3i(l,e.x,e.y,e.z)};case i.INT_VEC4:case i.BOOL_VEC4:return function(){var e=this.value;i.uniform4i(l,e.x,e.y,e.z,e.w)};case i.FLOAT_MAT2:return function(){i.uniformMatrix2fv(l,!1,n.toArray(this.value,w))};case i.FLOAT_MAT3:return function(){i.uniformMatrix3fv(l,!1,o.toArray(this.value,C))};case i.FLOAT_MAT4:return function(){i.uniformMatrix4fv(l,!1,a.toArray(this.value,x))};default:throw new t("Unrecognized uniform type: "+r.type+' for uniform "'+r.name+'".')}}(),(r.type===i.SAMPLER_2D||r.type===i.SAMPLER_CUBE)&&(this._setSampler=function(e){return i.activeTexture(i.TEXTURE0+e),i.bindTexture(this.value._getTarget(),this.value._getTexture()),i.uniform1i(l,e),e+1},this._clearSampler=function(e){return i.activeTexture(i.TEXTURE0+e),i.bindTexture(this.value._getTarget(),null),e+1})},E=function(i,r,s,l,c){this.value=c;var h=l;this.getName=function(){return s},this.getDatatype=u(i,r.type),this._getLocations=function(){return h},this._set=function(){switch(r.type){case i.FLOAT:return function(){for(var e=0;h.length>e;++e)i.uniform1f(h[e],this.value[e])};case i.FLOAT_VEC2:return function(){for(var e=0;h.length>e;++e){var t=this.value[e];i.uniform2f(h[e],t.x,t.y)}};case i.FLOAT_VEC3:return function(){for(var e=0;h.length>e;++e){var t=this.value[e];i.uniform3f(h[e],t.x,t.y,t.z)}};case i.FLOAT_VEC4:return function(){for(var t=0;h.length>t;++t){var r=this.value[t];if(r.red!==void 0)i.uniform4f(h[t],r.red,r.green,r.blue,r.alpha);else{if(void 0===r.x)throw new e("Invalid vec4 value.");i.uniform4f(h[t],r.x,r.y,r.z,r.w)}}};case i.SAMPLER_2D:case i.SAMPLER_CUBE:return void 0;case i.INT:case i.BOOL:return function(){for(var e=0;h.length>e;++e)i.uniform1i(h[e],this.value[e])};case i.INT_VEC2:case i.BOOL_VEC2:return function(){for(var e=0;h.length>e;++e){var t=this.value[e];i.uniform2i(h[e],t.x,t.y)}};case i.INT_VEC3:case i.BOOL_VEC3:return function(){for(var e=0;h.length>e;++e){var t=this.value[e];i.uniform3i(h[e],t.x,t.y,t.z)}};case i.INT_VEC4:case i.BOOL_VEC4:return function(){for(var e=0;h.length>e;++e){var t=this.value[e];i.uniform4i(h[e],t.x,t.y,t.z,t.w)}};case i.FLOAT_MAT2:return function(){for(var e=0;h.length>e;++e)i.uniformMatrix2fv(h[e],!1,n.toArray(this.value[e],w))};case i.FLOAT_MAT3:return function(){for(var e=0;h.length>e;++e)i.uniformMatrix3fv(h[e],!1,o.toArray(this.value[e],C))};case i.FLOAT_MAT4:return function(){for(var e=0;h.length>e;++e)i.uniformMatrix4fv(h[e],!1,a.toArray(this.value[e],x))};default:throw new t("Unrecognized uniform type: "+r.type)}}(),(r.type===i.SAMPLER_2D||r.type===i.SAMPLER_CUBE)&&(this._setSampler=function(e){for(var t=0;h.length>t;++t){var r=this.value[t],n=e+t;i.activeTexture(i.TEXTURE0+n),i.bindTexture(r._getTarget(),r._getTexture()),i.uniform1i(h[t],n)}return e+h.length},this._clearSampler=function(e){for(var t=0;h.length>t;++t)i.activeTexture(i.TEXTURE0+e+t),i.bindTexture(this.value[t]._getTarget(),null);return e+h.length})},b=function(e,t,i,r,n){var o=v(e,t,i,r,n),a=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),s=_(e,o),l=y(s.allUniforms);this._gl=e,this._program=o,this._numberOfVertexAttributes=a,this._vertexAttributes=g(e,o,a),this._allUniforms=s.allUniforms,this._uniforms=s.uniforms,this._samplerUniforms=s.samplerUniforms,this._automaticUniforms=l.automaticUniforms,this._manualUniforms=l.manualUniforms},M=function(){var e=p()+f()+l+"\n\n"+"#line 0 \n";return M=function(){return e},e};return b.prototype.getVertexAttributes=function(){return this._vertexAttributes},b.prototype.getNumberOfVertexAttributes=function(){return this._numberOfVertexAttributes},b.prototype.getAllUniforms=function(){return this._allUniforms},b.prototype.getManualUniforms=function(){return this._manualUniforms},b.prototype._bind=function(){this._gl.useProgram(this._program)},b.prototype._unBind=function(){this._gl.useProgram(null);for(var e=this._samplerUniforms,t=0,i=e.length,r=0;i>r;++r)t=e[r]._clearSampler(t)},b.prototype._setUniforms=function(t,i,r){var n,o,a=this._uniforms,s=this._samplerUniforms,l=this._manualUniforms,u=this._automaticUniforms;if(t)for(var c in l)l.hasOwnProperty(c)&&(l[c].value=t[c]());for(n=u.length,o=0;n>o;++o)u[o].uniform.value=u[o].automaticUniform.getValue(i);for(n=a.length,o=0;n>o;++o)a[o]._set();var h=0;for(n=s.length,o=0;n>o;++o)h=s[o]._setSampler(h);if(r){var d=this._gl,m=this._program;if(d.validateProgram(m),!d.getProgramParameter(m,d.VALIDATE_STATUS))throw new e("Program validation failed.  Link log: "+d.getProgramInfoLog(m))}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._gl.deleteProgram(this._program),i(this)},b.prototype.release=function(){return this._cachedShader?this._cachedShader.cache.releaseShaderProgram(this):this.destroy()},b}),i("Renderer/TextureAtlas",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/createGuid","../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","./PixelFormat"],function(e,t,i,r,n,o,a){function s(e,i,n,o,a){this.bottomLeft=r(e,t.ZERO),this.topRight=r(i,t.ZERO),this.childNode1=n,this.childNode2=o,this.imageIndex=a}var l=new t(16,16),u=function(e){e=r(e,r.EMPTY_OBJECT);var n=e.context;if(n===void 0)throw new o("context is required.");var u=r(e.borderWidthInPixels,1);if(0>u)throw new o("borderWidthInPixels must be greater than or equal to zero.");var c=r(e.initialSize,l);if(1>c.x||1>c.y)throw new o("initialSize must be greater than zero.");this._context=n,this._pixelFormat=r(e.pixelFormat,a.RGBA),this._borderWidthInPixels=u,this._textureCoordinates=[],this._guid=i(),this._texture=this._context.createTexture2D({width:c.x,height:c.y,pixelFormat:this._pixelFormat}),this._root=new s(new t,new t(c.x,c.y));var h=e.images;h!==void 0&&h.length>0&&this.addImages(h);var d=e.image;d!==void 0&&this.addImage(d)};return u.prototype._resizeAtlas=function(e){var i=this.getNumberOfImages(),r=2;if(i>0){var n=this._texture.getWidth(),o=this._texture.getHeight(),a=r*(n+e.width+this._borderWidthInPixels),l=r*(o+e.height+this._borderWidthInPixels),u=n/a,c=o/l,h=new s(new t(n+this._borderWidthInPixels,0),new t(a,o)),d=new s(new t,new t(a,o),this._root,h),m=new s(new t(0,o+this._borderWidthInPixels),new t(a,l)),p=new s(new t,new t(a,l),d,m);this._root=p;for(var f=0;this._textureCoordinates.length>f;f++){var v=this._textureCoordinates[f];v!==void 0&&(v.x*=u,v.y*=c,v.width*=u,v.height*=c)}var g=this._context.createTexture2D({width:a,height:l,pixelFormat:this._pixelFormat}),_=this._context.createFramebuffer({colorTexture:this._texture});_._bind(),g.copyFromFramebuffer(0,0,0,0,n,o),_._unBind(),_.destroy(),this._texture=g}else{var y=r*(e.width+this._borderWidthInPixels),w=r*(e.height+this._borderWidthInPixels);this._texture=this._texture&&this._texture.destroy(),this._texture=this._context.createTexture2D({width:y,height:w,pixelFormat:this._pixelFormat}),this._root=new s(new t,new t(y,w))}},u.prototype._findNode=function(e,i){if(e===void 0)return void 0;if(e.childNode1===void 0&&e.childNode2===void 0){if(e.imageIndex!==void 0)return void 0;var r=e.topRight.x-e.bottomLeft.x,n=e.topRight.y-e.bottomLeft.y,o=r-i.width,a=n-i.height;if(0>o||0>a)return void 0;if(0===o&&0===a)return e;if(o>a){e.childNode1=new s(new t(e.bottomLeft.x,e.bottomLeft.y),new t(e.bottomLeft.x+i.width,e.topRight.y));var l=e.bottomLeft.x+i.width+this._borderWidthInPixels;e.topRight.x>l&&(e.childNode2=new s(new t(l,e.bottomLeft.y),new t(e.topRight.x,e.topRight.y)))}else{e.childNode1=new s(new t(e.bottomLeft.x,e.bottomLeft.y),new t(e.topRight.x,e.bottomLeft.y+i.height));var u=e.bottomLeft.y+i.height+this._borderWidthInPixels;e.topRight.y>u&&(e.childNode2=new s(new t(e.bottomLeft.x,u),new t(e.topRight.x,e.topRight.y)))}return this._findNode(e.childNode1,i)}return this._findNode(e.childNode1,i)||this._findNode(e.childNode2,i)},u.prototype._addImage=function(t,i){if(t===void 0)throw new o("image is required.");var r=this._findNode(this._root,t);if(r!==void 0){r.imageIndex=i;var n=this._texture.getWidth(),a=this._texture.getHeight(),s=r.topRight.x-r.bottomLeft.x,l=r.topRight.y-r.bottomLeft.y;this._textureCoordinates[i]=new e(r.bottomLeft.x/n,r.bottomLeft.y/a,s/n,l/a),this._texture.copyFrom(t,r.bottomLeft.x,r.bottomLeft.y)}else this._resizeAtlas(t),this._addImage(t,i)},u.prototype.addImage=function(e){var t=this.getNumberOfImages();return this._addImage(e,t),this._guid=i(),t},u.prototype.addImages=function(e){if(e===void 0||1>e.length)throw new o("images is required and must have length greater than zero.");var t,r=[],n=e.length,a=this.getNumberOfImages();for(t=0;n>t;++t)r.push({image:e[t],index:t+a});for(r.sort(function(e,t){return Math.max(t.image.height,t.image.width)-Math.max(e.image.height,e.image.width)}),t=0;n>t;++t){var s=r[t];this._addImage(s.image,s.index)}return this._guid=i(),a},u.prototype.addSubRegions=function(t,r){for(var n=this.addImage(t),o=this._texture.getWidth(),a=this._texture.getHeight(),s=this.getNumberOfImages(),l=r.length,u=this._textureCoordinates[n],c=0;l>c;++c){var h=r[c];this._textureCoordinates.push(new e(u.x+h.x/o,u.y+h.y/a,h.width/o,h.height/a))}return this._guid=i(),s},u.prototype.getBorderWidthInPixels=function(){return this._borderWidthInPixels},u.prototype.getTextureCoordinates=function(){return this._textureCoordinates},u.prototype.getTexture=function(){return this._texture},u.prototype.getNumberOfImages=function(){return this._textureCoordinates.length},u.prototype.getGUID=function(){return this._guid},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),n(this)},u}),i("Renderer/UniformState",["../Core/DeveloperError","../Core/defaultValue","../Core/Ellipsoid","../Core/Matrix3","../Core/Matrix4","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Math","../Core/EncodedCartesian3","../Core/BoundingRectangle","../Core/Transforms","../Core/Simon1994PlanetaryPositions","../Scene/SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p){function f(e,t){n.clone(t,e._view),n.getRotation(t,e._viewRotation),e._view3DDirty=!0,e._inverseView3DDirty=!0,e._modelViewDirty=!0,e._modelView3DDirty=!0,e._modelViewRelativeToEyeDirty=!0,e._inverseModelViewDirty=!0,e._inverseModelView3DDirty=!0,e._viewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0,e._modelViewInfiniteProjectionDirty=!0,e._normalDirty=!0,e._inverseNormalDirty=!0,e._normal3DDirty=!0,e._inverseNormal3DDirty=!0}function v(e,t){n.clone(t,e._inverseView),n.getRotation(t,e._inverseViewRotation)}function g(e,t){n.clone(t,e._projection),e._inverseProjectionDirty=!0,e._viewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0}function _(e,t){n.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}function y(e,t){a.clone(t.getPositionWC(),e._cameraPosition),a.clone(t.getDirectionWC(),e._cameraDirection),a.clone(t.getRightWC(),e._cameraRight),a.clone(t.getUpWC(),e._cameraUp),e._encodedCameraPositionMCDirty=!0}function w(e,t){d.computeIcrfToFixedMatrix(t.time,q)===void 0&&(q=d.computeTemeToPseudoFixedMatrix(t.time,q)),F=m.ComputeSunPositionInEarthInertialFrame(t.time,F),q.multiplyByVector(F,F),a.normalize(F,e._sunDirectionWC),r.multiplyByVector(e.getViewRotation3D(),F,F),a.normalize(F,e._sunDirectionEC),F=m.ComputeMoonPositionInEarthInertialFrame(t.time,F),q.multiplyByVector(F,F),r.multiplyByVector(e.getViewRotation3D(),F,F),a.normalize(F,e._moonDirectionEC)}function C(e){if(e._viewportDirty){var t=e._viewport;n.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),n.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}function x(e){e._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,n.inverse(e._projection,e._inverseProjection))}function T(e){e._modelViewDirty&&(e._modelViewDirty=!1,n.multiply(e._view,e._model,e._modelView))}function S(e){e._modelView3DDirty&&(e._modelView3DDirty=!1,n.multiply(e.getView3D(),e._model,e._modelView3D))}function E(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;var t=e.getModelView(),i=e._modelViewRelativeToEye;i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=0,i[13]=0,i[14]=0,i[15]=t[15]}}function b(e){e._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,n.inverse(e.getModelView(),e._inverseModelView))}function M(e){e._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,n.inverse(e.getModelView3D(),e._inverseModelView3D))}function I(e){e._viewProjectionDirty&&(e._viewProjectionDirty=!1,n.multiply(e._projection,e._view,e._viewProjection))}function D(e){e._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,n.multiply(e._projection,e.getModelView(),e._modelViewProjection))}function A(e){e._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,n.multiply(e._projection,e.getModelViewRelativeToEye(),e._modelViewProjectionRelativeToEye))}function P(e){e._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,n.multiply(e._infiniteProjection,e.getModelView(),e._modelViewInfiniteProjection))}function R(e){e._normalDirty&&(e._normalDirty=!1,n.transpose(e.getInverseModelView(),U),n.getRotation(U,e._normal))}function O(e){e._normal3DDirty&&(e._normal3DDirty=!1,n.transpose(e.getInverseModelView3D(),U),n.getRotation(U,e._normal3D))}function z(e){e._inverseNormalDirty&&(e._inverseNormalDirty=!1,n.getRotation(e.getInverseModelView(),e._inverseNormal))}function L(e){e._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,n.getRotation(e.getInverseModelView3D(),e._inverseNormal3D))}function N(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,e.getInverseModel().multiplyByPoint(e._cameraPosition,k),c.fromCartesian(k,e._encodedCameraPositionMC))}function V(e,t,i,r,o,s,l,c){var h=W;h.x=e.y,h.y=e.z,h.z=e.x;var m=H;m.x=i.y,m.y=i.z,m.z=i.x;var f=j;f.x=r.y,f.y=r.z,f.z=r.x;var v=G;v.x=t.y,v.y=t.z,v.z=t.x,s===p.SCENE2D&&(h.z=.5*o);var g=l.unproject(h,Y);g.longitude=u.clamp(g.longitude,-Math.PI,Math.PI),g.latitude=u.clamp(g.latitude,-u.PI_OVER_TWO,u.PI_OVER_TWO);var _=l.getEllipsoid(),y=_.cartographicToCartesian(g,X),w=d.eastNorthUpToFixedFrame(y,_,Z);return w.multiplyByVector(m,m),w.multiplyByVector(f,f),w.multiplyByVector(v,v),c===void 0&&(c=new n),c[0]=m.x,c[1]=f.x,c[2]=-v.x,c[3]=0,c[4]=m.y,c[5]=f.y,c[6]=-v.y,c[7]=0,c[8]=m.z,c[9]=f.z,c[10]=-v.z,c[11]=0,c[12]=-a.dot(m,y),c[13]=-a.dot(f,y),c[14]=a.dot(v,y),c[15]=1,c}var B=function(){this._viewport=new h,this._viewportDirty=!1,this._viewportOrthographicMatrix=n.IDENTITY.clone(),this._viewportTransformation=n.IDENTITY.clone(),this._model=n.IDENTITY.clone(),this._view=n.IDENTITY.clone(),this._inverseView=n.IDENTITY.clone(),this._projection=n.IDENTITY.clone(),this._infiniteProjection=n.IDENTITY.clone(),this._entireFrustum=new o,this._currentFrustum=new o,this._pixelSize=0,this._frameNumber=1,this._time=void 0,this._temeToPseudoFixed=r.IDENTITY.clone(),this._view3DDirty=!0,this._view3D=new n,this._inverseView3DDirty=!0,this._inverseView3D=new n,this._inverseModelDirty=!0,this._inverseModel=new n,this._viewRotation=new r,this._inverseViewRotation=new r,this._viewRotation3D=new r,this._inverseViewRotation3D=new r,this._inverseProjectionDirty=!0,this._inverseProjection=new n,this._modelViewDirty=!0,this._modelView=new n,this._modelView3DDirty=!0,this._modelView3D=new n,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new n,this._inverseModelViewDirty=!0,this._inverseModelView=new n,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new n,this._viewProjectionDirty=!0,this._viewProjection=new n,this._modelViewProjectionDirty=!0,this._modelViewProjection=new n,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new n,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new n,this._normalDirty=!0,this._normal=new r,this._normal3DDirty=!0,this._normal3D=new r,this._inverseNormalDirty=!0,this._inverseNormal=new r,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new r,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new c,this._cameraPosition=new a,this._sunDirectionWC=new a,this._sunDirectionEC=new a,this._moonDirectionEC=new a,this._mode=void 0,this._mapProjection=void 0,this._cameraDirection=new a,this._cameraRight=new a,this._cameraUp=new a,this._frustum2DWidth=0},F=new a,q=new r;B.prototype.updateFrustum=function(e){g(this,e.getProjectionMatrix()),e.getInfiniteProjectionMatrix!==void 0&&_(this,e.getInfiniteProjectionMatrix()),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far},B.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.scene2D.projection;var t=e.camera;f(this,t.getViewMatrix()),v(this,t.getInverseViewMatrix()),y(this,t),this._frustum2DWidth=e.mode===p.SCENE2D?t.frustum.right-t.frustum.left:0,w(this,e);var i=t.frustum.getPixelSize(e.canvasDimensions);this._pixelSize=Math.max(i.x,i.y),this._entireFrustum.x=t.frustum.near,this._entireFrustum.y=t.frustum.far,this.updateFrustum(t.frustum),this._frameNumber=e.frameNumber,this._time=e.time,this._temeToPseudoFixed=d.computeTemeToPseudoFixedMatrix(e.time)},B.prototype.setViewport=function(e){h.equals(e,this._viewport)||(h.clone(e,this._viewport),this._viewportDirty=!0)},B.prototype.getViewport=function(){return this._viewport},B.prototype.getViewportOrthographic=function(){return C(this),this._viewportOrthographicMatrix},B.prototype.getViewportTransformation=function(){return C(this),this._viewportTransformation},B.prototype.setModel=function(e){n.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._modelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0},B.prototype.getModel=function(){return this._model},B.prototype.getInverseModel=function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,this._model.inverse(this._inverseModel)),this._inverseModel},B.prototype.getView=function(){return this._view},B.prototype.getView3D=function(){return this._view3DDirty&&(this._mode===p.SCENE3D?n.clone(this._view,this._view3D):V(this._cameraPosition,this._cameraDirection,this._cameraRight,this._cameraUp,this._frustum2DWidth,this._mode,this._mapProjection,this._view3D),n.getRotation(this._view3D,this._viewRotation3D),this._view3DDirty=!1),this._view3D},B.prototype.getViewRotation=function(){return this._viewRotation},B.prototype.getViewRotation3D=function(){return this.getView3D(),this._viewRotation3D},B.prototype.getInverseView=function(){return this._inverseView},B.prototype.getInverseView3D=function(){return this._inverseView3DDirty&&(n.inverseTransformation(this.getView3D(),this._inverseView3D),n.getRotation(this._inverseView3D,this._inverseViewRotation3D),this._inverseView3DDirty=!1),this._inverseView3D},B.prototype.getInverseViewRotation=function(){return this._inverseViewRotation},B.prototype.getInverseViewRotation3D=function(){return this.getInverseView3D(),this._inverseViewRotation3D},B.prototype.getProjection=function(){return this._projection},B.prototype.getInverseProjection=function(){return x(this),this._inverseProjection},B.prototype.getInfiniteProjection=function(){return this._infiniteProjection},B.prototype.getModelView=function(){return T(this),this._modelView},B.prototype.getModelView3D=function(){return S(this),this._modelView3D},B.prototype.getModelViewRelativeToEye=function(){return E(this),this._modelViewRelativeToEye},B.prototype.getInverseModelView=function(){return b(this),this._inverseModelView},B.prototype.getInverseModelView3D=function(){return M(this),this._inverseModelView3D
},B.prototype.getViewProjection=function(){return I(this),this._viewProjection},B.prototype.getModelViewProjection=function(){return D(this),this._modelViewProjection},B.prototype.getModelViewProjectionRelativeToEye=function(){return A(this),this._modelViewProjectionRelativeToEye},B.prototype.getModelViewInfiniteProjection=function(){return P(this),this._modelViewInfiniteProjection};var U=new n;B.prototype.getNormal=function(){return R(this),this._normal},B.prototype.getNormal3D=function(){return O(this),this._normal3D},B.prototype.getInverseNormal=function(){return z(this),this._inverseNormal},B.prototype.getInverseNormal3D=function(){return L(this),this._inverseNormal3D},B.prototype.getEntireFrustum=function(){return this._entireFrustum},B.prototype.getCurrentFrustum=function(){return this._currentFrustum},B.prototype.getPixelSize=function(){return this._pixelSize},B.prototype.getSunDirectionWC=function(){return this._sunDirectionWC},B.prototype.getSunDirectionEC=function(){return this._sunDirectionEC},B.prototype.getMoonDirectionEC=function(){return this._moonDirectionEC};var k=new a;B.prototype.getEncodedCameraPositionMCHigh=function(){return N(this),this._encodedCameraPositionMC.high},B.prototype.getEncodedCameraPositionMCLow=function(){return N(this),this._encodedCameraPositionMC.low},B.prototype.getFrameNumber=function(){return this._frameNumber},B.prototype.getTime=function(){return this._time},B.prototype.getTemeToPseudoFixedMatrix=function(){return this._temeToPseudoFixed},B.prototype.getHighResolutionSnapScale=function(){return 1};var W=new a,H=new s,j=new s,G=new s,Y=new l,X=new a,Z=new n;return B}),i("Renderer/VertexArray",["../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","../Core/ComponentDatatype"],function(e,t,i,r){var n=function(e,t,r){if(this._gl=e,this._attributes=[],this._indexBuffer=r,t)for(var n=0;t.length>n;++n)try{this._addAttribute(t[n],n)}catch(o){throw new i(o.message)}for(var a={},s=0;this._attributes.length>s;++s){var l=this._attributes[s].index;if(a[l])throw new i("Index "+l+" is used by more than one attribute.");a[l]=!0}};return n.prototype._addAttribute=function(t,n){if(!t.vertexBuffer&&!t.value)throw new i("attribute must have a vertexBuffer or a value.");if(t.vertexBuffer&&t.value)throw new i("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");var o=t.value?t.value.length:t.componentsPerAttribute;if(1!==o&&2!==o&&3!==o&&4!==o){if(t.value)throw new i("attribute.value.length must be in the range [1, 4].");throw new i("attribute.componentsPerAttribute must be in the range [1, 4].")}if(t.componentDatatype){var a=t.componentDatatype;if(!r.validate(a))throw new i("attribute must have a valid componentDatatype or not specify it.")}if(t.strideInBytes&&t.strideInBytes>255)throw new i("attribute must have a strideInBytes less than or equal to 255 or not specify it.");var s={index:e(t.index,n),enabled:e(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:t.value?t.value.slice(0):void 0,componentsPerAttribute:o,componentDatatype:t.componentDatatype||r.FLOAT,normalize:t.normalize||!1,offsetInBytes:t.offsetInBytes||0,strideInBytes:t.strideInBytes||0};if(s.vertexBuffer)s.vertexAttrib=function(e){e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),e.vertexAttribPointer(this.index,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),e.enableVertexAttribArray(this.index)},s.disableVertexAttribArray=function(e){e.disableVertexAttribArray(this.index)};else{switch(s.componentsPerAttribute){case 1:s.vertexAttrib=function(e){e.vertexAttrib1fv(this.index,this.value)};break;case 2:s.vertexAttrib=function(e){e.vertexAttrib2fv(this.index,this.value)};break;case 3:s.vertexAttrib=function(e){e.vertexAttrib3fv(this.index,this.value)};break;case 4:s.vertexAttrib=function(e){e.vertexAttrib4fv(this.index,this.value)}}s.disableVertexAttribArray=function(){}}this._attributes.push(s)},n.prototype.getAttribute=function(e){if(e===void 0)throw new i("index is required.");return this._attributes[e]},n.prototype.getNumberOfAttributes=function(){return this._attributes.length},n.prototype.addAttribute=function(t){if(t){for(var r=this._attributes,n=e(t.index,r.length),o=0;r.length>o;++o)if(n===r[o].index)throw new i("Index "+n+" is already in use.");try{this._addAttribute(t,n)}catch(a){throw new i(a.message)}}},n.prototype.removeAttribute=function(e){if(e){if(e.index===void 0)throw new i("Attribute must have an index.");for(var t=this._attributes,r=0;t.length>r;++r)if(t[r].index===e.index)return t.splice(r,1),!0}return!1},n.prototype.getIndexBuffer=function(){return this._indexBuffer},n.prototype.setIndexBuffer=function(e){this._indexBuffer=e},n.prototype._bind=function(){for(var e=this._attributes,t=this._gl,i=0;e.length>i;++i){var r=e[i];r.enabled&&r.vertexAttrib(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer._getBuffer())},n.prototype._unBind=function(){for(var e=this._attributes,t=this._gl,i=0;e.length>i;++i){var r=e[i];r.enabled&&r.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},n.prototype._getNumberOfVertices=function(){if(this._attributes.length>0){var e=this._attributes[0],t=e.strideInBytes||e.componentsPerAttribute*e.componentDatatype.sizeInBytes;return e.vertexBuffer.getSizeInBytes()/t}return 0},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){for(var e=this._attributes,i=0;e.length>i;++i){var r=e[i].vertexBuffer;r&&!r.isDestroyed()&&r.getVertexArrayDestroyable()&&r.destroy()}var n=this._indexBuffer;return n&&!n.isDestroyed()&&n.getVertexArrayDestroyable()&&n.destroy(),t(this)},n}),i("Renderer/Context",["../Core/defaultValue","../Core/DeveloperError","../Core/destroyObject","../Core/Color","../Core/IndexDatatype","../Core/RuntimeError","../Core/PrimitiveType","../Core/createGuid","../Core/Matrix4","./Buffer","./BufferUsage","./CubeMap","./Framebuffer","./MipmapHint","./PixelDatatype","./PixelFormat","./PickFramebuffer","./Renderbuffer","./RenderbufferFormat","./RenderState","./ShaderCache","./ShaderProgram","./Texture","./TextureAtlas","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap","./UniformState","./VertexArray","./VertexLayout","./ClearCommand","./PassState"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P){function R(e,t){var i="OpenGL Error:  ";switch(t){case e.INVALID_ENUM:i+="Invalid enumeration";break;case e.INVALID_VALUE:i+="Invalid value";break;case e.INVALID_OPERATION:i+="Invalid operation";break;case e.OUT_OF_MEMORY:i+="Out of memory";break;case e.CONTEXT_LOST_WEBGL:i+="Context lost";break;default:i+="Unknown"}return i}function O(e,t,i,r){for(var n=R(e,r)+": "+t.name+"(",o=0;i.length>o;++o)0!==o&&(n+=", "),n+=i[o];return n+=");"}function z(e,t,i){var r=e.getError();if(r!==e.NO_ERROR)throw new o(O(e,t,i,r))}function L(e,t){function i(i){return function(){var r=i.apply(e,arguments);return t(e,i,arguments),r}}if(!t)return e;var r={};for(var n in e){var o=e[n];r[n]="function"==typeof o?i(o):o}return r}function N(e,i,r,n){var o;if("number"==typeof r)o=r;else{if("object"!=typeof r||void 0===r.byteLength)throw new t("typedArrayOrSizeInBytes must be either a typed array or a number.");o=r.byteLength}if(0>=o)throw new t("typedArrayOrSizeInBytes must be greater than zero.");if(!c.validate(n))throw new t("usage is invalid.");var a=e.createBuffer();return e.bindBuffer(i,a),e.bufferData(i,r,n),e.bindBuffer(i,null),new u(e,i,o,n,a)}function V(e,t,i){var r=e._currentRenderState;r!==t&&(e._currentRenderState=t,y.partialApply(e._gl,r,t,i))}function B(e,t){var i,r,n=t||{},o=n.mesh||{},a=n.attributeIndices||{},s=n.bufferUsage||c.DYNAMIC_DRAW,l=n.vertexLayout&&n.vertexLayout===D.INTERLEAVED,u=[],h=o.attributes;if(l){var d=e._interleaveAttributes(h);if(d){var m=e.createVertexBuffer(d.buffer,s),p=d.offsetsInBytes,f=d.vertexSizeInBytes;for(i in h)h.hasOwnProperty(i)&&(r=h[i],r.values?u.push({index:a[i],vertexBuffer:m,componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,offsetInBytes:p[i],strideInBytes:f}):u.push({index:a[i],value:r.value,componentDatatype:r.componentDatatype,normalize:r.normalize}))}}else for(i in h)h.hasOwnProperty(i)&&(r=h[i],u.push({index:a[i],vertexBuffer:r.values?e.createVertexBuffer(r.componentDatatype.toTypedArray(r.values),s):void 0,value:r.value?r.value:void 0,componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize}));return e.createVertexArray(u)}function F(e,t,i){this._pickObjects=e,this.key=t,this.color=i}var q=function(e,i){if(!window.WebGLRenderingContext)throw new o("The browser does not support WebGL.  Visit http://get.webgl.org.");if(e===void 0)throw new t("canvas is required.");if(this._canvas=e,i===void 0&&(i={}),i.stencil===void 0&&(i.stencil=!1),i.alpha===void 0&&(i.alpha=!1),this._originalGLContext=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!this._originalGLContext)throw new o("The browser supports WebGL, but initialization failed.");this._id=s(),this._validateFB=!1,this._validateSP=!1,this._logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new w(this);var n=this._gl=this._originalGLContext;this._version=n.getParameter(n.VERSION),this._shadingLanguageVersion=n.getParameter(n.SHADING_LANGUAGE_VERSION),this._vendor=n.getParameter(n.VENDOR),this._renderer=n.getParameter(n.RENDERER),this._redBits=n.getParameter(n.RED_BITS),this._greenBits=n.getParameter(n.GREEN_BITS),this._blueBits=n.getParameter(n.BLUE_BITS),this._alphaBits=n.getParameter(n.ALPHA_BITS),this._depthBits=n.getParameter(n.DEPTH_BITS),this._stencilBits=n.getParameter(n.STENCIL_BITS),this._maximumCombinedTextureImageUnits=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._maximumCubeMapSize=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),this._maximumFragmentUniformVectors=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),this._maximumTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),this._maximumRenderbufferSize=n.getParameter(n.MAX_RENDERBUFFER_SIZE),this._maximumTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this._maximumVaryingVectors=n.getParameter(n.MAX_VARYING_VECTORS),this._maximumVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS),this._maximumVertexTextureImageUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maximumVertexUniformVectors=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),this._aliasedLineWidthRange=n.getParameter(n.ALIASED_LINE_WIDTH_RANGE),this._aliasedPointSizeRange=n.getParameter(n.ALIASED_POINT_SIZE_RANGE),this._maximumViewportDimensions=n.getParameter(n.MAX_VIEWPORT_DIMS),this._standardDerivatives=n.getExtension("OES_standard_derivatives"),this._depthTexture=n.getExtension("WEBKIT_WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture");var a=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic");this._textureFilterAnisotropic=a,this._maximumTextureFilterAnisotropy=a?n.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;var l=n.getParameter(n.COLOR_CLEAR_VALUE);this._clearColor=new r(l[0],l[1],l[2],l[3]),this._clearDepth=n.getParameter(n.DEPTH_CLEAR_VALUE),this._clearStencil=n.getParameter(n.STENCIL_CLEAR_VALUE);var u=new M,c=new P(this),h=this.createRenderState();this._defaultPassState=c,this._defaultRenderState=h,this._defaultTexture=void 0,this._defaultCubeMap=void 0,this._us=u,this._currentFramebuffer=void 0,this._currentSp=void 0,this._currentRenderState=h,this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.cache={},y.apply(n,h,c)};q.prototype.getId=function(){return this._id},q.prototype.getCanvas=function(){return this._canvas},q.prototype.getShaderCache=function(){return this._shaderCache},q.prototype.getUniformState=function(){return this._us},q.prototype.getVersion=function(){return this._version},q.prototype.getShadingLanguageVersion=function(){return this._shadingLanguageVersion},q.prototype.getVendor=function(){return this._vendor},q.prototype.getRenderer=function(){return this._renderer},q.prototype.getRedBits=function(){return this._redBits},q.prototype.getGreenBits=function(){return this._greenBits},q.prototype.getBlueBits=function(){return this._blueBits},q.prototype.getAlphaBits=function(){return this._alphaBits},q.prototype.getDepthBits=function(){return this._depthBits},q.prototype.getStencilBits=function(){return this._stencilBits},q.prototype.getMaximumCombinedTextureImageUnits=function(){return this._maximumCombinedTextureImageUnits},q.prototype.getMaximumCubeMapSize=function(){return this._maximumCubeMapSize},q.prototype.getMaximumFragmentUniformVectors=function(){return this._maximumFragmentUniformVectors},q.prototype.getMaximumTextureImageUnits=function(){return this._maximumTextureImageUnits},q.prototype.getMaximumRenderbufferSize=function(){return this._maximumRenderbufferSize},q.prototype.getMaximumTextureSize=function(){return this._maximumTextureSize},q.prototype.getMaximumVaryingVectors=function(){return this._maximumVaryingVectors},q.prototype.getMaximumVertexAttributes=function(){return this._maximumVertexAttributes},q.prototype.getMaximumVertexTextureImageUnits=function(){return this._maximumVertexTextureImageUnits},q.prototype.getMaximumVertexUniformVectors=function(){return this._maximumVertexUniformVectors},q.prototype.getMinimumAliasedLineWidth=function(){return this._aliasedLineWidthRange[0]},q.prototype.getMaximumAliasedLineWidth=function(){return this._aliasedLineWidthRange[1]},q.prototype.getMinimumAliasedPointSize=function(){return this._aliasedPointSizeRange[0]},q.prototype.getMaximumAliasedPointSize=function(){return this._aliasedPointSizeRange[1]},q.prototype.getMaximumViewportWidth=function(){return this._maximumViewportDimensions[0]},q.prototype.getMaximumViewportHeight=function(){return this._maximumViewportDimensions[1]},q.prototype.getStandardDerivatives=function(){return!!this._standardDerivatives},q.prototype.getDepthTexture=function(){return!!this._depthTexture},q.prototype.getTextureFilterAnisotropic=function(){return!!this._textureFilterAnisotropic},q.prototype.getMaximumTextureFilterAnisotropy=function(){return this._maximumTextureFilterAnisotropy},q.prototype.getValidateFramebuffer=function(){return this._validateFB},q.prototype.setValidateFramebuffer=function(e){this._validateFB=e},q.prototype.getValidateShaderProgram=function(){return this._validateSP},q.prototype.setValidateShaderProgram=function(e){this._validateSP=e},q.prototype.getThrowOnWebGLError=function(){return this._throwOnWebGLError},q.prototype.setThrowOnWebGLError=function(e){this._throwOnWebGLError=e,this._gl=L(this._originalGLContext,e?z:null)},q.prototype.getLogShaderCompilation=function(){return this._logShaderCompilation},q.prototype.setLogShaderCompilation=function(e){this._logShaderCompilation=e},q.prototype.getDefaultTexture=function(){return void 0===this._defaultTexture&&(this._defaultTexture=this.createTexture2D({source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])}})),this._defaultTexture},q.prototype.getDefaultCubeMap=function(){if(void 0===this._defaultCubeMap){var e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=this.createCubeMap({source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e}})}return this._defaultCubeMap},q.prototype.createShaderProgram=function(e,t,i){return new C(this._gl,this._logShaderCompilation,e,t,i)},q.prototype.createVertexBuffer=function(e,t){return N(this._gl,this._gl.ARRAY_BUFFER,e,t)},q.prototype.createIndexBuffer=function(e,i,r){var o;if(r===n.UNSIGNED_BYTE)o=Uint8Array.BYTES_PER_ELEMENT;else{if(r!==n.UNSIGNED_SHORT)throw new t("Invalid indexDatatype.");o=Uint16Array.BYTES_PER_ELEMENT}var a=this._gl,s=N(a,a.ELEMENT_ARRAY_BUFFER,e,i),l=s.getSizeInBytes()/o;return s.getIndexDatatype=function(){return r},s.getBytesPerIndex=function(){return o},s.getNumberOfIndices=function(){return l},s},q.prototype.createVertexArray=function(e,t){return new I(this._gl,e,t)},q.prototype.createTexture2D=function(i){if(!i)throw new t("description is required.");var r=i.source,n=r!==void 0?r.width:i.width,a=r!==void 0?r.height:i.height;if(n===void 0||a===void 0)throw new t("description requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(0>=n)throw new t("Width must be greater than zero.");if(n>this._maximumTextureSize)throw new t("Width must be less than or equal to the maximum texture size ("+this._maximumTextureSize+").  Check getMaximumTextureSize().");if(0>=a)throw new t("Height must be greater than zero.");if(a>this._maximumTextureSize)throw new t("Height must be less than or equal to the maximum texture size ("+this._maximumTextureSize+").  Check getMaximumTextureSize().");var s=e(i.pixelFormat,f.RGBA);if(!f.validate(s))throw new t("Invalid description.pixelFormat.");var l=e(i.pixelDatatype,p.UNSIGNED_BYTE);if(!p.validate(l))throw new t("Invalid description.pixelDatatype.");if(s===f.DEPTH_COMPONENT&&l!==p.UNSIGNED_SHORT&&l!==p.UNSIGNED_INT)throw new t("When description.pixelFormat is DEPTH_COMPONENT, description.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(s===f.DEPTH_STENCIL&&l!==p.UNSIGNED_INT_24_8_WEBGL)throw new t("When description.pixelFormat is DEPTH_STENCIL, description.pixelDatatype must be UNSIGNED_INT_24_8_WEBGL.");if(f.isDepthFormat(s)){if(r)throw new t("When description.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!this.getDepthTexture())throw new o("When description.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check getDepthTexture().")}var u=i.preMultiplyAlpha||s===f.RGB||s===f.LUMINANCE,c=e(i.flipY,!0),h=this._gl,d=h.TEXTURE_2D,m=h.createTexture();return h.activeTexture(h.TEXTURE0),h.bindTexture(d,m),r?(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),r.arrayBufferView?h.texImage2D(d,0,s,n,a,0,s,l,r.arrayBufferView):h.texImage2D(d,0,s,s,l,r)):h.texImage2D(d,0,s,n,a,0,s,l,null),h.bindTexture(d,null),new x(h,this._textureFilterAnisotropic,d,m,s,l,n,a,u,c)},q.prototype.createTexture2DFromFramebuffer=function(i,r,n,o,a){if(i=e(i,f.RGB),r=e(r,0),n=e(n,0),o=e(o,this._canvas.clientWidth),a=e(a,this._canvas.clientHeight),!f.validate(i))throw new t("Invalid pixelFormat.");if(f.isDepthFormat(i))throw new t("pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(0>r)throw new t("framebufferXOffset must be greater than or equal to zero.");if(0>n)throw new t("framebufferYOffset must be greater than or equal to zero.");if(r+o>this._canvas.clientWidth)throw new t("framebufferXOffset + width must be less than or equal to getCanvas().clientWidth");if(n+a>this._canvas.clientHeight)throw new t("framebufferYOffset + height must be less than or equal to getCanvas().clientHeight.");var s=this._gl,l=s.TEXTURE_2D,u=s.createTexture();return s.activeTexture(s.TEXTURE0),s.bindTexture(l,u),s.copyTexImage2D(l,0,i,r,n,o,a,0),s.bindTexture(l,null),new x(s,this._textureFilterAnisotropic,l,u,i,void 0,o,a)},q.prototype.createTextureAtlas=function(e){return e=e||{},e.context=this,new T(e)},q.prototype.createCubeMap=function(i){function r(e,t){t.arrayBufferView?g.texImage2D(e,0,c,u,u,0,c,d,t.arrayBufferView):g.texImage2D(e,0,c,c,d,t)}if(!i)throw new t("description is required.");var n,o,a=i.source;if(a){var s=[a.positiveX,a.negativeX,a.positiveY,a.negativeY,a.positiveZ,a.negativeZ];if(!(s[0]&&s[1]&&s[2]&&s[3]&&s[4]&&s[5]))throw new t("description.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");n=s[0].width,o=s[0].height;for(var l=1;6>l;++l)if(Number(s[l].width)!==n||Number(s[l].height)!==o)throw new t("Each face in description.source must have the same width and height.")}else n=i.width,o=i.height;if(n===void 0||o===void 0)throw new t("description requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(n!==o)throw new t("Width must equal height.");var u=n;if(0>=u)throw new t("Width and height must be greater than zero.");if(u>this._maximumCubeMapSize)throw new t("Width and height must be less than or equal to the maximum cube map size ("+this._maximumCubeMapSize+").  Check getMaximumCubeMapSize().");var c=e(i.pixelFormat,f.RGBA);if(!f.validate(c))throw new t("Invalid description.pixelFormat.");if(f.isDepthFormat(c))throw new t("description.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");var d=e(i.pixelDatatype,p.UNSIGNED_BYTE);if(!p.validate(d))throw new t("Invalid description.pixelDatatype.");var m=i.preMultiplyAlpha||c===f.RGB||c===f.LUMINANCE,v=e(i.flipY,!0),g=this._gl,_=g.TEXTURE_CUBE_MAP,y=g.createTexture();return g.activeTexture(g.TEXTURE0),g.bindTexture(_,y),a?(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,v),r(g.TEXTURE_CUBE_MAP_POSITIVE_X,a.positiveX),r(g.TEXTURE_CUBE_MAP_NEGATIVE_X,a.negativeX),r(g.TEXTURE_CUBE_MAP_POSITIVE_Y,a.positiveY),r(g.TEXTURE_CUBE_MAP_NEGATIVE_Y,a.negativeY),r(g.TEXTURE_CUBE_MAP_POSITIVE_Z,a.positiveZ),r(g.TEXTURE_CUBE_MAP_NEGATIVE_Z,a.negativeZ)):(g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X,0,c,u,u,0,c,d,null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c,u,u,0,c,d,null),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c,u,u,0,c,d,null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c,u,u,0,c,d,null),g.texImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c,u,u,0,c,d,null),g.texImage2D(g.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c,u,u,0,c,d,null)),g.bindTexture(_,null),new h(g,this._textureFilterAnisotropic,_,y,c,d,u,m,v)},q.prototype.createFramebuffer=function(e){return new d(this._gl,e)},q.prototype.createRenderbuffer=function(i){i=e(i,e.EMPTY_OBJECT);var r=e(i.format,_.RGBA4),n=i.width!==void 0?i.width:this._canvas.clientWidth,o=i.height!==void 0?i.height:this._canvas.clientHeight,a=this._gl;if(!_.validate(r))throw new t("Invalid format.");if(0>=n)throw new t("Width must be greater than zero.");if(n>this.getMaximumRenderbufferSize())throw new t("Width must be less than or equal to the maximum renderbuffer size ("+this.getMaximumRenderbufferSize()+").  Check getMaximumRenderbufferSize().");if(0>=o)throw new t("Height must be greater than zero.");if(o>this.getMaximumRenderbufferSize())throw new t("Height must be less than or equal to the maximum renderbuffer size ("+this.getMaximumRenderbufferSize()+").  Check getMaximumRenderbufferSize().");return new g(a,r,n,o)};var U=0,k={};q.prototype.createRenderState=function(e){var t=JSON.stringify(e),i=k[t];if(i!==void 0)return i;var r=new y(this,e),n=JSON.stringify(r);return i=k[n],i===void 0&&(r.id=U++,i=r,k[n]=i),k[t]=i,i},q.prototype.createSampler=function(e){var i={wrapS:e.wrapS||b.CLAMP,wrapT:e.wrapT||b.CLAMP,minificationFilter:e.minificationFilter||E.LINEAR,magnificationFilter:e.magnificationFilter||S.LINEAR,maximumAnisotropy:e.maximumAnisotropy!==void 0?e.maximumAnisotropy:1};if(!b.validate(i.wrapS))throw new t("Invalid sampler.wrapS.");if(!b.validate(i.wrapT))throw new t("Invalid sampler.wrapT.");if(!E.validate(i.minificationFilter))throw new t("Invalid sampler.minificationFilter.");if(!S.validate(i.magnificationFilter))throw new t("Invalid sampler.magnificationFilter.");if(1>i.maximumAnisotropy)throw new t("sampler.maximumAnisotropy must be greater than or equal to one.");return i},q.prototype._validateFramebuffer=function(){if(this._validateFB){var e=this._gl,i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!==e.FRAMEBUFFER_COMPLETE){var r;switch(i){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:r="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:r="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:r="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case e.FRAMEBUFFER_UNSUPPORTED:r="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new t(r)}}};var W=new A;return q.prototype.clear=function(t,i){t=e(t,W),i=e(i,this._defaultPassState);var n=this._gl,o=0,a=t.color,s=t.depth,l=t.stencil;a!==void 0&&(r.equals(this._clearColor,a)||(r.clone(a,this._clearColor),n.clearColor(a.red,a.green,a.blue,a.alpha)),o|=n.COLOR_BUFFER_BIT),s!==void 0&&(s!==this._clearDepth&&(this._clearDepth=s,n.clearDepth(s)),o|=n.DEPTH_BUFFER_BIT),l!==void 0&&(l!==this._clearStencil&&(this._clearStencil=l,n.clearStencil(l)),o|=n.STENCIL_BUFFER_BIT);var u=e(t.renderState,this._defaultRenderState);V(this,u,i);var c=e(t.framebuffer,i.framebuffer);c!==void 0&&(c._bind(),this._validateFramebuffer(c)),n.clear(o),c!==void 0&&c._unBind()},q.prototype.draw=function(t,i){i=e(i,this._defaultPassState),this.beginDraw(t,i),this.continueDraw(t),this.endDraw()},q.prototype.beginDraw=function(i,r){if(i===void 0)throw new t("command is required.");if(i.shaderProgram===void 0)throw new t("command.shaderProgram is required.");var n=e(i.framebuffer,r.framebuffer),o=i.shaderProgram,a=i.renderState!==void 0?i.renderState:this._defaultRenderState;if(n!==void 0&&a.depthTest&&a.depthTest.enabled&&!n.hasDepthAttachment())throw new t("The depth test can not be enabled (command.renderState.depthTest.enabled) because the framebuffer (command.framebuffer) does not have a depth or depth-stencil renderbuffer.");V(this,a,r),n!==void 0&&(n._bind(),this._validateFramebuffer(n)),o._bind(),this._currentFramebuffer=n,this._currentSp=o},q.prototype.continueDraw=function(i){var r=this._currentSp;if(r===void 0)throw new t("beginDraw must be called before continueDraw.");if(i===void 0)throw new t("command is required.");var n=i.primitiveType;if(!a.validate(n))throw new t("command.primitiveType is required and must be valid.");if(i.vertexArray===void 0)throw new t("command.vertexArray is required.");var o=i.vertexArray,s=o.getIndexBuffer(),u=i.offset,c=i.count;if(s?(u=(u||0)*s.getBytesPerIndex(),c=c||s.getNumberOfIndices()):(u=u||0,c=c||o._getNumberOfVertices()),0>u)throw new t("command.offset must be omitted or greater than or equal to zero.");c>0&&(this._us.setModel(e(i.modelMatrix,l.IDENTITY)),r._setUniforms(i.uniformMap,this._us,this._validateSP),o._bind(),s?this._gl.drawElements(n,c,s.getIndexDatatype().value,u):this._gl.drawArrays(n,u,c),o._unBind())},q.prototype.endDraw=function(){this._currentFramebuffer!==void 0&&(this._currentFramebuffer._unBind(),this._currentFramebuffer=void 0),this._currentSp._unBind(),this._currentSp=void 0},q.prototype.readPixels=function(e){e=e||{};var i=Math.max(e.x||0,0),r=Math.max(e.y||0,0),n=e.width||this._canvas.clientWidth,o=e.height||this._canvas.clientHeight,a=e.framebuffer||null;if(0>=n)throw new t("readState.width must be greater than zero.");if(0>=o)throw new t("readState.height must be greater than zero.");var s=new Uint8Array(4*n*o);a&&(a._bind(),this._validateFramebuffer(a));var l=this._gl;return l.readPixels(i,r,n,o,l.RGBA,l.UNSIGNED_BYTE,s),a&&a._unBind(),s},q.prototype._interleaveAttributes=function(e){function t(e){return e.values.length/e.componentsPerAttribute}function i(e){return e.componentDatatype.sizeInBytes*e.componentsPerAttribute}var r,n,a,s=[];for(n in e)e.hasOwnProperty(n)&&e[n].values&&s.push(n);var l,u=s.length;if(u>0)for(l=t(e[s[0]]),r=1;u>r;++r){var c=t(e[s[r]]);if(c!==l)throw new o("Each attribute list must have the same number of vertices.  Attribute "+s[r]+" has a different number of vertices "+"("+(""+c)+")"+" than attribute "+s[0]+" ("+(""+l)+").")}s.sort(function(t,i){return e[i].componentDatatype.sizeInBytes-e[t].componentDatatype.sizeInBytes});var h=0,d={};for(r=0;u>r;++r)n=s[r],a=e[n],d[n]=h,h+=i(a);if(h>0){var m=e[s[0]].componentDatatype.sizeInBytes,p=h%m;0!==p&&(h+=m-p);var f=l*h,v=new ArrayBuffer(f),g={};for(r=0;u>r;++r){n=s[r];var _=e[n].componentDatatype.sizeInBytes;g[n]={pointer:e[n].componentDatatype.toTypedArray(v),index:d[n]/_,strideInComponentType:h/_}}for(r=0;l>r;++r)for(var y=0;u>y;++y){n=s[y],a=e[n];for(var w=a.values,C=g[n],x=C.pointer,T=a.componentsPerAttribute,S=0;T>S;++S)x[C.index+S]=w[r*T+S];C.index+=C.strideInComponentType}return{buffer:v,offsetsInBytes:d,vertexSizeInBytes:h}}return void 0},q.prototype.createVertexArrayFromMesh=function(e){var i,r=e||{},o=r.mesh||{},a=r.bufferUsage||c.DYNAMIC_DRAW;if(o.indexLists&&(i=o.indexLists,1!==i.length))throw new t("The mesh must have zero or one index lists.  This mesh has "+(""+i.length)+" index lists.");var s=B(this,e);return i&&s.setIndexBuffer(this.createIndexBuffer(new Uint16Array(i[0].values),a,n.UNSIGNED_SHORT)),s},q.prototype.createPickFramebuffer=function(){return new v(this)},q.prototype.getObjectByPickColor=function(e){if(e===void 0)throw new t("pickColor is required.");return this._pickObjects[e.toRgba()]},F.prototype.destroy=function(){return delete this._pickObjects[this.key],void 0},q.prototype.createPickId=function(e){if(e===void 0)throw new t("object is required.");++this._nextPickColor[0];var i=this._nextPickColor[0];if(0===i)throw new o("Out of unique Pick IDs.");return this._pickObjects[i]=e,new F(this._pickObjects,i,r.fromRgba(i))},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){var e=this.cache;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];r.destroy!==void 0&&r.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),i(this)},q}),i("Renderer/loadCubeMap",["../Core/DeveloperError","../Core/loadImage","../ThirdParty/when"],function(e,t,i){var r=function(r,n,o){if(r===void 0)throw new e("context is required.");if(n===void 0||n.positiveX===void 0||n.negativeX===void 0||n.positiveY===void 0||n.negativeY===void 0||n.positiveZ===void 0||n.negativeZ===void 0)throw new e("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");var a=[t(n.positiveX,o),t(n.negativeX,o),t(n.positiveY,o),t(n.negativeY,o),t(n.positiveZ,o),t(n.negativeZ,o)];return i.all(a,function(e){return r.createCubeMap({source:{positiveX:e[0],negativeX:e[1],positiveY:e[2],negativeY:e[3],positiveZ:e[4],negativeZ:e[5]}})})};return r}),i("ThirdParty/Tween",[],function(){var e=e||function(){var e=[];return{REVISION:"7",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},update:function(t){if(0===e.length)return!1;var i=0,r=e.length;for(t=void 0!==t?t:Date.now();r>i;)e[i].update(t)?i++:(e.splice(i,1),r--);return!0}}}();return e.Tween=function(t){var i=t,r={},n={},o=1e3,a=0,s=null,l=e.Easing.Linear.None,u=e.Interpolation.Linear,c=[],h=null,d=!1,m=null,p=null;this.to=function(e,t){return void 0!==t&&(o=t),n=e,this},this.start=function(t){e.add(this),d=!1,s=void 0!==t?t:Date.now(),s+=a;for(var o in n)if(null!==i[o]){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[i[o]].concat(n[o])}r[o]=i[o]}return this},this.stop=function(){return e.remove(this),this
},this.delay=function(e){return a=e,this},this.easing=function(e){return l=e,this},this.interpolation=function(e){return u=e,this},this.chain=function(){return c=arguments,this},this.onStart=function(e){return h=e,this},this.onUpdate=function(e){return m=e,this},this.onComplete=function(e){return p=e,this},this.update=function(e){if(s>e)return!0;d===!1&&(null!==h&&h.call(i),d=!0);var t=(e-s)/o;t=t>1?1:t;var a=l(t);for(var f in r){var v=r[f],g=n[f];i[f]=g instanceof Array?u(g,a):v+(g-v)*a}if(null!==m&&m.call(i,a),1==t){null!==p&&p.call(i);for(var _=0,y=c.length;y>_;_++)c[_].start(e);return!1}return!0}},e.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)))},Out:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1)},InOut:function(e){var t,i=.1,r=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=r/4):t=r*Math.asin(1/i)/(2*Math.PI),1>(e*=2)?-.5*i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r):.5*i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return 1>(e*=2)?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(t){return 1-e.Easing.Bounce.Out(1-t)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(t){return.5>t?.5*e.Easing.Bounce.In(2*t):.5*e.Easing.Bounce.Out(2*t-1)+.5}}},e.Interpolation={Linear:function(t,i){var r=t.length-1,n=r*i,o=Math.floor(n),a=e.Interpolation.Utils.Linear;return 0>i?a(t[0],t[1],n):i>1?a(t[r],t[r-1],r-n):a(t[o],t[o+1>r?r:o+1],n-o)},Bezier:function(t,i){var r,n=0,o=t.length-1,a=Math.pow,s=e.Interpolation.Utils.Bernstein;for(r=0;o>=r;r++)n+=a(1-i,o-r)*a(i,r)*t[r]*s(o,r);return n},CatmullRom:function(t,i){var r=t.length-1,n=r*i,o=Math.floor(n),a=e.Interpolation.Utils.CatmullRom;return t[0]===t[r]?(0>i&&(o=Math.floor(n=r*(1+i))),a(t[(o-1+r)%r],t[o],t[(o+1)%r],t[(o+2)%r],n-o)):0>i?t[0]-(a(t[0],t[0],t[1],t[1],-n)-t[0]):i>1?t[r]-(a(t[r],t[r],t[r-1],t[r-1],n-r)-t[r]):a(t[o?o-1:0],t[o],t[o+1>r?r:o+1],t[o+2>r?r:o+2],n-o)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(t,i){var r=e.Interpolation.Utils.Factorial;return r(t)/r(i)/r(t-i)},Factorial:function(){var e=[1];return function(t){var i,r=1;if(e[t])return e[t];for(i=t;i>1;i--)r*=i;return e[t]=r}}(),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n,l=n*s;return(2*t-2*i+o+a)*l+(-3*t+3*i-2*o-a)*s+o*n+t}}},e}),i("Scene/AnimationCollection",["../Core/DeveloperError","../Core/clone","../ThirdParty/Tween","../Core/defaultValue"],function(e,t,i,r){var n=function(){};return n.prototype.add=function(n){if(n=r(n,r.EMPTY_OBJECT),n.duration===void 0)throw new e("duration is required.");var o=r(n.delayDuration,0),a=r(n.easingFunction,i.Easing.Linear.None),s=t(n.startValue),l=new i.Tween(s);return l.to(n.stopValue,n.duration),l.delay(o),l.easing(a),"function"==typeof n.onUpdate&&l.onUpdate(function(){n.onUpdate(s)}),l.onComplete(r(n.onComplete,null)),l.start(),{_tween:l}},n.prototype.addAlpha=function(t,n,o,a){if(t===void 0)throw new e("material is required.");var s=[];for(var l in t.uniforms)t.uniforms.hasOwnProperty(l)&&t.uniforms[l]!==void 0&&t.uniforms[l].alpha!==void 0&&s.push(l);if(0===s.length)throw new e("material has no properties with alpha components.");n=r(n,0),o=r(o,1),a=r(a,r.EMPTY_OBJECT);var u=r(a.duration,3e3),c=r(a.delayDuration,0),h=r(a.easingFunction,i.Easing.Linear.None),d={alpha:n},m=new i.Tween(d);return m.to({alpha:o},u),m.delay(c),m.easing(h),m.onUpdate(function(){for(var e=s.length,i=0;e>i;++i)t.uniforms[s[i]].alpha=d.alpha}),m.onComplete(r(a.onComplete,null)),m.start(),{_tween:m}},n.prototype.addProperty=function(t,n,o,a,s){if(t===void 0)throw new e("object is required.");if(n===void 0)throw new e("property is required.");if(t[n]===void 0)throw new e("object must have the specified property.");s=r(s,r.EMPTY_OBJECT);var l=r(s.duration,3e3),u=r(s.delayDuration,0),c=r(s.easingFunction,i.Easing.Linear.None),h={value:o},d=new i.Tween(h);return d.to({value:a},l),d.delay(u),d.easing(c),d.onUpdate(function(){t[n]=h.value}),d.onComplete(r(s.onComplete,null)),d.start(),{_tween:d}},n.prototype.addOffsetIncrement=function(t,n){if(t===void 0)throw new e("material is required.");if(t.uniforms.offset===void 0)throw new e("material must have an offset property.");n=r(n,r.EMPTY_OBJECT);var o=r(n.duration,3e3),a=r(n.delayDuration,0),s=r(n.easingFunction,i.Easing.Linear.None),l={offset:t.uniforms.offset},u=new i.Tween(l);return u.to({offset:t.uniforms.offset+1},o),u.delay(a),u.easing(s),u.onUpdate(function(){t.uniforms.offset=l.offset}),u.onComplete(function(){u.to({offset:t.uniforms.offset+1},o),u.start()}),u.start(),{_tween:u}},n.prototype.remove=function(e){if(e!==void 0){var t=i.getAll().length;return i.remove(e._tween),i.getAll().length===t-1}return!1},n.prototype.removeAll=function(){i.removeAll()},n.prototype.contains=function(e){return e!==void 0?-1!==i.getAll().indexOf(e._tween):!1},n.prototype.update=function(){i.update()},n}),i("Scene/TerrainProvider",["../Core/DeveloperError","../Core/ComponentDatatype","../Renderer/BufferUsage","../Core/IndexDatatype"],function(e,t,i,r){function n(e,t,i,r,n){return e[t++]=i,e[t++]=r,e[t++]=r,e[t++]=n,e[t++]=n,e[t++]=i,t}function o(e){for(var t=e.length,i=new Uint16Array(2*t),r=0,o=0;t>o;o+=3)r=n(i,r,e[o],e[o+1],e[o+2]);return i}var a=function(){throw new e("This type should not be instantiated directly.")};a.attributeIndices={position3DAndHeight:0,textureCoordinates:1},a.wireframe=!1;var s=[];return a.getRegularGridIndices=function(e,t){var i=s[e];i===void 0&&(s[e]=i=[]);var r=i[t];if(r===void 0){r=i[t]=new Uint16Array(6*(e-1)*(t-1));for(var n=0,o=0,a=0;t-1>a;++a){for(var l=0;e-1>l;++l){var u=n,c=u+e,h=c+1,d=u+1;r[o++]=u,r[o++]=c,r[o++]=d,r[o++]=d,r[o++]=c,r[o++]=h,++n}++n}}return r},a.createTileEllipsoidGeometryFromBuffers=function(e,n,s,l){var u=t.FLOAT,c=n.vertices,h=e.createVertexBuffer(c,i.STATIC_DRAW),d=5*u.sizeInBytes,m=3;l&&(d+=u.sizeInBytes,++m);var p=[{index:a.attributeIndices.position3DAndHeight,vertexBuffer:h,componentDatatype:u,componentsPerAttribute:m,offsetInBytes:0,strideInBytes:d},{index:a.attributeIndices.textureCoordinates,vertexBuffer:h,componentDatatype:u,componentsPerAttribute:2,offsetInBytes:m*u.sizeInBytes,strideInBytes:d}],f=n.indices.indexBuffers||{},v=f[e.getId()];if(v===void 0||v.isDestroyed()){var g=n.indices;a.wireframe&&(g=o(n.indices)),v=e.createIndexBuffer(g,i.STATIC_DRAW,r.UNSIGNED_SHORT),v.setVertexArrayDestroyable(!1),v.referenceCount=1,f[e.getId()]=v,n.indices.indexBuffers=f}else++v.referenceCount;s.vertexArray=e.createVertexArray(p,v)},a.heightmapTerrainQuality=.25,a.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,i){return 2*e.getMaximumRadius()*Math.PI*a.heightmapTerrainQuality/(t*i)},a.prototype.requestTileGeometry=function(){throw new e("This type should not be instantiated directly.")},a.prototype.getErrorEvent=function(){throw new e("This type should not be instantiated directly.")},a.prototype.getLevelMaximumGeometricError=function(){throw new e("This type should not be instantiated directly.")},a.prototype.getLogo=function(){throw new e("This type should not be instantiated directly.")},a.prototype.getTilingScheme=function(){throw new e("This type should not be instantiated directly.")},a.prototype.hasWaterMask=function(){throw new e("This type should not be instantiated directly.")},a.prototype.isReady=function(){throw new e("This type should not be instantiated directly.")},a}),i("Scene/ImageryState",["../Core/Enumeration"],function(e){var t={UNLOADED:new e(0,"UNLOADED"),TRANSITIONING:new e(1,"TRANSITIONING"),RECEIVED:new e(2,"RECEIVED"),TEXTURE_LOADED:new e(3,"TEXTURE_LOADED"),READY:new e(4,"READY"),FAILED:new e(5,"FAILED"),INVALID:new e(6,"INVALID"),PLACEHOLDER:new e(7,"PLACEHOLDER")};return t}),i("Scene/TerrainState",["../Core/Enumeration"],function(e){var t={FAILED:new e(0,"FAILED"),UNLOADED:new e(1,"UNLOADED"),RECEIVING:new e(2,"RECEIVING"),RECEIVED:new e(3,"RECEIVED"),TRANSFORMING:new e(4,"TRANSFORMING"),TRANSFORMED:new e(5,"TRANSFORMED"),READY:new e(6,"READY")};return t}),i("Scene/TileState",["../Core/Enumeration"],function(e){var t={START:new e(0,"START"),LOADING:new e(1,"LOADING"),READY:new e(2,"READY")};return t}),i("Scene/TileProviderError",["../Core/defaultValue","../Core/loadImage","../Core/DeveloperError","../Core/throttleRequestByServer"],function(e){var t=function t(t,i,r,n,o,a){this.provider=t,this.message=i,this.x=r,this.y=n,this.level=o,this.timesRetried=e(a,0),this.retry=!1};return t.handleError=function(e,i,r,n,o,a,s,l){var u=e;return e===void 0?u=new t(i,n,o,a,s,0):(u.provider=i,u.message=n,u.x=o,u.y=a,u.level=s,u.retry=!1,++u.timesRetried),r.getNumberOfListeners()>0?r.raiseEvent(u):(console.log('An error occurred in "'+i.constructor.name+'":'),console.log(n)),u.retry&&l!==void 0&&l(),u},t.handleSuccess=function(e){e!==void 0&&(e.timesRetried=-1)},t}),i("Scene/TileTerrain",["../Core/BoundingSphere","../Core/Cartesian3","../Core/DeveloperError","./TerrainProvider","./TerrainState","./TileProviderError","../ThirdParty/when"],function(e,t,i,r,n,o,a){function s(e,t,i,r,s){function l(t){e.data=t,e.state=n.RECEIVED}function u(){e.state=n.FAILED;var a="Failed to obtain terrain tile X: "+i+" Y: "+r+" Level: "+s+".";t._requestError=o.handleError(t._requestError,t,t.getErrorEvent(),a,i,r,s,c)}function c(){e.data=t.requestTileGeometry(i,r,s),e.data!==void 0?(e.state=n.RECEIVING,a(e.data,l,u)):e.state=n.UNLOADED}c()}function l(e,t,i,r,o,s){var l=i.getTilingScheme(),u=e.data,c=u.createMesh(l,r,o,s);void 0!==c&&(e.state=n.TRANSFORMING,a(c,function(t){e.mesh=t,e.state=n.TRANSFORMED},function(){e.state=n.FAILED}))}function u(e,t){r.createTileEllipsoidGeometryFromBuffers(t,e.mesh,e,!0),e.state=n.READY}var c=function c(e){this.state=n.UNLOADED,this.data=void 0,this.mesh=void 0,this.vertexArray=void 0,this.upsampleDetails=e};return c.prototype.freeResources=function(){if(this.state=n.UNLOADED,this.data=void 0,this.mesh=void 0,this.vertexArray!==void 0){var e=this.vertexArray.getIndexBuffer();this.vertexArray.destroy(),this.vertexArray=void 0,e.isDestroyed()||void 0===e.referenceCount||(--e.referenceCount,0===e.referenceCount&&e.destroy())}},c.prototype.publishToTile=function(i){var r=this.mesh;t.clone(r.center,i.center),i.minimumHeight=r.minimumHeight,i.maximumHeight=r.maximumHeight,e.clone(r.boundingSphere3D,i.boundingSphere3D),r.occludeePointInScaledSpace!==void 0?t.clone(r.occludeePointInScaledSpace,i.occludeePointInScaledSpace):i.occludeePointInScaledSpace=void 0,i.freeVertexArray(),i.vertexArray=this.vertexArray,this.vertexArray=void 0},c.prototype.processLoadStateMachine=function(e,t,i,r,o){this.state===n.UNLOADED&&s(this,t,i,r,o),this.state===n.RECEIVED&&l(this,e,t,i,r,o),this.state===n.TRANSFORMED&&u(this,e,t,i,r,o)},c.prototype.processUpsampleStateMachine=function(e,t,r,o,s){if(this.state===n.UNLOADED){var c=this.upsampleDetails;if(c===void 0)throw new i("TileTerrain cannot upsample unless provided upsampleDetails.");var h=c.data,d=c.x,m=c.y,p=c.level;if(this.data=h.upsample(t.getTilingScheme(),d,m,p,r,o,s),this.data===void 0)return;this.state=n.RECEIVING;var f=this;a(this.data,function(e){f.data=e,f.state=n.RECEIVED},function(){f.state=n.FAILED})}this.state===n.RECEIVED&&l(this,e,t,r,o,s),this.state===n.TRANSFORMED&&u(this,e,t,r,o,s)},c}),i("Scene/Tile",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/DeveloperError","./ImageryState","./TerrainState","./TileState","./TileTerrain","../Renderer/PixelDatatype","../Renderer/PixelFormat","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){function m(e,i,r){var n=f(e);n!==void 0&&(e.upsampledTerrain=new s(n)),_(e)&&(e.loadedTerrain=new s);for(var o=0,a=r.getLength();a>o;++o){var l=r.get(o);l.show&&l._createTileImagerySkeletons(e,i)}var u=e.tilingScheme.getEllipsoid(),c=e.extent;u.cartographicToCartesian(c.getSouthwest(),e.southwestCornerCartesian);var h=u.cartographicToCartesian(c.getSoutheast(),S);u.cartographicToCartesian(c.getNortheast(),e.northeastCornerCartesian);var d=u.cartographicToCartesian(c.getNorthwest(),E);t.UNIT_Z.cross(e.southwestCornerCartesian.negate(x),x).normalize(e.westNormal),e.northeastCornerCartesian.negate(x).cross(t.UNIT_Z,x).normalize(e.eastNormal),u.geodeticSurfaceNormal(h,x).cross(e.southwestCornerCartesian.subtract(h,T),x).normalize(e.southNormal),u.geodeticSurfaceNormal(d,x).cross(e.northeastCornerCartesian.subtract(d,T),x).normalize(e.northNormal)}function p(e,t,i){var r=e.loadedTerrain,n=e.upsampledTerrain,a=!1;if(r!==void 0){if(r.processLoadStateMachine(t,i,e.x,e.y,e.level),r.state.value>=o.RECEIVED.value){if(e.terrainData!==r.data){e.terrainData=r.data;var s=e.terrainData.getWaterMask();s!==void 0&&(e.waterMaskTexture!==void 0&&(--e.waterMaskTexture.referenceCount,0===e.waterMaskTexture.referenceCount&&e.waterMaskTexture.destroy()),e.waterMaskTexture=y(t,s),e.waterMaskTranslationAndScale.x=0,e.waterMaskTranslationAndScale.y=0,e.waterMaskTranslationAndScale.z=1,e.waterMaskTranslationAndScale.w=1),g(e)}a=!0}r.state===o.READY?(r.publishToTile(e),e.loadedTerrain=void 0,e.upsampledTerrain=void 0):r.state===o.FAILED&&(e.loadedTerrain=void 0)}a||void 0===n||(n.processUpsampleStateMachine(t,i,e.x,e.y,e.level),n.state.value>=o.RECEIVED.value&&e.terrainData!==n.data&&(e.terrainData=n.data,i.hasWaterMask()&&w(e,t),v(e)),n.state===o.READY?(n.publishToTile(e),e.upsampledTerrain=void 0):n.state===o.FAILED&&(e.upsampledTerrain=void 0))}function f(e){for(var t=e.parent;t!==void 0&&t.terrainData===void 0;)t=t.parent;return t===void 0?void 0:{data:t.terrainData,x:t.x,y:t.y,level:t.level}}function v(e){if(e.children!==void 0)for(var t=0;4>t;++t){var i=e.children[t];if(i.state!==a.START){if(i.terrainData!==void 0&&!i.terrainData.wasCreatedByUpsampling())continue;i.upsampledTerrain!==void 0&&i.upsampledTerrain.freeResources(),i.upsampledTerrain=new s({data:e.terrainData,x:e.x,y:e.y,level:e.level}),i.state=a.LOADING}}}function g(e){if(e.children!==void 0)for(var t=0;4>t;++t){var i=e.children[t];if(i.state!==a.START){if(i.terrainData!==void 0&&!i.terrainData.wasCreatedByUpsampling())continue;i.upsampledTerrain!==void 0&&i.upsampledTerrain.freeResources(),i.upsampledTerrain=new s({data:e.terrainData,x:e.x,y:e.y,level:e.level}),e.terrainData.isChildAvailable(e.x,e.y,i.x,i.y)&&i.loadedTerrain===void 0&&(i.loadedTerrain=new s),i.state=a.LOADING}}}function _(e){var t=e.parent;return t===void 0?!0:t.terrainData===void 0?!1:t.terrainData.isChildAvailable(t.x,t.y,e.x,e.y)}function y(e,t){var i,r=e.cache.tile_waterMaskData;r===void 0&&(r=e.cache.tile_waterMaskData={allWaterTexture:void 0,allLandTexture:void 0,sampler:void 0,destroy:function(){this.allWaterTexture!==void 0&&this.allWaterTexture.destroy(),this.allLandTexture!==void 0&&this.allLandTexture.destroy()}});var n=Math.sqrt(t.length);return 1!==n||0!==t[0]&&255!==t[0]?(i=e.createTexture2D({pixelFormat:u.LUMINANCE,pixelDatatype:l.UNSIGNED_BYTE,source:{width:n,height:n,arrayBufferView:t}}),i.referenceCount=0,r.sampler===void 0&&(r.sampler=e.createSampler({wrapS:d.CLAMP,wrapT:d.CLAMP,minificationFilter:h.LINEAR,magnificationFilter:c.LINEAR})),i.setSampler(r.sampler)):(r.allWaterTexture===void 0&&(r.allWaterTexture=e.createTexture2D({pixelFormat:u.LUMINANCE,pixelDatatype:l.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}}),r.allWaterTexture.referenceCount=1,r.allLandTexture=e.createTexture2D({pixelFormat:u.LUMINANCE,pixelDatatype:l.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([0]),width:1,height:1}}),r.allLandTexture.referenceCount=1),i=0===t[0]?r.allLandTexture:r.allWaterTexture),++i.referenceCount,i}function w(e){for(var t=e.parent;t!==void 0&&(t.terrainData===void 0||t.terrainData.wasCreatedByUpsampling());)t=t.parent;if(void 0!==t&&void 0!==t.waterMaskTexture){e.waterMaskTexture=t.waterMaskTexture,++e.waterMaskTexture.referenceCount;var i=t.extent,r=e.extent,n=r.east-r.west,o=r.north-r.south,a=n/(i.east-i.west),s=o/(i.north-i.south);e.waterMaskTranslationAndScale.x=a*(r.west-i.west)/n,e.waterMaskTranslationAndScale.y=s*(r.south-i.south)/o,e.waterMaskTranslationAndScale.z=a,e.waterMaskTranslationAndScale.w=s}}var C=function(n){if(n===void 0)throw new r("description is required.");if(n.x===void 0||n.y===void 0){if(n.extent===void 0)throw new r("Either description.extent is required or description.x and description.y are required.")}else if(0>n.x||0>n.y)throw new r("description.x and description.y must be greater than or equal to zero.");if(n.level===void 0||0>n.zoom)throw new r("description.level is required and must be greater than or equal to zero.");if(n.tilingScheme===void 0)throw new r("description.tilingScheme is required.");this.tilingScheme=n.tilingScheme,this.x=n.x,this.y=n.y,this.level=n.level,this.parent=n.parent,this.children=void 0,this.extent=this.tilingScheme.tileXYToExtent(this.x,this.y,this.level),this.state=a.START,this.loadPrevious=void 0,this.loadNext=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this.imagery=[],this.distance=0,this.southwestCornerCartesian=new t,this.northeastCornerCartesian=new t,this.westNormal=new t,this.southNormal=new t,this.eastNormal=new t,this.northNormal=new t,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new i(0,0,1,1),this.terrainData=void 0,this.center=new t,this.vertexArray=void 0,this.minimumHeight=0,this.maximumHeight=0,this.boundingSphere3D=new e,this.boundingSphere2D=new e,this.occludeePointInScaledSpace=new t,this.isRenderable=!1,this.loadedTerrain=void 0,this.upsampledTerrain=void 0};C.prototype.getChildren=function(){if(this.children===void 0){var e=this.tilingScheme,t=this.level+1,i=2*this.x,r=2*this.y;this.children=[new C({tilingScheme:e,x:i,y:r,level:t,parent:this}),new C({tilingScheme:e,x:i+1,y:r,level:t,parent:this}),new C({tilingScheme:e,x:i,y:r+1,level:t,parent:this}),new C({tilingScheme:e,x:i+1,y:r+1,level:t,parent:this})]}return this.children},C.prototype.freeResources=function(){this.waterMaskTexture!==void 0&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.state=a.START,this.isRenderable=!1,this.terrainData=void 0,this.loadedTerrain!==void 0&&(this.loadedTerrain.freeResources(),this.loadedTerrain=void 0),this.upsampledTerrain!==void 0&&(this.upsampledTerrain.freeResources(),this.upsampledTerrain=void 0);var e,t,i=this.imagery;for(e=0,t=i.length;t>e;++e)i[e].freeResources();if(this.imagery.length=0,this.children!==void 0){for(e=0,t=this.children.length;t>e;++e)this.children[e].freeResources();this.children=void 0}this.freeVertexArray()},C.prototype.freeVertexArray=function(){if(this.vertexArray!==void 0){var e=this.vertexArray.getIndexBuffer();this.vertexArray.destroy(),this.vertexArray=void 0,e.isDestroyed()||void 0===e.referenceCount||(--e.referenceCount,0===e.referenceCount&&e.destroy())}},C.prototype.processStateMachine=function(e,t,i){this.state===a.START&&(m(this,t,i),this.state=a.LOADING),this.state===a.LOADING&&p(this,e,t);for(var r=this.vertexArray!==void 0,o=this.loadedTerrain===void 0&&this.upsampledTerrain===void 0,s=this.imagery,l=0,u=s.length;u>l;++l){var c=s[l],h=c.imagery,d=h.imageryLayer;if(h.state===n.PLACEHOLDER&&d.getImageryProvider().isReady()&&(c.freeResources(),s.splice(l,1),d._createTileImagerySkeletons(this,t,l),--l,u=s.length),h.state===n.UNLOADED&&(h.state=n.TRANSITIONING,d._requestImagery(h)),h.state===n.RECEIVED&&(h.state=n.TRANSITIONING,d._createTexture(e,h)),h.state===n.TEXTURE_LOADED&&(h.state=n.TRANSITIONING,d._reprojectTexture(e,h)),h.state===n.FAILED||h.state===n.INVALID){for(var f=h.parent;f!==void 0&&(f.state===n.FAILED||f.state===n.INVALID);)f=f.parent;if(f===void 0){c.freeResources(),s.splice(l,1),--l,u=s.length;continue}c.originalImagery=h,f.addReference(),c.imagery=f,h=f}var v=h.state===n.READY;v&&c.textureTranslationAndScale===void 0&&(c.textureTranslationAndScale=d._calculateTextureTranslationAndScale(this,c)),r=r&&(v||0===d.alpha),o=o&&v}l===u&&r&&(this.isRenderable=!0,o&&(this.state=a.READY))};var x=new t,T=new t,S=new t,E=new t;return C}),i("Scene/TilingScheme",["../Core/DeveloperError","./Tile"],function(e,t){var i=function i(){throw new e("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.")};return i.prototype.getEllipsoid=function(){throw new e("This type should not be instantiated directly.")},i.prototype.getExtent=function(){throw new e("This type should not be instantiated directly.")},i.prototype.getProjection=function(){throw new e("This type should not be instantiated directly.")},i.prototype.getNumberOfXTilesAtLevel=function(){throw new e("This type should not be instantiated directly.")},i.prototype.getNumberOfYTilesAtLevel=function(){throw new e("This type should not be instantiated directly.")},i.prototype.createLevelZeroTiles=function(){throw new e("This type should not be instantiated directly.")},i.prototype.extentToNativeExtent=function(){throw new e("This type should not be instantiated directly.")},i.prototype.tileXYToNativeExtent=function(){throw new e("This type should not be instantiated directly.")},i.prototype.tileXYToExtent=function(){throw new e("This type should not be instantiated directly.")},i.prototype.positionToTileXY=function(){throw new e("This type should not be instantiated directly.")},i.createRectangleOfLevelZeroTiles=function(i,r,n){if(i===void 0)throw new e("tilingScheme is required.");if(r===void 0)throw new e("numberOfLevelZeroTilesX is required.");if(n===void 0)throw new e("numberOfLevelZeroTilesY is required.");for(var o=Array(r*n),a=0,s=0;n>s;++s)for(var l=0;r>l;++l)o[a++]=new t({tilingScheme:i,x:l,y:s,level:0});return o},i}),i("Scene/GeographicTilingScheme",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Cartesian2","../Core/Ellipsoid","../Core/Extent","../Core/GeographicProjection","./TilingScheme"],function(e,t,i,r,n,o,a,s){var l=function l(t){t=e(t,{}),this._ellipsoid=e(t.ellipsoid,n.WGS84),this._extent=e(t.extent,o.MAX_VALUE),this._projection=new a(this._ellipsoid),this._numberOfLevelZeroTilesX=e(t.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=e(t.numberOfLevelZeroTilesY,1)};return l.prototype.getEllipsoid=function(){return this._ellipsoid},l.prototype.getExtent=function(){return this._extent},l.prototype.getProjection=function(){return this._projection},l.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},l.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},l.prototype.createLevelZeroTiles=function(){return s.createRectangleOfLevelZeroTiles(this,this._numberOfLevelZeroTilesX,this._numberOfLevelZeroTilesY)},l.prototype.extentToNativeExtent=function(e,r){if(e===void 0)throw new t("extent is required.");var n=i.toDegrees(e.west),a=i.toDegrees(e.south),s=i.toDegrees(e.east),l=i.toDegrees(e.north);return r===void 0?new o(n,a,s,l):(r.west=n,r.south=a,r.east=s,r.north=l,r)},l.prototype.tileXYToNativeExtent=function(e,t,r,n){var o=this.tileXYToExtent(e,t,r,n);return o.west=i.toDegrees(o.west),o.south=i.toDegrees(o.south),o.east=i.toDegrees(o.east),o.north=i.toDegrees(o.north),o},l.prototype.tileXYToExtent=function(e,t,i,r){var n=this._extent,a=this.getNumberOfXTilesAtLevel(i),s=this.getNumberOfYTilesAtLevel(i),l=(n.east-n.west)/a,u=e*l+n.west,c=(e+1)*l+n.west,h=(n.north-n.south)/s,d=n.north-t*h,m=n.north-(t+1)*h;return r===void 0&&(r=new o(u,m,c,d)),r.west=u,r.south=m,r.east=c,r.north=d,r},l.prototype.positionToTileXY=function(e,t,i){var n=this._extent;if(e.latitude>n.north||n.south>e.latitude||n.west>e.longitude||e.longitude>n.east)return void 0;var o=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),s=(n.east-n.west)/o,l=(n.north-n.south)/a,u=0|(e.longitude-n.west)/s;u>=o&&(u=o-1);var c=0|(n.north-e.latitude)/l;return c>=a&&(c=a-1),i===void 0?new r(u,c):(i.x=u,i.y=c,i)},l}),i("Scene/TerrainMesh",[],function(){var e=function e(e,t,i,r,n,o,a){this.center=e,this.vertices=t,this.indices=i,this.minimumHeight=r,this.maximumHeight=n,this.boundingSphere3D=o,this.occludeePointInScaledSpace=a};return e}),i("Scene/HeightmapTerrainData",["../Core/defaultValue","../Core/BoundingSphere","../Core/Cartesian3","../Core/DeveloperError","../Core/HeightmapTessellator","../Core/Math","../Core/Occluder","../Core/TaskProcessor","./GeographicTilingScheme","./TerrainMesh","./TerrainProvider","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h){function d(e,t,i,r,n,o,a){var s=1,l=e._width,u=e._height,c=o*(l-1),h=c+l-1,d=a*(u-1),m=d+u-1,p=1<<s;c/=p,h/=p,d/=p,m/=p;var f=i*(l-1),v=r*(u-1);c-=f,h-=f,d-=v,m-=v;var g,_,w=0|c,C=0|h,x=0|d,T=0|m,S=C-w+1,E=T-x+1,b=e._buffer,M=e._structure,I=S*E,D=I*M.stride,A=new b.constructor(D),P=0,R=M.stride;if(R>1)for(_=x;T>=_;++_)for(g=w;C>=g;++g)for(var O=(_*l+g)*R,z=0;R>z;++z)A[P++]=b[O+z];else for(_=x;T>=_;++_)for(g=w;C>=g;++g)A[P++]=b[_*l+g];return new y({buffer:A,width:S,height:E,childTileMask:0,structure:e._structure,createdByUpsampling:!0})}function m(e,t,i,r,n,a,s,l){var u,c,h,d,m=e._width,v=e._height,g=e._structure,w=g.stride,C=e._buffer,x=new C.constructor(m*v*w),T=t.tileXYToExtent(i,r,n),S=t.tileXYToExtent(a,s,l);if(w>1){var E=g.elementsPerHeight,b=g.elementMultiplier,M=g.isBigEndian,I=Math.pow(b,E-1);for(c=0;v>c;++c)for(h=o.lerp(S.north,S.south,c/(v-1)),u=0;m>u;++u){d=o.lerp(S.west,S.east,u/(m-1));var D=f(C,E,b,w,M,T,m,v,d,h);_(x,E,b,I,w,M,c*m+u,D)}}else for(c=0;v>c;++c)for(h=o.lerp(S.north,S.south,c/(v-1)),u=0;m>u;++u)d=o.lerp(S.west,S.east,u/(m-1)),x[c*m+u]=p(C,T,m,v,d,h);return new y({buffer:x,width:m,height:v,childTileMask:0,structure:e._structure,createdByUpsampling:!0})}function p(e,t,i,r,n,o){var a=(n-t.west)*(i-1)/(t.east-t.west),s=(o-t.south)*(r-1)/(t.north-t.south),l=0|a,u=l+1;u>=i&&(u=i-1,l=i-2);var c=0|s,h=c+1;h>=r&&(h=r-1,c=r-2);var d=a-l,m=s-c;c=r-1-c,h=r-1-h;var p=e[c*i+l],f=e[c*i+u],g=e[h*i+l],_=e[h*i+u];return v(d,m,p,f,g,_)}function f(e,t,i,r,n,o,a,s,l,u){var c=(l-o.west)*(a-1)/(o.east-o.west),h=(u-o.south)*(s-1)/(o.north-o.south),d=0|c,m=d+1;m>=a&&(m=a-1,d=a-2);var p=0|h,f=p+1;f>=s&&(f=s-1,p=s-2);var _=c-d,y=h-p;p=s-1-p,f=s-1-f;var w=g(e,t,i,r,n,p*a+d),C=g(e,t,i,r,n,p*a+m),x=g(e,t,i,r,n,f*a+d),T=g(e,t,i,r,n,f*a+m);return v(_,y,w,C,x,T)}function v(e,t,i,r,n,o){return e>t?i+e*(r-i)+t*(o-r):i+e*(o-n)+t*(n-i)}function g(e,t,i,r,n,o){o*=r;var a,s=0;if(n)for(a=0;t>a;++a)s=s*i+e[o+a];else for(a=t-1;a>=0;--a)s=s*i+e[o+a];return s}function _(e,t,i,r,n,o,a,s){a*=n;var l;if(o)for(l=0;t>l;++l)e[a+l]=0|s/r,s-=e[a+l]*r,r/=i;else for(l=t-1;l>=0;--l)e[a+l]=0|s/r,s-=e[a+l]*r,r/=i}var y=function y(t){if(t===void 0||t.buffer===void 0)throw new r("description.buffer is required.");if(t.width===void 0)throw new r("description.width is required.");if(t.height===void 0)throw new r("description.height is required.");this._buffer=t.buffer,this._width=t.width,this._height=t.height,this._childTileMask=e(t.childTileMask,15);var i=n.DEFAULT_STRUCTURE,o=t.structure;o===void 0?o=i:o!==i&&(o.heightScale=e(o.heightScale,i.heightScale),o.heightOffset=e(o.heightOffset,i.heightOffset),o.elementsPerHeight=e(o.elementsPerHeight,i.elementsPerHeight),o.stride=e(o.stride,i.stride),o.elementMultiplier=e(o.elementMultiplier,i.elementMultiplier),o.isBigEndian=e(o.isBigEndian,i.isBigEndian)),this._structure=o,this._createdByUpsampling=e(t.createdByUpsampling,!1),this._waterMask=t.waterMask},w=new s("createVerticesFromHeightmap");return y.prototype.createMesh=function(e,t,i,n){if(e===void 0)throw new r("tilingScheme is required.");if(t===void 0)throw new r("x is required.");if(i===void 0)throw new r("y is required.");if(n===void 0)throw new r("level is required.");var o=e.getEllipsoid(),a=e.tileXYToNativeExtent(t,i,n),s=e.tileXYToExtent(t,i,n),d=o.cartographicToCartesian(s.getCenter()),m=this._structure,p=c.getEstimatedLevelZeroGeometricErrorForAHeightmap(o,this._width,e.getNumberOfXTilesAtLevel(0)),f=p/(1<<n),v=w.scheduleTask({heightmap:this._buffer,structure:m,width:this._width,height:this._height,nativeExtent:a,extent:s,relativeToCenter:d,ellipsoid:o,skirtHeight:Math.min(4*f,1e3),isGeographic:e instanceof l});return v===void 0?void 0:h(v,function(e){return new u(d,new Float32Array(e.vertices),c.getRegularGridIndices(e.gridWidth,e.gridHeight),e.minimumHeight,e.maximumHeight,e.boundingSphere3D,e.occludeePointInScaledSpace)})},y.prototype.interpolateHeight=function(e,t,i){var r,n=this._width,o=this._height,a=this._structure,s=a.stride;if(s>1){var l=a.elementsPerHeight,u=a.elementMultiplier,c=a.isBigEndian;r=f(this._buffer,l,u,s,c,e,n,o,t,i)}else r=p(this._buffer,e,n,o,t,i);return r*a.heightScale+a.heightOffset},y.prototype.upsample=function(e,t,i,n,o,a,s){if(e===void 0)throw new r("tilingScheme is required.");if(t===void 0)throw new r("thisX is required.");if(i===void 0)throw new r("thisY is required.");if(n===void 0)throw new r("thisLevel is required.");if(o===void 0)throw new r("descendantX is required.");if(a===void 0)throw new r("descendantY is required.");if(s===void 0)throw new r("descendantLevel is required.");var l=s-n;if(l>1)throw new r("Upsampling through more than one level at a time is not currently supported.");var u;return u=1===this._width%2&&1===this._height%2?d(this,e,t,i,n,o,a,s):m(this,e,t,i,n,o,a,s)},y.prototype.isChildAvailable=function(e,t,i,n){if(e===void 0)throw new r("thisX is required.");if(t===void 0)throw new r("thisY is required.");if(i===void 0)throw new r("childX is required.");if(n===void 0)throw new r("childY is required.");var o=2;return i!==2*e&&++o,n!==2*t&&(o-=2),0!==(this._childTileMask&1<<o)},y.prototype.getWaterMask=function(){return this._waterMask},y.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling},y}),i("Scene/ArcGisImageServerTerrainProvider",["../Core/defaultValue","../Core/loadImage","../Core/getImagePixels","../Core/throttleRequestByServer","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Math","../Core/Ellipsoid","../Core/Event","./TerrainProvider","./GeographicTilingScheme","./HeightmapTerrainData","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){var m=function m(t){if(t===void 0||t.url===void 0)throw new o("description.url is required.");this._url=t.url,this._token=t.token,this._tilingScheme=t.tilingScheme,this._tilingScheme===void 0&&(this._tilingScheme=new c({ellipsoid:e(t.ellipsoid,s.WGS84)})),this._heightmapWidth=65,this._levelZeroMaximumGeometricError=u.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.getEllipsoid(),this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._proxy=t.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0},this._errorEvent=new l,t.credit!==void 0&&(this._logo=n(t.credit,{font:"12px sans-serif"}))
};return m.prototype.requestTileGeometry=function(e,n,o){var s=this._tilingScheme.tileXYToExtent(e,n,o),l=(s.east-s.west)/(this._heightmapWidth-1),u=(s.north-s.south)/(this._heightmapWidth-1);s.west-=.5*l,s.east+=.5*l,s.south-=.5*u,s.north+=.5*u;var c=a.toDegrees(s.west)+"%2C"+a.toDegrees(s.south)+"%2C"+a.toDegrees(s.east)+"%2C"+a.toDegrees(s.north),m=this._url+"/exportImage?interpolation=RSP_BilinearInterpolation&format=tiff&f=image&size="+this._heightmapWidth+"%2C"+this._heightmapWidth+"&bboxSR=4326&imageSR=4326&bbox="+c;this._token&&(m+="&token="+this._token);var p=this._proxy;p!==void 0&&(m=p.getURL(m));var f=r(m,t);if(f===void 0)return void 0;var v=this;return d(f,function(e){return new h({buffer:i(e),width:v._heightmapWidth,height:v._heightmapWidth,childTileMask:15,structure:v._terrainDataStructure})})},m.prototype.getErrorEvent=function(){return this._errorEvent},m.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},m.prototype.getLogo=function(){return this._logo},m.prototype.getTilingScheme=function(){return this._tilingScheme},m.prototype.hasWaterMask=function(){return!1},m.prototype.isReady=function(){return!0},m}),i("Scene/DiscardMissingTileImagePolicy",["../Core/defaultValue","../Core/loadImage","../Core/getImagePixels","../Core/DeveloperError","../ThirdParty/when"],function(e,t,i,r,n){var o=function(o){function a(e){var t=i(e);if(o.disableCheckIfAllPixelsAreTransparent){for(var r=!0,n=e.width,a=o.pixelsToCheck,s=0,u=a.length;r&&u>s;++s){var c=a[s],h=4*c.x+c.y*n,d=t[h+3];d>0&&(r=!1)}r&&(t=void 0)}l._missingImagePixels=t,l._isReady=!0}function s(){l._missingImagePixels=void 0,l._isReady=!0}if(o=e(o,{}),o.missingImageUrl===void 0)throw new r("description.missingImageUrl is required.");if(o.pixelsToCheck===void 0)throw new r("description.pixelsToCheck is required.");this._pixelsToCheck=o.pixelsToCheck,this._missingImagePixels=void 0,this._isReady=!1;var l=this;n(t(o.missingImageUrl),a,s)};return o.prototype.isReady=function(){return this._isReady},o.prototype.shouldDiscardImage=function(e){if(!this._isReady)throw new r("shouldDiscardImage must not be called before the discard policy is ready.");var t=this._pixelsToCheck,n=this._missingImagePixels;if(n===void 0)return!1;for(var o=i(e),a=e.width,s=0,l=t.length;l>s;++s)for(var u=t[s],c=4*u.x+u.y*a,h=0;4>h;++h){var d=c+h;if(o[d]!==n[d])return!1}return!0},o}),i("Scene/ImageryProvider",["../Core/loadImage","../Core/DeveloperError","../Core/throttleRequestByServer"],function(e,t,i){var r=function r(){throw new t("This type should not be instantiated directly.")};return r.prototype.isReady=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getExtent=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getTileWidth=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getTileHeight=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getMaximumLevel=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getTilingScheme=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getTileDiscardPolicy=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getErrorEvent=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getLogo=function(){throw new t("This type should not be instantiated directly.")},r.prototype.getProxy=function(){throw new t("This type should not be instantiated directly.")},r.prototype.requestImage=function(){throw new t("This type should not be instantiated directly.")},r.loadImage=function(t){return i(t,e)},r}),i("Scene/WebMercatorTilingScheme",["../Core/defaultValue","../Core/DeveloperError","../Core/Math","../Core/Ellipsoid","../Core/Extent","../Core/Cartesian2","../Core/Cartographic","../Core/WebMercatorProjection","./TilingScheme"],function(e,t,i,r,n,o,a,s,l){var u=function u(t){if(t=e(t,{}),this._ellipsoid=e(t.ellipsoid,r.WGS84),this._numberOfLevelZeroTilesX=e(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e(t.numberOfLevelZeroTilesY,1),this._projection=new s(this._ellipsoid),t.extentSouthwestInMeters!==void 0&&t.extentNortheastInMeters!==void 0)this._extentSouthwestInMeters=t.extentSouthwestInMeters,this._extentNortheastInMeters=t.extentNortheastInMeters;else{var i=this._ellipsoid.getMaximumRadius()*Math.PI;this._extentSouthwestInMeters=new o(-i,-i),this._extentNortheastInMeters=new o(i,i)}var a=this._projection.unproject(this._extentSouthwestInMeters),l=this._projection.unproject(this._extentNortheastInMeters);this._extent=new n(a.longitude,a.latitude,l.longitude,l.latitude)};return u.prototype.getEllipsoid=function(){return this._ellipsoid},u.prototype.getExtent=function(){return this._extent},u.prototype.getProjection=function(){return this._projection},u.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},u.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},u.prototype.createLevelZeroTiles=function(){return l.createRectangleOfLevelZeroTiles(this,this._numberOfLevelZeroTilesX,this._numberOfLevelZeroTilesY)},u.prototype.extentToNativeExtent=function(e,t){var i=this._projection,r=i.project(e.getSouthwest()),o=i.project(e.getNortheast());return t===void 0?new n(r.x,r.y,o.x,o.y):(t.west=r.x,t.south=r.y,t.east=o.x,t.north=o.y,t)},u.prototype.tileXYToNativeExtent=function(e,t,i,r){var o=this.getNumberOfXTilesAtLevel(i),a=this.getNumberOfYTilesAtLevel(i),s=(this._extentNortheastInMeters.x-this._extentSouthwestInMeters.x)/o,l=this._extentSouthwestInMeters.x+e*s,u=this._extentSouthwestInMeters.x+(e+1)*s,c=(this._extentNortheastInMeters.y-this._extentSouthwestInMeters.y)/a,h=this._extentNortheastInMeters.y-t*c,d=this._extentNortheastInMeters.y-(t+1)*c;return r===void 0?new n(l,d,u,h):(r.west=l,r.south=d,r.east=u,r.north=h,r)},u.prototype.tileXYToExtent=function(e,t,i,r){var n=this.tileXYToNativeExtent(e,t,i,r),a=this._projection,s=a.unproject(new o(n.west,n.south)),l=a.unproject(new o(n.east,n.north));return n.west=s.longitude,n.south=s.latitude,n.east=l.longitude,n.north=l.latitude,n},u.prototype.positionToTileXY=function(e,t,i){var r=this._extent;if(e.latitude>r.north||r.south>e.latitude||r.west>e.longitude||e.longitude>r.east)return void 0;var n=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),s=this._extentNortheastInMeters.x-this._extentSouthwestInMeters.x,l=s/n,u=this._extentNortheastInMeters.y-this._extentSouthwestInMeters.y,c=u/a,h=this._projection,d=h.project(e),m=d.x-this._extentSouthwestInMeters.x,p=this._extentNortheastInMeters.y-d.y,f=0|m/l;f>=n&&(f=n-1);var v=0|p/c;return v>=a&&(v=a-1),i===void 0?new o(f,v):(i.x=f,i.y=v,i)},u}),i("Scene/ArcGisMapServerImageryProvider",["../Core/defaultValue","../Core/jsonp","../Core/writeTextToCanvas","../Core/Cartesian2","../Core/DeveloperError","../Core/Event","../Core/RuntimeError","./DiscardMissingTileImagePolicy","./GeographicTilingScheme","./ImageryProvider","./TileProviderError","./WebMercatorTilingScheme","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){function m(e,t,i,r){var n;if(e._useTiles)n=e._url+"/tile/"+r+"/"+i+"/"+t;else{var o=e._tilingScheme.tileXYToNativeExtent(t,i,r),a=o.west+"%2C"+o.south+"%2C"+o.east+"%2C"+o.north;n=e._url+"/export?",n+="bbox="+a,n+="&bboxSR=4326&size=256%2C256&imageSR=4326&format=png&transparent=true&f=image"}var s=e._proxy;return s!==void 0&&(n=s.getURL(n)),n}var p=function p(a){function u(e){var t=e.tileInfo;if(g._useTiles&&t!==void 0){if(g._tileWidth=t.rows,g._tileHeight=t.cols,102100===t.spatialReference.wkid)g._tilingScheme=new h;else{if(4326!==e.tileInfo.spatialReference.wkid){var n="Tile spatial reference WKID "+e.tileInfo.spatialReference.wkid+" is not supported.";return v=c.handleError(v,g,g._errorEvent,n,void 0,void 0,void 0,f),void 0}g._tilingScheme=new l}g._maximumLevel=e.tileInfo.lods.length-1,g._tileDiscardPolicy===void 0&&(g._tileDiscardPolicy=new s({missingImageUrl:m(g,0,0,g._maximumLevel),pixelsToCheck:[new r(0,0),new r(200,20),new r(20,200),new r(80,110),new r(160,130)],disableCheckIfAllPixelsAreTransparent:!0})),g._useTiles=!0}else g._tileWidth=256,g._tileHeight=256,g._tilingScheme=new l,g._useTiles=!1;e.copyrightText!==void 0&&e.copyrightText.length>0&&(g._logo=i(e.copyrightText,{font:"12px sans-serif"})),g._ready=!0,c.handleSuccess(v)}function p(){var e="An error occurred while accessing "+g._url+".";v=c.handleError(v,g,g._errorEvent,e,void 0,void 0,void 0,f)}function f(){var e=t(g._url,{parameters:{f:"json"},proxy:g._proxy});d(e,u,p)}if(a=e(a,{}),a.url===void 0)throw new n("description.url is required.");this._url=a.url,this._tileDiscardPolicy=a.tileDiscardPolicy,this._proxy=a.proxy,this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._tilingScheme=void 0,this._logo=void 0,this._useTiles=e(a.usePreCachedTilesIfAvailable,!0),this._errorEvent=new o,this._ready=!1;var v,g=this;f()};return p.prototype.isUsingPrecachedTiles=function(){return this._useTiles},p.prototype.getUrl=function(){return this._url},p.prototype.getProxy=function(){return this._proxy},p.prototype.getTileWidth=function(){if(!this._ready)throw new n("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},p.prototype.getTileHeight=function(){if(!this._ready)throw new n("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},p.prototype.getMaximumLevel=function(){if(!this._ready)throw new n("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},p.prototype.getTilingScheme=function(){if(!this._ready)throw new n("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},p.prototype.getExtent=function(){if(!this._ready)throw new n("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},p.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new n("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},p.prototype.getErrorEvent=function(){return this._errorEvent},p.prototype.isReady=function(){return this._ready},p.prototype.requestImage=function(e,t,i){if(!this._ready)throw new n("requestImage must not be called before the imagery provider is ready.");var r=m(this,e,t,i);return u.loadImage(r)},p.prototype.getLogo=function(){if(!this._ready)throw new n("getLogo must not be called before the imagery provider is ready.");return this._logo},p}),i("Scene/BingMapsStyle",["../Core/Enumeration"],function(e){var t={AERIAL:new e(0,"AERIAL",{imagerySetName:"Aerial"}),AERIAL_WITH_LABELS:new e(1,"AERIAL_WITH_LABELS",{imagerySetName:"AerialWithLabels"}),ROAD:new e(2,"ROAD",{imagerySetName:"Road"}),ORDNANCE_SURVEY:new e(3,"ORDNANCE_SURVEY",{imagerySetName:"OrdnanceSurvey"}),COLLINS_BART:new e(4,"COLLINS_BART",{imagerySetName:"CollinsBart"})};return t}),i("Scene/BingMapsImageryProvider",["../Core/defaultValue","../Core/jsonp","../Core/Cartesian2","../Core/DeveloperError","../Core/Event","./BingMapsStyle","./DiscardMissingTileImagePolicy","./ImageryProvider","./TileProviderError","./WebMercatorTilingScheme","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c){function h(e,t,i,r){var n=e._imageUrlTemplate,o=d.tileXYToQuadKey(t,i,r);n=n.replace("{quadkey}",o);var a=e._imageUrlSubdomains,s=(t+i+r)%a.length;n=n.replace("{subdomain}",a[s]);var l=e._proxy;return l!==void 0&&(n=l.getURL(n)),n}var d=function d(s){function d(e){var t=e.resourceSets[0].resources[0];g._tileWidth=t.imageWidth,g._tileHeight=t.imageHeight,g._maximumLevel=t.zoomMax-1,g._imageUrlSubdomains=t.imageUrlSubdomains,g._imageUrlTemplate=t.imageUrl.replace("{culture}",""),g._tileDiscardPolicy===void 0&&(g._tileDiscardPolicy=new a({missingImageUrl:h(g,0,0,g._maximumLevel),pixelsToCheck:[new i(0,0),new i(120,140),new i(130,160),new i(200,50),new i(200,200)],disableCheckIfAllPixelsAreTransparent:!0})),g._ready=!0,l.handleSuccess(f)}function m(){var e="An error occurred while accessing "+v+".";f=l.handleError(f,g,g._errorEvent,e,void 0,void 0,void 0,p)}function p(){var e=t(v,{callbackParameterName:"jsonp",proxy:g._proxy});c(e,d,m)}if(s=e(s,{}),s.url===void 0)throw new r("description.url is required.");this._url=s.url,this._key=e(s.key,"Auc5O1omLRY_ub2safz0m2vJbzhYhSfTkO9eRDtLOauonIVoAiy6BV8c-L4jl1MT"),this._mapStyle=e(s.mapStyle,o.AERIAL),this._tileDiscardPolicy=s.tileDiscardPolicy,this._proxy=s.proxy,this.defaultGamma=1,(this._mapStyle===o.AERIAL||this._mapStyle===o.AERIAL_WITH_LABELS)&&(this.defaultGamma=1.3),this._tilingScheme=new u({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2}),this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._imageUrlTemplate=void 0,this._imageUrlSubdomains=void 0,this._errorEvent=new n,this._ready=!1;var f,v=this._url+"/REST/v1/Imagery/Metadata/"+this._mapStyle.imagerySetName+"?key="+this._key,g=this;p()};return d.prototype.getUrl=function(){return this._url},d.prototype.getProxy=function(){return this._proxy},d.prototype.getKey=function(){return this._key},d.prototype.getMapStyle=function(){return this._mapStyle},d.prototype.getTileWidth=function(){if(!this._ready)throw new r("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},d.prototype.getTileHeight=function(){if(!this._ready)throw new r("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},d.prototype.getMaximumLevel=function(){if(!this._ready)throw new r("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},d.prototype.getTilingScheme=function(){if(!this._ready)throw new r("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},d.prototype.getExtent=function(){if(!this._ready)throw new r("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},d.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new r("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},d.prototype.getErrorEvent=function(){return this._errorEvent},d.prototype.isReady=function(){return this._ready},d.prototype.requestImage=function(e,t,i){if(!this._ready)throw new r("requestImage must not be called before the imagery provider is ready.");var n=h(this,e,t,i);return s.loadImage(n)},d.prototype.getLogo=function(){if(!this._ready)throw new r("getLogo must not be called before the imagery provider is ready.");if(d._logo===void 0){var e=new Image;e.loaded=!1,e.onload=function(){d._logo.loaded=!0},e.src=d._logoData,d._logo=e}var t=d._logo;return t&&t.loaded?t:void 0},d._logo=void 0,d._logoLoaded=!1,d._logoData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF0AAAAdCAYAAADIKWCvAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAABBZSURBVHja1FoJdFTVGZ6ZzJZlskMgsrcEoqAQrBhBliKBiBDAgFUL5RQkgIDaKCoqGEBAFkGSgEYrCKgoYtWICLIZBBEOFkX0YEKoDSQo2SczmX36fS/3xscUBAKxp/ecl5eZd99/7/3+/37/cker0Wi0moami4qKCvJ6vVqj0RjEL4KCgvwul8vLe3l5uRdf+cXV2CZPnqwJbHl5eZSpjY2NDcL7Oj2a3+9XxtFqtX632+3FV76qqirK9Ak5fs3/oGGu11Qe1nnJPlpx6cLDw4mNPiQkxARggggSLi8AcuOzG8rwqIC/pFwoUA9lEWyj2Ww28X8+8Hg8EOV1QawTz9xq4C/VrkQxQvHN0fzXAnRauB7AGiIiIsJCQ0PDAFIIPusAjKO+vt5WU1Njs1qtDpvN5v4VgORoioXjboAcc3BwsAWKDA8LCwuFTK3D4aiHrBorBeJ/nU7nUilTeyULlkq4CMDaS6xbGofuUiBxp2P3+7Ecf3FxsXq3+5sCurQ+WroZ4FhGpI1Mur1vvyGYltZaa/156dLF7wDscxhUoR3SDYBsXBCU4gdwftIGJwfL9TudziD00ZtMpuCYmJjY8SmdUgYl1N3H/ierwg4/t+nHPEzOh34eXARcg8VrSW3cYT6fT6seA318Kvk+SXMqalCDGHQhOZynAEX5zLXwOebeCDrH4Fr4v8FgUPrxM+T5eIcRemBQPmDlA/i+pm4Vgq7FAJyoEXdLn9v6pg4dOngCH1ZX19SsXLn8MwzoxoI5OTeA9NJipQB89omJeXH3RUZGerkYNDPkhfXvGX/jA4mfL9D765XFJcRoulnTUirmr69Zh/5OLhSL8IvF6zAOwdCpx4AcjuEDYB6A6qHiAZpXKEDBy2KxBHEdMCCK0As5FKOMC4PSYIp+QZuKAZFG0bRgVfbhQ2UN7AdZjSDxO/QlL7oxVzd2qFso2t9k0LlINAJv9njcRtVW0eFZFC4bJmbARN0EGBcthO9xEfyDf31eLNhJ7heWacD35vjIoNaBg7o9XgPHQp9gAgXZ3ML410DuV/wJ72IX+gQQ0he48MjFBgV4OZYA0IDvjbBsI+4mvEPK1EnQOVeuVewCOncDqNQEZbA/n9F/2bGr6+h3VIATXBqaC3fg7eCO83Xq1IlU0yTg9WJCnAwtg8DrfyFQRV4wJhaHxUTDmrSwbJ2YiFSMH5NUQLDb7XW1tbV15GkuDhM0rt1WeKzOcfPKkTc5h7H/8Z9Cvl35XlEBFmfAQsIgz4/FG8n5bADDjIuAy22vKBTi3fQvGMNah4Y+9QDcRZ6FsvQY04h5QkyYBWIskGumIiX1kGsBqg9yaCF6KMr88COZw264PrGb0Iv/ZHHxwdlPPv7qoUOHsiXdQHarwsLCtR07dhzaq1evUfjswfserE17NfSiyBccGET6UrstbKew4cNH3DBq9OjU1q1axUdGRoQHCqmrs9kBdtWJEyeOZmU9uw7bHr63xsGtDpCCvNFJnvdLg3aUlZbWdu9+YyuH40U9xgphpAQ6CoHFRi5YsCijffu2v4+Ojm6BYMeolk9rr6ioqjx16tR3mzZtevfgwQNFGKOSSqBPYHQEgwiHnJhHH52V3qtX0gD6kkA5DofTda68vMLpcDrbtLkuPvB5YWHREe6YpKSkBwoKCp4aMGDAc9u2bZvSoUOHVKLBXSMM9KoiI73ao0sno+JS/VtvbZofHR1lCQC5HkCQ1zQwUBppCK/4+NbXJSdvH1yw7/PdT81+YmNlZWU9I6H0u9NHJCZ26cr+lVVV1ry8l/bh+1iAZH755Vce6t79hh6CVxtBxhh1Uj6fxcW1iMXV7+abk/oWFRWfyM5elbdnz+4f6BdgGKGPPPLonaNGpd2rNopAOQS5bZvrWl8MjBUrln0MC3Zx82JH/Iw7Zcfl5+cvSklJGQPQvcLR0qleE9D/q1ksYcFqKzly5KvD72x++71vvv66hE5FOCLj+PETBtwx+I67YDyK9aQMHjQ0MfH9m+4ZO2YOF+5Xh2/4wFCSBP7O5nfnqUEoOX2mbNfOXfnr16/bS/4W4ZoxNXVYj3vvu/fPlE8FdO2akPj8888vzMzMXHD48KHTU6ZO6z9u3H0TpOJoFPsPfLHv+cUL3wA49cKAgqdOm56WOnRIKhTQuK4jR/75bfGpUyfhpRwwkiqAbsOcbQMHDlxCeklOTn6YQM+dO/cgeR2WztTFR1prKugEQ09LgRDs7Oj28+cvfDA9fVS6utPp06Vl999/79zq6uoyTKoaW9pOXuN2w2KM4M8wyIjNzJx1z8iRw0fKxZeUnCmbMGH8wuzs3BnXX981QbH0yiprevrds5ctWz4xKalnD2mRa9et3/BK3ks7QNc/Q75Vgk6HxyiI8tPSRiXPmDk9wxLWYAxU0qSJf13ywQcfLKEe+R0Iv37WY7OeO3Bg/3HIqpSgQ3nB4PoorDFu87tbFsa1bBEjx54586GsgoLPjsHPnMbY5RjbjnG9MoIh+HQs+I6Ri4evlZaW+i6Us1x2nC77U3hgh59+Plcxdmz6M+fOnSthvI4J0bs7pNfGO0xk7Viga8GCrLf5HZQ2mve2ba9rnTF12h2BtAUlGTt37txFfj745eGDq3Ozd8LSSrGoSsi3cmFCPsMaDG1zvPXWG/sTEhLapaePVuS3bhUXN2lSxiAJOFv2qpy8vXv3FCL3qgSAVcDKLuSYIZvRjiHr2axVq1fnZAml6tLSRvYBVR2ilTMe4Dt03gwdIZu0qyiHpQsCLQBvsqXr1IBfCPQPP8j/EBljJRwlF1FNS8cEajGpGt7xuRYOrRqgwLdVVSxfvmQrt7d8P6lnz56BuSHjaDV1lZWVnYWMGsqHZXInUXYNxqgGCByzis8IZHb2i582WgwAg5zz/M2OHZ+cgCwH3qMjd9L3MLrizuFnfO88duzrsyLWVlqbtm3aITojXyulCVInI1vMk1SihKkA340QkRZ+wRrUFXO6zChxIUXTnrdl3nxzw2EsuB4AKBN3NjSX2FrM+FgQ08sYGs/cJSUl/05M7KpYcjS85Vm08zStCjkFx1GWA2PUQw4VVg8lS1AArIVxI+N+ZR7qd9u1axuv/pySMrTLhg2vVwBgM/qbmE0KYzJBSSb6kzvvvCtRvTvKSs+eJI+jP52oG8r14LqYNV91YU4nrZzZGBdktdZWqDsMHjwkgXQgkg2m9ibwK4tYRoR7TCyMMjFRshuTydAKoaV832az2y6rQqZVlO3morFrZBGMFyuSHkYUzAoZQajf++77738gj8vP4PzJAwYOTEC6Hot5RoHHoxGaxkRERMQijIzD3KKnTMmYqA4QsrLmbCB/cVcwEQuwZH/ApbkmoDOtFlZsf+3vr+7iRGSH8ePH3wNjjcLEI5FQ8GI5Mhygh2OCESwd4ArH4qCDyGg402EIuy2/8PWXhy89VcXwvSqKO2+R8nsqRoCidlwehLWbyblKxAUnu+KFFc/k5q75G+Lrjrg6tG/fviOuTstfWJmxdevHK+T8+M6GjRs3IECoRj5BSvKw7PxrBa1r0fSCY5nK0zMz2Svfv//Ap4MGDVQyyDZt4luvWfPywzNmPLgCCY+B3EsFMXqhgwQIBlYS0WInT56Syuil0Qn/dK5izeqcHTk5q7v8quZ1SqHJJ6w9cLGyoOaTV8Bm98JQCuDoy6dNnfoAAWXY2qdPcp9du3b1qa6uqWW3wKSOUdSWLe/9Izc3ey+ozEYeF/WdZq/rE3Q/BvUilKLDIZeWP/307NXBwSvCb7vt1tsVZ5jUo8dHH23N2bNn7yc5Oavy2Y90JONocGTP4SOGp4HGu0rBVVXV1jlz57xAC9IEOGgoLIBaFMCVYlOgJasrgKQXPPcGPsOc7Rs3rD/wUf6HRzIypvXr379fSgvkUkzYLpRBs4WHW0LbtWsXH9TQdDLCCoy0ms3SiYOnodVjYdWMvzMzH1n4+BOzxw3o3+8uTpwWNHr0yDEjRtx1t8zyZBytTja4ZQuLTv6A+HlRRUWFjY5Lq9UEgu49P/PVuyCHTsyroheNurSL3cSdRWt0BERCbkY5rNGzGLV06eKSl17KfZ++hzmEKOixiGaGf7px4qSJ4xijM/IZMmTwHUing6dPn7YI1GJiSRp37dVUEC/b0oW1eFjQohfHAgiM59m5z6yBA9qcmfnYGHU9I9B6Amsj+/fvKwRN1jEsY2JTW2M9g23OzFOLHVDBwhjutaJ660eEV8pKpgjTAi3dz/hYJGMMAatramqrpUXa7Ha+a8X3dSyKQbYGY1eyeikiJRbyGAQEr1v3WvnWrfnH33578zzSJp/37v2H5D59b+/86Y7tZ0ExDAR08KnNaunawGM7AM8JMjoJxmKDydes3PH0h4cSDLvG/2VCHzjNKK1G69+9e/fho0e/KmNZVFYB0eyMK0WtPBh9w3lAwrMD+AzWpVnt4skSlWtn7I9Wjjifcb9ThIuNloZAhKgbMbewli1bxsBpx0A5oQDZR2qBr7G7GqIB7gaWmLljqCifTOAAfigunmDFDRkytNvq1blZUv6BL74smDY14ynszB9FvsHd5G2KtV9JRip7+gAYC/Us6JByXOLIrhZgl7N8SjpZvGhhMbcna9T0+FwwLRGLpiU6leIEKISgQ56NoMLyzKzbs5bNgQCUErEAPNaxmcg4eBaL6MgnKsYyctEiOeNpDUuq9XSYAIWOz4guPKwwsTQMhZg4H44N4OqZHPkaGg8naPFOzIF+y33s2DdKciRjdeQSsSwnywOO34rT1cD7haV5eUqCuxJKMkrhVmW8ztMWeczla6gA0cEpFMBLfJagBeF9ngjZ1YvicZg8oBDveHkqJc5LA5sPFuqFopysibDwRLDFcWDIcwsXTxTJkKaosLDw9dfXHmDxCruOPsotDkXMrKFjh5lT7xx2XnJ05kxpMRO7i/mU5gQ9MFTzAnxanUecO9KCdeQ8eQYpowrubIJM7gVNBGZybtCD8o66Do3/Gw99eTEDxOVXW7k8JKG1y/SbZ5SsofPwg6VngKi/tXfvsRERlsiGZOePSPfdKzZvfucg5s+SglOciYaw4NW7d3LXmTNmZKjPAubNm7sWu6PW03DW52tuS9dewXPtr7xzzZKJi8XJ6jNT6grg87QpLA5t0KDBt8ye/eSLoaEhodKxFxWdPJGfn//h9u2fHBflgW7Dhw8f0bnz7xJkFZRJYE5O7pKNG9dvA22dYc2HVUmVT2kWTtdeQwVpLiexUIPXlEREvK8F9RkY7oHLI3G17D9gYM/pD06f1aFDu06XIweUUrps2bLFe/fuOQra+glUxGKbDbTkbKoTbQ7QmzzINd2aAnT+toYRDaMsUAcjrCgoosUtvXt3uWfsn+7u2LHj9SaT0cgTI0EjdU6ny3X27Nl/7dy1c9t7W94l/TB8rQS11LCkS/8FJ+25mjrLbwL6hX5W19xN/mxP/kiK1USEtiHgeQuPB3lAzViXzl8cciu/LGMkg6iFoW0dwGbtnGesdvgXhwBcFtr8zWmE/5egq4GnxQNERlT8iYjy8wv5cw6Gp+L3OhpR4vXJErQ4mXLhXZf4DY36533NCvp/BBgAjIr8TQiNmVwAAAAASUVORK5CYII=",d.tileXYToQuadKey=function(e,t,i){for(var r="",n=i;n>=0;--n){var o=1<<n,a=0;0!==(e&o)&&(a|=1),0!==(t&o)&&(a|=2),r+=a}return r},d.quadKeyToTileXY=function(e){for(var t=0,i=0,r=e.length-1,n=r;n>=0;--n){var o=1<<n,a=+e[r-n];0!==(1&a)&&(t|=o),0!==(2&a)&&(i|=o)}return{x:t,y:i,level:r}},d}),i("Scene/CameraController",["../Core/defaultValue","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/DeveloperError","../Core/Ellipsoid","../Core/GeographicProjection","../Core/IntersectionTests","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/Ray","./SceneMode","../ThirdParty/Tween"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f){function v(e,t){var i=e._maxCoord.x*e.maximumTranslateFactor;t.x>i&&(t.x=i),-i>t.x&&(t.x=-i);var r=e._maxCoord.y*e.maximumTranslateFactor;t.y>r&&(t.y=r),-r>t.y&&(t.y=-r)}function g(e,t){var r,n=e._camera;if(t!==void 0){var o=i.clone(n.getPositionWC(),k),a=i.clone(n.getUpWC(),W),s=i.clone(n.getRightWC(),H),l=i.clone(n.getDirectionWC(),j);r=n.transform,n.transform=t.multiply(r);var u=n.getInverseTransform();i.clone(h.multiplyByVector(u,o,o),n.position),i.clone(h.multiplyByVector(u,a,a),n.up),i.clone(h.multiplyByVector(u,s,s),n.right),i.clone(h.multiplyByVector(u,l,l),n.direction)}return r}function _(e,t){if(t!==void 0){var r=e._camera,n=i.clone(r.getPositionWC(),G),o=i.clone(r.getUpWC(),Y),a=i.clone(r.getRightWC(),X),s=i.clone(r.getDirectionWC(),Z);r.transform=t,t=r.getInverseTransform(),n=i.clone(h.multiplyByVector(t,n,n),r.position),o=i.clone(h.multiplyByVector(t,o,o),r.up),a=i.clone(h.multiplyByVector(t,a,a),r.right),s=i.clone(h.multiplyByVector(t,s,s),r.direction)}}function y(e,t,r){var n=e._camera,o=g(e,r),a=n.position,s=i.normalize(a,Q);if(e.constrainedAxis!==void 0){var l=s.equalsEpsilon(e.constrainedAxis,u.EPSILON2),c=s.equalsEpsilon(e.constrainedAxis.negate(),u.EPSILON2);if(l||c)(l&&0>t||c&&t>0)&&e.rotate(n.right,t);else{var h=i.normalize(e.constrainedAxis,$),d=s.dot(h),m=Math.acos(d);t>0&&t>m&&(t=m),d=s.dot(h.negate()),m=Math.acos(d),0>t&&-t>m&&(t=-m);var p=i.cross(h,s,et);e.rotate(p,t)}}else e.rotate(n.right,t);_(e,o)}function w(e,t,i){e.constrainedAxis!==void 0?e.rotate(e.constrainedAxis,t,i):e.rotate(e._camera.up,t,i)}function C(e,t){var i=e._camera.frustum;if(i.left===void 0||i.right===void 0||i.top===void 0||i.bottom===void 0)throw new o("The camera frustum is expected to be orthographic for 2D camera control.");t=.5*t;var r=i.right-t,n=i.left+t,a=e._maxCoord.x*e.maximumZoomFactor;r>a&&(r=a,n=-a);var s=i.top/i.right;i.right=r,i.left=n,i.top=i.right*s,i.bottom=-i.top}function x(e,t){var i=e._camera;e.move(i.direction,t)}function T(e,r){var n=e._camera,o=.5*-r.height,a=-o,s=n.frustum;if(a>o){var l=s.top/s.right;s.right=a,s.left=o,s.top=s.right*l,s.bottom=-s.top}t.clone(e._projection.project(r),n.position),i.negate(i.UNIT_Z,n.direction),i.clone(i.UNIT_Y,n.up),i.clone(i.UNIT_X,n.right)}function S(e,t){var r=e._camera,n=e._projection;r.position=n.project(t),i.negate(i.UNIT_Z,r.direction),i.clone(i.UNIT_Y,r.up),i.clone(i.UNIT_X,r.right)}function E(e,t){var r=e._camera,n=e._projection.getEllipsoid();n.cartographicToCartesian(t,r.position),i.negate(r.position,r.direction),i.normalize(r.direction,r.direction),i.cross(r.direction,i.UNIT_Z,r.right),i.cross(r.right,r.direction,r.up),i.cross(r.direction,r.up,r.right)}function b(e,t,r){var n=t.north,o=t.south,a=t.east,s=t.west;s>a&&(a+=u.TWO_PI);var l=tt;l.longitude=a,l.latitude=n;var c=r.cartographicToCartesian(l,it);l.latitude=o;var h=r.cartographicToCartesian(l,ot);l.longitude=s;var d=r.cartographicToCartesian(l,rt);l.latitude=n;var m=r.cartographicToCartesian(l,nt),p=i.subtract(c,d,at);i.multiplyByScalar(p,.5,p),i.add(d,p,p),i.subtract(m,p,m),i.subtract(h,p,h),i.subtract(c,p,c),i.subtract(d,p,d);var f=r.geodeticSurfaceNormal(p,e.direction);i.negate(f,f),i.normalize(f,f);var v=i.cross(f,i.UNIT_Z,e.right);i.normalize(v,v);var g=i.cross(v,f,e.up),_=Math.max(Math.abs(g.dot(m)),Math.abs(g.dot(h)),Math.abs(g.dot(c)),Math.abs(g.dot(d))),y=Math.max(Math.abs(v.dot(m)),Math.abs(v.dot(h)),Math.abs(v.dot(c)),Math.abs(v.dot(d))),w=Math.tan(.5*e.frustum.fovy),C=e.frustum.aspectRatio*w,x=Math.max(y/C,_/w),T=p.magnitude()+x;i.normalize(p,p),i.multiplyByScalar(p,T,e.position)}function M(e,t,n){var o=t.north,a=t.south,s=t.east,l=t.west,u=h.clone(e.transform,ct);u.setColumn(3,r.UNIT_W);var c=e.getInverseTransform(),d=st;d.longitude=s,d.latitude=o;var m=n.project(d),p=i.clone(m,lt);h.multiplyByVector(u,p,p),h.multiplyByVector(c,p,p),d.longitude=l,d.latitude=a,m=n.project(d);var f=i.clone(m,ut);h.multiplyByVector(u,f,f),h.multiplyByVector(c,f,f);var v=Math.tan(.5*e.frustum.fovy),g=e.frustum.aspectRatio*v;m=e.position,m.x=.5*(p.x-f.x)+f.x,m.y=.5*(p.y-f.y)+f.y,m.z=.5*Math.max((p.x-f.x)/g,(p.y-f.y)/v);var _=i.clone(i.UNIT_Z,e.direction);i.negate(_,_);var y=i.clone(i.UNIT_X,e.right);i.cross(y,_,e.up)}function I(e,t,r){var n=t.north,o=t.south,a=t.east,s=t.west,l=ht;l.longitude=a,l.latitude=n;var u=r.project(l);l.longitude=s,l.latitude=o;var c,h,d=r.project(l),m=.5*Math.abs(u.x-d.x),p=.5*Math.abs(u.y-d.y),f=e.frustum.right/e.frustum.top,v=p*f;m>v?(c=m,h=c/f):(h=p,c=v),e.frustum.right=c,e.frustum.left=-c,e.frustum.top=h,e.frustum.bottom=-h,e.position.x=.5*(u.x-d.x)+d.x,e.position.y=.5*(u.y-d.y)+d.y;var g=i.clone(i.UNIT_X,e.right);i.cross(g,e.direction,e.up)}function D(t,i,r,n){r=e(r,a.WGS84);var o=t.getPickRay(i,dt),s=l.rayEllipsoid(o,r);return s?o.getPoint(s.start,n):void 0}function A(e,t,i,r){var n=e.getPickRay(t,mt),o=n.origin;o.z=0;var a=i.unproject(o);return-u.PI_OVER_TWO>a.latitude||a.latitude>u.PI_OVER_TWO||-Math.PI>a.longitude||a.longitude>Math.PI?void 0:i.getEllipsoid().cartographicToCartesian(a,r)}function P(e,t,r,n){var o=e.getPickRay(t,pt),a=-o.origin.x/o.direction.x;o.getPoint(a,n);var s=r.unproject(new i(n.y,n.z,0));return-u.PI_OVER_TWO>s.latitude||s.latitude>u.PI_OVER_TWO||-Math.PI>s.longitude||s.longitude>Math.PI?void 0:r.getEllipsoid().cartographicToCartesian(s,n)}function R(e,t,r){var n=e._canvas.clientWidth,o=e._canvas.clientHeight,a=Math.tan(.5*e.frustum.fovy),s=e.frustum.aspectRatio*a,l=e.frustum.near,u=2/n*t.x-1,c=2/o*(o-t.y)-1,h=e.getPositionWC();i.clone(h,r.origin);var d=i.multiplyByScalar(e.getDirectionWC(),l,ft);i.add(h,d,d);var m=i.multiplyByScalar(e.getRightWC(),u*l*s,vt),p=i.multiplyByScalar(e.getUpWC(),c*l*a,gt),f=i.add(d,m,r.direction);return i.add(f,p,f),i.subtract(f,h,f),i.normalize(f,f),r}function O(e,t,r){var n=e._canvas.clientWidth,o=e._canvas.clientHeight,a=2/n*t.x-1;a*=.5*(e.frustum.right-e.frustum.left);var s=2/o*(o-t.y)-1;s*=.5*(e.frustum.top-e.frustum.bottom);var l=r.origin;return i.clone(e.position,l),l.x+=a,l.y+=s,i.clone(e.getDirectionWC(),r.direction),r}function z(e,t){var i=e._camera,r=i.position,n=-e._maxCoord.x>r.x||r.x>e._maxCoord.x,o=-e._maxCoord.y>r.y||r.y>e._maxCoord.y,a=n||o,s=i.frustum,l=s.top,c=s.bottom,h=s.right,d=s.left,m=e._frustum,p=h>e._frustum.right;if(a||p){var v=r.clone();v.x>e._maxCoord.x?v.x=e._maxCoord.x:-e._maxCoord.x>v.x&&(v.x=-e._maxCoord.x),v.y>e._maxCoord.y?v.y=e._maxCoord.y:-e._maxCoord.y>v.y&&(v.y=-e._maxCoord.y);var g=function(e){a&&(i.position=r.lerp(v,e.time)),p&&(i.frustum.top=u.lerp(l,m.top,e.time),i.frustum.bottom=u.lerp(c,m.bottom,e.time),i.frustum.right=u.lerp(h,m.right,e.time),i.frustum.left=u.lerp(d,m.left,e.time))};return{easingFunction:f.Easing.Exponential.Out,startValue:{time:0},stopValue:{time:1},duration:t,onUpdate:g}}return void 0}function L(e,t,n,o,a,s){var l=t.clone();n.y>o?l.y-=n.y-o:-o>n.y&&(l.y+=-o-n.y),n.z>a?l.z-=n.z-a:-a>n.z&&(l.z+=-a-n.z);var u=e._camera,c=function(e){var n=t.lerp(l,e.time),o=new r(n.x,n.y,n.z,1);u.position=i.fromCartesian4(u.getInverseTransform().multiplyByVector(o))};return{easingFunction:f.Easing.Exponential.Out,startValue:{time:0},stopValue:{time:1},duration:s,onUpdate:c}}function N(e,t){var n=e._camera,o=n.position,a=n.direction,s=i.fromCartesian4(n.getInverseTransform().multiplyByVector(r.UNIT_X)),l=-s.dot(o)/s.dot(a),u=o.add(a.multiplyByScalar(l));u=new r(u.x,u.y,u.z,1);var c=n.transform.multiplyByVector(u),h=new r(n.position.x,n.position.y,n.position.z,1),d=n.transform.multiplyByVector(h),m=Math.tan(.5*e._camera.frustum.fovy),p=e._camera.frustum.aspectRatio*m,f=d.subtract(c).magnitude(),v=p*f,g=m*f,_=e._maxCoord.x,y=e._maxCoord.y,w=Math.max(v-_,_),C=Math.max(g-y,y);if(-w>d.z||d.z>w||-C>d.y||d.y>C){var x=-w>c.y||c.y>w,T=-C>c.z||c.z>C;if(x||T)return L(e,i.fromCartesian4(d),i.fromCartesian4(c),w,C,t)}return void 0}var V=function(e){if(e===void 0)throw new o("camera is required.");this._camera=e,this._mode=p.SCENE3D,this._projection=new s,this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumTranslateFactor=1.5,this.maximumZoomFactor=2.5,this._maxCoord=new i,this._frustum=void 0},B=new n(Math.PI,u.PI_OVER_TWO);V.prototype.update=function(e,t){var i=!1;e!==this._mode&&(this._mode=e,i=this._mode===p.SCENE2D);var r=t.projection;if(r!==void 0&&r!==this._projection&&(this._projection=r,this._maxCoord=r.project(B,this._maxCoord)),i){var n=this._frustum=this._camera.frustum.clone();if(n.left===void 0||n.right===void 0||n.top===void 0||n.bottom===void 0)throw new o("The camera frustum is expected to be orthographic for 2D camera control.");var a=2,s=n.top/n.right;n.right=this._maxCoord.x*a,n.left=-n.right,n.top=s*n.right,n.bottom=-n.top}};var F=new i;V.prototype.move=function(e,t){if(e===void 0)throw new o("direction is required.");var r=this._camera.position;i.multiplyByScalar(e,t,F),i.add(r,F,r),this._mode===p.SCENE2D&&v(this,r)},V.prototype.moveForward=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.direction,t)},V.prototype.moveBackward=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.direction,-t)},V.prototype.moveUp=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.up,t)},V.prototype.moveDown=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.up,-t)},V.prototype.moveRight=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.right,t)},V.prototype.moveLeft=function(t){t=e(t,this.defaultMoveAmount),this.move(this._camera.right,-t)},V.prototype.lookLeft=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.up,-t)},V.prototype.lookRight=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.up,t)},V.prototype.lookUp=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.right,-t)},V.prototype.lookDown=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.right,t)};var q=new d,U=new c;V.prototype.look=function(t,i){if(t===void 0)throw new o("axis is required.");var r=e(i,this.defaultLookAmount),n=c.fromQuaternion(d.fromAxisAngle(t,r,q),U),a=this._camera.direction,s=this._camera.up,l=this._camera.right;c.multiplyByVector(n,a,a),c.multiplyByVector(n,s,s),c.multiplyByVector(n,l,l)},V.prototype.twistLeft=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.direction,t)},V.prototype.twistRight=function(t){t=e(t,this.defaultLookAmount),this.look(this._camera.direction,-t)};var k=r.UNIT_W.clone(),W=r.ZERO.clone(),H=r.ZERO.clone(),j=r.ZERO.clone(),G=r.UNIT_W.clone(),Y=r.ZERO.clone(),X=r.ZERO.clone(),Z=r.ZERO.clone(),K=new d,J=new c;
V.prototype.rotate=function(t,r,n){if(t===void 0)throw new o("axis is required.");var a=this._camera,s=e(r,this.defaultRotateAmount),l=c.fromQuaternion(d.fromAxisAngle(t,s,K),J),u=g(this,n);c.multiplyByVector(l,a.position,a.position),c.multiplyByVector(l,a.direction,a.direction),c.multiplyByVector(l,a.up,a.up),i.cross(a.direction,a.up,a.right),i.cross(a.right,a.direction,a.up),_(this,u)},V.prototype.rotateDown=function(t,i){t=e(t,this.defaultRotateAmount),y(this,t,i)},V.prototype.rotateUp=function(t,i){t=e(t,this.defaultRotateAmount),y(this,-t,i)};var Q=new i,$=new i,et=new i;V.prototype.rotateRight=function(t,i){t=e(t,this.defaultRotateAmount),w(this,-t,i)},V.prototype.rotateLeft=function(t,i){t=e(t,this.defaultRotateAmount),w(this,t,i)},V.prototype.zoomIn=function(t){t=e(t,this.defaultZoomAmount),this._mode===p.SCENE2D?C(this,t):x(this,t)},V.prototype.zoomOut=function(t){t=e(t,this.defaultZoomAmount),this._mode===p.SCENE2D?C(this,-t):x(this,-t)},V.prototype.getMagnitude=function(){var e=this._camera;return this._mode===p.SCENE3D?e.position.magnitude():this._mode===p.COLUMBUS_VIEW?Math.abs(e.position.z):this._mode===p.SCENE2D?Math.max(e.frustum.right-e.frustum.left,e.frustum.top-e.frustum.bottom):void 0},V.prototype.setPositionCartographic=function(e){if(e===void 0)throw new o("cartographic is required.");this._mode===p.SCENE2D?T(this,e):this._mode===p.COLUMBUS_VIEW?S(this,e):this._mode===p.SCENE3D&&E(this,e)},V.prototype.lookAt=function(e,t,r){if(e===void 0)throw new o("eye is required");if(t===void 0)throw new o("target is required");if(r===void 0)throw new o("up is required");if(this._mode===p.SCENE2D)throw new o("lookAt is not supported in 2D mode because there is only one direction to look.");if(this._mode===p.MORPHING)throw new o("lookAt is not supported while morphing.");var n=this._camera;n.position=i.clone(e,n.position),n.direction=i.subtract(t,e,n.direction).normalize(n.direction),n.right=i.cross(n.direction,r,n.right).normalize(n.right),n.up=i.cross(n.right,n.direction,n.up)};var tt=new n,it=new i,rt=new i,nt=new i,ot=new i,at=new i,st=new n,lt=r.UNIT_W.clone(),ut=r.UNIT_W.clone(),ct=new h,ht=new n;V.prototype.viewExtent=function(t,i){if(t===void 0)throw new o("extent is required.");i=e(i,a.WGS84),this._mode===p.SCENE3D?b(this._camera,t,i):this._mode===p.COLUMBUS_VIEW?M(this._camera,t,this._projection):this._mode===p.SCENE2D&&I(this._camera,t,this._projection)};var dt=new m,mt=new m,pt=new m;V.prototype.pickEllipsoid=function(t,r,n){if(t===void 0)throw new o("windowPosition is required.");return n===void 0&&(n=new i),r=e(r,a.WGS84),this._mode===p.SCENE3D?n=D(this,t,r,n):this._mode===p.SCENE2D?n=A(this,t,this._projection,n):this._mode===p.COLUMBUS_VIEW&&(n=P(this,t,this._projection,n)),n};var ft=new i,vt=new i,gt=new i;return V.prototype.getPickRay=function(e,t){if(e===void 0)throw new o("windowPosition is required.");t===void 0&&(t=new m);var i=this._camera,r=i.frustum;return r.aspectRatio!==void 0&&r.fovy!==void 0&&r.near!==void 0?R(i,e,t):O(i,e,t)},V.prototype.createCorrectPositionAnimation=function(e){if(e===void 0)throw new o("duration is required.");return this._mode===p.SCENE2D?z(this,e):this._mode===p.COLUMBUS_VIEW?N(this,e):void 0},V}),i("Scene/CullingVolume",["../Core/defaultValue","../Core/DeveloperError","../Core/Intersect"],function(e,t,i){var r=function(t){this.planes=e(t,[])};return r.prototype.getVisibility=function(e){if(e===void 0)throw new t("boundingVolume is required.");for(var r=this.planes,n=!1,o=0,a=r.length;a>o;++o){var s=e.intersect(r[o]);if(s===i.OUTSIDE)return i.OUTSIDE;s===i.INTERSECTING&&(n=!0)}return n?i.INTERSECTING:i.INSIDE},r}),i("Scene/PerspectiveOffCenterFrustum",["../Core/DeveloperError","../Core/defaultValue","../Core/destroyObject","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/CullingVolume"],function(e,t,i,r,n,o,a,s){function l(t){if(t.right===void 0||t.left===void 0||t.top===void 0||t.bottom===void 0||" undefined"==typeof t.near||t.far===void 0)throw new e("right, left, top, bottom, near, or far parameters are not set.");var i=t.top,r=t.bottom,n=t.right,o=t.left,s=t.near,l=t.far;if(i!==t._top||r!==t._bottom||o!==t._left||n!==t._right||s!==t._near||l!==t._far){if(0>=t.near||t.near>t.far)throw new e("near must be greater than zero and less than far.");t._left=o,t._right=n,t._top=i,t._bottom=r,t._near=s,t._far=l,t._perspectiveMatrix=a.computePerspectiveOffCenter(o,n,r,i,s,l),t._infinitePerspective=a.computeInfinitePerspectiveOffCenter(o,n,r,i,s)}}var u=function(){this.left=void 0,this._left=void 0,this.right=void 0,this._right=void 0,this.top=void 0,this._top=void 0,this.bottom=void 0,this._bottom=void 0,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far,this._cullingVolume=new s,this._perspectiveMatrix=void 0,this._infinitePerspective=void 0};u.prototype.getProjectionMatrix=function(){return l(this),this._perspectiveMatrix},u.prototype.getInfiniteProjectionMatrix=function(){return l(this),this._infinitePerspective};var c=new n,h=new n,d=new n,m=new n;return u.prototype.computeCullingVolume=function(t,i,r){if(t===void 0)throw new e("position is required.");if(i===void 0)throw new e("direction is required.");if(r===void 0)throw new e("up is required.");var a=this._cullingVolume.planes,s=this.top,l=this.bottom,u=this.right,p=this.left,f=this.near,v=this.far,g=n.cross(i,r,c),_=h;n.multiplyByScalar(i,f,_),n.add(t,_,_);var y=d;n.multiplyByScalar(i,v,y),n.add(t,y,y);var w=m;n.multiplyByScalar(g,p,w),n.add(_,w,w),n.subtract(w,t,w),n.normalize(w,w),n.cross(w,r,w);var C=a[0];return C===void 0&&(C=a[0]=new o),C.x=w.x,C.y=w.y,C.z=w.z,C.w=-n.dot(w,t),n.multiplyByScalar(g,u,w),n.add(_,w,w),n.subtract(w,t,w),n.normalize(w,w),n.cross(r,w,w),C=a[1],C===void 0&&(C=a[1]=new o),C.x=w.x,C.y=w.y,C.z=w.z,C.w=-n.dot(w,t),n.multiplyByScalar(r,l,w),n.add(_,w,w),n.subtract(w,t,w),n.normalize(w,w),n.cross(g,w,w),C=a[2],C===void 0&&(C=a[2]=new o),C.x=w.x,C.y=w.y,C.z=w.z,C.w=-n.dot(w,t),n.multiplyByScalar(r,s,w),n.add(_,w,w),n.subtract(w,t,w),n.normalize(w,w),n.cross(w,g,w),C=a[3],C===void 0&&(C=a[3]=new o),C.x=w.x,C.y=w.y,C.z=w.z,C.w=-n.dot(w,t),C=a[4],C===void 0&&(C=a[4]=new o),C.x=i.x,C.y=i.y,C.z=i.z,C.w=-n.dot(i,_),n.negate(i,w),C=a[5],C===void 0&&(C=a[5]=new o),C.x=w.x,C.y=w.y,C.z=w.z,C.w=-n.dot(w,y),this._cullingVolume},u.prototype.getPixelSize=function(i,n){if(l(this),i===void 0)throw new e("canvasDimensions is required.");var o=i.x,a=i.y;if(0>=o)throw new e("canvasDimensions.x must be greater than zero.");if(0>=a)throw new e("canvasDimensions.y must be greater than zero.");n=t(n,this.near);var s=1/this.near,u=this.top*s,c=2*n*u/a;u=this.right*s;var h=2*n*u/o;return new r(h,c)},u.prototype.clone=function(){var e=new u;return e.right=this.right,e.left=this.left,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},u.prototype.equals=function(e){return e!==void 0&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},u}),i("Scene/PerspectiveFrustum",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/PerspectiveOffCenterFrustum"],function(e,t,i,r,n,o){function a(t){if(t.fovy===void 0||t.aspectRatio===void 0||t.near===void 0||t.far===void 0)throw new e("fovy, aspectRatio, near, or far parameters are not set.");var i=t._offCenterFrustum;if(t.fovy!==t._fovy||t.aspectRatio!==t._aspectRatio||t.near!==t._near||t.far!==t._far){if(0>t.fovy||t.fovy>=Math.PI)throw new e("fovy must be in the range [0, PI).");if(0>t.aspectRatio)throw new e("aspectRatio must be positive.");if(0>t.near||t.near>t.far)throw new e("near must be greater than zero and less than far.");t._fovy=t.fovy,t._aspectRatio=t.aspectRatio,t._near=t.near,t._far=t.far,i.top=t.near*Math.tan(.5*t.fovy),i.bottom=-i.top,i.right=t.aspectRatio*i.top,i.left=-i.right,i.near=t.near,i.far=t.far}}var s=function(){this._offCenterFrustum=new o,this.fovy=void 0,this._fovy=void 0,this.aspectRatio=void 0,this._aspectRatio=void 0,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far};return s.prototype.getProjectionMatrix=function(){return a(this),this._offCenterFrustum.getProjectionMatrix()},s.prototype.getInfiniteProjectionMatrix=function(){return a(this),this._offCenterFrustum.getInfiniteProjectionMatrix()},s.prototype.computeCullingVolume=function(e,t,i){return a(this),this._offCenterFrustum.computeCullingVolume(e,t,i)},s.prototype.getPixelSize=function(e,t){return a(this),this._offCenterFrustum.getPixelSize(e,t)},s.prototype.clone=function(){var e=new s;return e.fovy=this.fovy,e.aspectRatio=this.aspectRatio,e.near=this.near,e.far=this.far,e._offCenterFrustum=this._offCenterFrustum.clone(),e},s.prototype.equals=function(e){return e===void 0?!1:(a(this),a(e),this.fovy===e.fovy&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))},s}),i("Scene/Camera",["../Core/DeveloperError","../Core/Math","../Core/Ellipsoid","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Core/Ray","./CameraController","./PerspectiveFrustum"],function(e,t,i,r,n,o,a,s,l){function u(e){var t=e._right,i=e._up,r=e._direction,n=e._position,a=new o(t.x,t.y,t.z,-t.dot(n),i.x,i.y,i.z,-i.dot(n),-r.x,-r.y,-r.z,r.dot(n),0,0,0,1);e._viewMatrix=a.multiply(e._invTransform),e._invViewMatrix=e._viewMatrix.inverseTransformation()}function c(e){var i=e._position,o=!i.equals(e.position);o&&(i=e._position=e.position.clone());var a=e._direction,s=!a.equals(e.direction);s&&(a=e._direction=e.direction.clone());var l=e._up,c=!l.equals(e.up);c&&(l=e._up=e.up.clone());var h=e._right,d=!h.equals(e.right);d&&(h=e._right=e.right.clone());var m=e._transform,p=!m.equals(e.transform);if(p&&(m=e._transform=e.transform.clone(),e._invTransform=e._transform.inverseTransformation()),(o||p)&&(e._positionWC=r.fromCartesian4(m.multiplyByPoint(i))),s||c||d){var f=a.dot(l.cross(h));if(Math.abs(1-f)>t.EPSILON2){a=e._direction=a.normalize(),e.direction=a.clone();var v=1/l.magnitudeSquared(),g=l.dot(a)*v,_=a.multiplyByScalar(g);l=e._up=l.subtract(_).normalize(),e.up=l.clone(),h=e._right=a.cross(l),e.right=h.clone()}}(s||p)&&(e._directionWC=r.fromCartesian4(m.multiplyByVector(new n(a.x,a.y,a.z,0)))),(c||p)&&(e._upWC=r.fromCartesian4(m.multiplyByVector(new n(l.x,l.y,l.z,0)))),(d||p)&&(e._rightWC=r.fromCartesian4(m.multiplyByVector(new n(h.x,h.y,h.z,0)))),(o||s||c||d||p)&&u(e)}var h=function(n){if(n===void 0)throw new e("canvas is required.");this.transform=o.IDENTITY.clone(),this._transform=this.transform.clone(),this._invTransform=o.IDENTITY.clone();var a=i.WGS84.getMaximumRadius(),c=new r(0,-2,1).normalize().multiplyByScalar(2.5*a);this.position=c.clone(),this._position=c,this._positionWC=c;var h=r.ZERO.subtract(c).normalize();this.direction=h.clone(),this._direction=h,this._directionWC=h;var d=h.cross(r.UNIT_Z).normalize(),m=d.cross(h);this.up=m.clone(),this._up=m,this._upWC=m,d=h.cross(m),this.right=d.clone(),this._right=d,this._rightWC=d,this.frustum=new l,this.frustum.fovy=t.toRadians(60),this.frustum.aspectRatio=n.clientWidth/n.clientHeight,this.controller=new s(this),this._viewMatrix=void 0,this._invViewMatrix=void 0,u(this),this._canvas=n};return h.prototype.getInverseTransform=function(){return c(this),this._invTransform},h.prototype.getViewMatrix=function(){return c(this),this._viewMatrix},h.prototype.getInverseViewMatrix=function(){return c(this),this._invViewMatrix},h.prototype.getPositionWC=function(){return c(this),this._positionWC},h.prototype.getDirectionWC=function(){return c(this),this._directionWC},h.prototype.getUpWC=function(){return c(this),this._upWC},h.prototype.getRightWC=function(){return c(this),this._rightWC},h.prototype.clone=function(){var e=new h(this._canvas);return e.position=this.position.clone(),e.direction=this.direction.clone(),e.up=this.up.clone(),e.right=this.right.clone(),e.transform=this.transform.clone(),e.frustum=this.frustum.clone(),e},h.prototype.worldToCameraCoordinates=function(t,i){if(t===void 0)throw new e("cartesian is required.");return o.multiplyByVector(this.getInverseTransform(),t,i)},h.prototype.cameraToWorldCoordinates=function(t,i){if(t===void 0)throw new e("cartesian is required.");return o.multiplyByVector(this.transform,t,i)},h}),i("Scene/CameraEventType",["../Core/Enumeration"],function(e){var t={LEFT_DRAG:new e(0,"LEFT_DRAG"),RIGHT_DRAG:new e(1,"RIGHT_DRAG"),MIDDLE_DRAG:new e(2,"MIDDLE_DRAG"),WHEEL:new e(3,"WHEEL"),PINCH:new e(4,"PINCH")};return t}),i("Scene/CameraEventAggregator",["../Core/DeveloperError","../Core/destroyObject","../Core/Math","../Core/ScreenSpaceEventHandler","../Core/ScreenSpaceEventType","../Core/Cartesian2","./CameraEventType"],function(e,t,i,r,n,o,a){var s=function(t,s,l){if(t===void 0)throw new e("description.canvas is required.");if(s===void 0)throw new e("moveType is required.");this._eventHandler=new r(t),this._update=!0,this._movement=void 0,this._lastMovement=void 0,this._isDown=!1,this._pressTime=void 0,this._releaseTime=void 0;var u=this;if(s===a.PINCH)this._eventHandler.setInputAction(function(){u._isDown=!0,u._pressTime=new Date},n.PINCH_START,l),this._eventHandler.setInputAction(function(){u._isDown=!1,u._releaseTime=new Date},n.PINCH_END,l),this._eventHandler.setInputAction(function(e){if(u._isDown){u._update?(u._movement=e,u._update=!1,u._movement.prevAngle=u._movement.angleAndHeight.startPosition.x):(u._movement.distance.endPosition=e.distance.endPosition.clone(),u._movement.angleAndHeight.endPosition=e.angleAndHeight.endPosition.clone());for(var i=u._movement.angleAndHeight.endPosition.x,r=u._movement.prevAngle,n=2*Math.PI;i>=r+Math.PI;)i-=n;for(;r-Math.PI>i;)i+=n;u._movement.angleAndHeight.endPosition.x=-i*t.clientWidth/12,u._movement.angleAndHeight.startPosition.x=-r*t.clientWidth/12}},n.PINCH_MOVE,l);else if(s===a.WHEEL)this._eventHandler.setInputAction(function(e){var t=2*i.toRadians(e);u._update?(u._movement={startPosition:new o,endPosition:new o(0,t),motion:new o},u._lastMovement=u._movement,u._update=!1):u._movement.endPosition.y=u._movement.endPosition.y+t,u._pressTime=new Date,u._releaseTime=new Date(u._pressTime.getTime()+5*Math.abs(t))},n.WHEEL,l);else{var c,h;if(s===a.LEFT_DRAG)c=n.LEFT_DOWN,h=n.LEFT_UP;else if(s===a.RIGHT_DRAG)c=n.RIGHT_DOWN,h=n.RIGHT_UP;else{if(s!==a.MIDDLE_DRAG)throw this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),new e("moveType must be of type CameraEventType.");c=n.MIDDLE_DOWN,h=n.MIDDLE_UP}this._eventHandler.setInputAction(function(){u._lastMovement=null,u._isDown=!0,u._pressTime=new Date},c,l),this._eventHandler.setInputAction(function(){u._isDown=!1,u._releaseTime=new Date},h,l),this._eventHandler.setInputAction(function(e){u._isDown&&(u._update?(u._lastMovement=u._movement,u._movement=e,u._update=!1):u._movement.endPosition=e.endPosition.clone())},n.MOUSE_MOVE,l)}};return s.prototype.isMoving=function(){return!this._update},s.prototype.getMovement=function(){var e=this._movement;return this._update=!0,e},s.prototype.getLastMovement=function(){return this._lastMovement},s.prototype.isButtonDown=function(){return this._isDown},s.prototype.getButtonPressTime=function(){return this._pressTime},s.prototype.getButtonReleaseTime=function(){return this._releaseTime},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),t(this)},s}),i("Scene/CameraFlightPath",["../Core/Cartesian3","../Core/Cartographic","../Core/clone","../Core/defaultValue","../Core/DeveloperError","../Core/Ellipsoid","../Core/HermiteSpline","../Core/IntersectionTests","../Core/Math","../Core/Matrix3","../Core/OrientationInterpolator","../Core/Quaternion","../Core/Ray","../Scene/PerspectiveFrustum","../Scene/PerspectiveOffCenterFrustum","../Scene/SceneMode","../ThirdParty/Tween"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v){function g(e,t){var i=e.cross(t);t=i.cross(e);var r=new u(i.x,i.y,i.z,t.x,t.y,t.z,-e.x,-e.y,-e.z);return h.fromRotationMatrix(r)}function _(e,t,i){var r,n,o;if(e instanceof m){var a=Math.tan(.5*e.fovy);return r=e.near,n=e.near*a,o=e.aspectRatio*n,Math.max(t*r/o,i*r/n)}return e instanceof p?(r=e.near,n=e.top,o=e.right,Math.max(t*r/o,i*r/n)):Math.max(t,i)}function y(t){if(t.length>2)return new a(t);var i=t[0],r=t[1];return{getControlPoints:function(){return t},evaluate:function(t){t=l.clamp(t,i.time,r.time);var n=(t-i.time)/(r.time-i.time);return e.lerp(i.point,r.point,n)}}}function w(t,i,r,n,o){var a,s,c,d=i.getMaximumRadius(),m=t.frustum,p=_(m,d,d),f=r.normalize().dot(n.normalize());if(r.magnitude()>p)s=d+.6*(p-d),c=.35;else{var v=r.subtract(n);s=v.multiplyByScalar(.5).add(n).magnitude();var g=t.up.multiplyByScalar(v.dot(t.up)).magnitude(),w=t.right.multiplyByScalar(v.dot(t.right)).magnitude();s+=_(m,g,w),c=l.clamp(f+1,.25,.5)}var C,x,T,S,E=n.normalize().multiplyByScalar(s),b=r.normalize().multiplyByScalar(s);if(n.magnitude()>p&&f>.75)S=r.subtract(n).multiplyByScalar(.5).add(n),a=[{point:r},{point:S},{point:n}];else if(r.magnitude()>p&&f>0)S=r.subtract(E).multiplyByScalar(.5).add(E),a=[{point:r},{point:S},{point:n}];else{a=[{point:r}],x=Math.acos(b.normalize().dot(E.normalize())),C=b.cross(E),C.equalsEpsilon(e.ZERO,l.EPSILON6)&&(C=e.UNIT_Z);for(var M=c*x,I=x-M,D=I;D>0;D-=M)T=u.fromQuaternion(h.fromAxisAngle(C,D)),a.push({point:T.multiplyByVector(E)});a.push({point:n})}for(var A=o/(a.length-1),P=0;a.length>P;++P)a[P].time=P*A;return y(a)}function C(t,i,r,n){i[0].orientation=g(t.direction,t.up);for(var o,a,s,l,u=i.length-1,h=1;u>h;++h)o=i[h],a=o.point.negate().normalize(),s=a.cross(e.UNIT_Z).normalize(),l=s.cross(a),o.orientation=g(a,l);return o=i[u],r!==void 0&&n!==void 0?o.orientation=g(r,n):(a=o.point.negate().normalize(),s=a.cross(e.UNIT_Z).normalize(),l=s.cross(a),o.orientation=g(a,l)),new c(i)}function x(e,t,i,r,n){var o=e.camera,a=e.scene2D.projection.getEllipsoid(),s=w(o,a,o.position,t,i),l=C(o,s.getControlPoints(),r,n),c=function(e){var t=e.time,i=l.evaluate(t),r=u.fromQuaternion(i);o.position=s.evaluate(t),o.right=r.getRow(0),o.up=r.getRow(1),o.direction=r.getRow(2).negate()};return c}function T(t,i,r,n,o){var a,s,u=i.getMaximumRadius(),c=t.frustum,h=_(c,Math.PI*u,l.PI_OVER_TWO*u),d=.5;if(r.z>h)s=.6*h;else{var m=r.subtract(n);s=_(c,Math.abs(m.y),Math.abs(m.x))}var p=n.clone();p.z=s;var f=r.clone();f.z=s;var v;if(n.z>h)v=r.subtract(n).multiplyByScalar(.5).add(n),a=[{point:r},{point:v},{point:n}];else if(r.z>h)v=r.subtract(p).multiplyByScalar(.5).add(p),a=[{point:r},{point:v},{point:n}];else{a=[{point:r}];var g=f.subtract(p),w=g.magnitude();e.normalize(g,g);for(var C=d*w,x=w-C,T=x;T>0;T-=C)a.push({point:g.multiplyByScalar(T).add(p)});a.push({point:n})}for(var S=o/(a.length-1),E=0;a.length>E;++E)a[E].time=E*S;return y(a)}function S(t,i,r,n){i[0].orientation=g(t.direction,t.up);for(var o,a,s,l,u=i.length-1,h=1;u>h;++h)o=i[h],a=e.UNIT_Z.negate(),s=a.cross(e.UNIT_Y).normalize(),l=s.cross(a),o.orientation=g(a,l);return o=i[u],r!==void 0&&n!==void 0?o.orientation=g(r,n):(a=e.UNIT_Z.negate(),s=a.cross(e.UNIT_Y).normalize(),l=s.cross(a),o.orientation=g(a,l)),new c(i)}function E(e,t,i,r,n){var o=e.camera,a=e.scene2D.projection.getEllipsoid(),s=T(o,a,o.position.clone(),t,i),l=S(o,s.getControlPoints(),r,n),c=function(e){var t=e.time,i=l.evaluate(t),r=u.fromQuaternion(i);o.position=s.evaluate(t),o.right=r.getRow(0),o.up=r.getRow(1),o.direction=r.getRow(2).negate()};return c}function b(t,i,r,n,o){var a=t.camera,s=t.scene2D.projection.getEllipsoid(),l=a.position.clone();l.z=a.frustum.right-a.frustum.left;var c=T(a,s,l,i,r),h=c.getControlPoints(),d=S(a,h,e.UNIT_Z.negate(),o),m=a.position.z,p=function(e){var t=e.time,i=d.evaluate(t),r=u.fromQuaternion(i);a.position=c.evaluate(t);var n=a.position.z;a.position.z=m,a.right=r.getRow(0),a.up=r.getRow(1),a.direction=r.getRow(2).negate();var o=a.frustum,s=o.top/o.right,l=.5*(n-(o.right-o.left));o.right+=l,o.left-=l,o.top=s*o.right,o.bottom=-o.top};return p}var M={};return M.createAnimation=function(e,t){t=r(t,r.EMPTY_OBJECT);var i=t.destination,o=t.direction,a=t.up;if(e===void 0)throw new n("frameState is required.");if(i===void 0)throw new n("destination is required.");var s,l=r(t.duration,3e3),u=t.onComplete;return s=e.mode===f.SCENE3D?x(e,i,l,o,a):e.mode===f.SCENE2D?b(e,i,l,o,a):E(e,i,l,o,a),{duration:l,easingFunction:v.Easing.Sinusoidal.InOut,startValue:{time:0},stopValue:{time:l},onUpdate:s,onComplete:u}},M.createAnimationCartographic=function(e,t){t=r(t,r.EMPTY_OBJECT);var o=t.destination;if(e===void 0)throw new n("frameState is required.");if(o===void 0)throw new n("description.destination is required.");var a,s=e.scene2D.projection;if(e.mode===f.SCENE3D){var l=s.getEllipsoid();a=l.cartographicToCartesian(o)}else a=s.project(o);var u=i(t);return u.destination=a,this.createAnimation(e,u)},M}),i("Scene/Imagery",["../Core/destroyObject","./ImageryState"],function(e,t){var i=function(e,i,r,n,o){if(this.imageryLayer=e,this.x=i,this.y=r,this.level=n,0!==n){var a=0|i/2,s=0|r/2,l=n-1;this.parent=e.getImageryFromCache(a,s,l)}if(this.state=t.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.referenceCount=0,o===void 0&&e.getImageryProvider().isReady()){var u=e.getImageryProvider().getTilingScheme();o=u.tileXYToExtent(i,r,n)}this.extent=o};return i.createPlaceholder=function(e){var r=new i(e,0,0,0);return r.addReference(),r.state=t.PLACEHOLDER,r},i.prototype.addReference=function(){++this.referenceCount},i.prototype.releaseReference=function(){return--this.referenceCount,0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),this.parent!==void 0&&this.parent.releaseReference(),this.image!==void 0&&this.image.destroy!==void 0&&this.image.destroy(),this.texture!==void 0&&this.texture.destroy!==void 0&&this.texture.destroy(),e(this),0):this.referenceCount},i}),i("Scene/TileImagery",[],function(){var e=function(e,t){this.imagery=e,this.textureCoordinateExtent=t,this.originalImagery=void 0,this.textureTranslationAndScale=void 0};return e.prototype.freeResources=function(){this.imagery.releaseReference(),this.originalImagery!==void 0&&this.originalImagery.releaseReference()},e}),i("Scene/TexturePool",["../Core/destroyObject","../Core/DeveloperError","../Renderer/PixelDatatype","../Renderer/PixelFormat","../Renderer/Texture"],function(e,t,i,r,n){function o(e,t,i){return a===void 0&&(a=function(e,t,i){this._texture=e,this._textureTypeKey=t,this._pool=i},Object.keys(n.prototype).forEach(function(e){a.prototype[e]=function(){var t=this._texture;return t[e].apply(t,arguments)}}),a.prototype.destroy=function(){var e=this._pool._free[this._textureTypeKey];e===void 0&&(e=this._pool._free[this._textureTypeKey]=[]),e.length>=8?this._texture.destroy():e.push(this)}),new a(e,t,i)}var a,s=function(){this._free={}};return s.prototype.createTexture2D=function(e,n){if(!n)throw new t("description is required.");var a=n.source,s=a!==void 0?a.width:n.width,l=a!==void 0?a.height:n.height,u=+(n.pixelFormat||r.RGBA),c=+(n.pixelDatatype||i.UNSIGNED_BYTE),h=+(n.preMultiplyAlpha||u===r.RGB||u===r.LUMINANCE),d=JSON.stringify([s,l,u,c,h]),m=this._free[d];if(m!==void 0&&m.length>0){var p=m.pop();return a!==void 0&&p.copyFrom(a),p}return o(e.createTexture2D(n),d,this)},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){var t=this._free;return Object.keys(t).forEach(function(e){t[e].forEach(function(e){e._texture.destroy()})}),e(this)},s}),i("Shaders/ReprojectWebMercatorFS",[],function(){return"uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n"}),i("Shaders/ReprojectWebMercatorVS",[],function(){return"attribute vec4 position;\nuniform vec2 u_textureDimensions;\nuniform float u_northLatitude;\nuniform float u_southLatitude;\nuniform float u_southMercatorYHigh;\nuniform float u_southMercatorYLow;\nuniform float u_oneOverMercatorHeight;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nfloat currentLatitude = mix(u_southLatitude, u_northLatitude, position.y);\nfloat fraction = czm_latitudeToWebMercatorFraction(currentLatitude, u_southMercatorYLow, u_southMercatorYHigh, u_oneOverMercatorHeight);\nv_textureCoordinates = vec2(position.x, fraction);\ngl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n"}),i("Scene/ImageryLayer",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingRectangle","../Core/ComponentDatatype","../Core/Cartesian2","../Core/Cartesian4","../Core/Color","../Core/DeveloperError","../Core/Event","../Core/Extent","../Core/Math","../Core/PrimitiveType","../Renderer/BufferUsage","../Renderer/MipmapHint","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Renderer/ClearCommand","./GeographicTilingScheme","./Imagery","./TileProviderError","./ImageryState","./TileImagery","./TerrainProvider","./TexturePool","../ThirdParty/when","../Shaders/ReprojectWebMercatorFS","../Shaders/ReprojectWebMercatorVS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M){function I(e,t,i){return JSON.stringify([e,t,i])}function D(t,n,o,s){var l=n.cache.imageryLayer_reproject;if(l===void 0){l=n.cache.imageryLayer_reproject={framebuffer:void 0,vertexArray:void 0,shaderProgram:void 0,renderState:void 0,sampler:void 0,destroy:function(){this.framebuffer!==void 0&&this.frameBuffer.destroy(),this.vertexArray!==void 0&&this.vertexArray.destroy(),this.shaderProgram!==void 0&&this.shaderProgram.destroy()}},l.framebuffer=n.createFramebuffer(),l.framebuffer.destroyAttachments=!1;for(var u=Array(131072),c=0,_=0;256>_;++_)for(var y=_/255,w=0;256>w;++w){var C=w/255;u[c++]=C,u[c++]=y}var x={attributes:{position:{componentDatatype:r.FLOAT,componentsPerAttribute:2,values:u}},indexLists:[{primitiveType:h.TRIANGLES,values:T.getRegularGridIndices(256,256)}]},S={position:0};l.vertexArray=n.createVertexArrayFromMesh({mesh:x,attributeIndices:S,bufferUsage:d.STATIC_DRAW}),l.shaderProgram=n.getShaderCache().getShaderProgram(M,b,S);var E=n.getMaximumTextureFilterAnisotropy();l.sampler=n.createSampler({wrapS:v.CLAMP,wrapT:v.CLAMP,minificationFilter:f.LINEAR,magnificationFilter:p.LINEAR,maximumAnisotropy:Math.min(E,e(t._maximumAnisotropy,E))})}o.setSampler(l.sampler);var I=o.getWidth(),D=o.getHeight();R.textureDimensions.x=I,R.textureDimensions.y=D,R.texture=o,R.northLatitude=s.north,R.southLatitude=s.south;var A=Math.sin(s.south),P=.5*Math.log((1+A)/(1-A));O[0]=P,R.southMercatorYHigh=O[0],R.southMercatorYLow=P-O[0],A=Math.sin(s.north);var z=.5*Math.log((1+A)/(1-A));R.oneOverMercatorHeight=1/(z-P);var L=t._texturePool.createTexture2D(n,{width:I,height:D,pixelFormat:o.getPixelFormat(),pixelDatatype:o.getPixelDatatype(),preMultiplyAlpha:o.getPreMultiplyAlpha()});L.generateMipmap(m.NICEST),l.framebuffer.setColorTexture(L);var N=new g;return N.color=a.BLACK,N.framebuffer=l.framebuffer,N.execute(n),(l.renderState===void 0||l.renderState.viewport.width!==I||l.renderState.viewport.height!==D)&&(l.renderState=n.createRenderState({viewport:new i(0,0,I,D)})),n.draw({framebuffer:l.framebuffer,shaderProgram:l.shaderProgram,renderState:l.renderState,primitiveType:h.TRIANGLES,vertexArray:l.vertexArray,uniformMap:R}),L}function A(e,t,i){var r=e._imageryProvider,n=r.getTilingScheme(),o=n.getEllipsoid(),a=Math.cos(i),s=n.getExtent(),l=o.getMaximumRadius()*(s.east-s.west)*a/(r.getTileWidth()*n.getNumberOfXTilesAtLevel(0)),u=l/t,c=Math.log(u)/Math.log(2),h=Math.round(c);return 0|h}var P=function P(t,i){this._imageryProvider=t,i=e(i,{}),this.alpha=e(i.alpha,e(t.defaultAlpha,1)),this.brightness=e(i.brightness,e(t.defaultBrightness,P.DEFAULT_BRIGHTNESS)),this.contrast=e(i.contrast,e(t.defaultContrast,P.DEFAULT_CONTRAST)),this.hue=e(i.hue,e(t.defaultHue,P.DEFAULT_HUE)),this.saturation=e(i.saturation,e(t.defaultSaturation,P.DEFAULT_SATURATION)),this.gamma=e(i.gamma,e(t.defaultGamma,P.DEFAULT_GAMMA)),this.show=e(i.show,!0),this._extent=e(i.extent,u.MAX_VALUE),this._maximumAnisotropy=i.maximumAnisotropy,this._imageryCache={},this._texturePool=new S,this._skeletonPlaceholder=new x(y.createPlaceholder(this)),this._show=!1,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0};P.DEFAULT_BRIGHTNESS=1,P.DEFAULT_CONTRAST=1,P.DEFAULT_HUE=0,P.DEFAULT_SATURATION=1,P.DEFAULT_GAMMA=1,P.prototype.getImageryProvider=function(){return this._imageryProvider},P.prototype.getExtent=function(){return this._extent},P.prototype.isBaseLayer=function(){return this._isBaseLayer},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){return this._texturePool=this._texturePool&&this._texturePool.destroy(),t(this)},P.prototype._createTileImagerySkeletons=function(e,t,i){var r=this._imageryProvider;if(i===void 0&&(i=e.imagery.length),!r.isReady())return this._skeletonPlaceholder.imagery.addReference(),e.imagery.splice(i,0,this._skeletonPlaceholder),!0;var n=e.extent.intersectWith(r.getExtent());if(n=n.intersectWith(this._extent),n.west>=n.east||n.south>=n.north){if(!this.isBaseLayer())return!1;var a=r.getExtent().intersectWith(this._extent),s=e.extent;s.south>=a.north?n.north=n.south=a.north:a.south>=s.north&&(n.north=n.south=a.south),s.west>=a.east?n.west=n.east=a.east:a.west>=s.east&&(n.west=n.east=a.west)}var l=0;n.south>0?l=n.south:0>n.north&&(l=n.north);var u=1,c=u*t.getLevelMaximumGeometricError(e.level),h=A(this,c,l);h=Math.max(0,h);var d=r.getMaximumLevel();h>d&&(h=d);var m=r.getTilingScheme(),p=m.positionToTileXY(n.getNorthwest(),h),f=m.positionToTileXY(n.getSoutheast(),h),v=(e.extent.north-e.extent.south)/512,g=(e.extent.east-e.extent.west)/512,_=m.tileXYToExtent(p.x,p.y,h);g>Math.abs(_.south-n.north)&&f.y>p.y&&++p.y,v>Math.abs(_.east-n.west)&&f.x>p.x&&++p.x;var y=m.tileXYToExtent(f.x,f.y,h);g>Math.abs(y.north-n.south)&&f.y>p.y&&--f.y,v>Math.abs(y.west-n.east)&&f.x>p.x&&--f.x;var w,C,T=m.getNumberOfXTilesAtLevel(h),S=m.getNumberOfYTilesAtLevel(h),E=e.extent,b=m.tileXYToExtent(p.x,p.y,h),M=0,I=1;this.isBaseLayer()||0!==p.x||(M=Math.min(1,(b.west-E.west)/(E.east-E.west))),this.isBaseLayer()||0!==p.y||(I=Math.max(0,(b.north-E.south)/(E.north-E.south)));for(var D=I,P=p.x;f.x>=P;P++){w=M,b=m.tileXYToExtent(P,p.y,h),M=Math.min(1,(b.east-E.west)/(E.east-E.west)),P===f.x&&(this.isBaseLayer()||T-1>P)&&(M=1),I=D;for(var R=p.y;f.y>=R;R++){C=I,b=m.tileXYToExtent(P,R,h),I=Math.max(0,(b.south-E.south)/(E.north-E.south)),R===f.y&&(this.isBaseLayer()||S-1>R)&&(I=0);var O=new o(w,I,M,C),z=this.getImageryFromCache(P,R,h,b);e.imagery.splice(i,0,new x(z,O)),++i}}return!0},P.prototype._calculateTextureTranslationAndScale=function(e,t){var i=t.imagery.extent,r=e.extent,n=r.east-r.west,a=r.north-r.south,s=n/(i.east-i.west),l=a/(i.north-i.south);return new o(s*(r.west-i.west)/n,l*(r.south-i.south)/a,s,l)},P.prototype._requestImagery=function(e){function t(t){return t===void 0?i():(e.image=t,e.state=C.RECEIVED,w.handleSuccess(o._requestImageError),void 0)}function i(){e.state=C.FAILED;var t="Failed to obtain image tile X: "+e.x+" Y: "+e.y+" Level: "+e.level+".";o._requestImageError=w.handleError(o._requestImageError,n,n.getErrorEvent(),t,e.x,e.y,e.level,r)}function r(){e.state=C.TRANSITIONING;var r=n.requestImage(e.x,e.y,e.level);return r===void 0?(e.state=C.UNLOADED,void 0):(E(r,t,i),void 0)}var n=this._imageryProvider,o=this;r()},P.prototype._createTexture=function(e,t){var i=this._imageryProvider;if(i.getTileDiscardPolicy!==void 0){var r=i.getTileDiscardPolicy();if(r!==void 0){if(!r.isReady())return t.state=C.RECEIVED,void 0;if(r.shouldDiscardImage(t.image))return t.state=C.INVALID,void 0}}var n=this._texturePool.createTexture2D(e,{source:t.image});t.texture=n,t.image=void 0,t.state=C.TEXTURE_LOADED},P.prototype._reprojectTexture=function(t,i){var r=i.texture,n=i.extent;if(!(this._imageryProvider.getTilingScheme()instanceof _)&&(n.east-n.west)/r.getWidth()>1e-5){var o=D(this,t,r,i.extent);r.destroy(),i.texture=r=o}if(c.isPowerOfTwo(r.getWidth())&&c.isPowerOfTwo(r.getHeight())){var a=t.cache.imageryLayer_mipmapSampler;
if(a===void 0){var s=t.getMaximumTextureFilterAnisotropy();a=t.cache.imageryLayer_mipmapSampler=t.createSampler({wrapS:v.CLAMP,wrapT:v.CLAMP,minificationFilter:f.LINEAR_MIPMAP_LINEAR,magnificationFilter:p.LINEAR,maximumAnisotropy:Math.min(s,e(this._maximumAnisotropy,s))})}r.generateMipmap(m.NICEST),r.setSampler(a)}else{var l=t.cache.imageryLayer_nonMipmapSampler;l===void 0&&(l=t.cache.imageryLayer_nonMipmapSampler=t.createSampler({wrapS:v.CLAMP,wrapT:v.CLAMP,minificationFilter:f.LINEAR,magnificationFilter:p.LINEAR})),r.setSampler(l)}i.state=C.READY},P.prototype.getImageryFromCache=function(e,t,i,r){var n=I(e,t,i),o=this._imageryCache[n];return o===void 0&&(o=new y(this,e,t,i,r),this._imageryCache[n]=o),o.addReference(),o},P.prototype.removeImageryFromCache=function(e){var t=I(e.x,e.y,e.level);delete this._imageryCache[t]};var R={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},u_northLatitude:function(){return this.northLatitude},u_southLatitude:function(){return this.southLatitude},u_southMercatorYLow:function(){return this.southMercatorYLow},u_southMercatorYHigh:function(){return this.southMercatorYHigh},u_oneOverMercatorHeight:function(){return this.oneOverMercatorHeight},textureDimensions:new n,texture:void 0,northLatitude:0,southLatitude:0,southMercatorYHigh:0,southMercatorYLow:0,oneOverMercatorHeight:0},O="undefined"!=typeof Float32Array?new Float32Array(1):void 0;return P}),i("Scene/TileLoadQueue",[],function(){var e=function e(){this.head=void 0,this.tail=void 0,this._insertionPoint=void 0};return e.prototype.remove=function(e){var t=e.loadPrevious,i=e.loadNext;e===this.head?this.head=i:t.loadNext=i,e===this.tail?this.tail=t:i.loadPrevious=t,e.loadPrevious=void 0,e.loadNext=void 0},e.prototype.markInsertionPoint=function(){this._insertionPoint=this.head},e.prototype.insertBeforeInsertionPoint=function(e){var t=this._insertionPoint;if(t!==e){if(this.head===void 0)return e.loadPrevious=void 0,e.loadNext=void 0,this.head=e,this.tail=e,void 0;if((e.loadPrevious!==void 0||e.loadNext!==void 0)&&this.remove(e),t===void 0)return e.loadPrevious=this.tail,e.loadNext=void 0,this.tail.loadNext=e,this.tail=e,void 0;var i=t.loadPrevious;e.loadPrevious=i,i!==void 0&&(i.loadNext=e),e.loadNext=t,t.loadPrevious=e,t===this.head&&(this.head=e)}},e.prototype.clear=function(){for(var e=this.head;e!==void 0;){var t=e.loadNext;e.loadNext=void 0,e.loadPrevious=void 0,e=t}this.head=void 0,this.tail=void 0,this._insertionPoint=void 0},e}),i("Scene/TileReplacementQueue",["./ImageryState","./TerrainState"],function(e,t){var i=function i(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0};return i.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},i.prototype.trimTiles=function(i){for(var r=this.tail,n=!0;n&&this._lastBeforeStartOfFrame!==void 0&&this.count>i&&r!==void 0;){n=r!==this._lastBeforeStartOfFrame;for(var o=r.replacementPrevious,a=r.loadedTerrain,s=a!==void 0&&(a.state===t.RECEIVING||a.state===t.TRANSFORMING),l=r.upsampledTerrain,u=l!==void 0&&(l.state===t.RECEIVING||l.state===t.TRANSFORMING),c=!s&&!u,h=r.imagery,d=0,m=h.length;c&&m>d;++d){var p=h[d];c=p.imagery.state!==e.TRANSITIONING}c&&(r.freeResources(),this._remove(r)),r=o}},i.prototype._remove=function(e){var t=e.replacementPrevious,i=e.replacementNext;e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=i),e===this.head?this.head=i:t.replacementNext=i,e===this.tail?this.tail=t:i.replacementPrevious=t,e.replacementPrevious=void 0,e.replacementNext=void 0,--this.count},i.prototype.markTileRendered=function(e){var t=this.head;return t===e?(e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext),void 0):(++this.count,t===void 0?(e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,this.tail=e,void 0):((e.replacementPrevious!==void 0||e.replacementNext!==void 0)&&this._remove(e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e,void 0))},i}),i("Scene/CentralBodySurface",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingSphere","../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/CubeMapEllipsoidTessellator","../Core/DeveloperError","../Core/Ellipsoid","../Core/EllipsoidalOccluder","../Core/Intersect","../Core/Matrix4","../Core/MeshFilters","../Core/Occluder","../Core/PrimitiveType","../Core/Queue","../Core/TaskProcessor","../Core/WebMercatorProjection","../Renderer/DrawCommand","../Renderer/PixelDatatype","../Renderer/PixelFormat","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","./ImageryLayer","./ImageryState","./SceneMode","./TerrainProvider","./TerrainState","./TileLoadQueue","./TileReplacementQueue","./TileState","./TileTerrain","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P,R){function O(e,t){return e.imagery.imageryLayer._layerIndex-t.imagery.imageryLayer._layerIndex}function z(e){if(e._imageryLayerCollection._update(),e._layerOrderChanged){e._layerOrderChanged=!1;for(var t=e._tileReplacementQueue.head;t!==void 0;)t.imagery.sort(O),t=t.replacementNext}}function L(e,t,i){var r=e._debug;if(!r.suspendLodUpdate){var n,o,a=e._tilesToRenderByTextureCount;for(n=0,o=a.length;o>n;++n){var s=a[n];s!==void 0&&(s.length=0)}var l=e._tileTraversalQueue;if(l.clear(),r.maxDepth=0,r.tilesVisited=0,r.tilesCulled=0,r.tilesRendered=0,r.texturesRendered=0,r.tilesWaitingForChildren=0,e._tileLoadQueue.clear(),e._tileLoadQueue.markInsertionPoint(),e._tileReplacementQueue.markStartOfRenderFrame(),e._levelZeroTiles===void 0){if(!e._terrainProvider.isReady())return;var u=e._terrainProvider.getTilingScheme();e._levelZeroTiles=u.createLevelZeroTiles()}var c=i.camera.getPositionWC(),h=e._terrainProvider.getTilingScheme().getEllipsoid(),d=h.cartesianToCartographic(c);e._ellipsoidalOccluder.setCameraPosition(c);var m,p=e._levelZeroTiles;for(n=0,o=p.length;o>n;++n)m=p[n],m.state!==R.READY&&k(e,m),m.isRenderable&&F(e,i,m)?l.enqueue(m):(++r.tilesCulled,m.isRenderable||++r.tilesWaitingForChildren);for(;(m=l.dequeue())!==void 0;)if(++r.tilesVisited,e._tileReplacementQueue.markTileRendered(m),m.level>r.maxDepth&&(r.maxDepth=m.level),e._maxScreenSpaceError>N(e,t,i,c,d,m))B(e,m);else if(U(e,i,m)){var f=m.children;for(n=0,o=f.length;o>n;++n)F(e,i,f[n])?l.enqueue(f[n]):++r.tilesCulled}else++r.tilesWaitingForChildren,B(e,m);r.enableDebugOutput&&(r.tilesVisited!==r.lastTilesVisited||r.tilesRendered!==r.lastTilesRendered||r.texturesRendered!==r.lastTexturesRendered||r.tilesCulled!==r.lastTilesCulled||r.maxDepth!==r.lastMaxDepth||r.tilesWaitingForChildren!==r.lastTilesWaitingForChildren)&&(console.log("Visited "+r.tilesVisited+", Rendered: "+r.tilesRendered+", Textures: "+r.texturesRendered+", Culled: "+r.tilesCulled+", Max Depth: "+r.maxDepth+", Waiting for children: "+r.tilesWaitingForChildren),r.lastTilesVisited=r.tilesVisited,r.lastTilesRendered=r.tilesRendered,r.lastTexturesRendered=r.texturesRendered,r.lastTilesCulled=r.tilesCulled,r.lastMaxDepth=r.maxDepth,r.lastTilesWaitingForChildren=r.tilesWaitingForChildren)}}function N(e,t,i,r,n,o){if(i.mode===M.SCENE2D)return V(e,t,i,r,n,o);var a=o.extent,s=1;if(i.mode===M.SCENE3D){var l=0;a.south>0?l=a.south:0>a.north&&(l=a.north),s=Math.cos(l)}var u=s*e._terrainProvider.getLevelMaximumGeometricError(o.level),c=Math.sqrt(q(i,r,n,o));o.distance=c;var h=t.getCanvas(),d=h.clientHeight,m=i.camera,p=m.frustum,f=p.fovy;return u*d/(2*c*Math.tan(.5*f))}function V(e,t,i,r,n,o){var a=i.camera,s=a.frustum,l=t.getCanvas(),u=l.clientWidth,c=l.clientHeight,h=e._terrainProvider.getLevelMaximumGeometricError(o.level),d=Math.max(s.top-s.bottom,s.right-s.left)/Math.max(u,c);return h/d}function B(e,t){for(var i=0,r=t.imagery,n=0,o=r.length;o>n;++n){var a=r[n],s=a.imagery.imageryLayer;a.imagery.state===b.READY&&0!==s.alpha&&++i}var l=e._tilesToRenderByTextureCount[i];l===void 0&&(l=[],e._tilesToRenderByTextureCount[i]=l),l.push(t);var u=e._debug;++u.tilesRendered,u.texturesRendered+=i}function F(e,t,r){var n=t.cullingVolume,a=r.boundingSphere3D;if(t.mode!==M.SCENE3D&&(a=K,i.fromExtentWithHeights2D(r.extent,t.scene2D.projection,r.minimumHeight,r.maximumHeight,a),a.center=new o(a.center.z,a.center.x,a.center.y),t.mode===M.MORPHING&&(a=i.union(r.boundingSphere3D,a,a))),n.getVisibility(a)===h.OUTSIDE)return!1;if(t.mode===M.SCENE3D){var s=r.occludeePointInScaledSpace;return s===void 0?!0:e._ellipsoidalOccluder.isScaledSpacePointVisible(s)}return!0}function q(e,t,i,r){var n=r.southwestCornerCartesian,a=r.northeastCornerCartesian,s=r.westNormal,l=r.southNormal,u=r.eastNormal,c=r.northNormal,h=r.maximumHeight;e.mode!==M.SCENE3D&&(n=e.scene2D.projection.project(r.extent.getSouthwest(),J),n.z=n.y,n.y=n.x,n.x=0,a=e.scene2D.projection.project(r.extent.getNortheast(),Q),a.z=a.y,a.y=a.x,a.x=0,s=$,u=o.UNIT_Y,l=et,c=o.UNIT_Z,h=0);var d,m=t.subtract(n,tt),p=m.dot(s),f=m.dot(l),v=t.subtract(a,tt),g=v.dot(u),_=v.dot(c);d=e.mode===M.SCENE3D?i.height:t.x;var y=d-h,w=0;return p>0?w+=p*p:g>0&&(w+=g*g),f>0?w+=f*f:_>0&&(w+=_*_),y>0&&(w+=y*y),w}function U(e,t,i){for(var r=!0,n=i.getChildren(),o=0,a=n.length;a>o;++o){var s=n[o];e._tileReplacementQueue.markTileRendered(s),s.state!==R.READY&&k(e,s),s.isRenderable||(r=!1)}return r}function k(e,t){e._tileLoadQueue.insertBeforeInsertionPoint(t)}function W(e,t){var i=e._tileLoadQueue,r=e._terrainProvider,n=e._imageryLayerCollection,o=i.head;if(void 0!==o){e._tileReplacementQueue.trimTiles(e._tileCacheSize);var a=Date.now(),s=e._loadQueueTimeSlice,l=a+s;do{e._tileReplacementQueue.markTileRendered(o),o.processStateMachine(t,r,n);var u=o.loadNext;o.state===R.READY&&i.remove(o),o=u}while(l>Date.now()&&o!==void 0)}}function H(e,t,i,r,n,o,l){if(e._debug!==void 0&&e._debug.boundingSphereTile!==void 0){if(!e._debug.boundingSphereVA){var c=e._debug.boundingSphereTile.boundingSphere3D.radius,h=s.compute(new u(c,c,c),10);m.toWireframeInPlace(h),e._debug.boundingSphereVA=t.createVertexArrayFromMesh({mesh:h,attributeIndices:m.createAttributeIndices(h)})}var d=e._debug.boundingSphereTile;if(d.vertexArray===void 0)return;var p=d.center,v=G();Y(v,r),v.waterMask=d.waterMaskTexture,v.center3D=p;var g=i.camera.getViewMatrix(),_=g.multiplyByVector(new a(p.x,p.y,p.z,1));v.modifiedModelView=g.setColumn(3,_,v.modifiedModelView),v.dayTextures[0]=t.getDefaultTexture(),v.dayTextureTranslationAndScale[0]=new a(0,0,1,1),v.dayTextureTexCoordsExtent[0]=new a(0,0,1,1),v.dayTextureAlpha[0]=1;var w=new y;w.shaderProgram=n.getShaderProgram(t,0),w.renderState=o,w.primitiveType=f.LINES,w.vertexArray=e._debug.boundingSphereVA,w.uniformMap=v,l.push(w)}}function j(e,t){return e.distance-t.distance}function G(){return{u_center3D:function(){return this.center3D},u_tileExtent:function(){return this.tileExtent},u_modifiedModelView:function(){return this.modifiedModelView},u_dayTextures:function(){return this.dayTextures},u_dayTextureTranslationAndScale:function(){return this.dayTextureTranslationAndScale},u_dayTextureTexCoordsExtent:function(){return this.dayTextureTexCoordsExtent},u_dayTextureAlpha:function(){return this.dayTextureAlpha},u_dayTextureBrightness:function(){return this.dayTextureBrightness},u_dayTextureContrast:function(){return this.dayTextureContrast},u_dayTextureHue:function(){return this.dayTextureHue},u_dayTextureSaturation:function(){return this.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.dayTextureOneOverGamma},u_dayIntensity:function(){return this.dayIntensity},u_southAndNorthLatitude:function(){return this.southAndNorthLatitude},u_southMercatorYLowAndHighAndOneOverHeight:function(){return this.southMercatorYLowAndHighAndOneOverHeight},u_waterMask:function(){return this.waterMask},u_waterMaskTranslationAndScale:function(){return this.waterMaskTranslationAndScale},center3D:void 0,modifiedModelView:new d,tileExtent:new a,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsExtent:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayIntensity:0,southAndNorthLatitude:new n,southMercatorYLowAndHighAndOneOverHeight:new o,waterMask:void 0,waterMaskTranslationAndScale:new a}}function Y(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}function X(e,t,r,n,s,l,u,c,h){for(var m=r.camera.getViewMatrix(),p=t.getMaximumTextureImageUnits(),v=e._tileCommands,g=e._tileCommandUniformMaps,w=-1,C=e._tilesToRenderByTextureCount,x=0,T=C.length;T>x;++x){var S=C[x];if(void 0!==S&&0!==S.length){S.sort(j);for(var D=0,A=S.length;A>D;D++){var P=S[D],R=P.center,O=nt,z=0,L=0,N=0,V=0,B=0;if(s!==M.SCENE3D){var F=l.project(P.extent.getSouthwest()),q=l.project(P.extent.getNortheast());if(O.x=F.x,O.y=F.y,O.z=q.x,O.w=q.y,s!==M.MORPHING&&(R=ot,R.x=0,R.y=.5*(O.z+O.x),R.z=.5*(O.w+O.y),O.x-=R.y,O.y-=R.z,O.z-=R.y,O.w-=R.z),l instanceof _){z=P.extent.south,L=P.extent.north;var U=_.geodeticLatitudeToMercatorAngle(z),k=_.geodeticLatitudeToMercatorAngle(L);it[0]=U,N=it[0],V=U-it[0],B=1/(k-U)}}var W=at;W.x=R.x,W.y=R.y,W.z=R.z,W.w=1,d.multiplyByVector(m,W,W),m.setColumn(3,W,rt);var H=P.imagery,X=0,Z=H.length;do{var K=0;++w;var J=v[w];J===void 0&&(J=new y,v[w]=J,g[w]=G());var Q=g[w];Y(Q,u),Q.center3D=P.center,a.clone(O,Q.tileExtent),Q.southAndNorthLatitude.x=z,Q.southAndNorthLatitude.y=L,Q.southMercatorYLowAndHighAndOneOverHeight.x=V,Q.southMercatorYLowAndHighAndOneOverHeight.y=N,Q.southMercatorYLowAndHighAndOneOverHeight.z=B,d.clone(rt,Q.modifiedModelView);for(var $=!1,et=!1,tt=!1,st=!1,lt=!1;p>K&&Z>X;){var ut=H[X],ct=ut.imagery,ht=ct.imageryLayer;++X,ct.state===b.READY&&0!==ht.alpha&&(ut.textureTranslationAndScale===void 0&&(ut.textureTranslationAndScale=ht._calculateTextureTranslationAndScale(P,ut)),Q.dayTextures[K]=ct.texture,Q.dayTextureTranslationAndScale[K]=ut.textureTranslationAndScale,Q.dayTextureTexCoordsExtent[K]=ut.textureCoordinateExtent,Q.dayTextureAlpha[K]="function"==typeof ht.alpha?ht.alpha(r,ht,ct.x,ct.y,ct.level):ht.alpha,Q.dayTextureBrightness[K]="function"==typeof ht.brightness?ht.brightness(r,ht,ct.x,ct.y,ct.level):ht.brightness,$=$||Q.dayTextureBrightness[K]!==E.DEFAULT_BRIGHTNESS,Q.dayTextureContrast[K]="function"==typeof ht.contrast?ht.contrast(r,ht,ct.x,ct.y,ct.level):ht.contrast,et=et||Q.dayTextureContrast[K]!==E.DEFAULT_CONTRAST,Q.dayTextureHue[K]="function"==typeof ht.hue?ht.hue(r,ht,ct.x,ct.y,ct.level):ht.hue,tt=tt||Q.dayTextureHue[K]!==E.DEFAULT_HUE,Q.dayTextureSaturation[K]="function"==typeof ht.saturation?ht.saturation(r,ht,ct.x,ct.y,ct.level):ht.saturation,st=st||Q.dayTextureSaturation[K]!==E.DEFAULT_SATURATION,Q.dayTextureOneOverGamma[K]="function"==typeof ht.gamma?1/ht.gamma(r,ht,ct.x,ct.y,ct.level):1/ht.gamma,lt=lt||Q.dayTextureOneOverGamma[K]!==1/E.DEFAULT_GAMMA,++K)}Q.dayTextures.length=K,Q.waterMask=P.waterMaskTexture,a.clone(P.waterMaskTranslationAndScale,Q.waterMaskTranslationAndScale),c.push(J),J.shaderProgram=n.getShaderProgram(t,x,$,et,tt,st,lt),J.renderState=h,J.primitiveType=I.wireframe?f.LINES:f.TRIANGLES,J.vertexArray=P.vertexArray,J.uniformMap=Q;var dt=P.boundingSphere3D;r.mode!==M.SCENE3D&&(dt=i.fromExtentWithHeights2D(P.extent,r.scene2D.projection,P.minimumHeight,P.maximumHeight),dt.center=new o(dt.center.z,dt.center.x,dt.center.y),r.mode===M.MORPHING&&(dt=i.union(P.boundingSphere3D,dt,dt))),J.boundingVolume=dt}while(Z>X)}}}v.length=Math.max(0,w+1)}var Z=function(t){if(t.terrainProvider===void 0)throw new l("description.terrainProvider is required.");if(t.imageryLayerCollection===void 0)throw new l("description.imageryLayerCollection is required.");this._terrainProvider=t.terrainProvider,this._imageryLayerCollection=t.imageryLayerCollection,this._maxScreenSpaceError=e(t.maxScreenSpaceError,2),this._imageryLayerCollection.layerAdded.addEventListener(Z.prototype._onLayerAdded,this),this._imageryLayerCollection.layerRemoved.addEventListener(Z.prototype._onLayerRemoved,this),this._imageryLayerCollection.layerMoved.addEventListener(Z.prototype._onLayerMoved,this),this._imageryLayerCollection.layerShownOrHidden.addEventListener(Z.prototype._onLayerShownOrHidden,this),this._layerOrderChanged=!1;var i=this._terrainProvider.getTilingScheme();this._levelZeroTiles=void 0,this._tilesToRenderByTextureCount=[],this._tileCommands=[],this._tileCommandUniformMaps=[],this._tileTraversalQueue=new v,this._tileLoadQueue=new A,this._tileReplacementQueue=new P,this._tileCacheSize=100,this._loadQueueTimeSlice=5;var r=i.getEllipsoid();this._ellipsoidalOccluder=new c(r,o.ZERO),this._debug={enableDebugOutput:!1,boundingSphereTile:void 0,boundingSphereVA:void 0,maxDepth:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,texturesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTexturesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1}};Z.prototype.update=function(e,t,i,r,n,o,a,s){z(this),L(this,e,t),W(this,e,t),X(this,e,t,n,a,s,r,i,o),H(this,e,t,r,n,o,i)},Z.prototype.getTerrainProvider=function(){return this._terrainProvider},Z.prototype.setTerrainProvider=function(e){if(this._terrainProvider!==e){if(e===void 0)throw new l("terrainProvider is required.");this._terrainProvider=e;var t=this._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0;var i=this._levelZeroTiles;if(i!==void 0)for(var r=0;i.length>r;++r)i[r].freeResources();this._levelZeroTiles=void 0}},Z.prototype._onLayerAdded=function(e){if(void 0!==this._levelZeroTiles&&e.show){for(var t=this._tileReplacementQueue.head;t!==void 0;)e._createTileImagerySkeletons(t,this._terrainProvider)&&(t.state=R.LOADING),t=t.replacementNext;this._layerOrderChanged=!0}},Z.prototype._onLayerRemoved=function(e){if(void 0!==this._levelZeroTiles)for(var t=this._tileReplacementQueue.head;t!==void 0;){for(var i=t.imagery,r=-1,n=0,o=0,a=i.length;a>o;++o){var s=i[o],l=s.imagery;if(l.imageryLayer===e)-1===r&&(r=o),s.freeResources(),++n;else if(-1!==r)break}-1!==r&&i.splice(r,n),e.isBaseLayer()&&(t.isRenderable=!1),t=t.replacementNext}},Z.prototype._onLayerMoved=function(){void 0!==this._levelZeroTiles&&(this._layerOrderChanged=!0)},Z.prototype._onLayerShownOrHidden=function(e,t,i){void 0!==this._levelZeroTiles&&(i?this._onLayerAdded(e,t):this._onLayerRemoved(e,t))},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){var e=this._levelZeroTiles;if(e!==void 0)for(var i=0;e.length>i;++i)e[i].freeResources();this._imageryLayerCollection.destroy();var r=this._debug;return r!==void 0&&r.boundingSphereVA!==void 0&&r.boundingSphereVA.destroy(),t(this)};var K=new i,J=new o,Q=new o,$=o.UNIT_Y.negate(),et=o.UNIT_Z.negate(),tt=new o;Z.prototype.debugShowBoundingSphereOfTileAt=function(e){for(var t,i,r=this._tilesToRenderByTextureCount,n=0;r.length>n&&t===void 0;++n){var o=r[n];if(void 0!==o)for(var a=0;o.length>a;++a)if(i=o[a],i.extent.contains(e)){t=i;break}}t!==void 0&&console.log("x: "+t.x+" y: "+t.y+" level: "+t.level+" radius: "+t.boundingSphere3D.radius+" center magnitude: "+t.boundingSphere3D.center.magnitude()),this._debug.boundingSphereTile=t,this._debug.boundingSphereVA=void 0},Z.prototype.debugToggleLodUpdate=function(){this._debug.suspendLodUpdate=!this._debug.suspendLodUpdate};var it="undefined"!=typeof Float32Array?new Float32Array(1):void 0,rt=new d,nt=new a,ot=new o,at=new a;return Z}),i("Scene/CentralBodySurfaceShaderSet",["../Core/destroyObject","../Core/defaultValue"],function(e,t){function i(e){this.baseVertexShaderString=void 0,this.baseFragmentShaderString=void 0,this._attributeIndices=e,this._shaders={}}function r(e,t,i,r,n,o){var a="";return a+=e,a+=t?"_brightness":"",a+=i?"_contrast":"",a+=r?"_hue":"",a+=n?"_saturation":"",a+=o?"_gamma":""}return i.prototype.invalidateShaders=function(){var e=this._shaders;for(var t in e)e.hasOwnProperty(t)&&e[t].release();this._shaders={}},i.prototype.getShaderProgram=function(e,i,n,o,a,s,l){n=t(n,!1),o=t(o,!1),a=t(a,!1),s=t(s,!1),l=t(l,!1);var u=r(i,n,o,a,s,l),c=this._shaders[u];if(c===void 0){for(var h=this.baseVertexShaderString,d=(n?"#define APPLY_BRIGHTNESS\n":"")+(o?"#define APPLY_CONTRAST\n":"")+(a?"#define APPLY_HUE\n":"")+(s?"#define APPLY_SATURATION\n":"")+(l?"#define APPLY_GAMMA\n":"")+"#define TEXTURE_UNITS "+i+"\n"+this.baseFragmentShaderString+"\n"+"vec3 computeDayColor(vec3 initialColor, vec2 textureCoordinates)\n"+"{\n"+"    vec3 color = initialColor;\n",m=0;i>m;++m)d+="color = sampleAndBlend(\n   color,\n   u_dayTextures["+m+"],\n"+"   textureCoordinates,\n"+"   u_dayTextureTexCoordsExtent["+m+"],\n"+"   u_dayTextureTranslationAndScale["+m+"],\n"+"   u_dayTextureAlpha["+m+"],\n"+"   u_dayTextureBrightness["+m+"],\n"+"   u_dayTextureContrast["+m+"],\n"+"   u_dayTextureHue["+m+"],\n"+"   u_dayTextureSaturation["+m+"],\n"+"   u_dayTextureOneOverGamma["+m+"]);\n";d+="    return color;\n}",c=e.getShaderCache().getShaderProgram(h,d,this._attributeIndices),this._shaders[u]=c}return c},i.prototype.destroy=function(){return this.invalidateShaders(),e(this)},i}),i("Scene/EllipsoidTerrainProvider",["../Core/defaultValue","../Core/Ellipsoid","../Core/Event","./HeightmapTerrainData","./TerrainProvider","./GeographicTilingScheme"],function(e,t,i,r,n,o){var a=function a(a){a=e(a,{}),this._tilingScheme=a.tilingScheme,this._tilingScheme===void 0&&(this._tilingScheme=new o({ellipsoid:e(a.ellipsoid,t.WGS84)})),this._levelZeroMaximumGeometricError=n.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.getEllipsoid(),64,this._tilingScheme.getNumberOfXTilesAtLevel(0));var s=16,l=16;this._terrainData=new r({buffer:new Uint8Array(s*l),width:16,height:16}),this._errorEvent=new i};return a.prototype.requestTileGeometry=function(){return this._terrainData},a.prototype.getErrorEvent=function(){return this._errorEvent},a.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},a.prototype.getLogo=function(){return void 0},a.prototype.getTilingScheme=function(){return this._tilingScheme},a.prototype.hasWaterMask=function(){return!1},a.prototype.isReady=function(){return!0},a}),i("Scene/ImageryLayerCollection",["../Core/DeveloperError","../Core/defaultValue","../Core/destroyObject","../Core/Event","../Core/Math","./ImageryLayer"],function(e,t,i,r,n,o){function a(t,i){if(i===void 0)throw new e("layer is required.");var r=t.indexOf(i);if(-1===r)throw new e("layer is not in this collection.");return r}function s(e,t,i){var r=e._layers;if(t=n.clamp(t,0,r.length-1),i=n.clamp(i,0,r.length-1),t!==i){var o=r[t];r[t]=r[i],r[i]=o,e._update(),e.layerMoved.raiseEvent(o,i,t)}}var l=function l(){this._layers=[],this.layerAdded=new r,this.layerRemoved=new r,this.layerMoved=new r,this.layerShownOrHidden=new r};return l.prototype.add=function(t,i){if(t===void 0)throw new e("layer is required.");if(i===void 0)i=this._layers.length,this._layers.push(t);else{if(0>i)throw new e("index must be greater than or equal to zero.");if(i>this._layers.length)throw new e("index must be less than or equal to the number of layers.");this._layers.splice(i,0,t)}this._update(),this.layerAdded.raiseEvent(t,i)},l.prototype.addImageryProvider=function(t,i){if(t===void 0)throw new e("imageryProvider is required.");var r=new o(t);return this.add(r,i),r},l.prototype.remove=function(e,i){i=t(i,!0);var r=this._layers.indexOf(e);return-1!==r?(this._layers.splice(r,1),this._update(),this.layerRemoved.raiseEvent(e,r),i&&e.destroy(),!0):!1},l.prototype.removeAll=function(e){e=t(e,!0);for(var i=this._layers,r=0,n=i.length;n>r;r++){var o=i[r];this.layerRemoved.raiseEvent(o,r),e&&o.destroy()}this._layers=[]},l.prototype.contains=function(e){return-1!==this.indexOf(e)},l.prototype.indexOf=function(e){return this._layers.indexOf(e)},l.prototype.get=function(t){if(t===void 0)throw new e("index is required.","index");return this._layers[t]},l.prototype.getLength=function(){return this._layers.length},l.prototype.raise=function(e){var t=a(this._layers,e);s(this,t,t+1)},l.prototype.lower=function(e){var t=a(this._layers,e);s(this,t,t-1)},l.prototype.raiseToTop=function(e){var t=a(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},l.prototype.lowerToBottom=function(e){var t=a(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this.removeAll(!0),i(this)},l.prototype._update=function(){for(var e,t,i=!0,r=this._layers,n=0,o=r.length;o>n;++n)t=r[n],t._layerIndex=n,t.show?(t._isBaseLayer=i,i=!1):t._isBaseLayer=!1,t.show!==t._show&&(t._show!==void 0&&(e===void 0&&(e=[]),e.push(t)),t._show=t.show);if(e!==void 0)for(n=0,o=e.length;o>n;++n)t=e[n],this.layerShownOrHidden.raiseEvent(t,t._layerIndex,t.show)},l}),i("Shaders/ViewportQuadVS",[],function(){return"attribute vec4 position;\nattribute vec2 textureCoordinates;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_Position = position;\nv_textureCoordinates = textureCoordinates;\n}\n"}),i("Shaders/ViewportQuadFS",[],function(){return"varying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s = v_textureCoordinates.s;\nmaterialInput.st = v_textureCoordinates;\nmaterialInput.str = vec3(v_textureCoordinates, 0.0);\nmaterialInput.normalEC = vec3(0.0, 0.0, -1.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n}\n"}),i("Scene/ViewportQuad",["../Core/Color","../Core/combine","../Core/destroyObject","../Core/defaultValue","../Core/DeveloperError","../Core/BoundingRectangle","../Core/ComponentDatatype","../Core/PrimitiveType","./Material","../Renderer/BufferUsage","../Renderer/BlendingState","../Renderer/CommandLists","../Renderer/DrawCommand","../Shaders/ViewportQuadVS","../Shaders/ViewportQuadFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p){function f(e){var t=e.cache.viewportQuad_vertexArray;if(t!==void 0)return t;var i={attributes:{position:{componentDatatype:a.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]},textureCoordinates:{componentDatatype:a.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]}}};return t=e.createVertexArrayFromMesh({mesh:i,attributeIndices:g,bufferUsage:u.STATIC_DRAW}),e.cache.viewportQuad_vertexArray=t,t}var v=function(t,i){this._va=void 0,this._overlayCommand=new d,this._overlayCommand.primitiveType=s.TRIANGLE_FAN,this._commandLists=new h,this._commandLists.overlayList.push(this._overlayCommand),this.show=!0,t===void 0&&(t=new o),this.rectangle=o.clone(t),i===void 0&&(i=l.fromType(void 0,l.ColorType),i.uniforms.color=new e(1,1,1,1)),this.material=i,this._material=void 0},g={position:0,textureCoordinates:1};return v.prototype.update=function(e,t,i){if(this.show){if(this.material===void 0)throw new n("this.material must be defined.");if(this.rectangle===void 0)throw new n("this.rectangle must be defined.");this._va===void 0&&(this._va=f(e),this._overlayCommand.vertexArray=this._va);var r=this._overlayCommand.renderState;void 0!==r&&o.equals(r.viewport,this.rectangle)||(this._overlayCommand.renderState=e.createRenderState({blending:c.ALPHA_BLEND,viewport:this.rectangle}));var a=t.passes;if(a.overlay){if(this._material!==this.material){this._material=this.material;var s="#line 0\n"+this._material.shaderSource+"#line 0\n"+p;this._overlayCommand.shaderProgram=e.getShaderCache().replaceShaderProgram(this._overlayCommand.shaderProgram,m,s,g)}this._overlayCommand.uniformMap=this._material._uniforms,i.push(this._commandLists)}}},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.release(),i(this)},v}),i("Shaders/CentralBodyFS",[],function(){return"uniform float u_morphTime;\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\nuniform float u_dayTextureHue[TEXTURE_UNITS];\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTexCoordsExtent[TEXTURE_UNITS];\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\nvec3 sampleAndBlend(\nvec3 previousColor,\nsampler2D texture,\nvec2 tileTextureCoordinates,\nvec4 textureCoordinateExtent,\nvec4 textureCoordinateTranslationAndScale,\nfloat textureAlpha,\nfloat textureBrightness,\nfloat textureContrast,\nfloat textureHue,\nfloat textureSaturation,\nfloat textureOneOverGamma)\n{\nvec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nalphaMultiplier = step(vec2(0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nvec2 translation = textureCoordinateTranslationAndScale.xy;\nvec2 scale = textureCoordinateTranslationAndScale.zw;\nvec2 textureCoordinates = tileTextureCoordinates * scale + translation;\nvec4 sample = texture2D(texture, textureCoordinates);\nvec3 color = sample.rgb;\nfloat alpha = sample.a;\n#ifdef APPLY_BRIGHTNESS\ncolor = mix(vec3(0.0), color, textureBrightness);\n#endif\n#ifdef APPLY_CONTRAST\ncolor = mix(vec3(0.5), color, textureContrast);\n#endif\n#ifdef APPLY_HUE\ncolor = czm_hue(color, textureHue);\n#endif\n#ifdef APPLY_SATURATION\ncolor = czm_saturation(color, textureSaturation);\n#endif\n#ifdef APPLY_GAMMA\ncolor = pow(color, vec3(textureOneOverGamma));\n#endif\n#ifdef SHOW_TEXTURE_BOUNDARIES\nif (textureCoordinates.x < (1.0/256.0) || textureCoordinates.x > (255.0/256.0) ||\ntextureCoordinates.y < (1.0/256.0) || textureCoordinates.y > (255.0/256.0))\n{\ncolor = vec3(1.0);\nalpha = 1.0;\n}\n#endif\nreturn mix(previousColor, color, alpha * textureAlpha);\n}\nvec3 computeDayColor(vec3 initialColor, vec2 textureCoordinates);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec3 imageryColor, float specularMapValue);\nvoid main()\n{\nvec3 initialColor = vec3(0.0, 0.0, 0.5);\nvec3 startDayColor = computeDayColor(initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n#ifdef SHOW_TILE_BOUNDARIES\nif (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\nv_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n{\nstartDayColor = vec3(1.0, 0.0, 0.0);\n}\n#endif\nvec4 color = vec4(startDayColor, 1.0);\n#ifdef SHOW_REFLECTIVE_OCEAN\nvec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\nvec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\nvec2 waterMaskTextureCoordinates = v_textureCoordinates * waterMaskScale + waterMaskTranslation;\nfloat mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\nif (mask > 0.0)\n{\nvec3 normalMC = normalize(czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\nvec3 normalEC = normalize(czm_normal3D * normalMC);\nmat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\nvec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\nvec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\nvec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, u_morphTime * smoothstep(0.9, 0.95, normalMC.z));\ncolor = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, startDayColor, mask);\n}\n#endif\ngl_FragColor = color;\n}\n#ifdef SHOW_REFLECTIVE_OCEAN\nfloat waveFade(float edge0, float edge1, float x)\n{\nfloat y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\nreturn pow(1.0 - y, 5.0);\n}\nconst float oceanFrequency = 125000.0;\nconst float oceanAnimationSpeed = 0.006;\nconst float oceanAmplitude = 2.0;\nconst float oceanSpecularIntensity = 0.5;\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec3 imageryColor, float specularMapValue)\n{\nfloat time = czm_frameNumber * oceanAnimationSpeed;\nvec3 positionToEyeEC = -positionEyeCoordinates;\nfloat positionToEyeECLength = length(positionToEyeEC);\nvec3 normalizedpositionToEyeEC = normalize(normalize(positionToEyeEC));\nfloat waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n#ifdef SHOW_OCEAN_WAVES\nvec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequency, time, 0.0);\nvec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / oceanAmplitude));\nnormalTangentSpace.xy *= waveIntensity;\nnormalTangentSpace = normalize(normalTangentSpace);\n#else\nvec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\nvec3 normalEC = enuToEye * normalTangentSpace;\nconst vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\nfloat diffuseIntensity = getLambertDiffuse(czm_sunDirectionEC, normalEC);\nvec3 diffuseHighlight = waveHighlightColor * diffuseIntensity;\n#ifdef SHOW_OCEAN_WAVES\nfloat tsPerturbationRatio = normalTangentSpace.z;\nvec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\nvec3 nonDiffuseHighlight = vec3(0.0);\n#endif\nfloat specularIntensity = getSpecular(czm_sunDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0) + 0.25 * getSpecular(czm_moonDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0);\nfloat surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), specularMapValue);\nfloat specular = specularIntensity * surfaceReflectance;\nreturn vec4(imageryColor + diffuseHighlight + nonDiffuseHighlight + specular, 1.0);\n}\n#endif\n"
}),i("Shaders/CentralBodyFSDepth",[],function(){return"varying vec4 positionEC;\nvoid main()\n{\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nvec3 direction = normalize(positionEC.xyz);\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (!czm_isEmpty(intersection))\n{\ngl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n}\nelse\n{\ndiscard;\n}\n}\n"}),i("Shaders/CentralBodyFSPole",[],function(){return"uniform vec3 u_color;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nvec3 direction = normalize(czm_windowToEyeCoordinates(gl_FragCoord).xyz);\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (!czm_isEmpty(intersection))\n{\nvec3 positionEC = czm_pointAlongRay(ray, intersection.start);\nvec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\nvec3 normalMC = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), vec3(1.0)));\nvec3 normalEC = normalize(czm_normal * normalMC);\nvec3 startDayColor = u_color;\ngl_FragColor = vec4(startDayColor, 1.0);\n}\nelse\n{\ndiscard;\n}\n}\n"}),i("Shaders/CentralBodyVS",[],function(){return"attribute vec4 position3DAndHeight;\nattribute vec2 textureCoordinates;\nuniform float u_morphTime;\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform vec4 u_tileExtent;\nuniform vec2 u_southAndNorthLatitude;\nuniform vec3 u_southMercatorYLowAndHighAndOneOverHeight;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_textureCoordinates;\nvec4 getPosition(vec3 position3DWC);\nfloat get2DYPositionFraction();\nvec4 getPosition3DMode(vec3 position3DWC)\n{\nreturn czm_projection * (u_modifiedModelView * vec4(position3DAndHeight.xyz, 1.0));\n}\nfloat get2DMercatorYPositionFraction()\n{\nconst float maxTileWidth = 0.003068;\nfloat positionFraction = textureCoordinates.y;\nfloat southLatitude = u_southAndNorthLatitude.x;\nfloat northLatitude = u_southAndNorthLatitude.y;\nif (northLatitude - southLatitude > maxTileWidth)\n{\nfloat southMercatorYLow = u_southMercatorYLowAndHighAndOneOverHeight.x;\nfloat southMercatorYHigh = u_southMercatorYLowAndHighAndOneOverHeight.y;\nfloat oneOverMercatorHeight = u_southMercatorYLowAndHighAndOneOverHeight.z;\nfloat currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\ncurrentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\npositionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorYLow, southMercatorYHigh, oneOverMercatorHeight);\n}\nreturn positionFraction;\n}\nfloat get2DGeographicYPositionFraction()\n{\nreturn textureCoordinates.y;\n}\nvec4 getPositionPlanarEarth(vec3 position3DWC, float height2D)\n{\nfloat yPositionFraction = get2DYPositionFraction();\nvec4 rtcPosition2D = vec4(height2D, mix(u_tileExtent.st, u_tileExtent.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nreturn czm_projection * (u_modifiedModelView * rtcPosition2D);\n}\nvec4 getPosition2DMode(vec3 position3DWC)\n{\nreturn getPositionPlanarEarth(position3DWC, 0.0);\n}\nvec4 getPositionColumbusViewMode(vec3 position3DWC)\n{\nreturn getPositionPlanarEarth(position3DWC, position3DAndHeight.w);\n}\nvec4 getPositionMorphingMode(vec3 position3DWC)\n{\nfloat yPositionFraction = get2DYPositionFraction();\nvec3 position2DWC = vec3(0.0, mix(u_tileExtent.st, u_tileExtent.pq, vec2(textureCoordinates.x, yPositionFraction)));\nvec4 morphPosition = czm_columbusViewMorph(position2DWC, position3DWC, u_morphTime);\nreturn czm_modelViewProjection * morphPosition;\n}\nvoid main()\n{\nvec3 position3DWC = position3DAndHeight.xyz + u_center3D;\ngl_Position = getPosition(position3DWC);\nv_positionEC = (czm_modelView3D * vec4(position3DWC, 1.0)).xyz;\nv_positionMC = position3DWC;\nv_textureCoordinates = textureCoordinates;\n}\n"}),i("Shaders/CentralBodyVSDepth",[],function(){return"attribute vec4 position;\nvarying vec4 positionEC;\nvoid main()\n{\npositionEC = czm_modelView * position;\ngl_Position = czm_projection * positionEC;\n}\n"}),i("Shaders/CentralBodyVSPole",[],function(){return"attribute vec4 position;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nfloat x = (position.x - czm_viewport.x) / czm_viewport.z;\nfloat y = (position.y - czm_viewport.y) / czm_viewport.w;\nv_textureCoordinates = vec2(x, y);\ngl_Position = czm_viewportOrthographic * position;\n}\n"}),i("Scene/CentralBody",["../Core/buildModuleUrl","../Core/combine","../Core/loadImage","../Core/defaultValue","../Core/destroyObject","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/ComponentDatatype","../Core/CubeMapEllipsoidTessellator","../Core/Ellipsoid","../Core/Extent","../Core/GeographicProjection","../Core/Intersect","../Core/Math","../Core/Matrix4","../Core/MeshFilters","../Core/Occluder","../Core/PrimitiveType","../Core/Transforms","./Material","../Renderer/BufferUsage","../Renderer/ClearCommand","../Renderer/CommandLists","../Renderer/CullFace","../Renderer/DepthFunction","../Renderer/DrawCommand","../Renderer/PixelFormat","../Renderer/BlendingState","../Renderer/Texture","./CentralBodySurface","./CentralBodySurfaceShaderSet","./EllipsoidTerrainProvider","./ImageryLayerCollection","./SceneMode","./TerrainProvider","./ViewportQuad","../Shaders/CentralBodyFS","../Shaders/CentralBodyFSDepth","../Shaders/CentralBodyFSPole","../Shaders/CentralBodyVS","../Shaders/CentralBodyVSDepth","../Shaders/CentralBodyVSPole","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P,R,O,z,L,N,V,B,F,q,U,k,W,H,j,G){function Y(e,t,i,r){Q.logos=e._logos,Q.logoIndex=0,Q.rebuildLogo=!1,Q.totalLogoWidth=0,Q.totalLogoHeight=0,X(Q,e._surface._terrainProvider);for(var n=e._imageryLayerCollection,o=0,a=n.getLength();a>o;++o){var s=n.get(o);s.show&&X(Q,s.getImageryProvider())}Q.logos.length!==Q.logoIndex&&(Q.rebuildLogo=!0,Q.logos.length=Q.logoIndex);var l=Q.totalLogoWidth,u=Q.totalLogoHeight,c=e._logoQuad;if(0===l||0===u)return c!==void 0&&(c.material=c.material&&c.material.destroy(),c.destroy(),e._logoQuad=void 0),void 0;c===void 0&&(c=new F,c.material.destroy(),c.material=T.fromType(t,T.ImageType),c.material.uniforms.image=void 0,e._logoQuad=c);var h=e.logoOffset,d=c.rectangle;if(d.x=h.x,d.y=h.y,d.width=l,d.height=u,Q.rebuildLogo){var m=c.material.uniforms.image;m=m&&m.destroy(),m=t.createTexture2D({width:l,height:u}),c.material.uniforms.image=m;var p=0;for(o=0,a=Q.logos.length;a>o;o++){var f=Q.logos[o];f!==void 0&&(m.copyFrom(f,0,p),p+=f.height+2)}}c!==void 0&&c.update(t,i,r)}function X(e,t){if("function"!=typeof t.isReady||t.isReady()){var i;i="function"==typeof t.getLogo?t.getLogo():void 0,e.logos[e.logoIndex]!==i&&(e.rebuildLogo=!0,e.logos[e.logoIndex]=i),e.logoIndex++,i!==void 0&&(e.totalLogoWidth=Math.max(e.totalLogoWidth,i.width),e.totalLogoHeight+=i.height+2)}}var Z=function(t){t=r(t,m.WGS84);var i=new L({ellipsoid:t}),n=new N;this.terrainProvider=i,this._ellipsoid=t,this._imageryLayerCollection=n,this._surface=new O({terrainProvider:i,imageryLayerCollection:n}),this._occluder=new w(new a(l.ZERO,t.getMinimumRadius()),l.ZERO),this._surfaceShaderSet=new z(B.attributeIndices),this._rsColor=void 0,this._rsColorWithoutDepthTest=void 0;var o=new E;o.depth=1,o.stencil=0,this._clearDepthCommand=o,this._depthCommand=new D,this._depthCommand.primitiveType=C.TRIANGLES,this._depthCommand.boundingVolume=new a(l.ZERO,t.getMaximumRadius()),this._northPoleCommand=new D,this._northPoleCommand.primitiveType=C.TRIANGLE_FAN,this._southPoleCommand=new D,this._southPoleCommand.primitiveType=C.TRIANGLE_FAN,this._drawNorthPole=!1,this._drawSouthPole=!1,this._commandLists=new b,this.northPoleColor=new l(2/255,6/255,18/255),this.southPoleColor=new l(1,1,1),this.logoOffset=s.ZERO.clone(),this._logos=[],this._logoQuad=void 0,this.show=!0,this.morphTime=1,this._mode=V.SCENE3D,this._projection=void 0,this.oceanNormalMapUrl=e("Assets/Textures/waterNormalsSmall.jpg"),this.depthTestAgainstTerrain=!1,this.tileCacheSize=100,this._lastOceanNormalMapUrl=void 0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=.5,this._showingPrettyOcean=!1,this._hasWaterMask=!1;var u=this;this._drawUniforms={u_mode:function(){return u._mode},u_morphTime:function(){return u.morphTime},u_zoomedOutOceanSpecularIntensity:function(){return u._zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return u._oceanNormalMap}}};Z.prototype.getEllipsoid=function(){return this._ellipsoid},Z.prototype.getImageryLayers=function(){return this._imageryLayerCollection},Z.prototype._computeDepthQuad=function(e){var t=this._ellipsoid.getRadii(),i=e.camera.getPositionWC(),r=this._ellipsoid.getOneOverRadii().multiplyComponents(i),n=r.magnitude(),o=r.normalize(),a=l.UNIT_Z.cross(r).normalize(),s=o.cross(a).normalize(),u=Math.sqrt(r.magnitudeSquared()-1),c=o.multiplyByScalar(1/n),h=u/n,d=a.multiplyByScalar(h),m=s.multiplyByScalar(h),p=t.multiplyComponents(c.add(m).subtract(d)),f=t.multiplyComponents(c.add(m).add(d)),v=t.multiplyComponents(c.subtract(m).subtract(d)),g=t.multiplyComponents(c.subtract(m).add(d));return[p.x,p.y,p.z,v.x,v.y,v.z,f.x,f.y,f.z,g.x,g.y,g.z]},Z.prototype._computePoleQuad=function(e,t,i,r,n){var a,s=this._ellipsoid.cartographicToCartesian(new c(0,i)),u=this._ellipsoid.cartographicToCartesian(new c(Math.PI,i)),h=.5*s.subtract(u).magnitude(),d=this._ellipsoid.cartographicToCartesian(new c(0,t)),m=e.camera.direction;a=g.EPSILON6>1-l.UNIT_Z.negate().dot(m)?l.UNIT_X:m.cross(l.UNIT_Z).normalize();var p=d.add(a.multiplyByScalar(h)),f=d.add(l.UNIT_Z.cross(a).normalize().multiplyByScalar(h));x.pointToWindowCoordinates(r,n,d,d),x.pointToWindowCoordinates(r,n,p,p),x.pointToWindowCoordinates(r,n,f,f);var v=Math.floor(Math.max(f.subtract(d).magnitude(),p.subtract(d).magnitude())),_=v;return new o(Math.floor(d.x)-v,Math.floor(d.y)-_,2*v,2*_)};var K=new o,J=new _;Z.prototype._fillPoles=function(e,i){var r=this._surface._terrainProvider;if(i.mode===V.SCENE3D&&r.isReady()){var n=r.getTilingScheme().getExtent(),o=e.getUniformState().getViewProjection(),s=K;s.width=e.getCanvas().clientWidth,s.height=e.getCanvas().clientHeight;var l,u,c,d,m,f,y,C,x,T=_.computeViewportTransformation(s,0,1,J),E=.05,b=this._occluder;g.PI_OVER_TWO>n.north&&(l=new p(-Math.PI,n.north,Math.PI,g.PI_OVER_TWO),u=a.fromExtent3D(l,this._ellipsoid),c=i.cullingVolume.getVisibility(u)===v.OUTSIDE,d=w.computeOccludeePointFromExtent(l,this._ellipsoid),m=d&&!b.isPointVisible(d,0)||!b.isBoundingSphereVisible(u),this._drawNorthPole=!c&&!m,this._drawNorthPole&&(C=this._computePoleQuad(i,l.north,l.south-E,o,T),x=[C.x,C.y,C.x+C.width,C.y,C.x+C.width,C.y+C.height,C.x,C.y+C.height],this._northPoleCommand.vertexArray===void 0?(this._northPoleCommand.boundingVolume=a.fromExtent3D(l,this._ellipsoid),y={attributes:{position:{componentDatatype:h.FLOAT,componentsPerAttribute:2,values:x}}},this._northPoleCommand.vertexArray=e.createVertexArrayFromMesh({mesh:y,attributeIndices:{position:0},bufferUsage:S.STREAM_DRAW})):(f=h.FLOAT,this._northPoleCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(f.toTypedArray(x))))),n.south>-g.PI_OVER_TWO&&(l=new p(-Math.PI,-g.PI_OVER_TWO,Math.PI,n.south),u=a.fromExtent3D(l,this._ellipsoid),c=i.cullingVolume.getVisibility(u)===v.OUTSIDE,d=w.computeOccludeePointFromExtent(l,this._ellipsoid),m=d&&!b.isPointVisible(d)||!b.isBoundingSphereVisible(u),this._drawSouthPole=!c&&!m,this._drawSouthPole&&(C=this._computePoleQuad(i,l.south,l.north+E,o,T),x=[C.x,C.y,C.x+C.width,C.y,C.x+C.width,C.y+C.height,C.x,C.y+C.height],this._southPoleCommand.vertexArray===void 0?(this._southPoleCommand.boundingVolume=a.fromExtent3D(l,this._ellipsoid),y={attributes:{position:{componentDatatype:h.FLOAT,componentsPerAttribute:2,values:x}}},this._southPoleCommand.vertexArray=e.createVertexArrayFromMesh({mesh:y,attributeIndices:{position:0},bufferUsage:S.STREAM_DRAW})):(f=h.FLOAT,this._southPoleCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(f.toTypedArray(x)))));var M=0,I=this._imageryLayerCollection.getLength()>0?this._imageryLayerCollection.get(0):void 0;I!==void 0&&I.getImageryProvider()!==void 0&&I.getImageryProvider().getPoleIntensity!==void 0&&(M=I.getImageryProvider().getPoleIntensity());var D={u_dayIntensity:function(){return M}},A=this;if(this._northPoleCommand.uniformMap===void 0){var P=t([D,{u_color:function(){return A.northPoleColor}}],!1,!1);this._northPoleCommand.uniformMap=t([P,this._drawUniforms],!1,!1)}if(this._southPoleCommand.uniformMap===void 0){var R=t([D,{u_color:function(){return A.southPoleColor}}],!1,!1);this._southPoleCommand.uniformMap=t([R,this._drawUniforms],!1,!1)}}},Z.prototype.update=function(e,t,r){if(this.show){var n=e.getCanvas().clientWidth,o=e.getCanvas().clientHeight;if(0!==n&&0!==o){var a=t.mode,s=t.scene2D.projection,l=!1;(this._mode!==a||this._rsColor===void 0)&&(l=!0,a===V.SCENE3D||a===V.COLUMBUS_VIEW?(this._rsColor=e.createRenderState({cull:{enabled:!0},depthTest:{enabled:!0}}),this._rsColorWithoutDepthTest=e.createRenderState({cull:{enabled:!0}}),this._depthCommand.renderState=e.createRenderState({cull:{enabled:!0},depthTest:{enabled:!0,func:I.ALWAYS},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}})):(this._rsColor=e.createRenderState({cull:{enabled:!0}}),this._rsColorWithoutDepthTest=e.createRenderState({cull:{enabled:!0}}),this._depthCommand.renderState=e.createRenderState({cull:{enabled:!0}}))),this._northPoleCommand.renderState=this._rsColorWithoutDepthTest,this._southPoleCommand.renderState=this._rsColorWithoutDepthTest;var u=this._computeDepthQuad(t);if(this._depthCommand.vertexArray){var c=h.FLOAT;this._depthCommand.vertexArray.getAttribute(0).vertexBuffer.copyFromArrayView(c.toTypedArray(u))}else{var d={attributes:{position:{componentDatatype:h.FLOAT,componentsPerAttribute:3,values:u}},indexLists:[{primitiveType:C.TRIANGLES,values:[0,1,2,2,1,3]}]};this._depthCommand.vertexArray=e.createVertexArrayFromMesh({mesh:d,attributeIndices:{position:0},bufferUsage:S.DYNAMIC_DRAW})}var m=e.getShaderCache();if(this._depthCommand.shaderProgram===void 0&&(this._depthCommand.shaderProgram=m.getShaderProgram(H,"#line 0\n"+U,{position:0})),this._surface._terrainProvider.hasWaterMask()&&this.oceanNormalMapUrl!==this._lastOceanNormalMapUrl){this._lastOceanNormalMapUrl=this.oceanNormalMapUrl;var p=this;G(i(this.oceanNormalMapUrl),function(t){p._oceanNormalMap=p._oceanNormalMap&&p._oceanNormalMap.destroy(),p._oceanNormalMap=e.createTexture2D({source:t})})}var v=this._projection!==s,g=this._surface._terrainProvider.hasWaterMask(),_=this._hasWaterMask!==g;if(this._surfaceShaderSet===void 0||this._northPoleCommand.shaderProgram===void 0||this._southPoleCommand.shaderProgram===void 0||l||v||_||this._oceanNormalMap!==void 0!==this._showingPrettyOcean){var y,w="vec4 getPosition(vec3 position3DWC) { return getPosition3DMode(position3DWC); }",x="vec4 getPosition(vec3 position3DWC) { return getPosition2DMode(position3DWC); }",T="vec4 getPosition(vec3 position3DWC) { return getPositionColumbusViewMode(position3DWC); }",E="vec4 getPosition(vec3 position3DWC) { return getPositionMorphingMode(position3DWC); }";switch(a){case V.SCENE3D:y=w;break;case V.SCENE2D:y=x;break;case V.COLUMBUS_VIEW:y=T;break;case V.MORPHING:y=E}var b,M="float get2DYPositionFraction() { return get2DGeographicYPositionFraction(); }",D="float get2DYPositionFraction() { return get2DMercatorYPositionFraction(); }";b=s instanceof f?M:D,this._surfaceShaderSet.baseVertexShaderString=W+"\n"+y+"\n"+b;var A=g&&this._oceanNormalMap!==void 0;this._surfaceShaderSet.baseFragmentShaderString=(g?"#define SHOW_REFLECTIVE_OCEAN\n":"")+(A?"#define SHOW_OCEAN_WAVES\n":"")+"#line 0\n"+q,this._surfaceShaderSet.invalidateShaders();var P=m.replaceShaderProgram(this._northPoleCommand.shaderProgram,j,k,B.attributeIndices);this._northPoleCommand.shaderProgram=P,this._southPoleCommand.shaderProgram=P,this._showingPrettyOcean=this._oceanNormalMap!==void 0,this._hasWaterMask=g}var R=t.camera.getPositionWC();this._occluder.setCameraPosition(R),this._fillPoles(e,t),this._mode=a,this._projection=s;var O=t.passes,z=this._commandLists;if(z.removeAll(),O.color){var L=z.colorList;a===V.SCENE3D&&(this._drawNorthPole&&L.push(this._northPoleCommand),this._drawSouthPole&&L.push(this._southPoleCommand));var N=this._drawUniforms;this._zoomedOutOceanSpecularIntensity=a===V.SCENE3D?.5:0,this._surface._tileCacheSize=this.tileCacheSize,this._surface.setTerrainProvider(this.terrainProvider),this._surface.update(e,t,L,N,this._surfaceShaderSet,this._rsColor,this._mode,this._projection),Y(this,e,t,r),a===V.SCENE3D&&(this.depthTestAgainstTerrain||(L.push(this._clearDepthCommand),L.push(this._depthCommand)))}O.pick&&z.pickList.push(this._depthCommand),z.empty()||r.push(z)}}},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){return this._northPoleCommand.vertexArray=this._northPoleCommand.vertexArray&&this._northPoleCommand.vertexArray.destroy(),this._southPoleCommand.vertexArray=this._southPoleCommand.vertexArray&&this._southPoleCommand.vertexArray.destroy(),this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._northPoleCommand.shaderProgram=this._northPoleCommand.shaderProgram&&this._northPoleCommand.shaderProgram.release(),this._southPoleCommand.shaderProgram=this._northPoleCommand.shaderProgram,this._depthCommand.shaderProgram=this._depthCommand.shaderProgram&&this._depthCommand.shaderProgram.release(),this._depthCommand.vertexArray=this._depthCommand.vertexArray&&this._depthCommand.vertexArray.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),n(this)};var Q={logos:void 0,logoIndex:0,rebuildLogo:!1,totalLogoWidth:0,totalLogoHeight:0};return Z}),i("Scene/CesiumTerrainProvider",["../Core/defaultValue","../Core/loadArrayBuffer","../Core/throttleRequestByServer","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Event","./GeographicTilingScheme","./HeightmapTerrainData","./TerrainProvider","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u){var c=function c(e){if(e===void 0||e.url===void 0)throw new n("description.url is required.");this._url=e.url,this._proxy=e.proxy,this._tilingScheme=new a({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1}),this._heightmapWidth=65,this._levelZeroMaximumGeometricError=l.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.getEllipsoid(),this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._terrainDataStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1},this._errorEvent=new o,this._logo=void 0,e.credit!==void 0&&(this._logo=r(e.credit,{font:"12px sans-serif"}))};return c.prototype.requestTileGeometry=function(r,n,o,a){var l=this._tilingScheme.getNumberOfYTilesAtLevel(o),c=this._url+"/"+o+"/"+r+"/"+(l-n-1)+".terrain",h=this._proxy;h!==void 0&&(c=h.getURL(c));var d;if(a=e(a,!0)){if(d=i(c,t),d===void 0)return void 0}else d=t(c);var m=this;return u(d,function(e){var t=new Uint16Array(e,0,m._heightmapWidth*m._heightmapWidth);return new s({buffer:t,childTileMask:new Uint8Array(e,t.byteLength,1)[0],waterMask:new Uint8Array(e,t.byteLength+1,e.byteLength-t.byteLength-1),width:m._heightmapWidth,height:m._heightmapWidth,structure:m._terrainDataStructure})})},c.prototype.getErrorEvent=function(){return this._errorEvent},c.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},c.prototype.getLogo=function(){return this._logo},c.prototype.getTilingScheme=function(){return this._tilingScheme},c.prototype.hasWaterMask=function(){return!0},c.prototype.isReady=function(){return!0},c}),i("Scene/CompositePrimitive",["../Core/createGuid","../Core/destroyObject","../Core/DeveloperError"],function(e,t,i){var r=function(){this._centralBody=void 0,this._primitives=[],this._guid=e(),this.destroyPrimitives=!0,this.show=!0};return r.prototype.getCentralBody=function(){return this._centralBody},r.prototype.setCentralBody=function(e){this._centralBody=this.destroyPrimitives&&this._centralBody&&this._centralBody.destroy(),this._centralBody=e},r.prototype.add=function(e){if(e===void 0)throw new i("primitive is required.");var t=e._external=e._external||{},r=t._composites=t._composites||{};r[this._guid]={composite:this},this._primitives.push(e)},r.prototype.remove=function(e){if(this.contains(e)){var t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},r.prototype.removeAll=function(){if(this.destroyPrimitives)for(var e=this._primitives,t=e.length,i=0;t>i;++i)e[i].destroy();this._primitives=[]},r.prototype.contains=function(e){return!!(e&&e._external&&e._external._composites&&e._external._composites[this._guid])},r.prototype._getPrimitiveIndex=function(e){if(!this.contains(e))throw new i("primitive is not in this composite.");return this._primitives.indexOf(e)},r.prototype.raise=function(e){if(e!==void 0){var t=this._getPrimitiveIndex(e),i=this._primitives;if(t!==i.length-1){var r=i[t];i[t]=i[t+1],i[t+1]=r}}},r.prototype.raiseToTop=function(e){if(e!==void 0){var t=this._getPrimitiveIndex(e),i=this._primitives;t!==i.length-1&&(i.splice(t,1),i.push(e))}},r.prototype.lower=function(e){if(e!==void 0){var t=this._getPrimitiveIndex(e),i=this._primitives;if(0!==t){var r=i[t];i[t]=i[t-1],i[t-1]=r}}},r.prototype.lowerToBottom=function(e){if(e!==void 0){var t=this._getPrimitiveIndex(e),i=this._primitives;0!==t&&(i.splice(t,1),i.unshift(e))}},r.prototype.get=function(e){if(e===void 0)throw new i("index is required.");return this._primitives[e]},r.prototype.getLength=function(){return this._primitives.length},r.prototype.update=function(e,t,i){if(this.show){this._centralBody&&this._centralBody.update(e,t,i);for(var r=this._primitives,n=r.length,o=0;n>o;++o){var a=r[o];a.update(e,t,i)}}},r.prototype.isDestroyed=function(){return!1},r.prototype.destroy=function(){return this.removeAll(),this._centralBody=this.destroyPrimitives&&this._centralBody&&this._centralBody.destroy(),t(this)},r}),i("Scene/FrameState",["../Core/Cartesian2"],function(e){var t=function(){this.mode=void 0,this.morphTime=void 0,this.frameNumber=void 0,this.time=void 0,this.scene2D={projection:void 0},this.camera=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.canvasDimensions=new e,this.passes={color:!1,pick:!1,overlay:!1}};return t}),i("Scene/FrustumCommands",["../Core/defaultValue"],function(e){var t=function(t,i){this.near=e(t,0),this.far=e(i,0),this.commands=[]};return t}),i("Scene/GridImageryProvider",["../Core/defaultValue","../Core/Color","../Core/Event","./GeographicTilingScheme"],function(e,t,i,r){var n=function n(n){n=e(n,{}),this._tilingScheme=e(n.tilingScheme,new r),this._cells=e(n.cells,8),this._color=e(n.color,new t(1,1,1,.4)),this._glowColor=e(n.glowColor,new t(0,1,0,.05)),this._glowWidth=e(n.glowWidth,6),this._backgroundColor=e(n.backgroundColor,new t(0,.5,0,.2)),this._errorEvent=new i,this._tileWidth=e(n.tileWidth,256),this._tileHeight=e(n.tileHeight,256),this._canvasSize=e(n.canvasSize,256),this._canvas=this._createGridCanvas()};return n.prototype.getProxy=function(){return void 0},n.prototype.getTileWidth=function(){return this._tileWidth},n.prototype.getTileHeight=function(){return this._tileHeight},n.prototype.getMaximumLevel=function(){return void 0},n.prototype.getTilingScheme=function(){return this._tilingScheme},n.prototype.getExtent=function(){return this._tilingScheme.getExtent()},n.prototype.getTileDiscardPolicy=function(){return void 0},n.prototype.getErrorEvent=function(){return this._errorEvent},n.prototype.isReady=function(){return!0},n.prototype._drawGrid=function(e){for(var t=0,i=this._canvasSize,r=0;this._cells>=r;++r){var n=r/this._cells,o=1+n*(i-1);e.moveTo(o,t),e.lineTo(o,i),e.moveTo(t,o),e.lineTo(i,o)}e.stroke()},n.prototype._createGridCanvas=function(){var e=document.createElement("canvas");e.width=this._canvasSize,e.height=this._canvasSize;var t=0,i=this._canvasSize,r=e.getContext("2d"),n=this._backgroundColor.toCssColorString();r.fillStyle=n,r.fillRect(t,t,i,i);var o=this._glowColor.toCssColorString();r.strokeStyle=o,r.lineWidth=this._glowWidth,r.strokeRect(t,t,i,i),this._drawGrid(r),r.lineWidth=.5*this._glowWidth,r.strokeRect(t,t,i,i),this._drawGrid(r);var a=this._color.toCssColorString();return r.strokeStyle=a,r.lineWidth=2,r.strokeRect(t,t,i,i),r.lineWidth=1,this._drawGrid(r),e},n.prototype.requestImage=function(){return this._canvas},n.prototype.getLogo=function(){return void 0},n}),i("Scene/NeverTileDiscardPolicy",[],function(){var e=function(){};return e.prototype.isReady=function(){return!0},e.prototype.shouldDiscardImage=function(){return!1},e}),i("Scene/OpenStreetMapImageryProvider",["../Core/defaultValue","../Core/DeveloperError","../Core/Event","../Core/writeTextToCanvas","./ImageryProvider","./WebMercatorTilingScheme"],function(e,t,i,r,n,o){function a(e,t,i,r){var n=e._url+r+"/"+t+"/"+i+"."+e._fileExtension,o=e._proxy;return o!==void 0&&(n=o.getURL(n)),n}var s=/\/$/,l=function l(t){t=e(t,{});var n=e(t.url,"http://tile.openstreetmap.org/");s.test(n)||(n+="/"),this._url=n,this._fileExtension=e(t.fileExtension,"png"),this._proxy=t.proxy,this._tileDiscardPolicy=t.tileDiscardPolicy,this._tilingScheme=new o,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=e(t.maximumLevel,18),this._extent=e(t.extent,this._tilingScheme.getExtent()),this._errorEvent=new i,this._ready=!0;var a=e(t.credit,"MapQuest, Open Street Map and contributors, CC-BY-SA");this._logo=r(a,{font:"12px sans-serif"})};return l.prototype.getUrl=function(){return this._url},l.prototype.getProxy=function(){return this._proxy},l.prototype.getTileWidth=function(){if(!this._ready)throw new t("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},l.prototype.getTileHeight=function(){if(!this._ready)throw new t("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},l.prototype.getMaximumLevel=function(){if(!this._ready)throw new t("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},l.prototype.getTilingScheme=function(){if(!this._ready)throw new t("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},l.prototype.getExtent=function(){if(!this._ready)throw new t("getExtent must not be called before the imagery provider is ready.");return this._extent},l.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new t("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},l.prototype.getErrorEvent=function(){return this._errorEvent},l.prototype.isReady=function(){return this._ready},l.prototype.requestImage=function(e,i,r){if(!this._ready)throw new t("requestImage must not be called before the imagery provider is ready.");var o=a(this,e,i,r);return n.loadImage(o)},l.prototype.getLogo=function(){if(!this._ready)throw new t("getLogo must not be called before the imagery provider is ready.");return this._logo},l}),i("Scene/OrthographicFrustum",["../Core/DeveloperError","../Core/destroyObject","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix4","../Scene/CullingVolume"],function(e,t,i,r,n,o,a){function s(t){if(t.right===void 0||t.left===void 0||t.top===void 0||t.bottom===void 0||t.near===void 0||t.far===void 0)throw new e("right, left, top, bottom, near, or far parameters are not set.");if(t.top!==t._top||t.bottom!==t._bottom||t.left!==t._left||t.right!==t._right||t.near!==t._near||t.far!==t._far){if(t.left>t.right)throw new e("right must be greater than left.");if(t.bottom>t.top)throw new e("top must be greater than bottom.");if(0>=t.near||t.near>t.far)throw new e("near must be greater than zero and less than far.");t._left=t.left,t._right=t.right,t._top=t.top,t._bottom=t.bottom,t._near=t.near,t._far=t.far,t._orthographicMatrix=o.computeOrthographicOffCenter(t.left,t.right,t.bottom,t.top,t.near,t.far)}}var l=function(){this.left=void 0,this._left=void 0,this.right=void 0,this._right=void 0,this.top=void 0,this._top=void 0,this.bottom=void 0,this._bottom=void 0,this.near=1,this._near=this.near,this.far=5e8,this._far=this.far,this._cullingVolume=new a,this._orthographicMatrix=void 0};l.prototype.getProjectionMatrix=function(){return s(this),this._orthographicMatrix};var u=new r,c=new r,h=new r;return l.prototype.computeCullingVolume=function(t,i,o){if(t===void 0)throw new e("position is required.");if(i===void 0)throw new e("direction is required.");if(o===void 0)throw new e("up is required.");var a=this._cullingVolume.planes,s=this.top,l=this.bottom,d=this.right,m=this.left,p=this.near,f=this.far,v=r.cross(i,o,u),g=c;r.multiplyByScalar(i,p,g),r.add(t,g,g);var _=h;r.multiplyByScalar(v,m,_),r.add(g,_,_);var y=a[0];return y===void 0&&(y=a[0]=new n),y.x=v.x,y.y=v.y,y.z=v.z,y.w=-r.dot(v,_),r.multiplyByScalar(v,d,_),r.add(g,_,_),y=a[1],y===void 0&&(y=a[1]=new n),y.x=-v.x,y.y=-v.y,y.z=-v.z,y.w=-r.dot(v.negate(),_),r.multiplyByScalar(o,l,_),r.add(g,_,_),y=a[2],y===void 0&&(y=a[2]=new n),y.x=o.x,y.y=o.y,y.z=o.z,y.w=-r.dot(o,_),r.multiplyByScalar(o,s,_),r.add(g,_,_),y=a[3],y===void 0&&(y=a[3]=new n),y.x=-o.x,y.y=-o.y,y.z=-o.z,y.w=-r.dot(o.negate(),_),y=a[4],y===void 0&&(y=a[4]=new n),y.x=i.x,y.y=i.y,y.z=i.z,y.w=-r.dot(i,g),r.multiplyByScalar(i,f,_),r.add(t,_,_),y=a[5],y===void 0&&(y=a[5]=new n),y.x=-i.x,y.y=-i.y,y.z=-i.z,y.w=-r.dot(i.negate(),_),this._cullingVolume},l.prototype.getPixelSize=function(t){if(s(this),t===void 0)throw new e("canvasDimensions is required.");var r=t.x,n=t.y;if(0>=r)throw new e("canvasDimensions.x must be greater than zero.");if(0>=n)throw new e("canvasDimensions.y must be greater than zero.");var o=this.right-this.left,a=this.top-this.bottom,l=o/r,u=a/n;return new i(l,u)},l.prototype.clone=function(){var e=new l;return e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},l.prototype.equals=function(e){return e!==void 0&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},l}),i("Scene/PerformanceDisplay",["../Core/BoundingRectangle","../Core/Color","../Core/defaultValue","../Core/destroyObject","../Renderer/PixelFormat","./Material","./ViewportQuad"],function(e,t,i,r,n,o,a){var s=t.fromCssColorString("#e52"),l=t.fromCssColorString("#de3"),u=t.fromCssColorString("rgba(0, 0, 30, 0.9)"),c=new e(0,0,80,40),h=function(e){e=i(e,i.EMPTY_OBJECT),this._fpsColor=i(e.fpsColor,s).toCssColorString(),this._frameTimeColor=i(e.frameTimeColor,l).toCssColorString(),this._backgroundColor=i(e.backgroundColor,u).toCssColorString(),this._font=i(e.font,"bold 10px Helvetica,Arial,sans-serif"),this._rectangle=i(e.rectangle,c),this._canvas=document.createElement("canvas"),this._canvas.width=this._rectangle.width,this._canvas.height=this._rectangle.height,this._canvasContext=this._canvas.getContext("2d"),this._canvasContext.font=this._font,this._canvasContext.lineWidth=1,this._bufferLength=this._rectangle.width,this._frameTimeSamples=Array(this._bufferLength),this._fpsSamples=Array(this._bufferLength);for(var t=0;this._bufferLength>t;t++)this._frameTimeSamples[t]=this._fpsSamples[t]=0;this._frameTimeIndex=0,this._fpsIndex=0,this._lastFpsSampleTime=void 0,this._frameCount=0,this._quad=void 0,this._time=void 0,this._texture=void 0,this._viewportHeight=0};return h.prototype.update=function(e,t,i){if(this._time===void 0)return this._lastFpsSampleTime=this._time=Date.now(),void 0;var r=this._time,s=this._time=Date.now(),l=s-r;this._frameTimeSamples[this._frameTimeIndex++]=l,this._frameTimeIndex>=this._bufferLength&&(this._frameTimeIndex=0),this._frameCount++;
var u=this._fps,c=s-this._lastFpsSampleTime;c>1e3&&(u=this._fps=0|1e3*this._frameCount/c,this._fpsSamples[this._fpsIndex++]=u,this._fpsIndex>=this._bufferLength&&(this._fpsIndex=0),this._lastFpsSampleTime=s,this._frameCount=0);var h=this._canvasContext,d=this._rectangle.width,m=this._rectangle.height;h.clearRect(0,0,d,m),h.fillStyle=this._backgroundColor,h.fillRect(0,0,d,m),u!==void 0&&(h.fillStyle=this._fpsColor,h.textAlign="left",h.fillText(u+" FPS",1,10)),h.fillStyle=this._frameTimeColor,h.textAlign="right",h.fillText(l+" MS",d-1,10);for(var p=0;this._bufferLength>p;p++)u=this._fpsSamples[(p+this._fpsIndex)%this._bufferLength],u>0&&this._drawLine(this._fpsColor,p,u/100),l=this._frameTimeSamples[(p+this._frameTimeIndex)%this._bufferLength],l>0&&this._drawLine(this._frameTimeColor,p,l/200);this._quad===void 0&&(this._quad=new a(void 0,o.fromType(e,o.ImageType))),this._texture===void 0?(this._texture=e.createTexture2D({source:this._canvas,pixelFormat:n.RGBA}),this._quad.material.uniforms.image=this._texture):this._texture.copyFrom(this._canvas);var f=e.getCanvas().clientHeight;if(f!==this._viewportHeight){this._viewportHeight=f;var v=this._quad.rectangle;v.x=this._rectangle.x,v.y=f-m-this._rectangle.y,v.width=d,v.height=m}this._quad.update(e,t,i)},h.prototype._drawLine=function(e,t,i){var r=this._canvasContext,n=this._rectangle.height,o=n-10;t=.5+t,r.beginPath(),r.strokeStyle=e,r.moveTo(t,n);var a=i*o;a>o&&(a=o);var s=n-a;r.lineTo(t,s),r.stroke()},h.prototype.destroy=function(){return this._quad=this._quad.destroy(),r(this)},h}),i("Scene/Projections",["../Core/DeveloperError","../Core/Enumeration"],function(e,t){var i={WGS84:new t(0,"WGS84",{toWgs84:function(e,t){return t}}),MERCATOR:new t(1,"MERCATOR",{toWgs84:function(t,i){if(t===void 0||t.north===void 0||t.south===void 0)throw new e("extent, extent.north and extent.south are required.");if(i===void 0)throw new e("image is required.");var r=parseInt(i.width,10),n=parseInt(i.height,10),o=4*r,a=document.createElement("canvas");a.width=r,a.height=n;var s=a.getContext("2d");s.drawImage(i,0,0);var l=s.getImageData(0,0,r,n).data,u=s.createImageData(r,n),c=u.data,h=(t.north-t.south)/n,d=t.north-.5*h,m=Math.sin(t.south),p=.5*Math.log((1+m)/(1-m));m=Math.sin(t.north);for(var f=.5*Math.log((1+m)/(1-m)),v=1/(f-p),g=n-1,_=0;o>_;++_)c[_]=l[_];for(var y,w,C,x=1;g>x;++x,d-=h){m=Math.sin(d),w=.5*Math.log((1+m)/(1-m)),C=Math.floor(g-g*(w-p)*v),y=_+o;for(var T=0;y>_;++_,++T)c[_]=l[C*o+T]}for(y=_+o,x=0;y>_;++_,++x)c[_]=l[_];return s.putImageData(u,0,0),a}})};return i}),i("Scene/RectangularPyramidSensorVolume",["../Core/clone","../Core/Color","../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/Matrix4","../Renderer/BufferUsage","./Material","./CustomSensorVolume"],function(e,t,i,r,n,o,a,s,l,u){var c=function(r){r=i(r,i.EMPTY_OBJECT),this.show=i(r.show,!0),this.showIntersection=i(r.showIntersection,!0),this.showThroughEllipsoid=i(r.showThroughEllipsoid,!1),this.modelMatrix=a.clone(i(r.modelMatrix,a.IDENTITY)),this.bufferUsage=i(r.bufferUsage,s.STATIC_DRAW),this.radius=i(r.radius,Number.POSITIVE_INFINITY),this.xHalfAngle=i(r.xHalfAngle,o.PI_OVER_TWO),this._xHalfAngle=void 0,this.yHalfAngle=i(r.yHalfAngle,o.PI_OVER_TWO),this._yHalfAngle=void 0,this.material=r.material!==void 0?r.material:l.fromType(void 0,l.ColorType),this.intersectionColor=t.clone(i(r.intersectionColor,t.WHITE));var n=e(r);n._pickIdThis=i(r._pickIdThis,this),this._customSensor=new u(n)};return c.prototype.update=function(e,t,i){if(this.xHalfAngle>o.PI_OVER_TWO||this.yHalfAngle>o.PI_OVER_TWO)throw new n("this.xHalfAngle and this.yHalfAngle must each be less than or equal to 90 degrees.");var r=this._customSensor;if(r.show=this.show,r.showIntersection=this.showIntersection,r.showThroughEllipsoid=this.showThroughEllipsoid,r.modelMatrix=this.modelMatrix,r.bufferUsage=this.bufferUsage,r.radius=this.radius,r.material=this.material,r.intersectionColor=this.intersectionColor,this._xHalfAngle!==this.xHalfAngle||this._yHalfAngle!==this.yHalfAngle){this._xHalfAngle=this.xHalfAngle,this._yHalfAngle=this.yHalfAngle;var a=Math.tan(Math.min(this.xHalfAngle,o.toRadians(89))),s=Math.tan(Math.min(this.yHalfAngle,o.toRadians(89))),l=Math.atan(a/s),u=Math.atan(Math.sqrt(a*a+s*s));r.setDirections([{clock:l,cone:u},{clock:o.toRadians(180)-l,cone:u},{clock:o.toRadians(180)+l,cone:u},{clock:-l,cone:u}])}r.update(e,t,i)},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._customSensor=this._customSensor&&this._customSensor.destroy(),r(this)},c}),i("Scene/ScreenSpaceCameraController",["../Core/destroyObject","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/DeveloperError","../Core/Ellipsoid","../Core/KeyboardEventModifier","../Core/FAR","../Core/IntersectionTests","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/Ray","../Core/Transforms","./AnimationCollection","./CameraEventAggregator","./CameraEventType","./CameraColumbusViewMode","./SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w){function C(e,t){if(0>e)return 0;var i=25*(1-t);return Math.exp(-i*e)}function x(e){return e.startPosition.equalsEpsilon(e.endPosition,c.EPSILON14)}function T(e,i,r,n,o){var a=e.getButtonPressTime(),s=e.getButtonReleaseTime(),l=a&&s&&(s.getTime()-a.getTime())/1e3,u=new Date,c=s&&(u.getTime()-s.getTime())/1e3;if(a&&s&&k>l){var h=C(c,i);if(n[o]===void 0){var d=e.getLastMovement();if(!d||x(d))return;var m=.5*(d.endPosition.x-d.startPosition.x),p=.5*(d.endPosition.y-d.startPosition.y);n[o]={startPosition:new t(d.startPosition.x,d.startPosition.y),endPosition:new t(d.startPosition.x+m*h,d.startPosition.y+p*h),motion:new t(m,p)}}else n[o]={startPosition:n[o].endPosition.clone(),endPosition:new t(n[o].endPosition.x+n[o].motion.x*h,n[o].endPosition.y+n[o].motion.y*h),motion:new t};if(isNaN(n[o].endPosition.x)||isNaN(n[o].endPosition.y)||x(n[o]))return n[o]=void 0,void 0;e.isButtonDown()||r(n,n[o])}else n[o]=void 0}function S(e,t,i,r,n){var o=1;n!==void 0&&(o=c.clamp(Math.abs(n),.25,1));var a=e.minimumZoomDistance*o,s=e.maximumZoomDistance,l=r-a,u=i*l;u=c.clamp(u,e._minimumZoomRate,e._maximumZoomRate);var h=t.endPosition.y-t.startPosition.y,d=h/e._canvas.clientHeight;d=Math.min(d,e.maximumMovementRatio);var m=u*d;m>0&&1>Math.abs(r-a)||0>m&&1>Math.abs(r-s)||(a>r-m?m=r-a-1:r-m>s&&(m=r-s),e._cameraController.zoomIn(m))}function E(e,t){var i=e._cameraController,r=i.getPickRay(t.startPosition,W).origin,n=i.getPickRay(t.endPosition,H).origin;i.moveRight(r.x-n.x),i.moveUp(r.y-n.y)}function b(e,t){S(e,t,e._zoomFactor,e._cameraController.getMagnitude())}function M(e,i){var r=e._canvas.clientWidth,n=e._canvas.clientHeight,o=j;o.x=2/r*i.startPosition.x-1,o.y=2/n*(n-i.startPosition.y)-1,t.normalize(o,o);var a=G;a.x=2/r*i.endPosition.x-1,a.y=2/n*(n-i.endPosition.y)-1,t.normalize(a,a);var s=Math.acos(o.x);0>o.y&&(s=c.TWO_PI-s);var l=Math.acos(a.x);0>a.y&&(l=c.TWO_PI-l);var u=l-s;e._cameraController.twistRight(u)}function I(e,t){var i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate),e._minimumRotateRate>i&&(i=e._minimumRotateRate);var r=(t.endPosition.x-t.startPosition.x)/e._canvas.clientWidth;r=Math.min(r,e.maximumMovementRatio);var n=4*i*r*Math.PI;e._cameraController.twistRight(n)}function D(e){var t=e._translateHandler,i=e._zoomHandler,r=e._zoomWheelHandler,n=e._pinchHandler,o=t.isMoving()&&t.getMovement(),a=i.isMoving()&&i.getMovement(),s=r.isMoving()&&r.getMovement(),l=n.isMoving()&&n.getMovement();if((t.isButtonDown()||i.isButtonDown()||s)&&e._animationCollection.removeAll(),e.enableTranslate&&(o&&E(e,t.getMovement()),!o&&1>e.inertiaTranslate&&T(t,e.inertiaTranslate,E,e,"_lastInertiaTranslateMovement")),e.enableZoom&&(a?b(e,i.getMovement()):s?b(e,r.getMovement()):l&&b(e,n.getMovement().distance),!a&&1>e.inertiaZoom&&T(i,e.inertiaZoom,b,e,"_lastInertiaZoomMovement"),!s&&1>e.inertiaZoom&&T(r,e.inertiaZoom,b,e,"_lastInertiaWheelZoomMovement"),!l&&1>e.inertiaZoom&&T(n,e.inertiaZoom,b,e,"_lastInertiaZoomMovement")),e.enableRotate&&(e._rotateHandler.isMoving()&&M(e,e._rotateHandler.getMovement()),l&&I(e,n.getMovement().angleAndHeight)),!(t.isButtonDown()||i.isButtonDown()||e._lastInertiaZoomMovement||e._lastInertiaTranslateMovement||e._animationCollection.contains(e._animation))){var u=e._cameraController.createCorrectPositionAnimation(e.bounceAnimationTime);u!==void 0&&(e._animation=e._animationCollection.add(u))}return e._animationCollection.update(),!0}function A(e,t){var r=e._cameraController,n=r.getPickRay(t.startPosition,Y),o=r.getPickRay(t.endPosition,X),a=i.UNIT_X,s=n.origin,l=n.direction,u=-a.dot(s)/a.dot(l),h=i.multiplyByScalar(l,u,Z);i.add(s,h,h),s=o.origin,l=o.direction,u=-a.dot(s)/a.dot(l);var d=i.multiplyByScalar(l,u,K);i.add(s,d,d);var m=i.subtract(h,d,J),p=m.x;m.x=m.y,m.y=m.z,m.z=p;var f=m.magnitude();f>c.EPSILON6&&(i.normalize(m,m),r.move(m,f))}function P(e,t){var r=Q;r.x=e._canvas.clientWidth/2,r.y=e._canvas.clientHeight/2;var n=e._cameraController.getPickRay(r,$),o=i.UNIT_X,s=n.origin,l=n.direction,u=-o.dot(s)/o.dot(l),c=i.multiplyByScalar(l,u,et);i.add(s,c,c);var h=d.fromTranslation(c,tt),m=e._ellipsoid;e.setEllipsoid(a.UNIT_SPHERE),L(e,t,h,i.UNIT_Z),e.setEllipsoid(m)}function R(e,t){var r=it;r.x=e._canvas.clientWidth/2,r.y=e._canvas.clientHeight/2;var n=e._cameraController.getPickRay(r,rt),o=i.UNIT_X,a=n.origin,s=n.direction,l=-o.dot(a)/o.dot(s);S(e,t,e._zoomFactor,l)}function O(e){var t=e._zoomHandler,i=t.isMoving()&&t.getMovement(),r=e._zoomWheelHandler,n=r.isMoving()&&r.getMovement(),o=e._pinchHandler,a=o.isMoving()&&o.getMovement(),s=e._translateHandler,l=s.isMoving()&&s.getMovement(),u=e._rotateHandler,c=u.isMoving()&&u.getMovement(),h=e._spinHandler,d=h.isMoving()&&h.getMovement(),m=e._lookHandler,p=m.isMoving()&&m.getMovement(),f=u.isButtonDown()||h.isButtonDown()||s.isButtonDown()||t.isButtonDown()||p||n||a;if(e.columbusViewMode===y.LOCKED)e.enableRotate&&(d&&L(e,h.getMovement()),!f&&e.inertiaSpin>=0&&1>e.inertiaSpin&&T(h,e.inertiaSpin,L,e,"_lastInertiaSpinMovement")),e.enableZoom&&(i?V(e,t.getMovement()):n?V(e,r.getMovement()):a&&V(e,o.getMovement().distance),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(t,e.inertiaZoom,V,e,"_lastInertiaZoomMovement"),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(r,e.inertiaZoom,V,e,"_lastInertiaWheelZoomMovement"),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(o,e.inertiaZoom,V,e,"_lastInertiaZoomMovement"));else{if(f&&e._animationCollection.removeAll(),e.enableTilt&&(c&&P(e,u.getMovement()),a&&P(e,o.getMovement().angleAndHeight),!f&&e.inertiaSpin>=0&&1>e.inertiaSpin&&T(u,e.inertiaSpin,P,e,"_lastInertiaTiltMovement"),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(o,e.inertiaZoom,R,e,"_lastInertiaZoomMovement")),e.enableTranslate&&(l&&A(e,s.getMovement()),!f&&e.inertiaTranslate>=0&&1>e.inertiaTranslate&&T(s,e.inertiaTranslate,A,e,"_lastInertiaTranslateMovement")),e.enableZoom&&(i?R(e,t.getMovement()):n?R(e,r.getMovement()):a&&R(e,o.getMovement().distance),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(t,e.inertiaZoom,R,e,"_lastInertiaZoomMovement"),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(r,e.inertiaZoom,R,e,"_lastInertiaWheelZoomMovement"),!f&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(o,e.inertiaZoom,R,e,"_lastInertiaZoomMovement")),e.enableLook&&p&&F(e,m.getMovement()),!(f||e._lastInertiaZoomMovement||e._lastInertiaTranslateMovement||e._animationCollection.contains(e._animation))){var v=e._cameraController.createCorrectPositionAnimation(e.bounceAnimationTime);v!==void 0&&(e._animation=e._animationCollection.add(v))}e._animationCollection.update()}return!0}function z(e,t){e._cameraController.pickEllipsoid(t.startPosition,e._ellipsoid,nt)!==void 0?N(e,t):L(e,t)}function L(e,t,r,n,o){var a=e._cameraController,s=a.constrainedAxis;n!==void 0&&(a.constrainedAxis=n);var l=a._camera.position.magnitude(),u=e._rotateFactor*(l-e._rotateRateRangeAdjustment);u>e._maximumRotateRate&&(u=e._maximumRotateRate),e._minimumRotateRate>u&&(u=e._minimumRotateRate);var h=(t.startPosition.x-t.endPosition.x)/e._canvas.clientWidth,m=(t.startPosition.y-t.endPosition.y)/e._canvas.clientHeight;h=Math.min(h,e.maximumMovementRatio),m=Math.min(m,e.maximumMovementRatio);var p=2*u*h*Math.PI,f=u*m*Math.PI;if(a.constrainedAxis!==void 0&&r===void 0){var v=a._camera,g=v.position.normalize(),_=g.equalsEpsilon(a.constrainedAxis,c.EPSILON2),y=g.equalsEpsilon(a.constrainedAxis.negate(),c.EPSILON2);if(!_&&!y){var w;w=c.EPSILON4>i.dot(v.position,v.direction)+1?v.up:v.direction;var C;C=i.equalsEpsilon(a.constrainedAxis,v.position.normalize(),c.EPSILON2)?v.right:i.cross(a.constrainedAxis,v.position).normalize();var x=i.dot(v.right,C),T=0>c.sign(x)?-1:1;x=Math.abs(x);var S=i.dot(w,a.constrainedAxis),E=i.dot(w,C),b=S>0&&E>0||0>S&&0>E?-1:1;S=Math.abs(S);var M=f;f=T*(f*S-b*p*(1-x)),p=T*(p*x+b*M*(1-S))}}if(a.rotateRight(p,r),a.rotateUp(f,r),o!==void 0){var I=i.clone(a._camera.getDirectionWC(),ot),D=r.inverseTransformation();d.multiplyByVector(D,I,I);var A=-i.dot(I,n),P=Math.acos(A);P>o&&(P-=o,a.rotateUp(-P,r))}a.constrainedAxis=s}function N(e,t){var r=e._cameraController,n=r.pickEllipsoid(t.startPosition,e._ellipsoid,at),o=r.pickEllipsoid(t.endPosition,e._ellipsoid,st);if(void 0!==n&&void 0!==o)if(n=r._camera.worldToCameraCoordinates(n,n),o=r._camera.worldToCameraCoordinates(o,o),r.constrainedAxis===void 0){i.normalize(n,n),i.normalize(o,o);var a=i.dot(n,o),s=i.cross(n,o,lt);if(1>a&&!s.equalsEpsilon(i.ZERO,c.EPSILON14)){var l=Math.acos(a);r.rotate(s,l)}}else{var u=r.constrainedAxis,h=i.mostOrthogonalAxis(u,lt);i.cross(h,u,h),i.normalize(h,h);var d=i.cross(u,h,ut),m=i.magnitude(n),p=i.dot(u,n),f=Math.acos(p/m),v=i.multiplyByScalar(u,p,ct);i.subtract(n,v,v),i.normalize(v,v);var g=i.magnitude(o),_=i.dot(u,o),y=Math.acos(_/g),w=i.multiplyByScalar(u,_,ht);i.subtract(o,w,w),i.normalize(w,w);var C=Math.acos(i.dot(v,h));0>i.dot(v,d)&&(C=c.TWO_PI-C);var x=Math.acos(i.dot(w,h));0>i.dot(w,d)&&(x=c.TWO_PI-x);var T,S=C-x;T=i.equalsEpsilon(u,r._camera.position,c.EPSILON2)?r._camera.right:i.cross(u,r._camera.position);var E,b=i.cross(u,T,lt),M=i.dot(b,i.subtract(n,u,ut)),I=i.dot(b,i.subtract(o,u,ut));E=M>0&&I>0?y-f:M>0&&0>=I?i.dot(r._camera.position,u)>0?-f-y:f+y:f-y,r.rotateRight(S),r.rotateUp(E)}}function V(e,t){var r=e._cameraController._camera,n=e._ellipsoid,o=n.cartesianToCartographic(r.position).height,a=i.normalize(r.position,dt);S(e,t,e._zoomFactor,o,i.dot(a,r.direction))}function B(e,t){var r=e._cameraController,n=e._ellipsoid,o=.25*e.minimumZoomDistance,s=n.cartesianToCartographic(e._cameraController._camera.position).height;if(!(c.EPSILON3>s-o-1&&0>t.endPosition.y-t.startPosition.y)){var l=mt;l.x=e._canvas.clientWidth/2,l.y=e._canvas.clientHeight/2;var h,d=r.getPickRay(l,pt),m=u.rayEllipsoid(d,n);if(m!==void 0)h=d.getPoint(m.start,vt);else{var p=u.grazingAltitudeLocation(d,n);if(p===void 0)return;var v=n.cartesianToCartographic(p,ft);v.height=0,h=n.cartographicToCartesian(v,vt)}var g=r._camera;h=g.worldToCameraCoordinates(h,h);var _=f.eastNorthUpToFixedFrame(h,n,gt),y=e._ellipsoid;e.setEllipsoid(a.UNIT_SPHERE);var w=.25*o/i.subtract(h,g.position).magnitude();L(e,t,_,i.UNIT_Z,c.PI_OVER_TWO-w),e.setEllipsoid(y)}}function F(e,t){var i=e._cameraController,r=_t;r.x=t.startPosition.x,r.y=0;var n=yt;n.x=t.endPosition.x,n.y=0;var o=i.getPickRay(r,wt).direction,a=i.getPickRay(n,Ct).direction,s=0,l=o.dot(a);1>l&&(s=Math.acos(l)),s=t.startPosition.x>t.endPosition.x?-s:s;var u=e._horizontalRotationAxis;u!==void 0?i.look(u,s):i.lookLeft(s),r.x=0,r.y=t.startPosition.y,n.x=0,n.y=t.endPosition.y,o=i.getPickRay(r,wt).direction,a=i.getPickRay(n,Ct).direction,s=0,l=o.dot(a),1>l&&(s=Math.acos(l)),s=t.startPosition.y>t.endPosition.y?-s:s,i.lookUp(s)}function q(e){var t=e._spinHandler,i=e._zoomHandler,r=e._zoomWheelHandler,n=e._pinchHandler,o=t.isMoving()&&t.getMovement(),a=i.isMoving()&&i.getMovement(),s=r.isMoving()&&r.getMovement(),l=n.isMoving()&&n.getMovement(),u=e._rotateHandler,c=u.isMoving()&&u.getMovement(),h=e._lookHandler,d=h.isMoving()&&h.getMovement(),m=t.isButtonDown()||i.isButtonDown()||u.isButtonDown()||d||s||l;return e.enableRotate&&(o&&z(e,t.getMovement()),!m&&e.inertiaSpin>=0&&1>e.inertiaSpin&&T(t,e.inertiaSpin,z,e,"_lastInertiaSpinMovement")),e.enableTilt&&(c&&B(e,u.getMovement()),l&&B(e,n.getMovement().angleAndHeight),!m&&e.inertiaSpin>=0&&1>e.inertiaSpin&&T(u,e.inertiaSpin,B,e,"_lastInertiaTiltMovement"),!m&&e.inertiaSpin>=0&&1>e.inertiaSpin&&T(n,e.inertiaSpin,B,e,"_lastInertiaTiltMovement")),e.enableZoom&&(a?V(e,i.getMovement()):s?V(e,r.getMovement()):l&&V(e,n.getMovement().distance),!m&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(i,e.inertiaZoom,V,e,"_lastInertiaZoomMovement"),!m&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(r,e.inertiaZoom,V,e,"_lastInertiaWheelZoomMovement"),!m&&e.inertiaZoom>=0&&1>e.inertiaZoom&&T(n,e.inertiaZoom,V,e,"_lastInertiaZoomMovement")),e.enableLook&&d&&F(e,h.getMovement()),!0}var U=function(e,t){if(e===void 0)throw new o("canvas is required.");if(t===void 0)throw new o("cameraController is required.");this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.columbusViewMode=y.FREE,this.bounceAnimationTime=3e3,this.minimumZoomDistance=20,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this._canvas=e,this._cameraController=t,this._ellipsoid=a.WGS84,this._spinHandler=new g(e,_.LEFT_DRAG),this._translateHandler=new g(e,_.LEFT_DRAG),this._lookHandler=new g(e,_.LEFT_DRAG,s.SHIFT),this._rotateHandler=new g(e,_.MIDDLE_DRAG),this._zoomHandler=new g(e,_.RIGHT_DRAG),this._zoomWheelHandler=new g(e,_.WHEEL),this._pinchHandler=new g(e,_.PINCH),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaWheelZoomMovement=void 0,this._lastInertiaTiltMovement=void 0,this._animationCollection=new v,this._animation=void 0,this._horizontalRotationAxis=void 0;var i=this._ellipsoid.getMaximumRadius();this._zoomFactor=5,this._rotateFactor=1/i,this._rotateRateRangeAdjustment=i,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._translateFactor=1,this._minimumZoomRate=20,this._maximumZoomRate=l};U.prototype.getEllipsoid=function(){return this._ellipsoid},U.prototype.setEllipsoid=function(e){e=e||a.WGS84;var t=e.getMaximumRadius();this._ellipsoid=e,this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t};var k=.4,W=new p,H=new p,j=new t,G=new t,Y=new p,X=new p,Z=new i,K=new i,J=new i,Q=new t,$=new p,et=new i,tt=new d,it=new t,rt=new p,nt=new i,ot=r.ZERO.clone(),at=r.UNIT_W.clone(),st=r.UNIT_W.clone(),lt=new i,ut=new i,ct=new i,ht=new i,dt=new i,mt=new t,pt=new p,ft=new n,vt=r.UNIT_W.clone(),gt=new d,_t=new t,yt=new t,wt=new p,Ct=new p;return U.prototype.update=function(e){e===w.SCENE2D?D(this):e===w.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.UNIT_Z,O(this)):e===w.SCENE3D&&(this._horizontalRotationAxis=void 0,q(this))},U.prototype.isDestroyed=function(){return!1},U.prototype.destroy=function(){return this._spinHandler=this._spinHandler&&this._spinHandler.destroy(),this._translateHandler=this._translateHandler&&this._translateHandler.destroy(),this._lookHandler=this._lookHandler&&this._lookHandler.destroy(),this._rotateHandler=this._rotateHandler&&this._rotateHandler.destroy(),this._zoomHandler=this._zoomHandler&&this._zoomHandler.destroy(),this._zoomWheelHandler=this._zoomWheelHandler&&this._zoomWheelHandler.destroy(),this._pinchHandler=this._pinchHandler&&this._pinchHandler.destroy(),e(this)},U}),i("Scene/Scene",["../Core/Math","../Core/Color","../Core/defaultValue","../Core/destroyObject","../Core/GeographicProjection","../Core/Ellipsoid","../Core/DeveloperError","../Core/Occluder","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Intersect","../Core/IntersectionTests","../Core/Interval","../Core/Matrix4","../Core/JulianDate","../Renderer/Context","../Renderer/ClearCommand","../Renderer/PassState","./Camera","./ScreenSpaceCameraController","./CompositePrimitive","./CullingVolume","./AnimationCollection","./SceneMode","./FrameState","./OrthographicFrustum","./PerspectiveOffCenterFrustum","./FrustumCommands"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A){function P(e){e.color=!1,e.pick=!1,e.overlay=!1}function R(e,t,i){var r=e._camera,n=e._frameState;n.mode=e.mode,n.morphTime=e.morphTime,n.scene2D=e.scene2D,n.frameNumber=t,n.time=i,n.camera=r,n.cullingVolume=r.frustum.computeCullingVolume(r.getPositionWC(),r.getDirectionWC(),r.getUpWC()),n.occluder=void 0,n.canvasDimensions.x=e._canvas.clientWidth,n.canvasDimensions.y=e._canvas.clientHeight;var o=e._primitives.getCentralBody();if(e.mode===b.SCENE3D&&o!==void 0){var a=o.getEllipsoid(),l=new s(new u(h.ZERO,a.getMinimumRadius()),r.getPositionWC());n.occluder=l}P(n.passes)}function O(e,t,i,r,n){n.length=r;for(var o=0;r>o;++o){var a=Math.max(e,Math.pow(i,o)*e),s=Math.min(t,i*a);a*=.99;var l=n[o];l===void 0?l=n[o]=new A(a,s):(l.near=a,l.far=s)}}function z(e,t,i){for(var r=e._frustumCommandsList,n=r.length,o=0;n>o;++o){var a=r[o],s=a.near,l=a.far;if(i!==void 0){if(i.start>l)continue;if(s>i.stop)break}if(a.commands[a.index++]=t,t.executeInClosestFrustum)break}}function L(e,t){for(var r=e._commandList,n=e._frameState.cullingVolume,o=e._camera,a=o.getDirectionWC(),s=o.getPositionWC(),l=e._frustumCommandsList,u=l.length,c=0;u>c;++c)l[c].index=0;var h,d=Number.MAX_VALUE,p=Number.MIN_VALUE,f=!1;e._frameState.mode===b.SCENE3D&&(h=e._frameState.occluder);for(var g=k.planes,_=0;5>_;++_)g[_]=n.planes[_];n=k;for(var w=r.length,C=0;w>C;++C)for(var x=r[C][t],T=x.length,S=0;T>S;++S){var E=x[S],M=E.boundingVolume;if(M!==void 0){var I=i(E.modelMatrix,v.IDENTITY),D=M.transform(I);if(n.getVisibility(D)===m.OUTSIDE||h!==void 0&&!h.isBoundingSphereVisible(D))continue;W=D.getPlaneDistances(s,a,W),d=Math.min(d,W.start),p=Math.max(p,W.stop),z(e,E,W)}else f=!(E instanceof y),z(e,E)}f?(d=o.frustum.near,p=o.frustum.far):(d=Math.min(Math.max(d,o.frustum.near),o.frustum.far),p=Math.max(Math.min(p,o.frustum.far),d));var A=e.farToNearRatio,P=Math.ceil(Math.log(p/d)/Math.log(A));d!==Number.MAX_VALUE&&(P!==u||0!==l.length&&(l[0].near>d||p>l[u-1].far))&&(O(d,p,A,P,l),L(e,t))}function N(e,r){var n=e._camera,o=n.frustum.clone(),a=e._context,s=a.getUniformState(),l=e.skyBox!==void 0?e.skyBox.update(a,e._frameState):void 0,u=e.skyAtmosphere!==void 0?e.skyAtmosphere.update(a,e._frameState):void 0,c=e._clearColorCommand;t.clone(i(e.backgroundColor,t.BLACK),c.color),c.execute(a,r),o.near=n.frustum.near,o.far=n.frustum.far,s.updateFrustum(o),l!==void 0&&l.execute(a,r),u!==void 0&&u.execute(a,r);for(var h=e._clearDepthStencilCommand,d=e._frustumCommandsList,m=d.length,p=0;m>p;++p){h.execute(a,r);var f=m-p-1,v=d[f];o.near=v.near,o.far=v.far,s.updateFrustum(o);for(var g=v.commands,_=v.index,y=0;_>y;++y)g[y].execute(a,r)}}function V(e,t){for(var i=e._context,r=e._commandList,n=r.length,o=0;n>o;++o)for(var a=r[o].overlayList,s=a.length,l=0;s>l;++l)a[l].execute(i,t)}function B(e,t){var i=e._canvas,r=e._camera,n=r.frustum,o=i.clientWidth,a=i.clientHeight,s=2/o*t.x-1;s*=.5*(n.right-n.left);var l=2/a*(a-t.y)-1;l*=.5*(n.top-n.bottom);var u=r.position;u=new h(u.z,u.x,u.y),u.y+=s,u.z+=l;var d=n.getPixelSize(new c(o,a)),m=H;return m.right=.5*d.x,m.left=-m.right,m.top=.5*d.y,m.bottom=-m.top,m.near=n.near,m.far=n.far,m.computeCullingVolume(u,r.getDirectionWC(),r.getUpWC())}function F(e,t,i,r){var n=e._canvas,o=e._camera,a=o.frustum,s=a.near,l=n.clientWidth,u=n.clientHeight,h=Math.tan(.5*a.fovy),d=a.aspectRatio*h,m=2/l*t.x-1,p=2/u*(u-t.y)-1,f=m*s*d,v=p*s*h,g=a.getPixelSize(new c(l,u)),_=.5*g.x*i,y=.5*g.y*r,w=j;return w.top=v+y,w.bottom=v-y,w.right=f+_,w.left=f-_,w.near=s,w.far=a.far,w.computeCullingVolume(o.getPositionWC(),o.getDirectionWC(),o.getUpWC())}function q(e,t,i,r){return e.mode===b.SCENE2D?B(e,t,i,r):F(e,t,i,r)}var U=function(e){var i=new _(e);this._frameState=new M,this._passState=new w(i),this._canvas=e,this._context=i,this._primitives=new T,this._pickFramebuffer=void 0,this._camera=new C(e),this._screenSpaceCameraController=new x(e,this._camera.controller),this._animations=new E,this._shaderFrameCount=0,this._commandList=[],this._frustumCommandsList=[],this._clearColorCommand=new y,this._clearColorCommand.color=new t;var r=new y;r.depth=1,r.stencil=1,this._clearDepthStencilCommand=r,this.skyBox=void 0,this.skyAtmosphere=void 0,this.backgroundColor=t.BLACK.clone(),this.mode=b.SCENE3D,this.scene2D={projection:new n(o.WGS84)},this.morphTime=1,this.farToNearRatio=1e3;var a=this._camera.frustum.near,s=this._camera.frustum.far,l=Math.ceil(Math.log(s/a)/Math.log(this.farToNearRatio));O(a,s,this.farToNearRatio,l,this._frustumCommandsList)};U.prototype.getCanvas=function(){return this._canvas},U.prototype.getContext=function(){return this._context},U.prototype.getPrimitives=function(){return this._primitives},U.prototype.getCamera=function(){return this._camera},U.prototype.getScreenSpaceCameraController=function(){return this._screenSpaceCameraController},U.prototype.getUniformState=function(){return this._context.getUniformState()},U.prototype.getFrameState=function(){return this._frameState},U.prototype.getAnimations=function(){return this._animations};var k=new S,W=new f;U.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.getShaderCache().destroyReleasedShaderPrograms()),this._animations.update(),this._camera.controller.update(this.mode,this.scene2D),this._screenSpaceCameraController.update(this.mode)},U.prototype.render=function(t){t===void 0&&(t=new g);var i=this.getUniformState(),r=this._frameState,n=e.incrementWrap(i.getFrameNumber(),15e6,1);R(this,n,t),r.passes.color=!0,r.passes.overlay=!0,i.update(r),this._commandList.length=0,this._primitives.update(this._context,r,this._commandList);var o=this._passState;o.framebuffer=void 0,L(this,"colorList"),N(this,o),V(this,o)};var H=new I,j=new D,G=3,Y=3,X=new l(0,0,G,Y);return U.prototype.pick=function(e){var t=this._context,i=this._primitives,r=this._frameState;this._pickFramebuffer===void 0&&(this._pickFramebuffer=t.createPickFramebuffer()),R(this,r.frameNumber,r.time),r.cullingVolume=q(this,e,G,Y),r.passes.pick=!0;var n=this._commandList;return n.length=0,i.update(t,r,n),L(this,"pickList"),X.x=e.x-.5*(G-1),X.y=this._canvas.clientHeight-e.y-.5*(Y-1),N(this,this._pickFramebuffer.begin(X)),this._pickFramebuffer.end(X)},U.prototype.isDestroyed=function(){return!1},U.prototype.destroy=function(){return this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._pickFramebuffer=this._pickFramebuffer&&this._pickFramebuffer.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._context=this._context&&this._context.destroy(),r(this)},U}),i("Scene/SceneTransitioner",["../Core/defaultValue","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/Event","../Core/ScreenSpaceEventHandler","../Core/ScreenSpaceEventType","../Core/Ellipsoid","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Matrix4","../ThirdParty/Tween","./OrthographicFrustum","./PerspectiveFrustum","./SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v){function g(e,t){var i=new c(e.position.x,e.position.y,e.position.z,1),r=new c(e.direction.x,e.direction.y,e.direction.z,0),n=new c(e.up.x,e.up.y,e.up.z,0),o=t.inverseTransformation().multiply(e.transform);e.transform=t.clone(),e.position=u.fromCartesian4(o.multiplyByVector(i)),e.direction=u.fromCartesian4(o.multiplyByVector(r)),e.up=u.fromCartesian4(o.multiplyByVector(n)),e.right=e.direction.cross(e.up)}function _(e,t){if(e.completeMorphOnUserInput){e._morphHandler=new o(e._scene.getCanvas());var i=function(){e._morphCancelled=!0,t(e)};e._completeMorph=i,e._morphHandler.setInputAction(i,a.LEFT_DOWN),e._morphHandler.setInputAction(i,a.MIDDLE_DOWN),e._morphHandler.setInputAction(i,a.RIGHT_DOWN),e._morphHandler.setInputAction(i,a.WHEEL)}}function y(e){for(var t=e._scene.getAnimations(),i=0;e._currentAnimations.length>i;++i)t.remove(e._currentAnimations[i]);e._currentAnimations.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}function w(e,t,i){var r=e._scene,n=r.getCamera();g(n,d.IDENTITY);var o=n.position,a=n.direction,s=n.up,l=e._ellipsoid.getMaximumRadius(),c=e._ellipsoid.cartographicToCartesian(new h(0,0,10));c=c.normalize().multiplyByScalar(2*l);var p=u.ZERO.subtract(c).normalize(),f=p.cross(u.UNIT_Z).normalize(),v=f.cross(p),_=function(e){n.position=x(o,c,e.time),n.direction=x(a,p,e.time),n.up=x(s,v,e.time),n.right=n.direction.cross(n.up)},y=r.getAnimations().add({duration:t,easingFunction:m.Easing.Quartic.Out,startValue:{time:0},stopValue:{time:1},onUpdate:_});e._currentAnimations.push(y),A(e,r,0,1,t,i)}function C(e,t,i){t=.5*t;var r=e._scene.getCamera();b(e,t,function(){r.frustum=e._cameraCV.frustum.clone(),r.transform=e._cameraCV.transform.clone(),w(e,t,i)})}function x(e,t,i){return e.lerp(t,i)}function T(e,t,i){var n=e._scene,o=n.getCamera(),a=o.position,s=o.frustum.fovy,l=.5*r.RADIANS_PER_DEGREE,u=a.magnitude()*Math.tan(.5*s);o.frustum.far=u/Math.tan(.5*l)+1e7;var c=function(e){o.frustum.fovy=r.lerp(s,l,e.time);var t=u/Math.tan(.5*o.frustum.fovy);o.position=o.position.normalize().multiplyByScalar(t)},h=n.getAnimations().add({duration:t,easingFunction:m.Easing.Quartic.Out,startValue:{time:0},stopValue:{time:1},onUpdate:c,onComplete:function(){o.frustum=e._camera2D.frustum.clone(),i(e)}});e._currentAnimations.push(h)}function S(e,t,i){var r=e._scene,n=r.getCamera(),o=e._ellipsoid.getMaximumRadius();g(n,e._cameraCV.transform);var a=n.position.clone(),s=n.direction.clone(),l=n.up.clone(),u=Math.tan(.5*e._cameraCV.frustum.fovy),c=e._cameraCV.frustum.aspectRatio*u,h=o*Math.PI/c,d=e._camera2D.position.normalize().multiplyByScalar(h),p=e._camera2D.direction.clone(),f=e._camera2D.up.clone(),v=function(e){n.position=x(a,d,e.time),n.direction=x(s,p,e.time),n.up=x(l,f,e.time),n.right=n.direction.cross(n.up)};t=.5*t;var _=r.getAnimations().add({duration:t,easingFunction:m.Easing.Quartic.Out,startValue:{time:0},stopValue:{time:1},onUpdate:v,onComplete:function(){T(e,t,i)}});e._currentAnimations.push(_)}function E(e,t,i){t=.5*t;var r=e._ellipsoid.getMaximumRadius(),n=Math.tan(.5*e._camera3D.frustum.fovy),o=e._camera3D.frustum.aspectRatio*n,a=r*Math.PI/o,s={};s.position=e._camera2D.position.normalize().multiplyByScalar(a),s.direction=e._camera2D.direction.clone(),s.up=e._camera2D.up.clone();var l=function(){T(e,t,i)};I(e,t,s,l)}function b(e,t,i){var n=e._scene,o=n.getCamera(),a=e._ellipsoid.getMaximumRadius(),s=Math.tan(.5*e._cameraCV.frustum.fovy),l=e._cameraCV.frustum.aspectRatio*s,u=a*Math.PI/l,c=e._camera2D.position.normalize().multiplyByScalar(u),h=o.frustum.top,d=o.frustum.bottom,p=o.frustum.right,f=o.frustum.left,v=e._camera2D.frustum,g=e._cameraCV.frustum,_=o.position.clone(),y=function(e){o.position=x(_,c,e.time),o.frustum.top=r.lerp(h,v.top,e.time),o.frustum.bottom=r.lerp(d,v.bottom,e.time),o.frustum.right=r.lerp(p,v.right,e.time),o.frustum.left=r.lerp(f,v.left,e.time)},w=(p-f)/(2*a*Math.PI),C=1;w>C&&(w=0);var T=(C-w)*t;if(r.EPSILON6>T){if(_.equalsEpsilon(c,r.EPSILON6))return o.position=c,o.frustum=g.clone(),i(e),void 0;T=t,w=0,C=1}var S=n.getAnimations().add({easingFunction:m.Easing.Quartic.Out,duration:T,startValue:{time:w},stopValue:{time:C},onUpdate:y,onComplete:function(){o.frustum=g.clone(),i(e)}});e._currentAnimations.push(S)}function M(e,t,i){var r=e._scene,n=r.getCamera();t=.5*t;var o=function(){var o=n.position.clone(),a=n.direction.clone(),s=n.up.clone(),l=e._cameraCV.position.clone(),u=e._cameraCV.direction.clone(),c=e._cameraCV.up.clone(),h=function(e){n.position=x(o,l,e.time),n.direction=x(a,u,e.time),n.up=x(s,c,e.time),n.right=n.direction.cross(n.up)
},d=r.getAnimations().add({duration:t,easingFunction:m.Easing.Quartic.Out,startValue:{time:0},stopValue:{time:1},onUpdate:h,onComplete:function(){i(e)}});e._currentAnimations.push(d)};b(e,t,o)}function I(e,t,i,r){var n=e._scene,o=n.getCamera();g(o,e._cameraCV.transform);var a=o.position.clone(),s=o.direction.clone(),l=o.up.clone(),u=i.position.clone(),c=i.direction.clone(),h=i.up.clone(),d=function(e){o.position=x(a,u,e.time),o.direction=x(s,c,e.time),o.up=x(l,h,e.time),o.right=o.direction.cross(o.up)},p=n.getAnimations().add({duration:t,easingFunction:m.Easing.Quartic.Out,startValue:{time:0},stopValue:{time:1},onUpdate:d,onComplete:function(){o.position=u,o.direction=c,o.up=h}});e._currentAnimations.push(p),A(e,n,1,0,t,r)}function D(e,t){e.morphTime=t;for(var i=e.getPrimitives(),r=0,n=i.getLength();n>r;r++){var o=i.get(r);o.morphTime!==void 0&&(o.morphTime=t)}var a=i.getCentralBody();a.morphTime=t,e.skyBox!==void 0&&(e.skyBox.morphTime=t),e.skyAtmosphere!==void 0&&(e.skyAtmosphere.morphTime=t)}function A(e,t,i,r,n,o){for(var a,s={duration:n,easingFunction:m.Easing.Quartic.Out},l=t.getPrimitives(),u=t.getAnimations(),c=0,h=l.getLength();h>c;c++){var d=l.get(c);d.morphTime!==void 0&&(a=u.addProperty(d,"morphTime",i,r,s),e._currentAnimations.push(a))}var p=l.getCentralBody();a=u.addProperty(p,"morphTime",i,r,s),e._currentAnimations.push(a),t.skyBox!==void 0&&(a=u.addProperty(t.skyBox,"morphTime",i,r,s),e._currentAnimations.push(a)),t.skyAtmosphere!==void 0&&(a=u.addProperty(t.skyAtmosphere,"morphTime",i,r,s),e._currentAnimations.push(a)),o!==void 0&&(s.onComplete=function(){o(e)}),a=u.addProperty(t,"morphTime",i,r,s),e._currentAnimations.push(a)}function P(e){var t=e._scene,i=t.getCanvas(),r=i.clientHeight/i.clientWidth,n=e._camera2D.frustum;n.top=n.right*r,n.bottom=-n.top,r=1/r,n=e._cameraCV.frustum,n.aspectRatio=r,n=e._camera3D.frustum,n.aspectRatio=r;var o=t.getCamera();switch(t.mode){case v.SCENE3D:o.frustum=e._camera3D.frustum.clone();break;case v.COLUMBUS_VIEW:o.frustum=e._cameraCV.frustum.clone();break;case v.SCENE2D:o.frustum=e._camera2D.frustum.clone()}}function R(e){var t=e._scene;t.mode=v.SCENE3D,D(t,1),y(e),P(e);var i=t.getCamera();i.transform=d.IDENTITY.clone(),(e._previousMode!==v.MORPHING||e._morphCancelled)&&(e._morphCancelled=!1,i.position=e._camera3D.position.clone(),i.direction=e._camera3D.direction.clone(),i.up=e._camera3D.up.clone());var r=e._completeMorph!==void 0;e._completeMorph=void 0,e.onTransitionComplete.raiseEvent(e,e._previousMode,v.SCENE3D,r)}function O(e){var t=e._scene;t.mode=v.SCENE2D,D(t,0),y(e),P(e);var i=t.getCamera();i.transform=e._camera2D.transform.clone(),i.position=e._camera2D.position.clone(),i.direction=e._camera2D.direction.clone(),i.up=e._camera2D.up.clone();var r=e._completeMorph!==void 0;e._completeMorph=void 0,e.onTransitionComplete.raiseEvent(e,e._previousMode,v.SCENE2D,r)}function z(e){var t=e._scene;t.mode=v.COLUMBUS_VIEW,D(t,0),y(e),P(e);var i=t.getCamera();i.transform=e._cameraCV.transform.clone(),(e._previousModeMode!==v.MORPHING||e._morphCancelled)&&(e._morphCancelled=!1,i.position=e._cameraCV.position.clone(),i.direction=e._cameraCV.direction.clone(),i.up=e._cameraCV.up.clone(),i.right=i.direction.cross(i.up));var r=e._completeMorph!==void 0;e._completeMorph=void 0,e.onTransitionComplete.raiseEvent(e,e._previousMode,v.COLUMBUS_VIEW,r)}var L=function(t,o){if(t===void 0)throw new i("scene is required.");this.morphDuration=2e3,this.completeMorphOnUserInput=!0,this.onTransitionStart=new n,this.onTransitionComplete=new n,this._scene=t,this._ellipsoid=e(o,s.WGS84);var a=t.getCanvas(),l=this._ellipsoid.getMaximumRadius(),c=new u(0,0,2*l),h=c.negate().normalize(),m=u.UNIT_Y,v=new p;v.right=l*Math.PI,v.left=-v.right,v.top=v.right*(a.clientHeight/a.clientWidth),v.bottom=-v.top;var g=new d(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);this._camera2D={position:c,direction:h,up:m,frustum:v,transform:g},c=new u(0,-1,1).normalize().multiplyByScalar(5*l),h=u.ZERO.subtract(c).normalize();var _=h.cross(u.UNIT_Z).normalize();m=_.cross(h),v=new f,v.fovy=r.toRadians(60),v.aspectRatio=a.clientWidth/a.clientHeight,this._cameraCV={position:c,direction:h,up:m,frustum:v,transform:g},c=new u(0,-2,1).normalize().multiplyByScalar(2*l),h=u.ZERO.subtract(c).normalize(),_=h.cross(u.UNIT_Z).normalize(),m=_.cross(h),this._camera3D={position:c,direction:h,up:m,frustum:v},this._currentAnimations=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0};return L.prototype.getScene=function(){return this._scene},L.prototype.getEllipsoid=function(){return this._ellipsoid},L.prototype.to2D=function(){this._completeMorph!==void 0&&this._completeMorph(),this._previousMode=this._scene.mode,this._previousMode!==v.SCENE2D&&(this.onTransitionStart.raiseEvent(this,this._previousMode,v.SCENE2D,!1),O(this))},L.prototype.toColumbusView=function(){this._completeMorph!==void 0&&this._completeMorph();var e=this._scene;this._previousMode=e.mode,this._previousMode!==v.COLUMBUS_VIEW&&(this.onTransitionStart.raiseEvent(this,this._previousMode,v.COLUMBUS_VIEW,!1),z(this))},L.prototype.to3D=function(){this._completeMorph!==void 0&&this._completeMorph();var e=this._scene;this._previousMode=e.mode,e.mode!==v.SCENE3D&&(this.onTransitionStart.raiseEvent(this,this._previousMode,v.SCENE3D,!1),R(this))},L.prototype.completeMorph=function(){if(this._completeMorph===void 0)throw new i("completeMorph can only be called while morphing");this._completeMorph()},L.prototype.morphTo2D=function(){this._completeMorph!==void 0&&this._completeMorph();var e=this._scene.mode;e!==v.SCENE2D&&e!==v.MORPHING&&(this.onTransitionStart.raiseEvent(this,e,v.SCENE2D,!0),this._previousMode=v.MORPHING,P(this),this._scene.mode=v.MORPHING,_(this,O),e===v.COLUMBUS_VIEW?S(this,this.morphDuration,O):E(this,this.morphDuration,O))},L.prototype.morphToColumbusView=function(){this._completeMorph!==void 0&&this._completeMorph();var e=this._scene.mode;e!==v.COLUMBUS_VIEW&&e!==v.MORPHING&&(this.onTransitionStart.raiseEvent(this,e,v.COLUMBUS_VIEW,!0),this._previousMode=v.MORPHING,P(this),this._scene.mode=v.MORPHING,_(this,z),e===v.SCENE2D?M(this,this.morphDuration,z):I(this,this.morphDuration,this._cameraCV,z))},L.prototype.morphTo3D=function(){this._completeMorph!==void 0&&this._completeMorph();var e=this._scene;this._previousMode=e.mode,this._previousMode!==v.SCENE3D&&this._previousMode!==v.MORPHING&&(this.onTransitionStart.raiseEvent(this,this._previousMode,v.SCENE3D,!0),this._previousMode=v.MORPHING,P(this),e.mode=v.MORPHING,_(this,R),this._previousMode===v.SCENE2D?C(this,this.morphDuration,R):w(this,this.morphDuration,R))},L.prototype.isDestroyed=function(){return!1},L.prototype.destroy=function(){return y(this),t(this)},L}),i("Scene/SensorVolumeCollection",["../Core/defaultValue","../Core/destroyObject","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/DeveloperError","../Core/Intersect","../Core/Matrix4","./CustomSensorVolume","./RectangularPyramidSensorVolume","./SceneMode"],function(e,t,i,r,n,o,a,s,l,u,c){var h=function(){this._sensors=[]};return h.prototype.addRectangularPyramid=function(e){var t=new u(e);return this._sensors.push(t),t},h.prototype.addCustom=function(e){var t=new l(e);return this._sensors.push(t),t},h.prototype.remove=function(e){if(e){var t=this._sensors,i=t.indexOf(e);if(-1!==i)return t[i].destroy(),t.splice(i,1),!0}return!1},h.prototype.removeAll=function(){for(var e=this._sensors,t=e.length,i=0;t>i;++i)e[i].destroy();this._sensors=[]},h.prototype.contains=function(e){return e?-1!==this._sensors.indexOf(e):!1},h.prototype.get=function(e){if(e===void 0)throw new o("index is required.");return this._sensors[e]},h.prototype.getLength=function(){return this._sensors.length},h.prototype.update=function(e,t,i){var r=t.mode;if(r===c.SCENE3D)for(var n=this._sensors,o=n.length,a=0;o>a;++a)n[a].update(e,t,i)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this.removeAll(),t(this)},h}),i("Scene/SingleTileImageryProvider",["../Core/defaultValue","../Core/loadImage","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Event","../Core/Extent","./GeographicTilingScheme","./TileProviderError","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l){var u=function(u){function c(e){y._image=e,y._tileWidth=e.width,y._tileHeight=e.height,y._ready=!0,s.handleSuccess(y._errorEvent)}function h(){var e="Failed to load image "+g+".";_=s.handleError(_,y,y._errorEvent,e,0,0,0,d)}function d(){l(t(g),c,h)}u=e(u,{});var m=u.url;if(m===void 0)throw new r("url is required.");this._url=m;var p=u.proxy;this._proxy=p;var f=e(u.extent,o.MAX_VALUE),v=new a({extent:f,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1});this._tilingScheme=v,this._image=void 0,this._texture=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new n,this._ready=!1;var g=m;p!==void 0&&(g=p.getURL(g)),u.credit!==void 0&&(this._logo=i(u.credit,{font:"12px sans-serif"}));var _,y=this;d()};return u.prototype.getUrl=function(){return this._url},u.prototype.getProxy=function(){return this._proxy},u.prototype.getTileWidth=function(){if(!this._ready)throw new r("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},u.prototype.getTileHeight=function(){if(!this._ready)throw new r("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},u.prototype.getMaximumLevel=function(){if(!this._ready)throw new r("getMaximumLevel must not be called before the imagery provider is ready.");return 0},u.prototype.getTilingScheme=function(){if(!this._ready)throw new r("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},u.prototype.getExtent=function(){return this._tilingScheme.getExtent()},u.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new r("getTileDiscardPolicy must not be called before the imagery provider is ready.");return void 0},u.prototype.getErrorEvent=function(){return this._errorEvent},u.prototype.isReady=function(){return this._ready},u.prototype.requestImage=function(){if(!this._ready)throw new r("requestImage must not be called before the imagery provider is ready.");return this._image},u.prototype.getLogo=function(){if(!this._ready)throw new r("getLogo must not be called before the imagery provider is ready.");return this._logo},u}),i("Shaders/SkyAtmosphereVS",[],function(){return"attribute vec4 position;\nuniform float fCameraHeight;\nuniform float fCameraHeight2;\nuniform float fOuterRadius;\nuniform float fOuterRadius2;\nuniform float fInnerRadius;\nuniform float fScale;\nuniform float fScaleDepth;\nuniform float fScaleOverScaleDepth;\nconst float Kr = 0.0025;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float fKm4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float fKmESun = Km * ESun;\nconst float fKrESun = Kr * ESun;\nconst vec3 v3InvWavelength = vec3(\n5.60204474633241,\n9.473284437923038,\n19.643802610477206);\nconst float rayleighScaleDepth = 0.25;\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\nfloat scale(float fCos)\n{\nfloat x = 1.0 - fCos;\nreturn fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid main(void)\n{\nvec3 v3Pos = position.xyz;\nvec3 v3Ray = v3Pos - czm_viewerPositionWC;\nfloat fFar = length(v3Ray);\nv3Ray /= fFar;\n#ifdef SKY_FROM_SPACE\nfloat B = 2.0 * dot(czm_viewerPositionWC, v3Ray);\nfloat C = fCameraHeight2 - fOuterRadius2;\nfloat fDet = max(0.0, B*B - 4.0 * C);\nfloat fNear = 0.5 * (-B - sqrt(fDet));\nvec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\nfFar -= fNear;\nfloat fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\nfloat fStartDepth = exp(-1.0 / fScaleDepth);\nfloat fStartOffset = fStartDepth*scale(fStartAngle);\n#else\nvec3 v3Start = czm_viewerPositionWC;\nfloat fHeight = length(v3Start);\nfloat fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\nfloat fStartAngle = dot(v3Ray, v3Start) / fHeight;\nfloat fStartOffset = fDepth*scale(fStartAngle);\n#endif\nfloat fSampleLength = fFar / fSamples;\nfloat fScaledLength = fSampleLength * fScale;\nvec3 v3SampleRay = v3Ray * fSampleLength;\nvec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\nvec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\nfor(int i=0; i<nSamples; i++)\n{\nfloat fHeight = length(v3SamplePoint);\nfloat fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\nvec3 lightPosition = normalize(czm_viewerPositionWC);\nfloat fLightAngle = dot(lightPosition, v3SamplePoint) / fHeight;\nfloat fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\nfloat fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\nvec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\nv3FrontColor += v3Attenuate * (fDepth * fScaledLength);\nv3SamplePoint += v3SampleRay;\n}\nv_mieColor = v3FrontColor * fKmESun;\nv_rayleighColor = v3FrontColor * (v3InvWavelength * fKrESun);\nv_toCamera = czm_viewerPositionWC - v3Pos;\nv_positionEC = (czm_modelView * position).xyz;\ngl_Position = czm_modelViewProjection * position;\n}\n"}),i("Shaders/SkyAtmosphereFS",[],function(){return"uniform float u_morphTime;\nconst float g = -0.95;\nconst float g2 = g * g;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\nvoid main (void)\n{\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nvec3 direction = normalize(v_positionEC);\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (!czm_isEmpty(intersection)) {\ndiscard;\n}\nfloat fCos = dot(czm_sunDirectionWC, normalize(v_toCamera)) / length(v_toCamera);\nfloat fRayleighPhase = 0.75 * (1.0 + fCos*fCos);\nfloat fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos*fCos) / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\nconst float fExposure = 2.0;\nvec3 rgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\nrgb = vec3(1.0) - exp(-fExposure * rgb);\nfloat l = czm_luminance(rgb);\ngl_FragColor = vec4(rgb, min(smoothstep(0.0, 0.1, l), 1.0) * smoothstep(0.0, 1.0, u_morphTime));\n}\n"}),i("Scene/SkyAtmosphere",["../Core/defaultValue","../Core/CubeMapEllipsoidTessellator","../Core/destroyObject","../Core/MeshFilters","../Core/PrimitiveType","../Core/Ellipsoid","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/CullFace","../Renderer/BlendingState","../Scene/SceneMode","../Shaders/SkyAtmosphereVS","../Shaders/SkyAtmosphereFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d){var m=function(t){t=e(t,o.WGS84),this.show=!0,this.morphTime=1,this._ellipsoid=t,this._command=new s,this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._fCameraHeight=void 0,this._fCameraHeight2=void 0,this._outerRadius=t.getRadii().multiplyByScalar(1.025).getMaximumComponent();var i=t.getMaximumRadius(),r=.25,n=this;this._command.uniformMap={fCameraHeight:function(){return n._fCameraHeight},fCameraHeight2:function(){return n._fCameraHeight2},fOuterRadius:function(){return n._outerRadius},fOuterRadius2:function(){return n._outerRadius*n._outerRadius},fInnerRadius:function(){return i},fScale:function(){return 1/(n._outerRadius-i)},fScaleDepth:function(){return r},fScaleOverScaleDepth:function(){return 1/(n._outerRadius-i)/r},u_morphTime:function(){return n.morphTime}}};return m.prototype.getEllipsoid=function(){return this._ellipsoid},m.prototype.update=function(e,i){if(!this.show)return void 0;if(i.mode!==c.SCENE3D&&i.mode!==c.MORPHING)return void 0;if(!i.passes.color)return void 0;var s=this._command;if(s.vertexArray===void 0){var m=t.compute(o.fromCartesian3(this._ellipsoid.getRadii().multiplyByScalar(1.025)),60);s.vertexArray=e.createVertexArrayFromMesh({mesh:m,attributeIndices:r.createAttributeIndices(m),bufferUsage:a.STATIC_DRAW}),s.primitiveType=n.TRIANGLES,s.renderState=e.createRenderState({cull:{enabled:!0,face:l.FRONT},blending:u.ALPHA_BLEND});var p,f,v=e.getShaderCache();p="#define SKY_FROM_SPACE\n#line 0\n"+h,f="#line 0\n"+d,this._spSkyFromSpace=v.getShaderProgram(p,f),p="#define SKY_FROM_ATMOSPHERE\n#line 0\n"+h,this._spSkyFromAtmosphere=v.getShaderProgram(p,f)}var g=i.camera.getPositionWC();return this._fCameraHeight2=g.magnitudeSquared(),this._fCameraHeight=Math.sqrt(this._fCameraHeight2),s.shaderProgram=this._fCameraHeight>this._outerRadius?this._spSkyFromSpace:this._spSkyFromAtmosphere,s},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.release(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.release(),i(this)},m}),i("Shaders/SkyBoxVS",[],function(){return"attribute vec3 position;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\ngl_Position = czm_projection * vec4(p, 1.0);\nv_texCoord = position.xyz;\n}\n"}),i("Shaders/SkyBoxFS",[],function(){return"uniform samplerCube u_cubeMap;\nuniform float u_morphTime;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec3 rgb = textureCube(u_cubeMap, normalize(v_texCoord)).rgb;\ngl_FragColor = vec4(rgb, u_morphTime);\n}\n"}),i("Scene/SkyBox",["../Core/BoxTessellator","../Core/Cartesian3","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/MeshFilters","../Core/PrimitiveType","../Renderer/loadCubeMap","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/BlendingState","../Scene/SceneMode","../Shaders/SkyBoxVS","../Shaders/SkyBoxFS"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m){var p=function(e){if(e===void 0||e.positiveX===void 0||e.negativeX===void 0||e.positiveY===void 0||e.negativeY===void 0||e.positiveZ===void 0||e.negativeZ===void 0)throw new r("sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new r("sources properties must all be the same type.");this._command=new u,this._cubeMap=void 0,this._sources=e,this.show=!0,this.morphTime=1};return p.prototype.getSources=function(){return this._sources},p.prototype.update=function(i,r){if(!this.show)return void 0;if(r.mode!==h.SCENE3D&&r.mode!==h.MORPHING)return void 0;if(!r.passes.color)return void 0;var u=this._command;if(u.vertexArray===void 0){var p=this._sources,f=this;"string"==typeof p.positiveX?s(i,this._sources).then(function(e){f._cubeMap=e}):this._cubeMap=i.createCubeMap({source:p}),u.uniformMap={u_cubeMap:function(){return f._cubeMap},u_morphTime:function(){return f.morphTime}};var v=e.compute({dimensions:new t(2,2,2)}),g=o.createAttributeIndices(v);u.primitiveType=a.TRIANGLES,u.modelMatrix=n.IDENTITY.clone(),u.vertexArray=i.createVertexArrayFromMesh({mesh:v,attributeIndices:g,bufferUsage:l.STATIC_DRAW}),u.shaderProgram=i.getShaderCache().getShaderProgram(d,m,g),u.renderState=i.createRenderState({blending:c.ALPHA_BLEND})}return this._cubeMap===void 0?void 0:u},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.release(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),i(this)},p}),i("Scene/TerrainData",["../Core/DeveloperError"],function(e){var t=function t(){throw new e("This type should not be instantiated directly.")};return t.prototype.interpolateHeight=function(){throw new e("This type should not be instantiated directly.")},t.prototype.isChildAvailable=function(){throw new e("This type should not be instantiated directly.")},t.prototype.getWaterMask=function(){throw new e("This type should not be instantiated directly.")},t.prototype.createMesh=function(){throw new e("This type should not be instantiated directly.")},t.prototype.upsample=function(){throw new e("This type should not be instantiated directly.")},t.prototype.wasCreatedByUpsampling=function(){throw new e("This type should not be instantiated directly.")},t}),i("Scene/TileCoordinatesImageryProvider",["../Core/defaultValue","../Core/Color","../Core/Event","./GeographicTilingScheme"],function(e,t,i,r){var n=function n(n){n=e(n,{}),this._tilingScheme=e(n.tilingScheme,new r),this._color=e(n.color,t.YELLOW),this._errorEvent=new i,this._tileWidth=e(n.tileWidth,256),this._tileHeight=e(n.tileHeight,256)};return n.prototype.getProxy=function(){return void 0},n.prototype.getTileWidth=function(){return this._tileWidth},n.prototype.getTileHeight=function(){return this._tileHeight},n.prototype.getMaximumLevel=function(){return void 0},n.prototype.getTilingScheme=function(){return this._tilingScheme},n.prototype.getExtent=function(){return this._tilingScheme.getExtent()},n.prototype.getTileDiscardPolicy=function(){return void 0},n.prototype.getErrorEvent=function(){return this._errorEvent},n.prototype.isReady=function(){return!0},n.prototype.requestImage=function(e,t,i){var r=document.createElement("canvas");r.width=256,r.height=256;var n=r.getContext("2d"),o=this._color.toCssColorString();n.strokeStyle=o,n.lineWidth=2,n.strokeRect(1,1,255,255);var a="L"+i+"X"+e+"Y"+t;return n.font="bold 25px Arial",n.textAlign="center",n.fillStyle="black",n.fillText(a,127,127),n.fillStyle=o,n.fillText(a,124,124),r},n.prototype.getLogo=function(){return void 0},n}),i("Scene/TileDiscardPolicy",["../Core/DeveloperError"],function(e){var t=function(){throw new e("This type should not be instantiated directly.")};return t.prototype.isReady=function(){throw new e("This type should not be instantiated directly.")},t.prototype.shouldDiscardImage=function(){throw new e("This type should not be instantiated directly.")},t}),i("Scene/TileMapServiceImageryProvider",["../Core/defaultValue","../Core/Cartographic","../Core/DeveloperError","../Core/Event","../Core/loadXML","../Core/writeTextToCanvas","../Core/Extent","./ImageryProvider","./WebMercatorTilingScheme","./GeographicTilingScheme"],function(e,t,i,r,n,o,a,s,l,u){function c(e,t,i,r){var n=e._tilingScheme.getNumberOfYTilesAtLevel(r),o=e._url+r+"/"+t+"/"+(n-i-1)+"."+e._fileExtension,a=e._proxy;return a!==void 0&&(o=a.getURL(o)),o}var h=/\/$/,d=function d(s){if(s=e(s,{}),s.url===void 0)throw new i("description.url is required.");var c=s.url;h.test(c)||(c+="/"),this._url=c,this._ready=!1,this._proxy=s.proxy,this._tileDiscardPolicy=s.tileDiscardPolicy,this._errorEvent=new r;var d=s.credit;d!==void 0&&(this._logo=o(d,{font:"12px sans-serif"}));var m=this;n(c+"tilemapresource.xml").then(function(i){var r=i.getElementsByTagName("TileFormat")[0];m._fileExtension=e(s.fileExtension,r.getAttribute("extension")),m._tileWidth=e(s.tileWidth,parseInt(r.getAttribute("width"),10)),m._tileHeight=e(s.tileHeight,parseInt(r.getAttribute("height"),10));var n=i.getElementsByTagName("TileSet");if(m._maximumLevel=e(s.maximumLevel,parseInt(n[n.length-1].getAttribute("order"),10)),m._extent=s.extent,m._extent===void 0){var o=i.getElementsByTagName("BoundingBox")[0],c=t.fromDegrees(parseFloat(o.getAttribute("miny")),parseFloat(o.getAttribute("minx"))),h=t.fromDegrees(parseFloat(o.getAttribute("maxy")),parseFloat(o.getAttribute("maxx")));m._extent=new a(c.longitude,c.latitude,h.longitude,h.latitude)}else m._extent=m._extent.clone();var d=s.tilingScheme;if(d===void 0){var p=i.getElementsByTagName("TileSets")[0].getAttribute("profile");d="geodetic"===p?new u:new l}d.getExtent().west>m._extent.west&&(m._extent.west=d.getExtent().west),m._extent.east>d.getExtent().east&&(m._extent.east=d.getExtent().east),d.getExtent().south>m._extent.south&&(m._extent.south=d.getExtent().south),m._extent.north>d.getExtent().north&&(m._extent.north=d.getExtent().north),m._tilingScheme=d,m._ready=!0},function(){m._fileExtension=e(s.fileExtension,"png"),m._tileWidth=e(s.tileWidth,256),m._tileHeight=e(s.tileHeight,256),m._minimumLevel=e(s.minimumLevel,0),m._maximumLevel=e(s.maximumLevel,18),m._tilingScheme=e(s.tilingScheme,new l),m._extent=e(s.extent,m._tilingScheme.getExtent()),m._ready=!0})};return d.prototype.getUrl=function(){return this._url},d.prototype.getProxy=function(){return this._proxy},d.prototype.getTileWidth=function(){if(!this._ready)throw new i("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},d.prototype.getTileHeight=function(){if(!this._ready)throw new i("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},d.prototype.getMaximumLevel=function(){if(!this._ready)throw new i("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},d.prototype.getTilingScheme=function(){if(!this._ready)throw new i("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},d.prototype.getExtent=function(){if(!this._ready)throw new i("getExtent must not be called before the imagery provider is ready.");return this._extent},d.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new i("getTileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy},d.prototype.getErrorEvent=function(){return this._errorEvent},d.prototype.isReady=function(){return this._ready},d.prototype.requestImage=function(e,t,r){if(!this._ready)throw new i("requestImage must not be called before the imagery provider is ready.");var n=c(this,e,t,r);return s.loadImage(n)},d.prototype.getLogo=function(){return this._logo},d}),i("Scene/VRTheWorldTerrainProvider",["../Core/defaultValue","../Core/loadImage","../Core/loadXML","../Core/getImagePixels","../Core/throttleRequestByServer","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Extent","../Core/Math","../Core/Ellipsoid","../Core/Event","../Core/RuntimeError","./TerrainProvider","./TileProviderError","./GeographicTilingScheme","./HeightmapTerrainData","../ThirdParty/when"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v){function g(e,t){this.extent=e,this.maxLevel=t}function _(e,t,i,r){for(var n=e._tilingScheme,o=e._extents,a=n.tileXYToExtent(t,i,r),s=0,l=0;o.length>l&&15!==s;++l){var u=o[l];if(!(r>=u.maxLevel)){var c=u.extent,h=c.intersectWith(a,C);h.isEmpty()||(y(n,c,2*t,2*i,r+1)&&(s|=4),y(n,c,2*t+1,2*i,r+1)&&(s|=8),y(n,c,2*t,2*i+1,r+1)&&(s|=1),y(n,c,2*t+1,2*i+1,r+1)&&(s|=2))}}return s}function y(e,t,i,r,n){var o=e.tileXYToExtent(i,r,n);return!o.intersectWith(t,C).isEmpty()}var w=function w(t){function r(e){var t=e.getElementsByTagName("SRS")[0].textContent;if("EPSG:4326"!==t)return n("SRS "+t+" is not supported."),void 0;_._tilingScheme=new p({ellipsoid:y});var i=e.getElementsByTagName("TileFormat")[0];_._heightmapWidth=parseInt(i.getAttribute("width"),10),_._heightmapHeight=parseInt(i.getAttribute("height"),10),_._levelZeroMaximumGeometricError=d.getEstimatedLevelZeroGeometricErrorForAHeightmap(y,Math.min(_._heightmapWidth,_._heightmapHeight),_._tilingScheme.getNumberOfXTilesAtLevel(0));for(var r=e.getElementsByTagName("DataExtent"),o=0;r.length>o;++o){var a=r[o],u=l.toRadians(parseFloat(a.getAttribute("minx"))),c=l.toRadians(parseFloat(a.getAttribute("miny"))),h=l.toRadians(parseFloat(a.getAttribute("maxx"))),m=l.toRadians(parseFloat(a.getAttribute("maxy"))),f=parseInt(a.getAttribute("maxlevel"),10);_._extents.push(new g(new s(u,c,h,m),f))}_._ready=!0}function n(t){var i=e(t,"An error occurred while accessing "+_._url+".");f=m.handleError(f,_,_._errorEvent,i,void 0,void 0,void 0,h)}function h(){v(i(_._url),r,n)}if(t=e(t,e.EMPTY_OBJECT),t.url===void 0)throw new a("description.url is required.");this._url=t.url,this._url.length>0&&"/"!==this._url[this._url.length-1]&&(this._url+="/"),this._errorEvent=new c,this._ready=!1,this._proxy=t.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0},t.credit!==void 0&&(this._logo=o(t.credit,{font:"12px sans-serif"})),this._tilingScheme=void 0,this._extents=[];var f,_=this,y=e(t.ellipsoid,u.WGS84);h()};w.prototype.requestTileGeometry=function(i,o,s,l){if(!this.isReady())throw new a("requestTileGeometry must not be called before isReady returns true.");var u=this._tilingScheme.getNumberOfYTilesAtLevel(s),c=this._url+s+"/"+i+"/"+(u-o-1)+".tif?cesium=true",h=this._proxy;h!==void 0&&(c=h.getURL(c));var d;if(l=e(l,!0)){if(d=n(c,t),d===void 0)return void 0}else d=t(c);var m=this;return v(d,function(e){return new f({buffer:r(e),width:m._heightmapWidth,height:m._heightmapHeight,childTileMask:_(m,i,o,s),structure:m._terrainDataStructure})})},w.prototype.getErrorEvent=function(){return this._errorEvent},w.prototype.getLevelMaximumGeometricError=function(e){if(!this.isReady())throw new a("requestTileGeometry must not be called before isReady returns true.");return this._levelZeroMaximumGeometricError/(1<<e)},w.prototype.getLogo=function(){return this._logo},w.prototype.getTilingScheme=function(){if(!this.isReady())throw new a("requestTileGeometry must not be called before isReady returns true.");return this._tilingScheme},w.prototype.hasWaterMask=function(){return!1},w.prototype.isReady=function(){return this._ready};var C=new s;return w}),i("Scene/WebMapServiceImageryProvider",["../Core/clone","../Core/defaultValue","../Core/freezeObject","../Core/writeTextToCanvas","../Core/DeveloperError","../Core/Event","../Core/Extent","./ImageryProvider","./WebMercatorTilingScheme","./GeographicTilingScheme"],function(e,t,i,r,n,o,a,s,l,u){function c(e,t,i,r){var n=e._url,o=n.indexOf("?");o>=0&&n.length-1>o?"&"!==n[n.length-1]&&(n+="&"):0>o&&(n+="?");var a=e._parameters;for(var s in a)a.hasOwnProperty(s)&&(n+=s+"="+a[s]+"&");if(a.layers===void 0&&(n+="layers="+e._layers+"&"),a.srs===void 0&&(n+="srs=EPSG:4326&"),a.bbox===void 0){var l=e._tilingScheme.tileXYToNativeExtent(t,i,r),u=l.west+","+l.south+","+l.east+","+l.north;n+="bbox="+u+"&"}a.width===void 0&&(n+="width=256&"),a.height===void 0&&(n+="height=256&");var c=e._proxy;return c!==void 0&&(n=c.getURL(n)),n}var h=function h(i){if(i=t(i,{}),i.url===void 0)throw new n("description.url is required.");if(i.layers===void 0)throw new n("description.layers is required.");this._url=i.url,this._tileDiscardPolicy=i.tileDiscardPolicy,this._proxy=i.proxy,this._layers=i.layers;var s=e(h.DefaultParameters);if(i.parameters!==void 0)for(var l in i.parameters)if(i.parameters.hasOwnProperty(l)){var c=l.toLowerCase();s[c]=i.parameters[l]}this._parameters=s,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=i.maximumLevel;var d=t(i.extent,a.MAX_VALUE);this._tilingScheme=new u({extent:d}),i.credit!==void 0&&(this._logo=r(i.credit,{font:"12px sans-serif"})),this._errorEvent=new o,this._ready=!0};return h.prototype.getUrl=function(){return this._url},h.prototype.getProxy=function(){return this._proxy},h.prototype.getLayers=function(){return this._layers},h.prototype.getTileWidth=function(){if(!this._ready)throw new n("getTileWidth must not be called before the imagery provider is ready.");return this._tileWidth},h.prototype.getTileHeight=function(){if(!this._ready)throw new n("getTileHeight must not be called before the imagery provider is ready.");return this._tileHeight},h.prototype.getMaximumLevel=function(){if(!this._ready)throw new n("getMaximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel},h.prototype.getTilingScheme=function(){if(!this._ready)throw new n("getTilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},h.prototype.getExtent=function(){if(!this._ready)throw new n("getExtent must not be called before the imagery provider is ready.");return this._tilingScheme.getExtent()},h.prototype.getTileDiscardPolicy=function(){if(!this._ready)throw new n("getTileDiscardPolicy must not be called before the imagery provider is ready.");
return this._tileDiscardPolicy},h.prototype.getErrorEvent=function(){return this._errorEvent},h.prototype.isReady=function(){return this._ready},h.prototype.requestImage=function(e,t,i){if(!this._ready)throw new n("requestImage must not be called before the imagery provider is ready.");var r=c(this,e,t,i);return s.loadImage(r)},h.prototype.getLogo=function(){if(!this._ready)throw new n("getLogo must not be called before the imagery provider is ready.");return this._logo},h.DefaultParameters=i({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),h}),i("Scene/sampleTerrain",["../Core/defaultValue","../Core/DeveloperError","./TerrainState","../ThirdParty/when"],function(e,t,i,r){function n(e){var t=e.positions,i=e.tilingScheme.tileXYToExtent(e.x,e.y,e.level);return function(e){for(var r=0;t.length>r;++r){var n=t[r];n.height=e.interpolateHeight(i,n.longitude,n.latitude)}}}function o(e){var t=e.positions;return function(){for(var e=0;t.length>e;++e){var i=t[e];i.height=void 0}}}var a=function(e,i,a){if(e===void 0)throw new t("terrainProvider is required.");if(i===void 0)throw new t("level is required.");if(a===void 0)throw new t("positions is required.");var s,l=e.getTilingScheme(),u=[],c={};for(s=0;a.length>s;++s){var h=l.positionToTileXY(a[s],i),d=""+h;if(!c.hasOwnProperty(d)){var m={x:h.x,y:h.y,level:i,tilingScheme:l,terrainProvider:e,positions:[]};c[d]=m,u.push(m)}c[d].positions.push(a[s])}var p=[];for(s=0;u.length>s;++s){var f=u[s],v=f.terrainProvider.requestTileGeometry(f.x,f.y,f.level,!1),g=r(v,n(f),o(f));p.push(g)}return r.all(p,function(){return a})};return a}),function(){function e(e){throw e}function r(e){return function(){return e}}function n(t){function i(e,t,i,r,o){var s=[];return e=R.j(function(){var e=t(i,o)||[];s.length>0&&(R.a.Ya(n(s),e),r&&R.r.K(r,a,[i,e,o])),s.splice(0,s.length),R.a.P(s,e)},a,{W:e,Ka:function(){return 0==s.length||!R.a.X(s[0])}}),{M:s,j:e.pa()?e:d}}function n(e){for(;e.length&&!R.a.X(e[0]);)e.splice(0,1);if(e.length>1){for(var t=e[0],i=e[e.length-1],r=[t];t!==i;){if(t=t.nextSibling,!t)return;r.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(r))}return e}function m(e,t,i,r,n){var o,a,s,l,u,c=Math.min,h=Math.max,d=[],m=e.length,p=t.length,f=p-m||1,v=m+p+1;for(o=0;m>=o;o++)for(l=s,d.push(s=[]),u=c(p,o+f),a=h(0,o-1);u>=a;a++)s[a]=a?o?e[o-1]===t[a-1]?l[a-1]:c(l[a]||v,s[a-1]||v)+1:a+1:o+1;for(c=[],h=[],f=[],o=m,a=p;o||a;)p=d[o][a]-1,a&&p===d[o][a-1]?h.push(c[c.length]={status:i,value:t[--a],index:a}):o&&p===d[o-1][a]?f.push(c[c.length]={status:r,value:e[--o],index:o}):(c.push({status:"retained",value:t[--a]}),--o);if(h.length&&f.length){e=10*m;var g;for(t=i=0;(n||e>t)&&(g=h[i]);i++){for(r=0;d=f[r];r++)if(g.value===d.value){g.moved=d.index,d.moved=g.index,f.splice(r,1),t=r=0;break}t+=r}}return c.reverse()}function p(t,i,r,n,l){l=l||{};var u=t&&f(t),u=u&&u.ownerDocument,c=l.templateEngine||X;switch(R.za.vb(r,c,u),r=c.renderTemplate(r,n,l,u),("number"!=typeof r.length||r.length>0&&"number"!=typeof r[0].nodeType)&&e(Error("Template engine must return an array of DOM nodes")),u=s,i){case"replaceChildren":R.e.N(t,r),u=o;break;case"replaceNode":R.a.Ya(t,r),u=o;break;case"ignoreTargetNode":break;default:e(Error("Unknown renderMode: "+i))}return u&&(v(r,n),l.afterRender&&R.r.K(l.afterRender,a,[r,n.$data])),r}function f(e){return e.nodeType?e:e.length>0?e[0]:a}function v(e,t){if(e.length){var i=e[0],r=e[e.length-1];g(i,r,function(e){R.Da(t,e)}),g(i,r,function(e){R.s.ib(e,[t])})}}function g(e,t,i){var r;for(t=R.e.nextSibling(t);e&&(r=e)!==t;)e=R.e.nextSibling(r),(1===r.nodeType||8===r.nodeType)&&i(r)}function _(t,i,r){t=R.g.aa(t);for(var n=R.g.Q,o=0;t.length>o;o++){var a=t[o].key;if(n.hasOwnProperty(a)){var s=n[a];"function"==typeof s?(a=s(t[o].value))&&e(Error(a)):s||e(Error("This template engine does not support the '"+a+"' binding within its templates"))}}return t="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+R.g.ba(t)+" } })()})",r.createJavaScriptEvaluatorBlock(t)+i}function y(t,i,r,n){function o(e){return function(){return l[e]}}function s(){return l}var l,u,c=0;return R.j(function(){var a=r&&r instanceof R.z?r:new R.z(R.a.d(r)),h=a.$data;if(n&&R.eb(t,a),l=("function"==typeof i?i(a,t):i)||R.J.instance.getBindings(t,a)){if(0===c){c=1;for(var m in l){var p=R.c[m];p&&8===t.nodeType&&!R.e.I[m]&&e(Error("The binding '"+m+"' cannot be used with virtual elements")),p&&"function"==typeof p.init&&(p=p.init(t,o(m),s,h,a))&&p.controlsDescendantBindings&&(u!==d&&e(Error("Multiple bindings ("+u+" and "+m+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")),u=m)}c=2}if(2===c)for(m in l)(p=R.c[m])&&"function"==typeof p.update&&p.update(t,o(m),s,h,a)}},a,{W:t}),{Nb:u===d}}function w(e,t,i){var r=o,n=1===t.nodeType;n&&R.e.Ta(t),(n&&i||R.J.instance.nodeHasBindings(t))&&(r=y(t,a,e,i).Nb),r&&C(e,t,!n)}function C(e,t,i){for(var r=R.e.firstChild(t);t=r;)r=R.e.nextSibling(t),w(e,t,i)}function x(e,t){var i=T(e,t);return i?i.length>0?i[i.length-1].nextSibling:e.nextSibling:a}function T(t,i){for(var r=t,n=1,o=[];r=r.nextSibling;){if(S(r)&&(n--,0===n))return o;o.push(r),E(r)&&n++}return i||e(Error("Cannot find closing comment tag to match: "+t.nodeValue)),a}function S(e){return 8==e.nodeType&&(q?e.text:e.nodeValue).match(k)}function E(e){return 8==e.nodeType&&(q?e.text:e.nodeValue).match(U)}function b(e,t){for(var i=a;e!=i;)i=e,e=e.replace(V,function(e,i){return t[i]});return e}function M(){var e=[],t=[];this.save=function(i,r){var n=R.a.i(e,i);n>=0?t[n]=r:(e.push(i),t.push(r))},this.get=function(i){return i=R.a.i(e,i),i>=0?t[i]:d}}function I(e,t,i){function r(r){var o=t(e[r]);switch(typeof o){case"boolean":case"number":case"string":case"function":n[r]=o;break;case"object":case"undefined":var a=i.get(o);n[r]=a!==d?a:I(o,t,i)}}if(i=i||new M,e=t(e),"object"!=typeof e||e===a||e===d||e instanceof Date)return e;var n=e instanceof Array?[]:{};i.save(e,n);var o=e;if(o instanceof Array){for(var s=0;o.length>s;s++)r(s);"function"==typeof o.toJSON&&r("toJSON")}else for(s in o)r(s);return n}function D(e,t){if(e)if(8==e.nodeType){var i=R.s.Ua(e.nodeValue);i!=a&&t.push({sb:e,Fb:i})}else if(1==e.nodeType)for(var i=0,r=e.childNodes,n=r.length;n>i;i++)D(r[i],t)}function A(e,t,i,r){R.c[e]={init:function(e){return R.a.f.set(e,j,{}),{controlsDescendantBindings:o}},update:function(e,n,a,s,l){a=R.a.f.get(e,j),n=R.a.d(n()),s=!i!=!n;var u=!a.Za;(u||t||s!==a.qb)&&(u&&(a.Za=R.a.Ia(R.e.childNodes(e),o)),s?(u||R.e.N(e,R.a.Ia(a.Za)),R.Ea(r?r(l,n):l,e)):R.e.Y(e),a.qb=s)}},R.g.Q[e]=s,R.e.I[e]=o}function P(e,t,i){i&&t!==R.k.q(e)&&R.k.T(e,t),t!==R.k.q(e)&&R.r.K(R.a.Ba,a,[e,"change"])}var R=t!==void 0?t:{};R.b=function(e,t){for(var i=e.split("."),r=R,n=0;i.length-1>n;n++)r=r[i[n]];r[i[i.length-1]]=t},R.p=function(e,t,i){e[t]=i},R.version="2.2.1",R.b("version",R.version),R.a=new function(){function t(e,t){if("input"!==R.a.u(e)||!e.type||"click"!=t.toLowerCase())return s;var i=e.type;return"checkbox"==i||"radio"==i}var i=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,r={},n={};r[/Firefox\/2/i.test(c.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],r.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");for(var m in r){var p=r[m];if(p.length)for(var f=0,v=p.length;v>f;f++)n[p[f]]=m}var g,_={propertychange:o},r=3;for(m=u.createElement("div"),p=m.getElementsByTagName("i");m.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->",p[0];);return g=r>4?r:d,{Na:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(e,t){for(var i=0,r=e.length;r>i;i++)t(e[i])},i:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var i=0,r=e.length;r>i;i++)if(e[i]===t)return i;return-1},lb:function(e,t,i){for(var r=0,n=e.length;n>r;r++)if(t.call(i,e[r]))return e[r];return a},ga:function(e,t){var i=R.a.i(e,t);i>=0&&e.splice(i,1)},Ga:function(e){e=e||[];for(var t=[],i=0,r=e.length;r>i;i++)0>R.a.i(t,e[i])&&t.push(e[i]);return t},V:function(e,t){e=e||[];for(var i=[],r=0,n=e.length;n>r;r++)i.push(t(e[r]));return i},fa:function(e,t){e=e||[];for(var i=[],r=0,n=e.length;n>r;r++)t(e[r])&&i.push(e[r]);return i},P:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var i=0,r=t.length;r>i;i++)e.push(t[i]);return e},extend:function(e,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},ka:function(e){for(;e.firstChild;)R.removeNode(e.firstChild)},Hb:function(e){e=R.a.L(e);for(var t=u.createElement("div"),i=0,r=e.length;r>i;i++)t.appendChild(R.A(e[i]));return t},Ia:function(e,t){for(var i=0,r=e.length,n=[];r>i;i++){var a=e[i].cloneNode(o);n.push(t?R.A(a):a)}return n},N:function(e,t){if(R.a.ka(e),t)for(var i=0,r=t.length;r>i;i++)e.appendChild(t[i])},Ya:function(e,t){var i=e.nodeType?[e]:e;if(i.length>0){for(var r=i[0],n=r.parentNode,o=0,a=t.length;a>o;o++)n.insertBefore(t[o],r);for(o=0,a=i.length;a>o;o++)R.removeNode(i[o])}},bb:function(e,t){7>g?e.setAttribute("selected",t):e.selected=t},D:function(e){return(e||"").replace(i,"")},Rb:function(e,t){for(var i=[],r=(e||"").split(t),n=0,o=r.length;o>n;n++){var a=R.a.D(r[n]);""!==a&&i.push(a)}return i},Ob:function(e,t){return e=e||"",t.length>e.length?s:e.substring(0,t.length)===t},tb:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e!=a;){if(e==t)return o;e=e.parentNode}return s},X:function(e){return R.a.tb(e,e.ownerDocument)},u:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},n:function(i,r,n){var a=g&&_[r];if(a||h===void 0)a||"function"!=typeof i.addEventListener?i.attachEvent!==void 0?i.attachEvent("on"+r,function(e){n.call(i,e)}):e(Error("Browser doesn't support addEventListener or attachEvent")):i.addEventListener(r,n,s);else{if(t(i,r)){var l=n;n=function(e,t){var i=this.checked;t&&(this.checked=t.nb!==o),l.call(this,e),this.checked=i}}h(i).bind(r,n)}},Ba:function(i,r){if((!i||!i.nodeType)&&e(Error("element must be a DOM node when calling triggerEvent")),h!==void 0){var a=[];t(i,r)&&a.push({nb:i.checked}),h(i).trigger(r,a)}else"function"==typeof u.createEvent?"function"==typeof i.dispatchEvent?(a=u.createEvent(n[r]||"HTMLEvents"),a.initEvent(r,o,o,l,0,0,0,0,0,s,s,s,s,0,i),i.dispatchEvent(a)):e(Error("The supplied element doesn't support dispatchEvent")):i.fireEvent!==void 0?(t(i,r)&&(i.checked=i.checked!==o),i.fireEvent("on"+r)):e(Error("Browser doesn't support triggering events"))},d:function(e){return R.$(e)?e():e},ua:function(e){return R.$(e)?e.t():e},da:function(e,t,i){if(t){var r=/[\w-]+/g,n=e.className.match(r)||[];R.a.o(t.match(r),function(e){var t=R.a.i(n,e);t>=0?i||n.splice(t,1):i&&n.push(e)}),e.className=n.join(" ")}},cb:function(e,t){var i=R.a.d(t);if((i===a||i===d)&&(i=""),3===e.nodeType)e.data=i;else{var r=R.e.firstChild(e);!r||3!=r.nodeType||R.e.nextSibling(r)?R.e.N(e,[u.createTextNode(i)]):r.data=i,R.a.wb(e)}},ab:function(e,t){if(e.name=t,7>=g)try{e.mergeAttributes(u.createElement("<input name='"+e.name+"'/>"),s)}catch(i){}},wb:function(e){g>=9&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},ub:function(e){if(g>=9){var t=e.style.width;e.style.width=0,e.style.width=t}},Lb:function(e,t){e=R.a.d(e),t=R.a.d(t);for(var i=[],r=e;t>=r;r++)i.push(r);return i},L:function(e){for(var t=[],i=0,r=e.length;r>i;i++)t.push(e[i]);return t},Pb:6===g,Qb:7===g,Z:g,Oa:function(e,t){for(var i=R.a.L(e.getElementsByTagName("input")).concat(R.a.L(e.getElementsByTagName("textarea"))),r="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},n=[],o=i.length-1;o>=0;o--)r(i[o])&&n.push(i[o]);return n},Ib:function(e){return"string"==typeof e&&(e=R.a.D(e))?l.JSON&&l.JSON.parse?l.JSON.parse(e):Function("return "+e)():a},xa:function(t,i,r){return("undefined"==typeof JSON||JSON.stringify===void 0)&&e(Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js")),JSON.stringify(R.a.d(t),i,r)},Jb:function(e,t,i){i=i||{};var r=i.params||{},n=i.includeFields||this.Na,o=e;if("object"==typeof e&&"form"===R.a.u(e))for(var o=e.action,a=n.length-1;a>=0;a--)for(var s=R.a.Oa(e,n[a]),l=s.length-1;l>=0;l--)r[s[l].name]=s[l].value;t=R.a.d(t);var c=u.createElement("form");c.style.display="none",c.action=o,c.method="post";for(var h in t)e=u.createElement("input"),e.name=h,e.value=R.a.xa(R.a.d(t[h])),c.appendChild(e);for(h in r)e=u.createElement("input"),e.name=h,e.value=r[h],c.appendChild(e);u.body.appendChild(c),i.submitter?i.submitter(c):c.submit(),setTimeout(function(){c.parentNode.removeChild(c)},0)}}},R.b("utils",R.a),R.b("utils.arrayForEach",R.a.o),R.b("utils.arrayFirst",R.a.lb),R.b("utils.arrayFilter",R.a.fa),R.b("utils.arrayGetDistinctValues",R.a.Ga),R.b("utils.arrayIndexOf",R.a.i),R.b("utils.arrayMap",R.a.V),R.b("utils.arrayPushAll",R.a.P),R.b("utils.arrayRemoveItem",R.a.ga),R.b("utils.extend",R.a.extend),R.b("utils.fieldsIncludedWithJsonPost",R.a.Na),R.b("utils.getFormFields",R.a.Oa),R.b("utils.peekObservable",R.a.ua),R.b("utils.postJson",R.a.Jb),R.b("utils.parseJson",R.a.Ib),R.b("utils.registerEventHandler",R.a.n),R.b("utils.stringifyJson",R.a.xa),R.b("utils.range",R.a.Lb),R.b("utils.toggleDomNodeCssClass",R.a.da),R.b("utils.triggerEvent",R.a.Ba),R.b("utils.unwrapObservable",R.a.d),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,i=Array.prototype.slice.call(arguments);return e=i.shift(),function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}}),R.a.f=new function(){var e=0,t="__ko__"+(new Date).getTime(),i={};return{get:function(e,t){var i=R.a.f.la(e,s);return i===d?d:i[t]},set:function(e,t,i){i===d&&R.a.f.la(e,s)===d||(R.a.f.la(e,o)[t]=i)},la:function(r,n){var o=r[t];if(!o||"null"===o||!i[o]){if(!n)return d;o=r[t]="ko"+e++,i[o]={}}return i[o]},clear:function(e){var r=e[t];return r?(delete i[r],e[t]=a,o):s}}},R.b("utils.domData",R.a.f),R.b("utils.domData.clear",R.a.f.clear),R.a.F=new function(){function t(e,t){var i=R.a.f.get(e,r);return i===d&&t&&(i=[],R.a.f.set(e,r,i)),i}function i(e){var r=t(e,s);if(r)for(var r=r.slice(0),n=0;r.length>n;n++)r[n](e);if(R.a.f.clear(e),"function"==typeof h&&"function"==typeof h.cleanData&&h.cleanData([e]),a[e.nodeType])for(r=e.firstChild;e=r;)r=e.nextSibling,8===e.nodeType&&i(e)}var r="__ko_domNodeDisposal__"+(new Date).getTime(),n={1:o,8:o,9:o},a={1:o,9:o};return{Ca:function(i,r){"function"!=typeof r&&e(Error("Callback must be a function")),t(i,o).push(r)},Xa:function(e,i){var n=t(e,s);n&&(R.a.ga(n,i),0==n.length&&R.a.f.set(e,r,d))},A:function(e){if(n[e.nodeType]&&(i(e),a[e.nodeType])){var t=[];R.a.P(t,e.getElementsByTagName("*"));for(var r=0,o=t.length;o>r;r++)i(t[r])}return e},removeNode:function(e){R.A(e),e.parentNode&&e.parentNode.removeChild(e)}}},R.A=R.a.F.A,R.removeNode=R.a.F.removeNode,R.b("cleanNode",R.A),R.b("removeNode",R.removeNode),R.b("utils.domNodeDisposal",R.a.F),R.b("utils.domNodeDisposal.addDisposeCallback",R.a.F.Ca),R.b("utils.domNodeDisposal.removeDisposeCallback",R.a.F.Xa),R.a.ta=function(e){var t;if(h!==void 0){if(h.parseHTML)t=h.parseHTML(e);else if((t=h.clean([e]))&&t[0]){for(e=t[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var i=R.a.D(e).toLowerCase();for(t=u.createElement("div"),i=i.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!i.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!i.indexOf("<td")||!i.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],e="ignored<div>"+i[1]+e+i[2]+"</div>","function"==typeof l.innerShiv?t.appendChild(l.innerShiv(e)):t.innerHTML=e;i[0]--;)t=t.lastChild;t=R.a.L(t.lastChild.childNodes)}return t},R.a.ca=function(e,t){if(R.a.ka(e),t=R.a.d(t),t!==a&&t!==d)if("string"!=typeof t&&(t=""+t),h!==void 0)h(e).html(t);else for(var i=R.a.ta(t),r=0;i.length>r;r++)e.appendChild(i[r])},R.b("utils.parseHtmlFragment",R.a.ta),R.b("utils.setHtml",R.a.ca);var O={};R.s={ra:function(t){"function"!=typeof t&&e(Error("You can only pass a function to ko.memoization.memoize()"));var i=(0|4294967296*(1+Math.random())).toString(16).substring(1)+(0|4294967296*(1+Math.random())).toString(16).substring(1);return O[i]=t,"<!--[ko_memo:"+i+"]-->"},hb:function(t,i){var r=O[t];r===d&&e(Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized."));try{return r.apply(a,i||[]),o}finally{delete O[t]}},ib:function(e,t){var i=[];D(e,i);for(var r=0,n=i.length;n>r;r++){var o=i[r].sb,a=[o];t&&R.a.P(a,t),R.s.hb(i[r].Fb,a),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},Ua:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:a}},R.b("memoization",R.s),R.b("memoization.memoize",R.s.ra),R.b("memoization.unmemoize",R.s.hb),R.b("memoization.parseMemoText",R.s.Ua),R.b("memoization.unmemoizeDomNodeAndDescendants",R.s.ib),R.Ma={throttle:function(e,t){e.throttleEvaluation=t;var i=a;return R.j({read:e,write:function(r){clearTimeout(i),i=setTimeout(function(){e(r)},t)}})},notify:function(e,t){return e.equalityComparer="always"==t?r(s):R.m.fn.equalityComparer,e}},R.b("extenders",R.Ma),R.fb=function(e,t,i){this.target=e,this.ha=t,this.rb=i,R.p(this,"dispose",this.B)},R.fb.prototype.B=function(){this.Cb=o,this.rb()},R.S=function(){this.w={},R.a.extend(this,R.S.fn),R.p(this,"subscribe",this.ya),R.p(this,"extend",this.extend),R.p(this,"getSubscriptionsCount",this.yb)},R.S.fn={ya:function(e,t,i){i=i||"change";var r=new R.fb(this,t?e.bind(t):e,function(){R.a.ga(this.w[i],r)}.bind(this));return this.w[i]||(this.w[i]=[]),this.w[i].push(r),r},notifySubscribers:function(e,t){t=t||"change",this.w[t]&&R.r.K(function(){R.a.o(this.w[t].slice(0),function(t){t&&t.Cb!==o&&t.ha(e)})},this)},yb:function(){var e,t=0;for(e in this.w)this.w.hasOwnProperty(e)&&(t+=this.w[e].length);return t},extend:function(e){var t=this;if(e)for(var i in e){var r=R.Ma[i];"function"==typeof r&&(t=r(t,e[i]))}return t}},R.Qa=function(e){return"function"==typeof e.ya&&"function"==typeof e.notifySubscribers},R.b("subscribable",R.S),R.b("isSubscribable",R.Qa);var z=[];R.r={mb:function(e){z.push({ha:e,La:[]})},end:function(){z.pop()},Wa:function(t){if(R.Qa(t)||e(Error("Only subscribable things can act as dependencies")),z.length>0){var i=z[z.length-1];i&&!(R.a.i(i.La,t)>=0)&&(i.La.push(t),i.ha(t))}},K:function(e,t,i){try{return z.push(a),e.apply(t,i||[])}finally{z.pop()}}};var L={undefined:o,"boolean":o,number:o,string:o};R.m=function(e){function t(){return arguments.length>0?(t.equalityComparer&&t.equalityComparer(i,arguments[0])||(t.H(),i=arguments[0],t.G()),this):(R.r.Wa(t),i)}var i=e;return R.S.call(t),t.t=function(){return i},t.G=function(){t.notifySubscribers(i)},t.H=function(){t.notifySubscribers(i,"beforeChange")},R.a.extend(t,R.m.fn),R.p(t,"peek",t.t),R.p(t,"valueHasMutated",t.G),R.p(t,"valueWillMutate",t.H),t},R.m.fn={equalityComparer:function(e,t){return e===a||typeof e in L?e===t:s}};var N=R.m.Kb="__ko_proto__";R.m.fn[N]=R.m,R.ma=function(e,t){return e===a||e===d||e[N]===d?s:e[N]===t?o:R.ma(e[N],t)},R.$=function(e){return R.ma(e,R.m)},R.Ra=function(e){return"function"==typeof e&&e[N]===R.m||"function"==typeof e&&e[N]===R.j&&e.zb?o:s},R.b("observable",R.m),R.b("isObservable",R.$),R.b("isWriteableObservable",R.Ra),R.R=function(t){0==arguments.length&&(t=[]),t!==a&&t!==d&&!("length"in t)&&e(Error("The argument passed when initializing an observable array must be an array, or null, or undefined."));var i=R.m(t);return R.a.extend(i,R.R.fn),i},R.R.fn={remove:function(e){for(var t=this.t(),i=[],r="function"==typeof e?e:function(t){return t===e},n=0;t.length>n;n++){var o=t[n];r(o)&&(0===i.length&&this.H(),i.push(o),t.splice(n,1),n--)}return i.length&&this.G(),i},removeAll:function(e){if(e===d){var t=this.t(),i=t.slice(0);return this.H(),t.splice(0,t.length),this.G(),i}return e?this.remove(function(t){return R.a.i(e,t)>=0}):[]},destroy:function(e){var t=this.t(),i="function"==typeof e?e:function(t){return t===e};this.H();for(var r=t.length-1;r>=0;r--)i(t[r])&&(t[r]._destroy=o);this.G()},destroyAll:function(e){return e===d?this.destroy(r(o)):e?this.destroy(function(t){return R.a.i(e,t)>=0}):[]},indexOf:function(e){var t=this();return R.a.i(t,e)},replace:function(e,t){var i=this.indexOf(e);i>=0&&(this.H(),this.t()[i]=t,this.G())}},R.a.o("pop push reverse shift sort splice unshift".split(" "),function(e){R.R.fn[e]=function(){var t=this.t();return this.H(),t=t[e].apply(t,arguments),this.G(),t}}),R.a.o(["slice"],function(e){R.R.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),R.b("observableArray",R.R),R.j=function(t,i,n){function l(){R.a.o(x,function(e){e.B()}),x=[]}function u(){var e=h.throttleEvaluation;e&&e>=0?(clearTimeout(T),T=setTimeout(c,e)):c()}function c(){if(!v)if(f&&w())C();else{v=o;try{var e=R.a.V(x,function(e){return e.target});R.r.mb(function(t){var i;(i=R.a.i(e,t))>=0?e[i]=d:x.push(t.ya(u))});for(var t=g.call(i),r=e.length-1;r>=0;r--)e[r]&&x.splice(r,1)[0].B();f=o,h.notifySubscribers(p,"beforeChange"),p=t}finally{R.r.end()}h.notifySubscribers(p),v=s,x.length||C()}}function h(){return arguments.length>0?("function"==typeof _?_.apply(i,arguments):e(Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")),this):(f||c(),R.r.Wa(h),p)}function m(){return!f||x.length>0}var p,f=s,v=s,g=t;g&&"object"==typeof g?(n=g,g=n.read):(n=n||{},g||(g=n.read)),"function"!=typeof g&&e(Error("Pass a function that returns the value of the ko.computed"));var _=n.write,y=n.disposeWhenNodeIsRemoved||n.W||a,w=n.disposeWhen||n.Ka||r(s),C=l,x=[],T=a;if(i||(i=n.owner),h.t=function(){return f||c(),p},h.xb=function(){return x.length},h.zb="function"==typeof n.write,h.B=function(){C()},h.pa=m,R.S.call(h),R.a.extend(h,R.j.fn),R.p(h,"peek",h.t),R.p(h,"dispose",h.B),R.p(h,"isActive",h.pa),R.p(h,"getDependenciesCount",h.xb),n.deferEvaluation!==o&&c(),y&&m()){C=function(){R.a.F.Xa(y,arguments.callee),l()},R.a.F.Ca(y,C);var S=w,w=function(){return!R.a.X(y)||S()}}return h},R.Bb=function(e){return R.ma(e,R.j)},t=R.m.Kb,R.j[t]=R.m,R.j.fn={},R.j.fn[t]=R.j,R.b("dependentObservable",R.j),R.b("computed",R.j),R.b("isComputed",R.Bb),R.gb=function(t){return 0==arguments.length&&e(Error("When calling ko.toJS, pass the object you want to convert.")),I(t,function(e){for(var t=0;R.$(e)&&10>t;t++)e=e();return e})},R.toJSON=function(e,t,i){return e=R.gb(e),R.a.xa(e,t,i)},R.b("toJS",R.gb),R.b("toJSON",R.toJSON),R.k={q:function(e){switch(R.a.u(e)){case"option":return e.__ko__hasDomDataOptionValue__===o?R.a.f.get(e,R.c.options.sa):7>=R.a.Z?e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return e.selectedIndex>=0?R.k.q(e.options[e.selectedIndex]):d;default:return e.value}},T:function(e,t){switch(R.a.u(e)){case"option":switch(typeof t){case"string":R.a.f.set(e,R.c.options.sa,d),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=t;break;default:R.a.f.set(e,R.c.options.sa,t),e.__ko__hasDomDataOptionValue__=o,e.value="number"==typeof t?t:""}break;case"select":for(var i=e.options.length-1;i>=0;i--)if(R.k.q(e.options[i])==t){e.selectedIndex=i;break}break;default:(t===a||t===d)&&(t=""),e.value=t}}},R.b("selectExtensions",R.k),R.b("selectExtensions.readValue",R.k.q),R.b("selectExtensions.writeValue",R.k.T);var V=/\@ko_token_(\d+)\@/g,B=["true","false"],F=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;R.g={Q:[],aa:function(e){var t=R.a.D(e);if(3>t.length)return[];"{"===t.charAt(0)&&(t=t.substring(1,t.length-1)),e=[];for(var i,r=a,n=0;t.length>n;n++){var o=t.charAt(n);if(r===a)switch(o){case'"':case"'":case"/":r=n,i=o}else if(o==i&&"\\"!==t.charAt(n-1)){o=t.substring(r,n+1),e.push(o);var s="@ko_token_"+(e.length-1)+"@",t=t.substring(0,r)+s+t.substring(n+1),n=n-(o.length-s.length),r=a}}i=r=a;for(var l=0,u=a,n=0;t.length>n;n++){if(o=t.charAt(n),r===a)switch(o){case"{":r=n,u=o,i="}";break;case"(":r=n,u=o,i=")";break;case"[":r=n,u=o,i="]"}o===u?l++:o===i&&(l--,0===l&&(o=t.substring(r,n+1),e.push(o),s="@ko_token_"+(e.length-1)+"@",t=t.substring(0,r)+s+t.substring(n+1),n-=o.length-s.length,r=a))}for(i=[],t=t.split(","),r=0,n=t.length;n>r;r++)l=t[r],u=l.indexOf(":"),u>0&&l.length-1>u?(o=l.substring(u+1),i.push({key:b(l.substring(0,u),e),value:b(o,e)})):i.push({unknown:b(l,e)});return i},ba:function(e){var t="string"==typeof e?R.g.aa(e):e,i=[];e=[];for(var r,n=0;r=t[n];n++)if(i.length>0&&i.push(","),r.key){var o;e:{o=r.key;var l=R.a.D(o);switch(l.length&&l.charAt(0)){case"'":case'"':break e;default:o="'"+l+"'"}}r=r.value,i.push(o),i.push(":"),i.push(r),r=R.a.D(r),R.a.i(B,R.a.D(r).toLowerCase())>=0?r=s:(l=r.match(F),r=l===a?s:l[1]?"Object("+l[1]+")"+l[2]:r),r&&(e.length>0&&e.push(", "),e.push(o+" : function(__ko_value) { "+r+" = __ko_value; }"))}else r.unknown&&i.push(r.unknown);return t=i.join(""),e.length>0&&(t=t+", '_ko_property_writers' : { "+e.join("")+" } "),t},Eb:function(e,t){for(var i=0;e.length>i;i++)if(R.a.D(e[i].key)==t)return o;return s},ea:function(e,t,i,r,n){e&&R.Ra(e)?(!n||e.t()!==r)&&e(r):(e=t()._ko_property_writers)&&e[i]&&e[i](r)}},R.b("expressionRewriting",R.g),R.b("expressionRewriting.bindingRewriteValidators",R.g.Q),R.b("expressionRewriting.parseObjectLiteral",R.g.aa),R.b("expressionRewriting.preProcessBindings",R.g.ba),R.b("jsonExpressionRewriting",R.g),R.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",R.g.ba);var q="<!--test-->"===u.createComment("test").text,U=q?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,k=q?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,W={ul:o,ol:o};R.e={I:{},childNodes:function(e){return E(e)?T(e):e.childNodes},Y:function(e){if(E(e)){e=R.e.childNodes(e);for(var t=0,i=e.length;i>t;t++)R.removeNode(e[t])}else R.a.ka(e)},N:function(e,t){if(E(e)){R.e.Y(e);for(var i=e.nextSibling,r=0,n=t.length;n>r;r++)i.parentNode.insertBefore(t[r],i)}else R.a.N(e,t)},Va:function(e,t){E(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},Pa:function(e,t,i){i?E(e)?e.parentNode.insertBefore(t,i.nextSibling):i.nextSibling?e.insertBefore(t,i.nextSibling):e.appendChild(t):R.e.Va(e,t)},firstChild:function(e){return E(e)?!e.nextSibling||S(e.nextSibling)?a:e.nextSibling:e.firstChild},nextSibling:function(e){return E(e)&&(e=x(e)),e.nextSibling&&S(e.nextSibling)?a:e.nextSibling},jb:function(e){return(e=E(e))?e[1]:a},Ta:function(e){if(W[R.a.u(e)]){var t=e.firstChild;if(t)do if(1===t.nodeType){var i;i=t.firstChild;var r=a;if(i)do if(r)r.push(i);else if(E(i)){var n=x(i,o);n?i=n:r=[i]}else S(i)&&(r=[i]);while(i=i.nextSibling);if(i=r)for(r=t.nextSibling,n=0;i.length>n;n++)r?e.insertBefore(i[n],r):e.appendChild(i[n])}while(t=t.nextSibling)}}},R.b("virtualElements",R.e),R.b("virtualElements.allowedBindings",R.e.I),R.b("virtualElements.emptyNode",R.e.Y),R.b("virtualElements.insertAfter",R.e.Pa),R.b("virtualElements.prepend",R.e.Va),R.b("virtualElements.setDomNodeChildren",R.e.N),R.J=function(){this.Ha={}},R.a.extend(R.J.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind")!=a;case 8:return R.e.jb(e)!=a;default:return s}},getBindings:function(e,t){var i=this.getBindingsString(e,t);return i?this.parseBindingsString(i,t,e):a},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return R.e.jb(e);default:return a}},parseBindingsString:function(t,i,r){try{var n;if(!(n=this.Ha[t])){var o,a=this.Ha,s="with($context){with($data||{}){return{"+R.g.ba(t)+"}}}";o=Function("$context","$element",s),n=a[t]=o}return n(i,r)}catch(l){e(Error("Unable to parse bindings.\nMessage: "+l+";\nBindings value: "+t))}}}),R.J.instance=new R.J,R.b("bindingProvider",R.J),R.c={},R.z=function(e,t,i){t?(R.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=R),this.$data=e,i&&(this[i]=e)},R.z.prototype.createChildContext=function(e,t){return new R.z(e,this,t)},R.z.prototype.extend=function(e){var t=R.a.extend(new R.z,this);return R.a.extend(t,e)},R.eb=function(e,t){return 2!=arguments.length?R.a.f.get(e,"__ko_bindingContext__"):(R.a.f.set(e,"__ko_bindingContext__",t),void 0)},R.Fa=function(e,t,i){return 1===e.nodeType&&R.e.Ta(e),y(e,t,i,o)},R.Ea=function(e,t){(1===t.nodeType||8===t.nodeType)&&C(e,t,o)},R.Da=function(t,i){i&&1!==i.nodeType&&8!==i.nodeType&&e(Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node")),i=i||l.document.body,w(t,i,o)},R.ja=function(e){switch(e.nodeType){case 1:case 8:var t=R.eb(e);if(t)return t;if(e.parentNode)return R.ja(e.parentNode)}return d},R.pb=function(e){return(e=R.ja(e))?e.$data:d},R.b("bindingHandlers",R.c),R.b("applyBindings",R.Da),R.b("applyBindingsToDescendants",R.Ea),R.b("applyBindingsToNode",R.Fa),R.b("contextFor",R.ja),R.b("dataFor",R.pb);var H={"class":"className","for":"htmlFor"};R.c.attr={update:function(e,t){var i,r=R.a.d(t())||{};for(i in r)if("string"==typeof i){var n=R.a.d(r[i]),o=n===s||n===a||n===d;o&&e.removeAttribute(i),8>=R.a.Z&&i in H?(i=H[i],o?e.removeAttribute(i):e[i]=n):o||e.setAttribute(i,""+n),"name"===i&&R.a.ab(e,o?"":""+n)}}},R.c.checked={init:function(e,t,i){R.a.n(e,"click",function(){var r;if("checkbox"==e.type)r=e.checked;else{if("radio"!=e.type||!e.checked)return;r=e.value}var n=t(),a=R.a.d(n);"checkbox"==e.type&&a instanceof Array?(r=R.a.i(a,e.value),e.checked&&0>r?n.push(e.value):!e.checked&&r>=0&&n.splice(r,1)):R.g.ea(n,i,"checked",r,o)}),"radio"==e.type&&!e.name&&R.c.uniqueName.init(e,r(o))},update:function(e,t){var i=R.a.d(t());"checkbox"==e.type?e.checked=i instanceof Array?R.a.i(i,e.value)>=0:i:"radio"==e.type&&(e.checked=e.value==i)}},R.c.css={update:function(e,t){var i=R.a.d(t());if("object"==typeof i)for(var r in i){var n=R.a.d(i[r]);R.a.da(e,r,n)}else i=(i||"")+"",R.a.da(e,e.__ko__cssValue,s),e.__ko__cssValue=i,R.a.da(e,i,o)}},R.c.enable={update:function(e,t){var i=R.a.d(t());i&&e.disabled?e.removeAttribute("disabled"):!i&&!e.disabled&&(e.disabled=o)}},R.c.disable={update:function(e,t){R.c.enable.update(e,function(){return!R.a.d(t())})}},R.c.event={init:function(e,t,i,r){var n,a=t()||{};for(n in a)(function(){var a=n;"string"==typeof a&&R.a.n(e,a,function(e){var n,l=t()[a];if(l){var u=i();try{var c=R.a.L(arguments);c.unshift(r),n=l.apply(r,c)}finally{n!==o&&(e.preventDefault?e.preventDefault():e.returnValue=s)}u[a+"Bubble"]===s&&(e.cancelBubble=o,e.stopPropagation&&e.stopPropagation())}})})()}},R.c.foreach={Sa:function(e){return function(){var t=e(),i=R.a.ua(t);return i&&"number"!=typeof i.length?(R.a.d(t),{foreach:i.data,as:i.as,includeDestroyed:i.includeDestroyed,afterAdd:i.afterAdd,beforeRemove:i.beforeRemove,afterRender:i.afterRender,beforeMove:i.beforeMove,afterMove:i.afterMove,templateEngine:R.C.oa}):{foreach:t,templateEngine:R.C.oa}}},init:function(e,t){return R.c.template.init(e,R.c.foreach.Sa(t))},update:function(e,t,i,r,n){return R.c.template.update(e,R.c.foreach.Sa(t),i,r,n)}},R.g.Q.foreach=s,R.e.I.foreach=o,R.c.hasfocus={init:function(e,t,i){function r(r){e.__ko_hasfocusUpdating=o;var n=e.ownerDocument;"activeElement"in n&&(r=n.activeElement===e),n=t(),R.g.ea(n,i,"hasfocus",r,o),e.__ko_hasfocusUpdating=s}var n=r.bind(a,o),l=r.bind(a,s);R.a.n(e,"focus",n),R.a.n(e,"focusin",n),R.a.n(e,"blur",l),R.a.n(e,"focusout",l)},update:function(e,t){var i=R.a.d(t());e.__ko_hasfocusUpdating||(i?e.focus():e.blur(),R.r.K(R.a.Ba,a,[e,i?"focusin":"focusout"]))}},R.c.html={init:function(){return{controlsDescendantBindings:o}},update:function(e,t){R.a.ca(e,t())}};var j="__ko_withIfBindingData";A("if"),A("ifnot",s,o),A("with",o,s,function(e,t){return e.createChildContext(t)}),R.c.options={update:function(t,i,r){"select"!==R.a.u(t)&&e(Error("options binding applies only to SELECT elements"));for(var n=0==t.length,a=R.a.V(R.a.fa(t.childNodes,function(e){return e.tagName&&"option"===R.a.u(e)&&e.selected
}),function(e){return R.k.q(e)||e.innerText||e.textContent}),s=t.scrollTop,l=R.a.d(i());t.length>0;)R.A(t.options[0]),t.remove(0);if(l){r=r();var c=r.optionsIncludeDestroyed;if("number"!=typeof l.length&&(l=[l]),r.optionsCaption){var h=u.createElement("option");R.a.ca(h,r.optionsCaption),R.k.T(h,d),t.appendChild(h)}i=0;for(var m=l.length;m>i;i++){var p=l[i];if(!p||!p._destroy||c){var h=u.createElement("option"),f=function(e,t,i){var r=typeof t;return"function"==r?t(e):"string"==r?e[t]:i},v=f(p,r.optionsValue,p);R.k.T(h,R.a.d(v)),p=f(p,r.optionsText,v),R.a.cb(h,p),t.appendChild(h)}}for(l=t.getElementsByTagName("option"),i=c=0,m=l.length;m>i;i++)R.a.i(a,R.k.q(l[i]))>=0&&(R.a.bb(l[i],o),c++);t.scrollTop=s,n&&"value"in r&&P(t,R.a.ua(r.value),o),R.a.ub(t)}}},R.c.options.sa="__ko.optionValueDomData__",R.c.selectedOptions={init:function(e,t,i){R.a.n(e,"change",function(){var r=t(),n=[];R.a.o(e.getElementsByTagName("option"),function(e){e.selected&&n.push(R.k.q(e))}),R.g.ea(r,i,"value",n)})},update:function(t,i){"select"!=R.a.u(t)&&e(Error("values binding applies only to SELECT elements"));var r=R.a.d(i());r&&"number"==typeof r.length&&R.a.o(t.getElementsByTagName("option"),function(e){var t=R.a.i(r,R.k.q(e))>=0;R.a.bb(e,t)})}},R.c.style={update:function(e,t){var i,r=R.a.d(t()||{});for(i in r)if("string"==typeof i){var n=R.a.d(r[i]);e.style[i]=n||""}}},R.c.submit={init:function(t,i,r,n){"function"!=typeof i()&&e(Error("The value for a submit binding must be a function")),R.a.n(t,"submit",function(e){var r,a=i();try{r=a.call(n,t)}finally{r!==o&&(e.preventDefault?e.preventDefault():e.returnValue=s)}})}},R.c.text={update:function(e,t){R.a.cb(e,t())}},R.e.I.text=o,R.c.uniqueName={init:function(e,t){if(t()){var i="ko_unique_"+ ++R.c.uniqueName.ob;R.a.ab(e,i)}}},R.c.uniqueName.ob=0,R.c.value={init:function(e,t,i){function r(){l=s;var r=t(),n=R.k.q(e);R.g.ea(r,i,"value",n)}var n=["change"],a=i().valueUpdate,l=s;a&&("string"==typeof a&&(a=[a]),R.a.P(n,a),n=R.a.Ga(n)),!R.a.Z||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=R.a.i(n,"propertychange")||(R.a.n(e,"propertychange",function(){l=o}),R.a.n(e,"blur",function(){l&&r()})),R.a.o(n,function(t){var i=r;R.a.Ob(t,"after")&&(i=function(){setTimeout(r,0)},t=t.substring(5)),R.a.n(e,t,i)})},update:function(e,t){var i="select"===R.a.u(e),r=R.a.d(t()),n=R.k.q(e),a=r!=n;0===r&&0!==n&&"0"!==n&&(a=o),a&&(n=function(){R.k.T(e,r)},n(),i&&setTimeout(n,0)),i&&e.length>0&&P(e,r,s)}},R.c.visible={update:function(e,t){var i=R.a.d(t()),r="none"!=e.style.display;i&&!r?e.style.display="":!i&&r&&(e.style.display="none")}},R.c.click={init:function(e,t,i,r){return R.c.event.init.call(this,e,function(){var e={};return e.click=t(),e},i,r)}},R.v=function(){},R.v.prototype.renderTemplateSource=function(){e(Error("Override renderTemplateSource"))},R.v.prototype.createJavaScriptEvaluatorBlock=function(){e(Error("Override createJavaScriptEvaluatorBlock"))},R.v.prototype.makeTemplateSource=function(t,i){if("string"==typeof t){i=i||u;var r=i.getElementById(t);return r||e(Error("Cannot find template with ID "+t)),new R.l.h(r)}return 1==t.nodeType||8==t.nodeType?new R.l.O(t):(e(Error("Unknown template type: "+t)),void 0)},R.v.prototype.renderTemplate=function(e,t,i,r){return e=this.makeTemplateSource(e,r),this.renderTemplateSource(e,t,i)},R.v.prototype.isTemplateRewritten=function(e,t){return this.allowTemplateRewriting===s?o:this.makeTemplateSource(e,t).data("isRewritten")},R.v.prototype.rewriteTemplate=function(e,t,i){e=this.makeTemplateSource(e,i),t=t(e.text()),e.text(t),e.data("isRewritten",o)},R.b("templateEngine",R.v);var G=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,Y=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;R.za={vb:function(e,t,i){t.isTemplateRewritten(e,i)||t.rewriteTemplate(e,function(e){return R.za.Gb(e,t)},i)},Gb:function(e,t){return e.replace(G,function(e,i,r,n,o,a,s){return _(s,i,t)}).replace(Y,function(e,i){return _(i,"<!-- ko -->",t)})},kb:function(e){return R.s.ra(function(t,i){t.nextSibling&&R.Fa(t.nextSibling,e,i)})}},R.b("__tr_ambtns",R.za.kb),R.l={},R.l.h=function(e){this.h=e},R.l.h.prototype.text=function(){var e=R.a.u(this.h),e="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.h[e];var t=arguments[0];"innerHTML"===e?R.a.ca(this.h,t):this.h[e]=t},R.l.h.prototype.data=function(e){return 1===arguments.length?R.a.f.get(this.h,"templateSourceData_"+e):(R.a.f.set(this.h,"templateSourceData_"+e,arguments[1]),void 0)},R.l.O=function(e){this.h=e},R.l.O.prototype=new R.l.h,R.l.O.prototype.text=function(){if(0==arguments.length){var e=R.a.f.get(this.h,"__ko_anon_template__")||{};return e.Aa===d&&e.ia&&(e.Aa=e.ia.innerHTML),e.Aa}R.a.f.set(this.h,"__ko_anon_template__",{Aa:arguments[0]})},R.l.h.prototype.nodes=function(){return 0==arguments.length?(R.a.f.get(this.h,"__ko_anon_template__")||{}).ia:(R.a.f.set(this.h,"__ko_anon_template__",{ia:arguments[0]}),void 0)},R.b("templateSources",R.l),R.b("templateSources.domElement",R.l.h),R.b("templateSources.anonymousTemplate",R.l.O);var X;R.wa=function(t){t!=d&&!(t instanceof R.v)&&e(Error("templateEngine must inherit from ko.templateEngine")),X=t},R.va=function(t,i,r,n,o){if(r=r||{},(r.templateEngine||X)==d&&e(Error("Set a template engine before calling renderTemplate")),o=o||"replaceChildren",n){var s=f(n);return R.j(function(){var e=i&&i instanceof R.z?i:new R.z(R.a.d(i)),a="function"==typeof t?t(e.$data,e):t,e=p(n,o,a,e,r);"replaceNode"==o&&(n=e,s=f(n))},a,{Ka:function(){return!s||!R.a.X(s)},W:s&&"replaceNode"==o?s.parentNode:s})}return R.s.ra(function(e){R.va(t,i,r,e,"replaceNode")})},R.Mb=function(e,t,i,r,n){function o(e,t){v(t,l),i.afterRender&&i.afterRender(t,e)}function s(t,r){l=n.createChildContext(R.a.d(t),i.as),l.$index=r;var o="function"==typeof e?e(t,l):e;return p(a,"ignoreTargetNode",o,l,i)}var l;return R.j(function(){var e=R.a.d(t)||[];e.length===void 0&&(e=[e]),e=R.a.fa(e,function(e){return i.includeDestroyed||e===d||e===a||!R.a.d(e._destroy)}),R.r.K(R.a.$a,a,[r,e,s,i,o])},a,{W:r})},R.c.template={init:function(e,t){var i=R.a.d(t());return"string"==typeof i||i.name||1!=e.nodeType&&8!=e.nodeType||(i=1==e.nodeType?e.childNodes:R.e.childNodes(e),i=R.a.Hb(i),new R.l.O(e).nodes(i)),{controlsDescendantBindings:o}},update:function(e,t,i,r,n){t=R.a.d(t()),i={},r=o;var s,l=a;"string"!=typeof t&&(i=t,t=i.name,"if"in i&&(r=R.a.d(i["if"])),r&&"ifnot"in i&&(r=!R.a.d(i.ifnot)),s=R.a.d(i.data)),"foreach"in i?l=R.Mb(t||e,r&&i.foreach||[],i,e,n):r?(n="data"in i?n.createChildContext(s,i.as):n,l=R.va(t||e,n,i,e)):R.e.Y(e),n=l,(s=R.a.f.get(e,"__ko__templateComputedDomDataKey__"))&&"function"==typeof s.B&&s.B(),R.a.f.set(e,"__ko__templateComputedDomDataKey__",n&&n.pa()?n:d)}},R.g.Q.template=function(e){return e=R.g.aa(e),1==e.length&&e[0].unknown||R.g.Eb(e,"name")?a:"This template engine does not support anonymous templates nested within its templates"},R.e.I.template=o,R.b("setTemplateEngine",R.wa),R.b("renderTemplate",R.va),R.a.Ja=function(e,t,i){return e=e||[],t=t||[],t.length>=e.length?m(e,t,"added","deleted",i):m(t,e,"deleted","added",i)},R.b("utils.compareArrays",R.a.Ja),R.a.$a=function(e,t,r,a,s){function l(e,t){w=h[t],g!==t&&(T[e]=w),w.na(g++),n(w.M),f.push(w),y.push(w)}function u(e,t){if(e)for(var i=0,r=t.length;r>i;i++)t[i]&&R.a.o(t[i].M,function(r){e(r,i,t[i].U)})}t=t||[],a=a||{};var c=R.a.f.get(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===d,h=R.a.f.get(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],m=R.a.V(h,function(e){return e.U}),p=R.a.Ja(m,t),f=[],v=0,g=0,_=[],y=[];t=[];for(var w,C,x,T=[],m=[],S=0;C=p[S];S++)switch(x=C.moved,C.status){case"deleted":x===d&&(w=h[v],w.j&&w.j.B(),_.push.apply(_,n(w.M)),a.beforeRemove&&(t[S]=w,y.push(w))),v++;break;case"retained":l(S,v++);break;case"added":x!==d?l(S,x):(w={U:C.value,na:R.m(g++)},f.push(w),y.push(w),c||(m[S]=w))}u(a.beforeMove,T),R.a.o(_,a.beforeRemove?R.A:R.removeNode);for(var E,S=0,c=R.e.firstChild(e);w=y[S];S++){for(w.M||R.a.extend(w,i(e,r,w.U,s,w.na)),v=0;p=w.M[v];c=p.nextSibling,E=p,v++)p!==c&&R.e.Pa(e,p,E);!w.Ab&&s&&(s(w.U,w.M,w.na),w.Ab=o)}u(a.beforeRemove,t),u(a.afterMove,T),u(a.afterAdd,m),R.a.f.set(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult",f)},R.b("utils.setDomNodeChildrenFromArrayMapping",R.a.$a),R.C=function(){this.allowTemplateRewriting=s},R.C.prototype=new R.v,R.C.prototype.renderTemplateSource=function(e){var t=9>R.a.Z||!e.nodes?a:e.nodes();return t?R.a.L(t.cloneNode(o).childNodes):(e=e.text(),R.a.ta(e))},R.C.oa=new R.C,R.wa(R.C.oa),R.b("nativeTemplateEngine",R.C),R.qa=function(){var t=this.Db=function(){if(h===void 0||!h.tmpl)return 0;try{if((""+h.tmpl.tag.tmpl.open).indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(i,r,n){n=n||{},2>t&&e(Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later."));var o=i.data("precompiled");return o||(o=i.text()||"",o=h.template(a,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),i.data("precompiled",o)),i=[r.$data],r=h.extend({koBindingContext:r},n.templateOptions),r=h.tmpl(o,i,r),r.appendTo(u.createElement("div")),h.fragments={},r},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){u.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},t>0&&(h.tmpl.tag.ko_code={open:"__.push($1 || '');"},h.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},R.qa.prototype=new R.v,t=new R.qa,t.Db>0&&R.wa(t),R.b("jqueryTmplTemplateEngine",R.qa)}var o=!0,a=null,s=!1,l=window,u=document,c=navigator,h=window.jQuery,d=void 0;"function"==typeof t&&"object"==typeof exports&&"object"==typeof module?n(module.exports||exports):"function"==typeof i&&i.amd?i("ThirdParty/knockout",["exports"],n):n(l.ko={})}(),i("Widgets/Animation/Animation",["../../Core/destroyObject","../../Core/DeveloperError","../../Core/ClockStep","../../Core/Color","../../Core/defaultValue","../../ThirdParty/sprintf"],function(e,t,i,r,n){function o(e){return r.fromCssColorString(window.getComputedStyle(e).getPropertyValue("color"))}function a(e,t,i){return t.call(i,e()),e.subscribe(t,i)}function s(e){var t=document.createElementNS(v,e.tagName);for(var i in e)if(e.hasOwnProperty(i)&&"tagName"!==i)if("children"===i){var r,n=e.children.length;for(r=0;n>r;++r)t.appendChild(s(e.children[r]))}else 0===i.indexOf("xlink:")?t.setAttributeNS(g,i.substring(6),e[i]):"textContent"===i?t.textContent=e[i]:t.setAttribute(i,e[i]);return t}function l(e,t,i){var r=document.createElementNS(v,"text");r.setAttribute("x",e),r.setAttribute("y",t),r.setAttribute("class","cesium-animation-svgText");var n=document.createElementNS(v,"tspan");return n.textContent=i,r.appendChild(n),r}function u(e,t,i){e.setAttribute("transform","translate(100,100) rotate("+i+")"),t.setAttribute("transform","rotate("+i+")")}function c(e,t){var i=t.alpha,r=1-i;return b.red=e.red*r+t.red*i,b.green=e.green*r+t.green*i,b.blue=e.blue*r+t.blue*i,b.toCssColorString()}function h(e,t,i){var r={tagName:"g","class":"cesium-animation-rectButton",transform:"translate("+e+","+t+")",children:[{tagName:"rect","class":"cesium-animation-buttonGlow",width:32,height:32,rx:2,ry:2},{tagName:"rect","class":"cesium-animation-buttonMain",width:32,height:32,rx:4,ry:4},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":i},{tagName:"title",textContent:""}]};return s(r)}function d(e,t,i){var r={tagName:"g","class":"cesium-animation-rectButton",transform:"translate("+e+","+t+")",children:[{tagName:"use","class":"cesium-animation-buttonGlow","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonMain","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":i},{tagName:"title",textContent:""}]};return s(r)}function m(e,t){var i=e.viewModel,r=i.shuttleRingDragging();if(!r||f===e)if("mousedown"===t.type||r&&"mousemove"===t.type||"touchstart"===t.type&&1===t.touches.length||r&&"touchmove"===t.type&&1===t.touches.length){var n,o,a=e._centerX,s=e._centerY,l=e._svgNode,u=l.getBoundingClientRect();if("touchstart"===t.type||"touchmove"===t.type?(n=t.touches[0].clientX,o=t.touches[0].clientY):(n=t.clientX,o=t.clientY),!r&&(n>u.right||u.left>n||u.top>o||o>u.bottom))return;var c=e._shuttleRingPointer.getBoundingClientRect(),h=n-a-u.left,d=o-s-u.top,m=180*Math.atan2(d,h)/Math.PI+90;m>180&&(m-=360);var p=i.shuttleRingAngle();r||c.right>n&&n>c.left&&o>c.top&&c.bottom>o?(f=e,i.shuttleRingDragging(!0),i.shuttleRingAngle(m)):p>m?i.slower():m>p&&i.faster(),t.preventDefault()}else f=void 0,i.shuttleRingDragging(!1)}function p(e){var t=e._svgNode,i=200,r=132,o=n(e.container.clientWidth,0),a=n(e.container.clientHeight,0),s=o,l=a;0===o&&0===a?(s=i,l=r):0===o?(l=a,s=i*(a/r)):0===a&&(s=o,l=r*(o/i));var u=s/i,c=l/r;t.style.cssText="width: "+s+"px; height: "+l+"px; position: absolute; bottom: 0; left: 0;",t.setAttribute("width",s),t.setAttribute("height",l),t.setAttribute("viewBox","0 0 "+s+" "+l),e._topG.setAttribute("transform","scale("+u+","+c+")"),e._centerX=Math.max(1,100*u),e._centerY=Math.max(1,100*c)}var f,v="http://www.w3.org/2000/svg",g="http://www.w3.org/1999/xlink",_=r.fromCssColorString("rgba(247,250,255,0.384)"),y=r.fromCssColorString("rgba(143,191,255,0.216)"),w=r.fromCssColorString("rgba(153,197,255,0.098)"),C=r.fromCssColorString("rgba(255,255,255,0.086)"),x=r.fromCssColorString("rgba(255,255,255,0.267)"),T=r.fromCssColorString("rgba(255,255,255,0)"),S=r.fromCssColorString("rgba(66,67,68,0.3)"),E=r.fromCssColorString("rgba(0,0,0,0.5)"),b=new r,M=function(e,t){this.viewModel=t,this.svgElement=e,this._enabled=void 0,this._toggled=void 0;var i=this;this._clickFunction=function(){var e=i.viewModel.command;e.canExecute()&&e()},e.addEventListener("click",this._clickFunction,!0),this._subscriptions=[a(t.toggled,this.setToggled,this),a(t.tooltip,this.setToolTip,this),a(t.command.canExecute,this.setEnabled,this)]};M.prototype.destroy=function(){this.svgElement.removeEventListener("click",this._clickFunction,!0);for(var t=this._subscriptions,i=0,r=t.length;r>i;i++)t[i].dispose();e(this)},M.prototype.isDestroyed=function(){return!1},M.prototype.setEnabled=function(e){if(this._enabled!==e){if(this._enabled=e,!e)return this.svgElement.setAttribute("class","cesium-animation-buttonDisabled"),void 0;if(this._toggled)return this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"),void 0;this.svgElement.setAttribute("class","cesium-animation-rectButton")}},M.prototype.setToggled=function(e){this._toggled!==e&&(this._toggled=e,this._enabled&&(e?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton")))},M.prototype.setToolTip=function(e){this.svgElement.getElementsByTagName("title")[0].textContent=e};var I=function(e,i){if(e===void 0)throw new t("container is required.");if("string"==typeof e){var r=document.getElementById(e);if(null===r)throw new t('Element with id "'+e+'" does not exist in the document.');e=r}if(i===void 0)throw new t("viewModel is required.");this.viewModel=i,this.container=e,this._centerX=0,this._centerY=0,this._defsElement=void 0,this._svgNode=void 0,this._topG=void 0;var n=document.createElement("style");n.textContent=".cesium-animation-rectButton .cesium-animation-buttonGlow { filter: url(#animation_blurred); }\n.cesium-animation-rectButton .cesium-animation-buttonMain { fill: url(#animation_buttonNormal); }\n.cesium-animation-buttonToggled .cesium-animation-buttonMain { fill: url(#animation_buttonToggled); }\n.cesium-animation-rectButton:hover .cesium-animation-buttonMain { fill: url(#animation_buttonHovered); }\n.cesium-animation-buttonDisabled .cesium-animation-buttonMain { fill: url(#animation_buttonDisabled); }\n.cesium-animation-shuttleRingG .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshGradient); }\n.cesium-animation-shuttleRingG:hover .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshHovered); }\n.cesium-animation-shuttleRingPointer { fill: url(#animation_shuttleRingPointerGradient); }\n.cesium-animation-shuttleRingPausePointer { fill: url(#animation_shuttleRingPointerPaused); }\n.cesium-animation-knobOuter { fill: url(#animation_knobOuter); }\n.cesium-animation-knobInner { fill: url(#animation_knobInner); }\n",document.head.insertBefore(n,document.head.childNodes[0]);var o=document.createElement("div");o.className="cesium-animation-theme",o.innerHTML='<div class="cesium-animation-themeNormal"></div><div class="cesium-animation-themeHover"></div><div class="cesium-animation-themeSelect"></div><div class="cesium-animation-themeDisabled"></div><div class="cesium-animation-themeKnob"></div><div class="cesium-animation-themePointer"></div><div class="cesium-animation-themeSwoosh"></div><div class="cesium-animation-themeSwooshHover"></div>',this._theme=o,this._themeNormal=o.childNodes[0],this._themeHover=o.childNodes[1],this._themeSelect=o.childNodes[2],this._themeDisabled=o.childNodes[3],this._themeKnob=o.childNodes[4],this._themePointer=o.childNodes[5],this._themeSwoosh=o.childNodes[6],this._themeSwooshHover=o.childNodes[7];var c=document.createElementNS(v,"svg:svg");this._svgNode=c,c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",g);var f=document.createElementNS(v,"g");this._topG=f,this._realtimeSVG=new M(d(3,4,"#animation_pathClock"),i.playRealtimeViewModel),this._playReverseSVG=new M(h(44,99,"#animation_pathPlayReverse"),i.playReverseViewModel),this._playForwardSVG=new M(h(124,99,"#animation_pathPlay"),i.playForwardViewModel),this._pauseSVG=new M(h(84,99,"#animation_pathPause"),i.pauseViewModel);var _=document.createElementNS(v,"g");_.appendChild(this._realtimeSVG.svgElement),_.appendChild(this._playReverseSVG.svgElement),_.appendChild(this._playForwardSVG.svgElement),_.appendChild(this._pauseSVG.svgElement);var y=s({tagName:"circle","class":"cesium-animation-shuttleRingBack",cx:100,cy:100,r:99});this._shuttleRingBackPanel=y;var w=s({tagName:"g","class":"cesium-animation-shuttleRingSwoosh",children:[{tagName:"use",transform:"translate(100,97) scale(-1,1)","xlink:href":"#animation_pathSwooshFX"},{tagName:"use",transform:"translate(100,97)","xlink:href":"#animation_pathSwooshFX"},{tagName:"line",x1:100,y1:8,x2:100,y2:22}]});this._shuttleRingSwooshG=w,this._shuttleRingPointer=s({tagName:"use","class":"cesium-animation-shuttleRingPointer","xlink:href":"#animation_pathPointer"});var C=s({tagName:"g",transform:"translate(100,100)"});this._knobOuter=s({tagName:"circle","class":"cesium-animation-knobOuter",cx:0,cy:0,r:71});var x=61,T=s({tagName:"circle","class":"cesium-animation-knobInner",cx:0,cy:0,r:x});this._knobDate=l(0,-24,""),this._knobTime=l(0,-7,""),this._knobStatus=l(0,-41,"");var S=s({tagName:"circle","class":"cesium-animation-blank",cx:0,cy:0,r:x}),E=document.createElementNS(v,"g");E.setAttribute("class","cesium-animation-shuttleRingG"),e.appendChild(o),f.appendChild(E),f.appendChild(C),f.appendChild(_),E.appendChild(y),E.appendChild(w),E.appendChild(this._shuttleRingPointer),C.appendChild(this._knobOuter),C.appendChild(T),C.appendChild(this._knobDate),C.appendChild(this._knobTime),C.appendChild(this._knobStatus),C.appendChild(S),c.appendChild(f),e.appendChild(c);var b=this;this._resizeCallback=function(){p(b)},window.addEventListener("resize",this._resizeCallback,!0);var I=function(e){m(b,e)};this._mouseCallback=I,y.addEventListener("mousedown",I,!0),y.addEventListener("touchstart",I,!0),w.addEventListener("mousedown",I,!0),w.addEventListener("touchstart",I,!0),document.addEventListener("mousemove",I,!0),document.addEventListener("touchmove",I,!0),document.addEventListener("mouseup",I,!0),document.addEventListener("touchend",I,!0),this._shuttleRingPointer.addEventListener("mousedown",I,!0),this._shuttleRingPointer.addEventListener("touchstart",I,!0),this._knobOuter.addEventListener("mousedown",I,!0),this._knobOuter.addEventListener("touchstart",I,!0);var D,A=this._knobTime.childNodes[0],P=this._knobDate.childNodes[0],R=this._knobStatus.childNodes[0];this._subscriptions=[a(i.pauseViewModel.toggled,function(e){D!==e&&(D=e,D?b._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPausePointer"):b._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPointer"))}),a(i.shuttleRingAngle,function(e){u(b._shuttleRingPointer,b._knobOuter,e)}),a(i.dateLabel,function(e){P.textContent!==e&&(P.textContent=e)}),a(i.timeLabel,function(e){A.textContent!==e&&(A.textContent=e)}),a(i.multiplierLabel,function(e){R.textContent!==e&&(R.textContent=e)})],this.applyThemeChanges(),p(this)};return I.prototype.destroy=function(){var t=this._mouseCallback;window.removeEventListener("resize",this._resizeCallback,!0),this._shuttleRingBackPanel.removeEventListener("mousedown",t,!0),this._shuttleRingBackPanel.removeEventListener("touchstart",t,!0),this._shuttleRingSwooshG.removeEventListener("mousedown",t,!0),this._shuttleRingSwooshG.removeEventListener("touchstart",t,!0),document.removeEventListener("mousemove",t,!0),document.removeEventListener("touchmove",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("touchend",t,!0),this._shuttleRingPointer.removeEventListener("mousedown",t,!0),this._shuttleRingPointer.removeEventListener("touchstart",t,!0),this._knobOuter.removeEventListener("mousedown",t,!0),this._knobOuter.removeEventListener("touchstart",t,!0),this.container.removeChild(this._svgNode),this.container.removeChild(this._theme),this._realtimeSVG.destroy(),this._playReverseSVG.destroy(),this._playForwardSVG.destroy(),this._pauseSVG.destroy();for(var i=this._subscriptions,r=0,n=i.length;n>r;r++)i[r].dispose();return e(this)},I.prototype.isDestroyed=function(){return!1},I.prototype.applyThemeChanges=function(){var e=o(this._themeNormal),t=o(this._themeHover),i=o(this._themeSelect),r=o(this._themeDisabled),n=o(this._themeKnob),a=o(this._themePointer),l=o(this._themeSwoosh),u=o(this._themeSwooshHover),h=s({tagName:"defs",children:[{id:"animation_buttonNormal",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":c(e,_)},{tagName:"stop",offset:"12%","stop-color":c(e,y)},{tagName:"stop",offset:"46%","stop-color":c(e,w)},{tagName:"stop",offset:"81%","stop-color":c(e,C)}]},{id:"animation_buttonHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":c(t,_)},{tagName:"stop",offset:"12%","stop-color":c(t,y)},{tagName:"stop",offset:"46%","stop-color":c(t,w)},{tagName:"stop",offset:"81%","stop-color":c(t,C)}]},{id:"animation_buttonToggled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":c(i,_)},{tagName:"stop",offset:"12%","stop-color":c(i,y)},{tagName:"stop",offset:"46%","stop-color":c(i,w)},{tagName:"stop",offset:"81%","stop-color":c(i,C)}]},{id:"animation_buttonDisabled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":c(r,x)},{tagName:"stop",offset:"75%","stop-color":c(r,T)}]},{id:"animation_blurred",tagName:"filter",width:"200%",height:"200%",x:"-50%",y:"-50%",children:[{tagName:"feGaussianBlur",stdDeviation:4,"in":"SourceGraphic"}]},{id:"animation_shuttleRingSwooshGradient",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":l.toCssColorString()}]},{id:"animation_shuttleRingSwooshHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":u.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":u.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":u.toCssColorString()}]},{id:"animation_shuttleRingPointerGradient",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":a.toCssColorString()},{tagName:"stop",offset:"40%","stop-color":a.toCssColorString()},{tagName:"stop",offset:"60%","stop-color":c(a,E)},{tagName:"stop",offset:"100%","stop-color":c(a,E)}]},{id:"animation_shuttleRingPointerPaused",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":"#CCC"},{tagName:"stop",offset:"40%","stop-color":"#CCC"},{tagName:"stop",offset:"60%","stop-color":"#555"},{tagName:"stop",offset:"100%","stop-color":"#555"}]},{id:"animation_knobOuter",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":c(n,_)},{tagName:"stop",offset:"60%","stop-color":c(n,S)},{tagName:"stop",offset:"85%","stop-color":c(n,y)}]},{id:"animation_knobInner",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":c(n,S)},{tagName:"stop",offset:"60%","stop-color":c(n,_)},{tagName:"stop",offset:"85%","stop-color":c(n,C)}]},{id:"animation_pathReset",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z"},{id:"animation_pathPause",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M13,5.5,7.5,5.5,7.5,25.5,13,25.5zM24.5,5.5,19,5.5,19,25.5,24.5,25.5z"},{id:"animation_pathPlay",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathPlayReverse",tagName:"path",transform:"translate(16,16) scale(-0.85,0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathLoop",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z"},{id:"animation_pathClock",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-15.5)",d:"M15.5,2.374C8.251,2.375,2.376,8.251,2.374,15.5C2.376,22.748,8.251,28.623,15.5,28.627c7.249-0.004,13.124-5.879,13.125-13.127C28.624,8.251,22.749,2.375,15.5,2.374zM15.5,25.623C9.909,25.615,5.385,21.09,5.375,15.5C5.385,9.909,9.909,5.384,15.5,5.374c5.59,0.01,10.115,4.535,10.124,10.125C25.615,21.09,21.091,25.615,15.5,25.623zM8.625,15.5c-0.001-0.552-0.448-0.999-1.001-1c-0.553,0-1,0.448-1,1c0,0.553,0.449,1,1,1C8.176,16.5,8.624,16.053,8.625,15.5zM8.179,18.572c-0.478,0.277-0.642,0.889-0.365,1.367c0.275,0.479,0.889,0.641,1.365,0.365c0.479-0.275,0.643-0.887,0.367-1.367C9.27,18.461,8.658,18.297,8.179,18.572zM9.18,10.696c-0.479-0.276-1.09-0.112-1.366,0.366s-0.111,1.09,0.365,1.366c0.479,0.276,1.09,0.113,1.367-0.366C9.821,11.584,9.657,10.973,9.18,10.696zM22.822,12.428c0.478-0.275,0.643-0.888,0.366-1.366c-0.275-0.478-0.89-0.642-1.366-0.366c-0.479,0.278-0.642,0.89-0.366,1.367C21.732,12.54,22.344,12.705,22.822,12.428zM12.062,21.455c-0.478-0.275-1.089-0.111-1.366,0.367c-0.275,0.479-0.111,1.09,0.366,1.365c0.478,0.277,1.091,0.111,1.365-0.365C12.704,22.344,12.54,21.732,12.062,21.455zM12.062,9.545c0.479-0.276,0.642-0.888,0.366-1.366c-0.276-0.478-0.888-0.642-1.366-0.366s-0.642,0.888-0.366,1.366C10.973,9.658,11.584,9.822,12.062,9.545zM22.823,18.572c-0.48-0.275-1.092-0.111-1.367,0.365c-0.275,0.479-0.112,1.092,0.367,1.367c0.477,0.275,1.089,0.113,1.365-0.365C23.464,19.461,23.3,18.848,22.823,18.572zM19.938,7.813c-0.477-0.276-1.091-0.111-1.365,0.366c-0.275,0.48-0.111,1.091,0.366,1.367s1.089,0.112,1.366-0.366C20.581,8.702,20.418,8.089,19.938,7.813zM23.378,14.5c-0.554,0.002-1.001,0.45-1.001,1c0.001,0.552,0.448,1,1.001,1c0.551,0,1-0.447,1-1C24.378,14.949,23.929,14.5,23.378,14.5zM15.501,6.624c-0.552,0-1,0.448-1,1l-0.466,7.343l-3.004,1.96c-0.478,0.277-0.642,0.889-0.365,1.365c0.275,0.479,0.889,0.643,1.365,0.367l3.305-1.676C15.39,16.99,15.444,17,15.501,17c0.828,0,1.5-0.671,1.5-1.5l-0.5-7.876C16.501,7.072,16.053,6.624,15.501,6.624zM15.501,22.377c-0.552,0-1,0.447-1,1s0.448,1,1,1s1-0.447,1-1S16.053,22.377,15.501,22.377zM18.939,21.455c-0.479,0.277-0.643,0.889-0.366,1.367c0.275,0.477,0.888,0.643,1.366,0.365c0.478-0.275,0.642-0.889,0.366-1.365C20.028,21.344,19.417,21.18,18.939,21.455z"},{id:"animation_pathWingButton",tagName:"path",d:"m 4.5,0.5 c -2.216,0 -4,1.784 -4,4 l 0,24 c 0,2.216 1.784,4 4,4 l 13.71875,0 C 22.478584,27.272785 27.273681,22.511272 32.5,18.25 l 0,-13.75 c 0,-2.216 -1.784,-4 -4,-4 l -24,0 z"},{id:"animation_pathPointer",tagName:"path",d:"M-15,-65,-15,-55,15,-55,15,-65,0,-95z"},{id:"animation_pathSwooshFX",tagName:"path",d:"m 85,0 c 0,16.617 -4.813944,35.356 -13.131081,48.4508 h 6.099803 c 8.317138,-13.0948 13.13322,-28.5955 13.13322,-45.2124 0,-46.94483 -38.402714,-85.00262 -85.7743869,-85.00262 -1.0218522,0 -2.0373001,0.0241 -3.0506131,0.0589 45.958443,1.59437 82.723058,35.77285 82.723058,81.70532 z"}]});this._defsElement===void 0?this._svgNode.appendChild(h):this._svgNode.replaceChild(h,this._defsElement),this._defsElement=h},I}),i("Widgets/createCommand",["../Core/defaultValue","../Core/DeveloperError","../ThirdParty/knockout"],function(e,t,i){var r=function(r,n){function o(){if(!n())throw new t("Cannot execute command, canExecute is false.");return r.apply(null,arguments)}return n=e(n,i.observable(!0)),o.canExecute=n,o};return r}),i("Widgets/ToggleButtonViewModel",["../Core/defaultValue","../ThirdParty/knockout"],function(e,t){var i=function(i){i=e(i,{}),this.command=i.command,this.toggled=e(i.toggled,t.observable(!1)),this.tooltip=e(i.tooltip,t.observable(""))};return i}),i("Widgets/Animation/AnimationViewModel",["../createCommand","../ToggleButtonViewModel","../../Core/binarySearch","../../Core/ClockStep","../../Core/ClockRange","../../Core/Color","../../Core/DeveloperError","../../Core/JulianDate","../../Core/defaultValue","../../ThirdParty/sprintf","../../ThirdParty/knockout"],function(e,t,i,r,n,o,a,s,l,u,c){function h(e){e.clockStep()===r.SYSTEM_CLOCK&&(e.clockStep(r.SYSTEM_CLOCK_MULTIPLIER),e.multiplier(1))}function d(e){h(e),e.shouldAnimate(!0)}function m(e,t){return e-t}function p(e,t){var r=i(t,e,m);return 0>r?~r:r}function f(e,t){if(_>=Math.abs(e))return e/_;var i,r,n=_,o=y,a=0;return e>0?(i=Math.log(t[t.length-1]),r=(i-a)/(o-n),Math.exp(a+r*(e-n))):(i=Math.log(-t[0]),r=(i-a)/(o-n),-Math.exp(a+r*(Math.abs(e)-n)))}function v(e,t,i){if(i.clockStep()===r.SYSTEM_CLOCK)return _;if(1>=Math.abs(e))return e*_;var n,o,a=_,s=y,l=0;return e>0?(n=Math.log(t[t.length-1]),o=(n-l)/(s-a),(Math.log(e)-l)/o+a):(n=Math.log(-t[0]),o=(n-l)/(s-a),-((Math.log(Math.abs(e))-l)/o+a))}var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=15,y=105,w=function(i){if(i===void 0)throw new a("clockViewModel is required.");var o=this;this.clockViewModel=i,this.shuttleRingDragging=c.observable(!1),this._shuttleRingTicks=c.observable(),this.setShuttleRingTicks(w.defaultTicks),this._dateFormatter=c.observable(w.defaultDateFormatter),this._timeFormatter=c.observable(w.defaultTimeFormatter),this._canAnimate=c.computed(function(){var e=o.clockViewModel,t=e.clockRange();if(o.shuttleRingDragging()||t===n.UNBOUNDED)return!0;var i=e.multiplier(),r=e.currentTime(),a=e.startTime(),s=!1;if(t===n.LOOP_STOP)s=r.greaterThan(a)||r.equals(a)&&i>0;else{var l=e.stopTime();s=r.greaterThan(a)&&r.lessThan(l)||r.equals(a)&&i>0||r.equals(l)&&0>i}return s||e.shouldAnimate(!1),s
}),this._isSystemTimeAvailable=c.computed(function(){var e=o.clockViewModel,t=e.clockRange();if(t===n.UNBOUNDED)return!0;var i=e.systemTime(),r=e.startTime(),a=e.stopTime();return i.greaterThanOrEquals(r)&&i.lessThanOrEquals(a)}),this._isAnimatingObs=c.computed(function(){return o.clockViewModel.shouldAnimate()&&(o._canAnimate()||o.shuttleRingDragging())}),this.timeLabel=c.computed(function(){return o._timeFormatter()(o.clockViewModel.currentTime(),o)}),this.dateLabel=c.computed(function(){return o._dateFormatter()(o.clockViewModel.currentTime(),o)}),this.multiplierLabel=c.computed(function(){var e=o.clockViewModel;if(e.clockStep()===r.SYSTEM_CLOCK)return"Today";var t=e.multiplier();return 0===t%1?t.toFixed(0)+"x":t.toFixed(3).replace(/0{0,3}$/,"")+"x"}),this.pauseViewModel=new t({toggled:c.computed(function(){return!o._isAnimatingObs()}),tooltip:c.observable("Pause"),command:e(function(){var e=o.clockViewModel;e.shouldAnimate()?(h(e),e.shouldAnimate(!1)):o._canAnimate()&&d(e)})}),this.playReverseViewModel=new t({toggled:c.computed(function(){return o._isAnimatingObs()&&0>i.multiplier()}),tooltip:c.observable("Play Reverse"),command:e(function(){var e=o.clockViewModel;h(e);var t=e.multiplier();t>0&&e.multiplier(-t),e.shouldAnimate(!0)})}),this.playForwardViewModel=new t({toggled:c.computed(function(){return o._isAnimatingObs()&&i.multiplier()>0&&i.clockStep()!==r.SYSTEM_CLOCK}),tooltip:c.observable("Play Forward"),command:e(function(){var e=o.clockViewModel;h(e);var t=e.multiplier();0>t&&e.multiplier(-t),e.shouldAnimate(!0)})}),this.playRealtimeViewModel=new t({toggled:c.computed(function(){return i.clockStep()===r.SYSTEM_CLOCK}),tooltip:c.computed(function(){return o._isSystemTimeAvailable()?"Today (real-time)":"Current time not in range"}),command:e(function(){var e=o.clockViewModel;e.clockStep()!==r.SYSTEM_CLOCK&&o._isSystemTimeAvailable()&&(e.clockStep(r.SYSTEM_CLOCK),e.multiplier(1),o.clockViewModel.shouldAnimate(!0))},c.computed(function(){return o._isSystemTimeAvailable()}))}),this.snapToTicks=c.observable(!1),this.shuttleRingAngle=c.computed({read:function(){return v(i.multiplier(),o._shuttleRingTicks(),i)},write:function(e){e=Math.max(Math.min(e,y),-y);var t=o._shuttleRingTicks(),i=o.clockViewModel;if(i.clockStep(r.SYSTEM_CLOCK_MULTIPLIER),Math.abs(e)===y)return i.multiplier(e>0?t[t.length-1]:t[0]),void 0;var n=f(e,t);if(o.snapToTicks())n=t[p(n,t)];else if(0!==n){var a=Math.abs(n);if(a>100){var s=a.toFixed(0).length-2,l=Math.pow(10,s);n=0|Math.round(n/l)*l}else a>_?n=Math.round(n):a>1?n=+n.toFixed(1):a>0&&(n=+n.toFixed(2))}i.multiplier(n)}}),this.slower=e(function(){var e=o.clockViewModel;h(e);var t=o._shuttleRingTicks(),i=e.multiplier(),r=p(i,t)-1;r>=0&&e.multiplier(t[r])}),this.faster=e(function(){var e=o.clockViewModel;h(e);var t=o._shuttleRingTicks(),i=e.multiplier(),r=p(i,t)+1;t.length>r&&e.multiplier(t[r])})};return w.defaultDateFormatter=function(e){var t=e.toGregorianDate();return g[t.month-1]+" "+t.day+" "+t.year},w.defaultTicks=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800],w.prototype.getShuttleRingTicks=function(){return this._shuttleRingTicks()},w.prototype.setShuttleRingTicks=function(e){if(e===void 0)throw new a("positiveTicks is required.");for(var t=e.length,i=[],r=0;t>r;r++){var n=e[r];i.push(n),0!==n&&i.push(-n)}i.sort(m),this._shuttleRingTicks(i)},w.defaultTimeFormatter=function(e,t){var i=e.toGregorianDate(),r=Math.round(i.millisecond);return 1>Math.abs(t.clockViewModel.multiplier())?u("%02d:%02d:%02d.%03d",i.hour,i.minute,i.second,r):u("%02d:%02d:%02d UTC",i.hour,i.minute,i.second)},w.prototype.getDateFormatter=function(){return this._dateFormatter()},w.prototype.setDateFormatter=function(e){if("function"!=typeof e)throw new a("dateFormatter must be a function");this._dateFormatter(e)},w.prototype.getTimeFormatter=function(){return this._timeFormatter()},w.prototype.setTimeFormatter=function(e){if("function"!=typeof e)throw new a("timeFormatter must be a function.");this._timeFormatter(e)},w._maxShuttleRingAngle=y,w._realtimeShuttleRingAngle=_,w}),i("Widgets/BaseLayerPicker/BaseLayerPickerViewModel",["../../Core/DeveloperError","../../Scene/SceneMode","../createCommand","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(t,n){if(t===void 0)throw new e("imageryLayers is required");if(n===void 0)n=[];else if(!Array.isArray(n))throw new e("imageryProviderViewModels must be an array");var o=r.observable(!1),a=r.observable();this.imageryLayers=t,this.imageryProviderViewModels=r.observableArray(n),this.dropDownVisible=o,this.toggleDropDown=i(function(){o(!o())}),this.selectedName=r.computed(function(){var e=a();return e!==void 0?e.name():void 0}),this.selectedIconUrl=r.computed(function(){var e=a();return e!==void 0?e.iconUrl():void 0}),this.selectedItem=r.computed({read:function(){return a()},write:function(e){t.getLength()>0&&t.remove(t.get(0));var i=e.creationCommand();i!==void 0&&t.addImageryProvider(i,0),a(e),o(!1)}})};return n}),i("Widgets/BaseLayerPicker/BaseLayerPicker",["./BaseLayerPickerViewModel","../../Core/DeveloperError","../../Core/destroyObject","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(i,n,o){if(i===void 0)throw new t("container is required.");if("string"==typeof i){var a=document.getElementById(i);if(null===a)throw new t('Element with id "'+i+'" does not exist in the document.');i=a}if(n===void 0)throw new t("imageryLayers is required.");var s=new e(n,o);this.viewModel=s,this.container=i,this.element=document.createElement("img");var l=this.element;l.setAttribute("draggable","false"),l.className="cesium-baseLayerPicker-selected",l.setAttribute("data-bind","                attr: {title: selectedName, src: selectedIconUrl},                click: toggleDropDown"),i.appendChild(l);var u=document.createElement("div");u.className="cesium-baseLayerPicker-dropDown",u.setAttribute("data-bind",'                css: { "cesium-baseLayerPicker-visible" : dropDownVisible(),                       "cesium-baseLayerPicker-hidden" : !dropDownVisible() },                foreach: imageryProviderViewModels'),i.appendChild(u);var c=document.createElement("div");c.className="cesium-baseLayerPicker-item",c.setAttribute("data-bind",'                css: {"cesium-baseLayerPicker-selectedItem" : $data === $parent.selectedItem()},                attr: {title: tooltip},                visible: creationCommand.canExecute(),                click: $parent.selectedItem'),u.appendChild(c);var h=document.createElement("img");h.className="cesium-baseLayerPicker-itemIcon",h.setAttribute("data-bind","attr: { src: iconUrl }"),h.setAttribute("draggable","false"),c.appendChild(h);var d=document.createElement("div");d.className="cesium-baseLayerPicker-itemLabel",d.setAttribute("data-bind","text: name"),c.appendChild(d),r.applyBindings(s,i),this._closeDropDown=function(e){i.contains(e.target)||s.dropDownVisible(!1)},document.addEventListener("mousedown",this._closeDropDown),document.addEventListener("touchstart",this._closeDropDown)};return n.prototype.destroy=function(){document.removeEventListener("mousedown",this._closeDropDown),document.removeEventListener("touchstart",this._closeDropDown);var e=this.container;return r.cleanNode(e),e.removeChild(this.element),i(this)},n}),i("Widgets/BaseLayerPicker/ImageryProviderViewModel",["../createCommand","../../Core/DeveloperError","../../ThirdParty/knockout"],function(e,t,i){var r=function(e){if(e.name===void 0)throw new t("description.name is required.");if(e.tooltip===void 0)throw new t("description.tooltip is required.");if(e.iconUrl===void 0)throw new t("description.iconUrl is required.");if(e.creationCommand===void 0)throw new t("description.creationCommand is required.");this.name=e.name,this.tooltip=e.tooltip,this.iconUrl=e.iconUrl,this.creationCommand=e.creationCommand};return r.fromConstants=function(n){if(n.name===void 0)throw new t("description.name is required.");if(n.tooltip===void 0)throw new t("description.tooltip is required.");if(n.iconUrl===void 0)throw new t("description.iconUrl is required.");if(n.creationFunction===void 0)throw new t("description.creationFunction is required.");return new r({name:i.observable(n.name),tooltip:i.observable(n.tooltip),iconUrl:i.observable(n.iconUrl),creationCommand:e(n.creationFunction)})},r}),i("Widgets/CesiumWidget/CesiumWidget",["../../Core/buildModuleUrl","../../Core/Cartesian2","../../Core/Cartesian3","../../Core/Clock","../../Core/DefaultProxy","../../Core/defaultValue","../../Core/destroyObject","../../Core/DeveloperError","../../Core/Ellipsoid","../../Core/FeatureDetection","../../Core/requestAnimationFrame","../../Scene/BingMapsImageryProvider","../../Scene/CentralBody","../../Scene/Scene","../../Scene/SceneTransitioner","../../Scene/SkyBox","../../Scene/SkyAtmosphere"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v){function g(t){return e("Assets/Textures/SkyBox/tycho2t3_80_"+t+".jpg")}var _=function(e,a){function _(){M._isDestroyed||(M.render(),c(_))}if(e===void 0)throw new s("container is required.");if("string"==typeof e){var y=document.getElementById(e);if(null===y)throw new s('Element with id "'+e+'" does not exist in the document.');e=y}a=o(a,{});var w=document.createElement("div");w.className="cesium-widget",e.appendChild(w);var C=document.createElement("canvas");C.oncontextmenu=function(){return!1},C.onselectstart=function(){return!1},w.appendChild(C);var x=document.createElement("a");x.href="http://cesium.agi.com/",x.target="_blank",x.className="cesium-widget-logo",w.appendChild(x);var T=new m(C);T.getCamera().controller.constrainedAxis=i.UNIT_Z;var S=l.WGS84,E=new d(S);E.logoOffset=new t(125,0),T.getPrimitives().setCentralBody(E),T.skyBox=new f({positiveX:g("px"),negativeX:g("mx"),positiveY:g("py"),negativeY:g("my"),positiveZ:g("pz"),negativeZ:g("mz")}),T.skyAtmosphere=new v(S);var b=a.imageryProvider;b===void 0&&(b=new h({url:"http://dev.virtualearth.net",proxy:u.supportsCrossOriginImagery()?void 0:new n("http://cesium.agi.com/proxy/")})),E.getImageryLayers().addImageryProvider(b),a.terrainProvider!==void 0&&(E.terrainProvider=a.terrainProvider),this.container=e,this.element=w,this.canvas=C,this.cesiumLogo=x,this.scene=T,this.centralBody=E,this.clock=o(a.clock,new r),this.transitioner=new p(T,S);var M=this;this._needResize=!0,this._resizeCallback=function(){M._needResize=!0},window.addEventListener("resize",this._resizeCallback,!1),this._isDestroyed=!1,c(_)};return _.prototype.isDestroyed=function(){return!1},_.prototype.destroy=function(){window.removeEventListener("resize",this._resizeCallback,!1),this.container.removeChild(this.element),this._isDestroyed=!0,a(this)},_.prototype.resize=function(){var e=this.canvas.clientWidth,t=this.canvas.clientHeight;if(this.canvas.width!==e||this.canvas.height!==t){this.canvas.width=e,this.canvas.height=t;var i=this.scene.getCamera().frustum;i.aspectRatio!==void 0?i.aspectRatio=e/t:(i.top=i.right*(t/e),i.bottom=-i.top)}},_.prototype.render=function(){this._needResize&&(this.resize(),this._needResize=!1);var e=this.clock.tick();this.scene.initializeFrame(),this.scene.render(e)},_}),i("Widgets/ClockViewModel",["../Core/DeveloperError","../Core/defaultValue","../Core/Clock","../Core/JulianDate","../ThirdParty/knockout"],function(e,t,i,r,n){var o=function(e){e=t(e,new i),this.clock=e,this.clock.onTick.addEventListener(this.synchronize,this);var o=n.observable(e.startTime);o.equalityComparer=r.equals,this.startTime=n.computed({read:o,write:function(t){o(t),e.startTime=t}});var a=n.observable(e.stopTime);a.equalityComparer=r.equals,this.stopTime=n.computed({read:a,write:function(t){e.stopTime=t,a(t)}});var s=n.observable(e.currentTime);s.equalityComparer=r.equals,this.currentTime=n.computed({read:s,write:function(t){e.currentTime=t,s(t)}}),this.systemTime=n.observable(new r),this.systemTime.equalityComparer=r.equals;var l=n.observable(e.multiplier);this.multiplier=n.computed({read:l,write:function(t){e.multiplier=t,l(t)}},this);var u=n.observable(e.clockStep);u.equalityComparer=function(e,t){return e===t},this.clockStep=n.computed({read:u,write:function(t){u(t),e.clockStep=t}});var c=n.observable(e.clockRange);c.equalityComparer=function(e,t){return e===t},this.clockRange=n.computed({read:c,write:function(t){c(t),e.clockRange=t}});var h=n.observable(e.shouldAnimate);this.shouldAnimate=n.computed({read:h,write:function(t){h(t),e.shouldAnimate=t}})};return o.prototype.synchronize=function(){var e=this.clock,t=e.startTime,i=e.stopTime,n=e.currentTime,o=e.multiplier,a=e.clockStep,s=e.clockRange,l=e.shouldAnimate;this.systemTime(new r),this.startTime(t),this.stopTime(i),this.currentTime(n),this.multiplier(o),this.clockStep(a),this.clockRange(s),this.shouldAnimate(l)},o}),i("Widgets/Command",["../Core/DeveloperError"],function(e){var t=function(){throw this.canExecute=void 0,new e("This type should not be instantiated directly.")};return t}),i("Widgets/Fullscreen/FullscreenViewModel",["../createCommand","../../Core/defaultValue","../../Core/Fullscreen","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(n){var o=this,a=r.observable(i.isFullscreen()),s=r.observable(i.isFullscreenEnabled()),l=r.computed({read:function(){return s()},write:function(e){s(e&&i.isFullscreenEnabled())}});this.isFullscreenEnabled=l,this.toggled=a,this.command=e(function(){i.isFullscreen()?i.exitFullscreen():i.requestFullscreen(o.fullscreenElement())},l),this.tooltip=r.computed(function(){return l()?a()?"Exit full screen":"Full screen":"Full screen unavailable"}),this.fullscreenElement=r.observable(t(n,document.body)),document.addEventListener(i.getFullscreenChangeEventName(),function(){a(i.isFullscreen())})};return n}),i("Widgets/Fullscreen/FullscreenWidget",["./FullscreenViewModel","../../Core/DeveloperError","../../Core/destroyObject","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(i,n){if(i===void 0)throw new t("container is required.");if("string"==typeof i){var o=document.getElementById(i);if(null===o)throw new t('Element with id "'+i+'" does not exist in the document.');i=o}this.container=i,this.viewModel=new e(n),this.container=i,this.element=document.createElement("button"),this.element.className="cesium-fullscreen",this.element.setAttribute("data-bind",'attr: { title: tooltip }, css: { "cesium-fullscreen-exit": toggled }, click: command, enable: isFullscreenEnabled'),i.appendChild(this.element),r.applyBindings(this.viewModel,this.element)};return n.prototype.destroy=function(){var e=this.container;return r.cleanNode(e),e.removeChild(this.element),i(this)},n}),i("Widgets/Observable",["../Core/DeveloperError"],function(e){var t=function t(){throw new e("This type should not be instantiated directly.")};return t}),i("Widgets/SceneModePicker/SceneModePickerViewModel",["../../Core/DeveloperError","../../Scene/SceneMode","../createCommand","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(n){if(n===void 0)throw new e("transitioner is required.");var o=r.observable(n.getScene().mode);this._transitionStart=function(e,t,i){o(i)},n.onTransitionStart.addEventListener(this._transitionStart);var a=r.observable(!1),s=r.observable("2D"),l=r.observable("3D"),u=r.observable("Columbus View");this.transitioner=n,this.sceneMode=o,this.dropDownVisible=a,this.toggleDropDown=i(function(){a(!a())}),this.morphTo2D=i(function(){n.morphTo2D(),a(!1)}),this.morphTo3D=i(function(){n.morphTo3D(),a(!1)}),this.morphToColumbusView=i(function(){n.morphToColumbusView(),a(!1)}),this.tooltip2D=s,this.tooltip3D=l,this.tooltipColumbusView=u,this.selectedTooltip=r.computed(function(){var e=o();return e===t.SCENE2D?s():e===t.SCENE3D?l():u()}),this._sceneMode=t};return n.prototype.destroy=function(){this.transitioner.onTransitionStart.removeEventListener(this._transitionStart)},n}),i("Widgets/SceneModePicker/SceneModePicker",["./SceneModePickerViewModel","../../Core/DeveloperError","../../Core/destroyObject","../../ThirdParty/knockout"],function(e,t,i,r){var n=function(i,n){if(i===void 0)throw new t("container is required.");if("string"==typeof i){var o=document.getElementById(i);if(null===o)throw new t('Element with id "'+i+'" does not exist in the document.');i=o}if(n===void 0)throw new t("transitioner is required.");var a=new e(n);this.viewModel=a,this.container=i,this.element=document.createElement("span");var s=this.element;s.className="cesium-sceneModePicker-button",s.setAttribute("data-bind",'                                 css: { "cesium-sceneModePicker-button2D": sceneMode() === _sceneMode.SCENE2D,                                        "cesium-sceneModePicker-button3D": sceneMode() === _sceneMode.SCENE3D,                                        "cesium-sceneModePicker-buttonColumbusView": sceneMode() === _sceneMode.COLUMBUS_VIEW,                                        "cesium-sceneModePicker-selected": dropDownVisible},                                 attr: { title: selectedTooltip }, click: toggleDropDown'),i.appendChild(s);var l=document.createElement("span");l.className="cesium-sceneModePicker-button cesium-sceneModePicker-button3D",l.setAttribute("data-bind",'                             css: { "cesium-sceneModePicker-visible" : (dropDownVisible() && (sceneMode() !== _sceneMode.SCENE3D)) || (!dropDownVisible() && (sceneMode() === _sceneMode.SCENE3D)),                                    "cesium-sceneModePicker-none" : sceneMode() === _sceneMode.SCENE3D,                                    "cesium-sceneModePicker-hidden" : !dropDownVisible()},                             attr: { title: tooltip3D },                             click: morphTo3D'),i.appendChild(l),this._node3D=l;var u=document.createElement("span");u.className="cesium-sceneModePicker-button cesium-sceneModePicker-button2D",u.setAttribute("data-bind",'                             css: { "cesium-sceneModePicker-visible" : (dropDownVisible() && (sceneMode() !== _sceneMode.SCENE2D)),                                    "cesium-sceneModePicker-none" : sceneMode() === _sceneMode.SCENE2D,                                    "cesium-sceneModePicker-hidden" : !dropDownVisible()},                             attr: { title: tooltip2D },                             click: morphTo2D'),i.appendChild(u),this._node2D=u;var c=document.createElement("span");c.className="cesium-sceneModePicker-button cesium-sceneModePicker-buttonColumbusView",c.setAttribute("data-bind",'                                   css: { "cesium-sceneModePicker-visible" : (dropDownVisible() && (sceneMode() !== _sceneMode.COLUMBUS_VIEW)) || (!dropDownVisible() && (sceneMode() === _sceneMode.COLUMBUS_VIEW)),                                          "cesium-sceneModePicker-none" : sceneMode() === _sceneMode.COLUMBUS_VIEW,                                          "cesium-sceneModePicker-hidden" : !dropDownVisible()},                                   attr: { title: tooltipColumbusView },                                   click: morphToColumbusView'),i.appendChild(c),this._nodeColumbus=c,r.applyBindings(a,i),this._closeDropDown=function(e){i.contains(e.target)||a.dropDownVisible(!1)},document.addEventListener("mousedown",this._closeDropDown),document.addEventListener("touchstart",this._closeDropDown)};return n.prototype.destroy=function(){this.viewModel.destroy(),document.removeEventListener("mousedown",this._closeDropDown),document.removeEventListener("touchstart",this._closeDropDown);var e=this.container;return r.cleanNode(e),e.removeChild(this.element),e.removeChild(this._node3D),e.removeChild(this._node2D),e.removeChild(this._nodeColumbus),i(this)},n}),i("Widgets/Timeline/TimelineTrack",["../../Core/Color"],function(e){function t(t,i,r,n){this.interval=t,this.height=i,this.color=r||new e(.5,.5,.5,1),this.backgroundColor=n||new e(0,0,0,0)}return t.prototype.render=function(e,t){var i=this.interval.start,r=this.interval.stop,n=t.startJulian,o=t.startJulian.addSeconds(t.duration);if(i.lessThan(n)&&r.greaterThan(o))e.fillStyle=this.color.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height);else if(i.lessThanOrEquals(o)&&r.greaterThanOrEquals(n)){var a,s,l;for(a=0;t.timeBarWidth>a;++a){var u=t.startJulian.addSeconds(a/t.timeBarWidth*t.duration);s===void 0&&u.greaterThanOrEquals(i)?s=a:l===void 0&&u.greaterThanOrEquals(r)&&(l=a)}e.fillStyle=this.backgroundColor.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height),s!==void 0&&(l===void 0&&(l=t.timeBarWidth),e.fillStyle=this.color.toCssColorString(),e.fillRect(s,t.y,Math.max(l-s,1),this.height))}},t}),i("Widgets/Timeline/TimelineHighlightRange",[],function(){function e(e,t){this._color=e,this._height=t}return e.prototype.getHeight=function(){return this._height},e.prototype.getStartTime=function(){return this._start},e.prototype.getStopTime=function(){return this._stop},e.prototype.setRange=function(e,t){this._start=e,this._stop=t},e.prototype.render=function(e){var t="";if(this._start&&this._stop&&this._color){var i=e.epochJulian.getSecondsDifference(this._start),r=Math.round(e.timeBarWidth*e.getAlpha(i)),n=e.epochJulian.getSecondsDifference(this._stop),o=Math.round(e.timeBarWidth*e.getAlpha(n))-r;0>r&&(o+=r,r=0),r+o>e.timeBarWidth&&(o=e.timeBarWidth-r),o>0&&(t='<span class="cesium-timeline-highlight" style="left: '+(""+r)+"px; width: "+(""+o)+"px; bottom: "+(""+e.y)+"px; height: "+this._height+"px; background-color: "+this._color+';"></span>')}return e.y+=this._height,t},e}),i("Widgets/Timeline/Timeline",["./TimelineTrack","./TimelineHighlightRange","../../Core/DeveloperError","../../Core/Clock","../../Core/ClockRange","../../Core/JulianDate"],function(e,t,i,r,n,o){function a(e,t){if(e===void 0)throw new i("container is required.");if("string"==typeof e){var r=document.getElementById(e);if(null===r)throw new i('Element with id "'+e+'" does not exist in the document.');e=r}if(t===void 0)throw new i("clock is required.");this.container=e,this._endJulian=void 0,this._epochJulian=void 0,this._lastXPos=void 0,this._scrubElement=void 0,this._startJulian=void 0,this._timeBarSecondsSpan=void 0,this._clock=t,this._scrubJulian=t.currentTime,this._mainTicSpan=-1,this._mouseMode=u.none,this._touchMode=c.none,this._touchState={centerX:0,spanX:0},this._mouseX=0,this._timelineDrag=0,this._timelineDragLocation=void 0;var n=this;this.container.className+=" cesium-timeline-main",this.container.innerHTML='<div class="cesium-timeline-bar"></div><div class="cesium-timeline-trackContainer"><canvas class="cesium-timeline-tracks" width="10" height="1"></canvas></div><div class="cesium-timeline-needle"></div><span class="cesium-timeline-ruler"></span>',this._timeBarEle=this.container.childNodes[0],this._trackContainer=this.container.childNodes[1],this._trackListEle=this.container.childNodes[1].childNodes[0],this._needleEle=this.container.childNodes[2],this._rulerEle=this.container.childNodes[3],this._context=this._trackListEle.getContext("2d"),this._trackList=[],this._highlightRanges=[],this.zoomTo(t.startTime,t.stopTime),this._timeBarEle.addEventListener("mousedown",function(e){n._handleMouseDown(e)},!1),document.addEventListener("mouseup",function(e){n._handleMouseUp(e)},!1),document.addEventListener("mousemove",function(e){n._handleMouseMove(e)},!1),this._timeBarEle.addEventListener("DOMMouseScroll",function(e){n._handleMouseWheel(e)},!1),this._timeBarEle.addEventListener("mousewheel",function(e){n._handleMouseWheel(e)},!1),this._timeBarEle.addEventListener("touchstart",function(e){n._handleTouchStart(e)},!1),document.addEventListener("touchmove",function(e){n._handleTouchMove(e)},!1),document.addEventListener("touchend",function(e){n._handleTouchEnd(e)},!1),this.container.oncontextmenu=function(){return!1},window.addEventListener("resize",function(){n.handleResize()},!1),this.addEventListener=function(e,t,i){n.container.addEventListener(e,t,i)},t.onTick.addEventListener(this.updateFromClock,this),this.updateFromClock()}function s(e){return 10>e?"0"+(""+e):""+e}var l=1e12,u={none:0,scrub:1,slide:2,zoom:3,touchOnly:4},c={none:0,scrub:1,slideZoom:2,singleTap:3,ignore:4},h=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800,1296e3,2592e3,5184e3,7776e3,15552e3,31536e3,63072e3,126144e3,15768e4,31536e4,63072e4,126144e4,15768e5,31536e5,63072e5,126144e5,15768e6,31536e6],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a.prototype.addHighlightRange=function(e,i){var r=new t(e,i);return this._highlightRanges.push(r),this.handleResize(),r},a.prototype.addTrack=function(t,i,r,n){var o=new e(t,i,r,n);return this._trackList.push(o),this.handleResize(),o},a.prototype.zoomTo=function(e,t){if(this._timeBarSecondsSpan=e.getSecondsDifference(t),0>=this._timeBarSecondsSpan)throw new i("Start time must come before end time.");if(this._startJulian=e,this._endJulian=t,this._clock&&this._clock.clockRange!==n.UNBOUNDED){var r=this._clock.startTime,o=this._clock.stopTime,a=r.getSecondsDifference(o),s=this._startJulian.getSecondsDifference(r),l=this._endJulian.getSecondsDifference(o);this._timeBarSecondsSpan>=a?(this._timeBarSecondsSpan=a,this._startJulian=this._clock.startTime,this._endJulian=this._clock.stopTime):s>0?(this._endJulian=this._endJulian.addSeconds(s),this._startJulian=r,this._timeBarSecondsSpan=this._startJulian.getSecondsDifference(this._endJulian)):0>l&&(this._startJulian=this._startJulian.addSeconds(l),this._endJulian=o,this._timeBarSecondsSpan=this._startJulian.getSecondsDifference(this._endJulian))}this.handleResize();var u=document.createEvent("Event");u.initEvent("setzoom",!0,!0),u.startJulian=this._startJulian,u.endJulian=this._endJulian,u.epochJulian=this._epochJulian,u.totalSpan=this._timeBarSecondsSpan,u.mainTicSpan=this._mainTicSpan,this.container.dispatchEvent(u)},a.prototype.zoomFrom=function(e){var t=this._startJulian.getSecondsDifference(this._scrubJulian);e>1||0>t||t>this._timeBarSecondsSpan?t=.5*this._timeBarSecondsSpan:t+=t-.5*this._timeBarSecondsSpan;var i=this._timeBarSecondsSpan-t;this.zoomTo(this._startJulian.addSeconds(t-t*e),this._endJulian.addSeconds(i*e-i))},a.prototype.makeLabel=function(e){var t=e.toGregorianDate(),i=t.hour,r=12>i?" AM":" PM";i>=13?i-=12:0===i&&(i=12);var n=t.millisecond,o="";if(n>0&&3600>this._timeBarSecondsSpan){for(o=""+Math.floor(n);3>o.length;)o="0"+o;o="."+o}return d[t.month-1]+" "+t.day+" "+t.year+" "+s(i)+":"+s(t.minute)+":"+s(t.second)+o+r},a.prototype.smallestTicInPixels=7,a.prototype._makeTics=function(){function e(e){return Math.floor(x/e)*e}function t(e,t){return Math.ceil(e/t+.5)*t}function i(e){return(e-x)/g}function r(e,t){return e-t*Math.round(e/t)}var n,a=this._timeBarEle,s=this._startJulian.getSecondsDifference(this._scrubJulian),l=Math.round(s*this.container.clientWidth/this._timeBarSecondsSpan),u=l-8,c=this;this._needleEle.style.left=""+l+"px";var d='<span class="cesium-timeline-icon16" style="left:'+u+'px;bottom:0;background-position: 0px 0px;"></span>',m=.01,p=31536e6,f=1e-10,v=0,g=this._timeBarSecondsSpan;m>g?(g=m,this._timeBarSecondsSpan=m,this._endJulian=this._startJulian.addSeconds(m)):g>p&&(g=p,this._timeBarSecondsSpan=p,this._endJulian=this._startJulian.addSeconds(p));var _=this._timeBarEle.clientWidth;10>_&&(_=10);var y,w=this._startJulian,C=Math.min(1e-5*(g/_),.4);y=g>31536e4?o.fromIso8601(w.toDate().toISOString().substring(0,2)+"00-01-01T00:00:00Z"):g>31536e3?o.fromIso8601(w.toDate().toISOString().substring(0,3)+"0-01-01T00:00:00Z"):g>86400?o.fromIso8601(w.toDate().toISOString().substring(0,4)+"-01-01T00:00:00Z"):o.fromIso8601(w.toDate().toISOString().substring(0,10)+"T00:00:00Z");var x=y.addSeconds(C).getSecondsDifference(this._startJulian),T=x+g;this._epochJulian=y,this._rulerEle.innerHTML=this.makeLabel(this._endJulian.addSeconds(-m));var S=this._rulerEle.offsetWidth+20,E=v;v-=f;var b={y:0,startTime:x,startJulian:w,epochJulian:y,duration:g,timeBarWidth:_,getAlpha:i};this._highlightRanges.forEach(function(e){d+=e.render(b)});var M=0,I=0,D=0,A=S/_;A>1&&(A=1),A*=this._timeBarSecondsSpan;var P,R=-1,O=-1,z=h.length;for(P=0;z>P;++P){var L=h[P];if(++R,M=L,L>A&&L>v)break;0>O&&_*(L/this._timeBarSecondsSpan)>=this.smallestTicInPixels&&(O=R)}if(R>0){for(;R>0;)if(--R,1e-5>Math.abs(r(M,h[R]))){h[R]>=v&&(I=h[R]);break}if(O>=0)for(;R>O;){if(1e-5>Math.abs(r(I,h[O]))&&h[O]>=v){D=h[O];break}++O}}v=E,v>f&&1e-5>D&&Math.abs(v-M)>f&&(D=v,M+f>=v&&(I=0));var N,V=-999999;if(_*(D/this._timeBarSecondsSpan)>=3)for(n=e(D);T>=n;n=t(n,D))d+='<span class="cesium-timeline-ticTiny" style="left: '+(""+Math.round(_*i(n)))+'px;"></span>';if(_*(I/this._timeBarSecondsSpan)>=3)for(n=e(I);T>=n;n=t(n,I))d+='<span class="cesium-timeline-ticSub" style="left: '+(""+Math.round(_*i(n)))+'px;"></span>';if(_*(M/this._timeBarSecondsSpan)>=2){this._mainTicSpan=M,T+=M,n=e(M);for(var B=y.getTaiMinusUtc();T>=n;){var F=w.addSeconds(n-x);if(M>2.1){var q=F.getTaiMinusUtc();Math.abs(q-B)>.1&&(n+=q-B,F=w.addSeconds(n-x))}var U=Math.round(_*i(n)),k=this.makeLabel(F);this._rulerEle.innerHTML=k,N=this._rulerEle.offsetWidth;var W=U-(N/2-1);W>V?(V=W+N+5,d+='<span class="cesium-timeline-ticMain" style="left: '+(""+U)+'px;"></span>'+'<span class="cesium-timeline-ticLabel" style="left: '+(""+W)+'px;">'+k+"</span>"):d+='<span class="cesium-timeline-ticSub" style="left: '+(""+U)+'px;"></span>',n=t(n,M)}}else this._mainTicSpan=-1;a.innerHTML=d,this._scrubElement=a.childNodes[0],b.y=0,this._trackList.forEach(function(e){e.render(c._context,b),b.y+=e.height})},a.prototype.updateFromClock=function(){this._scrubJulian=this._clock.currentTime;var e=this._scrubElement;if(this._scrubElement!==void 0){var t=this._startJulian.getSecondsDifference(this._scrubJulian),i=Math.round(t*this.container.clientWidth/this._timeBarSecondsSpan);this._lastXPos!==i&&(this._lastXPos=i,e.style.left=i-8+"px",this._needleEle.style.left=i+"px")}this._timelineDragLocation!==void 0&&(this._setTimeBarTime(this._timelineDragLocation,this._timelineDragLocation*this._timeBarSecondsSpan/this.container.clientWidth),this.zoomTo(this._startJulian.addSeconds(this._timelineDrag),this._endJulian.addSeconds(this._timelineDrag)))},a.prototype._setTimeBarTime=function(e,t){if(e=Math.round(e),this._scrubJulian=this._startJulian.addSeconds(t),this._scrubElement){var i=e-8;this._scrubElement.style.left=""+i+"px",this._needleEle.style.left=""+e+"px"}var r=document.createEvent("Event");r.initEvent("settime",!0,!0),r.clientX=e,r.timeSeconds=t,r.timeJulian=this._scrubJulian,this.container.dispatchEvent(r)},a.prototype._handleMouseDown=function(e){this._mouseMode!==u.touchOnly&&(0===e.button?(this._mouseMode=u.scrub,this._scrubElement&&(this._scrubElement.style.backgroundPosition="-16px 0"),this._handleMouseMove(e)):(this._mouseX=e.clientX,this._mouseMode=2===e.button?u.zoom:u.slide)),e.preventDefault()},a.prototype._handleMouseUp=function(){this._mouseMode=u.none,this._scrubElement&&(this._scrubElement.style.backgroundPosition="0px 0px"),this._timelineDrag=0,this._timelineDragLocation=void 0},a.prototype._handleMouseMove=function(e){var t;if(this._mouseMode===u.scrub){e.preventDefault();var i=e.clientX-this.container.getBoundingClientRect().left;0>i?(this._timelineDragLocation=0,this._timelineDrag=-.01*this._timeBarSecondsSpan):i>this.container.clientWidth?(this._timelineDragLocation=this.container.clientWidth,this._timelineDrag=.01*this._timeBarSecondsSpan):(this._timelineDragLocation=void 0,this._setTimeBarTime(i,i*this._timeBarSecondsSpan/this.container.clientWidth))}else if(this._mouseMode===u.slide){if(t=this._mouseX-e.clientX,this._mouseX=e.clientX,0!==t){var r=t*this._timeBarSecondsSpan/this.container.clientWidth;this.zoomTo(this._startJulian.addSeconds(r),this._endJulian.addSeconds(r))}}else this._mouseMode===u.zoom&&(t=this._mouseX-e.clientX,this._mouseX=e.clientX,0!==t&&this.zoomFrom(Math.pow(1.01,t)))},a.prototype._handleMouseWheel=function(e){var t=e.wheelDeltaY||e.wheelDelta||-e.detail;l=Math.max(Math.min(Math.abs(t),l),1),t/=l,this.zoomFrom(Math.pow(1.05,-t))},a.prototype._handleTouchStart=function(e){var t,i,r=e.touches.length,n=this.container.getBoundingClientRect().left;
e.preventDefault(),this._mouseMode=u.touchOnly,1===r?(t=this._startJulian.getSecondsDifference(this._scrubJulian),i=Math.round(t*this.container.clientWidth/this._timeBarSecondsSpan+n),50>Math.abs(e.touches[0].clientX-i)?(this._touchMode=c.scrub,this._scrubElement&&(this._scrubElement.style.backgroundPosition=1===r?"-16px 0":"0 0")):(this._touchMode=c.singleTap,this._touchState.centerX=e.touches[0].clientX-n)):2===r?(this._touchMode=c.slideZoom,this._touchState.centerX=.5*(e.touches[0].clientX+e.touches[1].clientX)-n,this._touchState.spanX=Math.abs(e.touches[0].clientX-e.touches[1].clientX)):this._touchMode=c.ignore},a.prototype._handleTouchEnd=function(e){var t=e.touches.length,i=this.container.getBoundingClientRect().left;this._touchMode===c.singleTap?(this._touchMode=c.scrub,this._handleTouchMove(e)):this._touchMode===c.scrub&&this._handleTouchMove(e),this._mouseMode=u.touchOnly,1!==t?this._touchMode=t>0?c.ignore:c.none:this._touchMode===c.slideZoom&&(this._touchState.centerX=e.touches[0].clientX-i),this._scrubElement&&(this._scrubElement.style.backgroundPosition="0 0")},a.prototype._handleTouchMove=function(e){var t,i,r,n,o,a,s=1,l=this.container.getBoundingClientRect().left;this._touchMode===c.singleTap&&(this._touchMode=c.slideZoom),this._mouseMode=u.touchOnly,this._touchMode===c.scrub?(e.preventDefault(),1===e.changedTouches.length&&(i=e.changedTouches[0].clientX-l,i>=0&&this.container.clientWidth>=i&&this._setTimeBarTime(i,i*this._timeBarSecondsSpan/this.container.clientWidth))):this._touchMode===c.slideZoom&&(r=e.touches.length,2===r?(n=.5*(e.touches[0].clientX+e.touches[1].clientX)-l,o=Math.abs(e.touches[0].clientX-e.touches[1].clientX)):1===r&&(n=e.touches[0].clientX-l,o=0),n!==void 0&&(o>0&&this._touchState.spanX>0?(s=this._touchState.spanX/o,a=this._startJulian.addSeconds((this._touchState.centerX*this._timeBarSecondsSpan-n*this._timeBarSecondsSpan*s)/this.container.clientWidth)):(t=this._touchState.centerX-n,a=this._startJulian.addSeconds(t*this._timeBarSecondsSpan/this.container.clientWidth)),this.zoomTo(a,a.addSeconds(this._timeBarSecondsSpan*s)),this._touchState.centerX=n,this._touchState.spanX=o))},a.prototype.handleResize=function(){var e=this.container.getBoundingClientRect().height-this._timeBarEle.getBoundingClientRect().height-2;this._trackContainer.style.height=""+e+"px";var t=1;this._trackList.forEach(function(e){t+=e.height}),this._trackListEle.style.height=""+t+"px",this._trackListEle.width=this._trackListEle.clientWidth,this._trackListEle.height=t,this._makeTics()},a}),i("Cesium",["Core/AxisAlignedBoundingBox","Core/BoundingRectangle","Core/BoundingSphere","Core/BoxTessellator","Core/Cartesian2","Core/Cartesian3","Core/Cartesian4","Core/Cartographic","Core/CatmullRomSpline","Core/Clock","Core/ClockRange","Core/ClockStep","Core/Color","Core/ComponentDatatype","Core/CubeMapEllipsoidTessellator","Core/CubicRealPolynomial","Core/DefaultProxy","Core/DeveloperError","Core/EarthOrientationParameters","Core/EarthOrientationParametersSample","Core/Ellipsoid","Core/EllipsoidTangentPlane","Core/EllipsoidalOccluder","Core/EncodedCartesian3","Core/Enumeration","Core/Event","Core/Extent","Core/ExtentTessellator","Core/FAR","Core/FeatureDetection","Core/Fullscreen","Core/GeographicProjection","Core/HeightmapTessellator","Core/HermitePolynomialApproximation","Core/HermiteSpline","Core/Iau2006XysData","Core/Iau2006XysSample","Core/IndexDatatype","Core/Intersect","Core/IntersectionTests","Core/Interval","Core/Iso8601","Core/JulianDate","Core/KeyboardEventModifier","Core/LagrangePolynomialApproximation","Core/LeapSecond","Core/LinearApproximation","Core/Math","Core/Matrix2","Core/Matrix3","Core/Matrix4","Core/MeshFilters","Core/Occluder","Core/OrientationInterpolator","Core/Plane","Core/PlaneTessellator","Core/PolygonPipeline","Core/PolylinePipeline","Core/PrimitiveType","Core/QuadraticRealPolynomial","Core/QuarticRealPolynomial","Core/Quaternion","Core/Queue","Core/Ray","Core/ReferenceFrame","Core/RequestErrorEvent","Core/RuntimeError","Core/ScreenSpaceEventHandler","Core/ScreenSpaceEventType","Core/Shapes","Core/Simon1994PlanetaryPositions","Core/Spherical","Core/TaskProcessor","Core/TimeConstants","Core/TimeInterval","Core/TimeIntervalCollection","Core/TimeStandard","Core/Tipsify","Core/Transforms","Core/TridiagonalSystemSolver","Core/Visibility","Core/WebMercatorProjection","Core/WindingOrder","Core/binarySearch","Core/buildModuleUrl","Core/clone","Core/combine","Core/createGuid","Core/defaultValue","Core/destroyObject","Core/freezeObject","Core/getImagePixels","Core/isCrossOriginUrl","Core/isLeapYear","Core/jsonp","Core/loadArrayBuffer","Core/loadImage","Core/loadJson","Core/loadText","Core/loadXML","Core/pointInsideTriangle2D","Core/requestAnimationFrame","Core/throttleRequestByServer","Core/writeTextToCanvas","DynamicScene/CompositeDynamicObjectCollection","DynamicScene/CzmlBoolean","DynamicScene/CzmlCartesian2","DynamicScene/CzmlCartesian3","DynamicScene/CzmlColor","DynamicScene/CzmlDefaults","DynamicScene/CzmlHorizontalOrigin","DynamicScene/CzmlImage","DynamicScene/CzmlLabelStyle","DynamicScene/CzmlNumber","DynamicScene/CzmlPosition","DynamicScene/CzmlString","DynamicScene/CzmlUnitCartesian3","DynamicScene/CzmlUnitQuaternion","DynamicScene/CzmlUnitSpherical","DynamicScene/CzmlVerticalOrigin","DynamicScene/DynamicBillboard","DynamicScene/DynamicBillboardVisualizer","DynamicScene/DynamicClock","DynamicScene/DynamicColorMaterial","DynamicScene/DynamicCone","DynamicScene/DynamicConeVisualizerUsingCustomSensor","DynamicScene/DynamicDirectionsProperty","DynamicScene/DynamicEllipse","DynamicScene/DynamicEllipsoid","DynamicScene/DynamicEllipsoidVisualizer","DynamicScene/DynamicGridMaterial","DynamicScene/DynamicImageMaterial","DynamicScene/DynamicLabel","DynamicScene/DynamicLabelVisualizer","DynamicScene/DynamicMaterialProperty","DynamicScene/DynamicObject","DynamicScene/DynamicObjectCollection","DynamicScene/DynamicObjectView","DynamicScene/DynamicPath","DynamicScene/DynamicPathVisualizer","DynamicScene/DynamicPoint","DynamicScene/DynamicPointVisualizer","DynamicScene/DynamicPolygon","DynamicScene/DynamicPolygonVisualizer","DynamicScene/DynamicPolyline","DynamicScene/DynamicPolylineVisualizer","DynamicScene/DynamicPositionProperty","DynamicScene/DynamicProperty","DynamicScene/DynamicPyramid","DynamicScene/DynamicPyramidVisualizer","DynamicScene/DynamicVertexPositionsProperty","DynamicScene/ReferenceProperty","DynamicScene/VisualizerCollection","DynamicScene/processCzml","Renderer/BlendEquation","Renderer/BlendFunction","Renderer/BlendingState","Renderer/Buffer","Renderer/BufferUsage","Renderer/ClearCommand","Renderer/CommandLists","Renderer/Context","Renderer/CubeMap","Renderer/CubeMapFace","Renderer/CullFace","Renderer/DepthFunction","Renderer/DrawCommand","Renderer/Framebuffer","Renderer/MipmapHint","Renderer/PassState","Renderer/PickFramebuffer","Renderer/PixelDatatype","Renderer/PixelFormat","Renderer/RenderState","Renderer/Renderbuffer","Renderer/RenderbufferFormat","Renderer/ShaderCache","Renderer/ShaderProgram","Renderer/StencilFunction","Renderer/StencilOperation","Renderer/Texture","Renderer/TextureAtlas","Renderer/TextureAtlasBuilder","Renderer/TextureMagnificationFilter","Renderer/TextureMinificationFilter","Renderer/TextureWrap","Renderer/UniformDatatype","Renderer/UniformState","Renderer/VertexArray","Renderer/VertexArrayFacade","Renderer/VertexLayout","Renderer/createPickFragmentShaderSource","Renderer/loadCubeMap","Scene/AnimationCollection","Scene/ArcGisImageServerTerrainProvider","Scene/ArcGisMapServerImageryProvider","Scene/Billboard","Scene/BillboardCollection","Scene/BingMapsImageryProvider","Scene/BingMapsStyle","Scene/Camera","Scene/CameraColumbusViewMode","Scene/CameraController","Scene/CameraEventAggregator","Scene/CameraEventType","Scene/CameraFlightPath","Scene/CentralBody","Scene/CentralBodySurface","Scene/CentralBodySurfaceShaderSet","Scene/CesiumTerrainProvider","Scene/CompositePrimitive","Scene/CullingVolume","Scene/CustomSensorVolume","Scene/DiscardMissingTileImagePolicy","Scene/EllipsoidPrimitive","Scene/EllipsoidTerrainProvider","Scene/FrameState","Scene/FrustumCommands","Scene/GeographicTilingScheme","Scene/GridImageryProvider","Scene/HeightmapTerrainData","Scene/HorizontalOrigin","Scene/Imagery","Scene/ImageryLayer","Scene/ImageryLayerCollection","Scene/ImageryProvider","Scene/ImageryState","Scene/Label","Scene/LabelCollection","Scene/LabelStyle","Scene/Material","Scene/NeverTileDiscardPolicy","Scene/OpenStreetMapImageryProvider","Scene/OrthographicFrustum","Scene/PerformanceDisplay","Scene/PerspectiveFrustum","Scene/PerspectiveOffCenterFrustum","Scene/Polygon","Scene/Polyline","Scene/PolylineCollection","Scene/Projections","Scene/RectangularPyramidSensorVolume","Scene/Scene","Scene/SceneMode","Scene/SceneTransitioner","Scene/ScreenSpaceCameraController","Scene/SensorVolumeCollection","Scene/SingleTileImageryProvider","Scene/SkyAtmosphere","Scene/SkyBox","Scene/TerrainData","Scene/TerrainMesh","Scene/TerrainProvider","Scene/TerrainState","Scene/TexturePool","Scene/Tile","Scene/TileCoordinatesImageryProvider","Scene/TileDiscardPolicy","Scene/TileImagery","Scene/TileLoadQueue","Scene/TileMapServiceImageryProvider","Scene/TileProviderError","Scene/TileReplacementQueue","Scene/TileState","Scene/TileTerrain","Scene/TilingScheme","Scene/VRTheWorldTerrainProvider","Scene/VerticalOrigin","Scene/ViewportQuad","Scene/WebMapServiceImageryProvider","Scene/WebMercatorTilingScheme","Scene/sampleTerrain","Shaders/BillboardCollectionFS","Shaders/BillboardCollectionVS","Shaders/BuiltinFunctions","Shaders/CentralBodyFS","Shaders/CentralBodyFSDepth","Shaders/CentralBodyFSPole","Shaders/CentralBodyVS","Shaders/CentralBodyVSDepth","Shaders/CentralBodyVSPole","Shaders/CustomSensorVolumeFS","Shaders/CustomSensorVolumeVS","Shaders/EllipsoidFS","Shaders/EllipsoidVS","Shaders/Materials/AsphaltMaterial","Shaders/Materials/BlobMaterial","Shaders/Materials/BrickMaterial","Shaders/Materials/BumpMapMaterial","Shaders/Materials/CementMaterial","Shaders/Materials/CheckerboardMaterial","Shaders/Materials/DotMaterial","Shaders/Materials/ErosionMaterial","Shaders/Materials/FacetMaterial","Shaders/Materials/FadeMaterial","Shaders/Materials/FresnelMaterial","Shaders/Materials/GrassMaterial","Shaders/Materials/GridMaterial","Shaders/Materials/NormalMapMaterial","Shaders/Materials/PolylineArrowMaterial","Shaders/Materials/PolylineGlowMaterial","Shaders/Materials/PolylineOutlineMaterial","Shaders/Materials/ReflectionMaterial","Shaders/Materials/RefractionMaterial","Shaders/Materials/RimLightingMaterial","Shaders/Materials/StripeMaterial","Shaders/Materials/TieDyeMaterial","Shaders/Materials/Water","Shaders/Materials/WoodMaterial","Shaders/PolygonFS","Shaders/PolygonVS","Shaders/PolylineFS","Shaders/PolylineVS","Shaders/ReprojectWebMercatorFS","Shaders/ReprojectWebMercatorVS","Shaders/SensorVolume","Shaders/SkyAtmosphereFS","Shaders/SkyAtmosphereVS","Shaders/SkyBoxFS","Shaders/SkyBoxVS","Shaders/ViewportQuadFS","Shaders/ViewportQuadVS","ThirdParty/Tween","ThirdParty/Uri","ThirdParty/knockout","ThirdParty/measureText","ThirdParty/sprintf","ThirdParty/when","Widgets/Animation/Animation","Widgets/Animation/AnimationViewModel","Widgets/BaseLayerPicker/BaseLayerPicker","Widgets/BaseLayerPicker/BaseLayerPickerViewModel","Widgets/BaseLayerPicker/ImageryProviderViewModel","Widgets/CesiumWidget/CesiumWidget","Widgets/ClockViewModel","Widgets/Command","Widgets/Fullscreen/FullscreenViewModel","Widgets/Fullscreen/FullscreenWidget","Widgets/Observable","Widgets/SceneModePicker/SceneModePicker","Widgets/SceneModePicker/SceneModePickerViewModel","Widgets/Timeline/Timeline","Widgets/Timeline/TimelineHighlightRange","Widgets/Timeline/TimelineTrack","Widgets/ToggleButtonViewModel","Widgets/createCommand"],function(e,t,i,r,n,o,a,s,l,u,c,h,d,m,p,f,v,g,_,y,w,C,x,T,S,E,b,M,I,D,A,P,R,O,z,L,N,V,B,F,q,U,k,W,H,j,G,Y,X,Z,K,J,Q,$,et,tt,it,rt,nt,ot,at,st,lt,ut,ct,ht,dt,mt,pt,ft,vt,gt,_t,yt,wt,Ct,xt,Tt,St,Et,bt,Mt,It,Dt,At,Pt,Rt,Ot,zt,Lt,Nt,Vt,Bt,Ft,qt,Ut,kt,Wt,Ht,jt,Gt,Yt,Xt,Zt,Kt,Jt,Qt,$t,ei,ti,ii,ri,ni,oi,ai,si,li,ui,ci,hi,di,mi,pi,fi,vi,gi,_i,yi,wi,Ci,xi,Ti,Si,Ei,bi,Mi,Ii,Di,Ai,Pi,Ri,Oi,zi,Li,Ni,Vi,Bi,Fi,qi,Ui,ki,Wi,Hi,ji,Gi,Yi,Xi,Zi,Ki,Ji,Qi,$i,er,tr,ir,rr,nr,or,ar,sr,lr,ur,cr,hr,dr,mr,pr,fr,vr,gr,_r,yr,wr,Cr,xr,Tr,Sr,Er,br,Mr,Ir,Dr,Ar,Pr,Rr,Or,zr,Lr,Nr,Vr,Br,Fr,qr,Ur,kr,Wr,Hr,jr,Gr,Yr,Xr,Zr,Kr,Jr,Qr,$r,en,tn,rn,nn,on,an,sn,ln,un,cn,hn,dn,mn,pn,fn,vn,gn,_n,yn,wn,Cn,xn,Tn,Sn,En,bn,Mn,In,Dn,An,Pn,Rn,On,zn,Ln,Nn,Vn,Bn,Fn,qn,Un,kn,Wn,Hn,jn,Gn,Yn,Xn,Zn,Kn,Jn,Qn,$n,eo,to,io,ro,no,oo,ao,so,lo,uo,co,ho,mo,po,fo,vo,go,_o,yo,wo,Co,xo,To,So,Eo,bo,Mo,Io,Do,Ao,Po,Ro,Oo,zo,Lo,No,Vo,Bo,Fo,qo,Uo,ko,Wo,Ho,jo,Go,Yo,Xo,Zo,Ko,Jo,Qo,$o,ea,ta,ia,ra,na,oa,aa,sa,la,ua,ca,ha,da,ma,pa,fa,va,ga,_a,ya,wa,Ca,xa,Ta){var Sa={_shaders:{}};return Sa.AxisAlignedBoundingBox=e,Sa.BoundingRectangle=t,Sa.BoundingSphere=i,Sa.BoxTessellator=r,Sa.Cartesian2=n,Sa.Cartesian3=o,Sa.Cartesian4=a,Sa.Cartographic=s,Sa.CatmullRomSpline=l,Sa.Clock=u,Sa.ClockRange=c,Sa.ClockStep=h,Sa.Color=d,Sa.ComponentDatatype=m,Sa.CubeMapEllipsoidTessellator=p,Sa.CubicRealPolynomial=f,Sa.DefaultProxy=v,Sa.DeveloperError=g,Sa.EarthOrientationParameters=_,Sa.EarthOrientationParametersSample=y,Sa.Ellipsoid=w,Sa.EllipsoidTangentPlane=C,Sa.EllipsoidalOccluder=x,Sa.EncodedCartesian3=T,Sa.Enumeration=S,Sa.Event=E,Sa.Extent=b,Sa.ExtentTessellator=M,Sa.FAR=I,Sa.FeatureDetection=D,Sa.Fullscreen=A,Sa.GeographicProjection=P,Sa.HeightmapTessellator=R,Sa.HermitePolynomialApproximation=O,Sa.HermiteSpline=z,Sa.Iau2006XysData=L,Sa.Iau2006XysSample=N,Sa.IndexDatatype=V,Sa.Intersect=B,Sa.IntersectionTests=F,Sa.Interval=q,Sa.Iso8601=U,Sa.JulianDate=k,Sa.KeyboardEventModifier=W,Sa.LagrangePolynomialApproximation=H,Sa.LeapSecond=j,Sa.LinearApproximation=G,Sa.Math=Y,Sa.Matrix2=X,Sa.Matrix3=Z,Sa.Matrix4=K,Sa.MeshFilters=J,Sa.Occluder=Q,Sa.OrientationInterpolator=$,Sa.Plane=et,Sa.PlaneTessellator=tt,Sa.PolygonPipeline=it,Sa.PolylinePipeline=rt,Sa.PrimitiveType=nt,Sa.QuadraticRealPolynomial=ot,Sa.QuarticRealPolynomial=at,Sa.Quaternion=st,Sa.Queue=lt,Sa.Ray=ut,Sa.ReferenceFrame=ct,Sa.RequestErrorEvent=ht,Sa.RuntimeError=dt,Sa.ScreenSpaceEventHandler=mt,Sa.ScreenSpaceEventType=pt,Sa.Shapes=ft,Sa.Simon1994PlanetaryPositions=vt,Sa.Spherical=gt,Sa.TaskProcessor=_t,Sa.TimeConstants=yt,Sa.TimeInterval=wt,Sa.TimeIntervalCollection=Ct,Sa.TimeStandard=xt,Sa.Tipsify=Tt,Sa.Transforms=St,Sa.TridiagonalSystemSolver=Et,Sa.Visibility=bt,Sa.WebMercatorProjection=Mt,Sa.WindingOrder=It,Sa.binarySearch=Dt,Sa.buildModuleUrl=At,Sa.clone=Pt,Sa.combine=Rt,Sa.createGuid=Ot,Sa.defaultValue=zt,Sa.destroyObject=Lt,Sa.freezeObject=Nt,Sa.getImagePixels=Vt,Sa.isCrossOriginUrl=Bt,Sa.isLeapYear=Ft,Sa.jsonp=qt,Sa.loadArrayBuffer=Ut,Sa.loadImage=kt,Sa.loadJson=Wt,Sa.loadText=Ht,Sa.loadXML=jt,Sa.pointInsideTriangle2D=Gt,Sa.requestAnimationFrame=Yt,Sa.throttleRequestByServer=Xt,Sa.writeTextToCanvas=Zt,Sa.CompositeDynamicObjectCollection=Kt,Sa.CzmlBoolean=Jt,Sa.CzmlCartesian2=Qt,Sa.CzmlCartesian3=$t,Sa.CzmlColor=ei,Sa.CzmlDefaults=ti,Sa.CzmlHorizontalOrigin=ii,Sa.CzmlImage=ri,Sa.CzmlLabelStyle=ni,Sa.CzmlNumber=oi,Sa.CzmlPosition=ai,Sa.CzmlString=si,Sa.CzmlUnitCartesian3=li,Sa.CzmlUnitQuaternion=ui,Sa.CzmlUnitSpherical=ci,Sa.CzmlVerticalOrigin=hi,Sa.DynamicBillboard=di,Sa.DynamicBillboardVisualizer=mi,Sa.DynamicClock=pi,Sa.DynamicColorMaterial=fi,Sa.DynamicCone=vi,Sa.DynamicConeVisualizerUsingCustomSensor=gi,Sa.DynamicDirectionsProperty=_i,Sa.DynamicEllipse=yi,Sa.DynamicEllipsoid=wi,Sa.DynamicEllipsoidVisualizer=Ci,Sa.DynamicGridMaterial=xi,Sa.DynamicImageMaterial=Ti,Sa.DynamicLabel=Si,Sa.DynamicLabelVisualizer=Ei,Sa.DynamicMaterialProperty=bi,Sa.DynamicObject=Mi,Sa.DynamicObjectCollection=Ii,Sa.DynamicObjectView=Di,Sa.DynamicPath=Ai,Sa.DynamicPathVisualizer=Pi,Sa.DynamicPoint=Ri,Sa.DynamicPointVisualizer=Oi,Sa.DynamicPolygon=zi,Sa.DynamicPolygonVisualizer=Li,Sa.DynamicPolyline=Ni,Sa.DynamicPolylineVisualizer=Vi,Sa.DynamicPositionProperty=Bi,Sa.DynamicProperty=Fi,Sa.DynamicPyramid=qi,Sa.DynamicPyramidVisualizer=Ui,Sa.DynamicVertexPositionsProperty=ki,Sa.ReferenceProperty=Wi,Sa.VisualizerCollection=Hi,Sa.processCzml=ji,Sa.BlendEquation=Gi,Sa.BlendFunction=Yi,Sa.BlendingState=Xi,Sa.Buffer=Zi,Sa.BufferUsage=Ki,Sa.ClearCommand=Ji,Sa.CommandLists=Qi,Sa.Context=$i,Sa.CubeMap=er,Sa.CubeMapFace=tr,Sa.CullFace=ir,Sa.DepthFunction=rr,Sa.DrawCommand=nr,Sa.Framebuffer=or,Sa.MipmapHint=ar,Sa.PassState=sr,Sa.PickFramebuffer=lr,Sa.PixelDatatype=ur,Sa.PixelFormat=cr,Sa.RenderState=hr,Sa.Renderbuffer=dr,Sa.RenderbufferFormat=mr,Sa.ShaderCache=pr,Sa.ShaderProgram=fr,Sa.StencilFunction=vr,Sa.StencilOperation=gr,Sa.Texture=_r,Sa.TextureAtlas=yr,Sa.TextureAtlasBuilder=wr,Sa.TextureMagnificationFilter=Cr,Sa.TextureMinificationFilter=xr,Sa.TextureWrap=Tr,Sa.UniformDatatype=Sr,Sa.UniformState=Er,Sa.VertexArray=br,Sa.VertexArrayFacade=Mr,Sa.VertexLayout=Ir,Sa.createPickFragmentShaderSource=Dr,Sa.loadCubeMap=Ar,Sa.AnimationCollection=Pr,Sa.ArcGisImageServerTerrainProvider=Rr,Sa.ArcGisMapServerImageryProvider=Or,Sa.Billboard=zr,Sa.BillboardCollection=Lr,Sa.BingMapsImageryProvider=Nr,Sa.BingMapsStyle=Vr,Sa.Camera=Br,Sa.CameraColumbusViewMode=Fr,Sa.CameraController=qr,Sa.CameraEventAggregator=Ur,Sa.CameraEventType=kr,Sa.CameraFlightPath=Wr,Sa.CentralBody=Hr,Sa.CentralBodySurface=jr,Sa.CentralBodySurfaceShaderSet=Gr,Sa.CesiumTerrainProvider=Yr,Sa.CompositePrimitive=Xr,Sa.CullingVolume=Zr,Sa.CustomSensorVolume=Kr,Sa.DiscardMissingTileImagePolicy=Jr,Sa.EllipsoidPrimitive=Qr,Sa.EllipsoidTerrainProvider=$r,Sa.FrameState=en,Sa.FrustumCommands=tn,Sa.GeographicTilingScheme=rn,Sa.GridImageryProvider=nn,Sa.HeightmapTerrainData=on,Sa.HorizontalOrigin=an,Sa.Imagery=sn,Sa.ImageryLayer=ln,Sa.ImageryLayerCollection=un,Sa.ImageryProvider=cn,Sa.ImageryState=hn,Sa.Label=dn,Sa.LabelCollection=mn,Sa.LabelStyle=pn,Sa.Material=fn,Sa.NeverTileDiscardPolicy=vn,Sa.OpenStreetMapImageryProvider=gn,Sa.OrthographicFrustum=_n,Sa.PerformanceDisplay=yn,Sa.PerspectiveFrustum=wn,Sa.PerspectiveOffCenterFrustum=Cn,Sa.Polygon=xn,Sa.Polyline=Tn,Sa.PolylineCollection=Sn,Sa.Projections=En,Sa.RectangularPyramidSensorVolume=bn,Sa.Scene=Mn,Sa.SceneMode=In,Sa.SceneTransitioner=Dn,Sa.ScreenSpaceCameraController=An,Sa.SensorVolumeCollection=Pn,Sa.SingleTileImageryProvider=Rn,Sa.SkyAtmosphere=On,Sa.SkyBox=zn,Sa.TerrainData=Ln,Sa.TerrainMesh=Nn,Sa.TerrainProvider=Vn,Sa.TerrainState=Bn,Sa.TexturePool=Fn,Sa.Tile=qn,Sa.TileCoordinatesImageryProvider=Un,Sa.TileDiscardPolicy=kn,Sa.TileImagery=Wn,Sa.TileLoadQueue=Hn,Sa.TileMapServiceImageryProvider=jn,Sa.TileProviderError=Gn,Sa.TileReplacementQueue=Yn,Sa.TileState=Xn,Sa.TileTerrain=Zn,Sa.TilingScheme=Kn,Sa.VRTheWorldTerrainProvider=Jn,Sa.VerticalOrigin=Qn,Sa.ViewportQuad=$n,Sa.WebMapServiceImageryProvider=eo,Sa.WebMercatorTilingScheme=to,Sa.sampleTerrain=io,Sa._shaders.BillboardCollectionFS=ro,Sa._shaders.BillboardCollectionVS=no,Sa._shaders.BuiltinFunctions=oo,Sa._shaders.CentralBodyFS=ao,Sa._shaders.CentralBodyFSDepth=so,Sa._shaders.CentralBodyFSPole=lo,Sa._shaders.CentralBodyVS=uo,Sa._shaders.CentralBodyVSDepth=co,Sa._shaders.CentralBodyVSPole=ho,Sa._shaders.CustomSensorVolumeFS=mo,Sa._shaders.CustomSensorVolumeVS=po,Sa._shaders.EllipsoidFS=fo,Sa._shaders.EllipsoidVS=vo,Sa._shaders.AsphaltMaterial=go,Sa._shaders.BlobMaterial=_o,Sa._shaders.BrickMaterial=yo,Sa._shaders.BumpMapMaterial=wo,Sa._shaders.CementMaterial=Co,Sa._shaders.CheckerboardMaterial=xo,Sa._shaders.DotMaterial=To,Sa._shaders.ErosionMaterial=So,Sa._shaders.FacetMaterial=Eo,Sa._shaders.FadeMaterial=bo,Sa._shaders.FresnelMaterial=Mo,Sa._shaders.GrassMaterial=Io,Sa._shaders.GridMaterial=Do,Sa._shaders.NormalMapMaterial=Ao,Sa._shaders.PolylineArrowMaterial=Po,Sa._shaders.PolylineGlowMaterial=Ro,Sa._shaders.PolylineOutlineMaterial=Oo,Sa._shaders.ReflectionMaterial=zo,Sa._shaders.RefractionMaterial=Lo,Sa._shaders.RimLightingMaterial=No,Sa._shaders.StripeMaterial=Vo,Sa._shaders.TieDyeMaterial=Bo,Sa._shaders.Water=Fo,Sa._shaders.WoodMaterial=qo,Sa._shaders.PolygonFS=Uo,Sa._shaders.PolygonVS=ko,Sa._shaders.PolylineFS=Wo,Sa._shaders.PolylineVS=Ho,Sa._shaders.ReprojectWebMercatorFS=jo,Sa._shaders.ReprojectWebMercatorVS=Go,Sa._shaders.SensorVolume=Yo,Sa._shaders.SkyAtmosphereFS=Xo,Sa._shaders.SkyAtmosphereVS=Zo,Sa._shaders.SkyBoxFS=Ko,Sa._shaders.SkyBoxVS=Jo,Sa._shaders.ViewportQuadFS=Qo,Sa._shaders.ViewportQuadVS=$o,Sa.Tween=ea,Sa.Uri=ta,Sa.knockout=ia,Sa.measureText=ra,Sa.sprintf=na,Sa.when=oa,Sa.Animation=aa,Sa.AnimationViewModel=sa,Sa.BaseLayerPicker=la,Sa.BaseLayerPickerViewModel=ua,Sa.ImageryProviderViewModel=ca,Sa.CesiumWidget=ha,Sa.ClockViewModel=da,Sa.Command=ma,Sa.FullscreenViewModel=pa,Sa.FullscreenWidget=fa,Sa.Observable=va,Sa.SceneModePicker=ga,Sa.SceneModePickerViewModel=_a,Sa.Timeline=ya,Sa.TimelineHighlightRange=wa,Sa.TimelineTrack=Ca,Sa.ToggleButtonViewModel=xa,Sa.createCommand=Ta,Sa}),t(["Cesium"],function(e){var t="undefined"!=typeof window?window:"undefined"!=typeof self?self:{};t.Cesium=e},void 0,!0),i("main",function(){})})();