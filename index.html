<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Open Aviation Map WebGL viewer</title>
    <script type="text/javascript" src="lib/Cesium/Cesium.js"></script>
    <script type="text/javascript" src="AirspaceTessellator.js"></script>
    <script type="text/javascript" src="Box.js"></script>
    <style>
      @import url(lib/Cesium/Widgets/CesiumWidget/CesiumWidget.css);
      body {
        padding: 0;
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
<body>
  <div id="cesiumContainer" class="fullSize"></div>
  <div id="buttons"></div>
  <script>
    var addAirspace = function(airspace, primitives) {
        var box = new Box(airspace);
        primitives.add(box);

        var c = new Cesium.Cartographic();

        var upperPoints = [];
        var lowerPoints = [];
        for (var i = 2; i < airspace.poslist.length; i += 2) {
            c.latitude  = Cesium.Math.toRadians(airspace.poslist[i]);
            c.longitude = Cesium.Math.toRadians(airspace.poslist[i+1]);
            c.height    = airspace.upper;

            var v = ellipsoid.cartographicToCartesian(c);
            upperPoints.push(v);

            c.height    = airspace.lower;
            v = ellipsoid.cartographicToCartesian(c);
            lowerPoints.push(v);
        }

        var upperPoly = new Cesium.Polygon();
        upperPoly.setPositions(upperPoints);
        upperPoly.height = airspace.upper;
        upperPoly.material.uniforms.color = airspace.color;
        primitives.add(upperPoly);

        var lowerPoly = new Cesium.Polygon();
        lowerPoly.setPositions(lowerPoints);
        lowerPoly.height = airspace.lower;
        lowerPoly.material.uniforms.color = airspace.color;
        primitives.add(lowerPoly);
    };


    var bg = new Cesium.SingleTileImageryProvider({
        url: 'white.png'
    });
    var osmProvider = new Cesium.OpenStreetMapImageryProvider({
        url: 'http://openaviationmap.tyrell.hu/static/osm',
        maximumLevel: 15,
        credit: 'Open Aviation Map'
    });
    var oamProvider = new Cesium.OpenStreetMapImageryProvider({
        url: 'http://openaviationmap.tyrell.hu/static/oam',
        maximumLevel: 15,
        credit: 'Open Aviation Map'
    });

    var widget = new Cesium.CesiumWidget('cesiumContainer');
    var scene = widget.scene;
    var ellipsoid = widget.centralBody.getEllipsoid();
    var primitives = scene.getPrimitives();

    var layers = widget.centralBody.getImageryLayers();
    /*
    layers.removeAll();
    layers.addImageryProvider(bg);
    layers.addImageryProvider(osmProvider);
    layers.addImageryProvider(oamProvider);
    */

    widget.centralBody.depthTestAgainstTerrain = true;


    var terrainProvider = new Cesium.CesiumTerrainProvider({
       url : 'http://cesium.agi.com/smallterrain'
    });
    widget.centralBody.terrainProvider = terrainProvider;


    var addPoint = function(lon, lat, elev) {
        var e = new Cesium.EllipsoidPrimitive();
        e.center = ellipsoid.cartographicToCartesian(
            Cesium.Cartographic.fromDegrees(lon, lat, elev));
        e.radii = new Cesium.Cartesian3(100, 100, 100);
        e.material = Cesium.Material.fromType(undefined, Cesium.Material.RimLightingType);
        primitives.add(e);
    }

    var lhr1 = {
        color: new Cesium.Color(1.0, 0, 0, 0.4),
        lower: 0,
        upper: 1066,
        poslist: [ 47.51638888888889, 18.974444444444444, 47.515277777777776, 19.021666666666665, 47.515, 19.033055555555556, 47.514722222222225, 19.04361111111111, 47.510555555555555, 19.055833333333332, 47.50611111111111, 19.056944444444444, 47.49472222222222, 19.060000000000002, 47.48305555555556, 19.029722222222222, 47.486111111111114, 19.013055555555557, 47.49194444444444, 18.979444444444443, 47.50055555555556, 18.97, 47.51638888888889, 18.974444444444444 ]
    };

    var lhr1a = {
        color: new Cesium.Color(1.0, 0, 0, 0.4),
        lower: 0,
        upper: 1066,
        poslist: [ 47.531666666666666, 18.93888888888889, 47.531666666666666, 18.965555555555554, 47.5225, 18.965555555555554, 47.5225, 18.93888888888889, 47.531666666666666, 18.93888888888889 ]
    };

    var lhbp_ctr = {
        color: new Cesium.Color(1.0, 0.68, 0.5, 0.4),
        lower: 0,
        upper: 610,
        poslist: [ 47.596111111111114, 19.08972222222222, 47.566111111111105, 19.171666666666667, 47.52444444444444, 19.240833333333335, 47.541666666666664, 19.325, 47.4, 19.566666666666666, 47.25, 19.358333333333334, 47.4, 19.125, 47.45, 19.108333333333334, 47.46888888888889, 19.073888888888888, 47.494166666666665, 19.060000000000002, 47.50611111111111, 19.056944444444444, 47.596111111111114, 19.08972222222222 ]
    };

    var budapest_tma1 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 2286,
        upper: 5944,
        poslist: [ 47.73861111111111, 18.258333333333333, 47.740185, 18.249217, 47.733391, 18.278716, 47.732746, 18.295126, 47.738854, 18.328923, 47.740796, 18.346272, 47.750945, 18.387948, 47.754036, 18.415984, 47.758371, 18.429041, 47.763127, 18.438096, 47.765766, 18.448314, 47.76416666666667, 18.465, 47.58416666666667, 18.465, 47.15222222222222, 18.742222222222225, 47.22527777777778, 18.251944444444444, 47.58916666666667, 18.2575, 47.73861111111111, 18.258333333333333 ]
    };

    var budapest_tma2 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 1981,
        upper: 5944,
        poslist: [ 47.76416666666667, 18.465, 47.764301, 18.460582, 47.7607, 18.472399, 47.75634, 18.482621, 47.753997, 18.49381, 47.754692, 18.505433, 47.758407, 18.519354, 47.766815, 18.538526, 47.768921, 18.552413, 47.767148, 18.569953, 47.760978, 18.601453, 47.7575, 18.618055555555557, 47.5425, 18.698888888888888, 47.42111111111111, 18.89611111111111, 47.135, 18.853333333333335, 47.15222222222222, 18.742222222222225, 47.58416666666667, 18.465, 47.76416666666667, 18.465 ]
    };

    var budapest_tma3 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 1066,
        upper: 5944,
        poslist: [ 47.7575, 18.618055555555557, 47.5425, 18.698888888888888, 47.42111111111111, 18.89611111111111, 47.135, 18.853333333333335, 47.0675, 19.275, 47.10166666666667, 19.458055555555553, 47.42361111111111, 18.994444444444447, 47.515277777777776, 19.021666666666665, 47.538888888888884, 18.982777777777777, 47.583333333333336, 18.883333333333333, 47.62222222222222, 18.90694444444444, 47.77861111111111, 19.114444444444445, 47.79722222222222, 18.730833333333333, 47.797528, 18.72883, 47.791425, 18.725734, 47.77613, 18.697569, 47.765705, 18.674675, 47.761345, 18.662953, 47.7575, 18.618055555555557 ]
    };

    var budapest_tma4 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 762,
        upper: 5944,
        poslist: [ 47.77861111111111, 19.114444444444445, 47.62222222222222, 18.90694444444444, 47.583333333333336, 18.883333333333333, 47.538888888888884, 18.982777777777777, 47.515277777777776, 19.021666666666665, 47.515, 19.033055555555556, 47.60333333333333, 19.07, 47.770833333333336, 19.275277777777777, 47.77861111111111, 19.114444444444445 ]
    };

    var budapest_tma5 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 1981,
        upper: 5944,
        poslist: [ 47.79722222222222, 18.730833333333333, 47.77861111111111, 19.114444444444445, 47.770833333333336, 19.275277777777777, 47.75083333333333, 19.68138888888889, 47.873333333333335, 19.578055555555554, 48.08694444444445, 19.391666666666666, 48.088173, 19.393526, 48.092911, 19.387377, 48.092469, 19.375407, 48.089091, 19.372049, 48.092984, 19.357675, 48.093365, 19.344203, 48.091393, 19.33133, 48.088298, 19.320812, 48.089848, 19.309594, 48.089276, 19.298399, 48.084152, 19.29336, 48.080937, 19.282837, 48.074721, 19.277509, 48.075177, 19.270015, 48.078719, 19.266288, 48.078792, 19.261776, 48.073479, 19.261338, 48.072365, 19.255424, 48.069365, 19.249434, 48.064411, 19.248418, 48.057831, 19.244368, 48.057158, 19.236632, 48.059349, 19.226761, 48.063435, 19.225269, 48.065051, 19.216539, 48.065776, 19.205805, 48.063251, 19.198477, 48.062496, 19.187189, 48.065135, 19.178829, 48.069835, 19.153635, 48.076335, 19.134304, 48.073491, 19.124825, 48.068935, 19.119831, 48.068508, 19.113078, 48.070072, 19.099219, 48.07438, 19.08902, 48.072709, 19.081802, 48.066715, 19.076425, 48.064743, 19.065105, 48.060841, 19.057916, 48.067162, 19.046919, 48.068164, 19.035936, 48.07223, 19.030592, 48.077274, 19.020755, 48.077946, 19.012491, 48.073972, 19.010686, 48.070949, 19.005476, 48.069885, 18.994786, 48.062893, 18.991176, 48.058362, 18.987555, 48.056953, 18.967731, 48.060039, 18.939506, 48.058788, 18.929056, 48.054528, 18.922385, 48.053261, 18.912972, 48.054364, 18.902511, 48.057949, 18.893479, 48.056153, 18.88609, 48.047176, 18.875549, 48.047611, 18.867627, 48.050389, 18.859593, 48.052459, 18.848053, 48.049026, 18.838843, 48.043841, 18.836156, 48.042339, 18.827343, 48.036218, 18.828305, 48.030331, 18.828163, 48.023566, 18.819054, 48.01558, 18.817235, 48.007254, 18.82079, 47.999813, 18.819181, 47.996754, 18.81744, 47.998505, 18.814172, 47.995599, 18.808588, 47.992527, 18.812827, 47.990017, 18.807321, 47.988274, 18.798133, 47.989283, 18.787873, 47.986373, 18.77616, 47.98898, 18.77209, 47.986633, 18.765991, 47.983189, 18.766408, 47.983326, 18.762388, 47.978993, 18.758292, 47.975682, 18.753314, 47.970993, 18.756658, 47.966011, 18.7716, 47.958027, 18.777551, 47.95462, 18.775481, 47.954921, 18.770365, 47.948352, 18.773391, 47.940663, 18.774048, 47.936234, 18.772347, 47.930459, 18.768612, 47.922042, 18.757873, 47.91706, 18.758643, 47.912044, 18.762584, 47.907649, 18.75934, 47.903998, 18.762141, 47.898747, 18.759001, 47.889286, 18.766091, 47.883851, 18.768325, 47.882775, 18.763411, 47.873303, 18.763329, 47.871917, 18.76855, 47.869576, 18.770643, 47.869939, 18.779151, 47.867272, 18.783198, 47.866826, 18.792315, 47.859924, 18.797049, 47.854557, 18.815364, 47.849219, 18.822178, 47.842179, 18.824865, 47.833103, 18.830727, 47.830277, 18.835965, 47.82999, 18.843718, 47.830735, 18.850597, 47.828071, 18.855661, 47.822059, 18.849382, 47.817108, 18.848199, 47.819103, 18.781986, 47.818294, 18.754363, 47.815502, 18.742258, 47.810547, 18.734441, 47.803691, 18.730673, 47.79722222222222, 18.730833333333333 ]
    };

    var budapest_tma6 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 610,
        upper: 5944,
        poslist: [ 47.770833333333336, 19.275277777777777, 47.60333333333333, 19.07, 47.515, 19.033055555555556, 47.515277777777776, 19.021666666666665, 47.42361111111111, 18.994444444444447, 47.10166666666667, 19.458055555555553, 47.200833333333335, 19.998055555555556, 47.75083333333333, 19.68138888888889, 47.770833333333336, 19.275277777777777 ]
    };

    var budapest_tma7 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 1676,
        upper: 5944,
        poslist: [ 47.75083333333333, 19.68138888888889, 47.200833333333335, 19.998055555555556, 47.3975, 20.17777777777778, 47.59138888888889, 20.065, 47.75083333333333, 19.68138888888889 ]
    };

    var budapest_tma8 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 2896,
        upper: 5944,
        poslist: [ 48.08694444444445, 19.391666666666666, 48.088173, 19.393526, 48.086589, 19.403372, 48.090493, 19.409405, 48.090591, 19.420673, 48.093264, 19.428454, 48.098857, 19.432843, 48.102547, 19.438012, 48.104954, 19.454752, 48.105018, 19.46115, 48.102367, 19.462253, 48.099904, 19.455671, 48.094844, 19.453952, 48.091195, 19.456715, 48.088718, 19.461314, 48.087902, 19.46863, 48.093383, 19.469353, 48.100136, 19.47242, 48.105355, 19.485156, 48.113339, 19.493067, 48.122111, 19.495278, 48.133922, 19.496746, 48.140682, 19.496233, 48.153286, 19.511831, 48.161048, 19.512467, 48.167507, 19.509634, 48.174732, 19.508458, 48.17937, 19.511551, 48.184754, 19.51757, 48.188127, 19.524455, 48.194417, 19.528029, 48.199971, 19.524654, 48.206433, 19.52781, 48.210777, 19.53782, 48.210986, 19.548774, 48.21307, 19.560331, 48.215825, 19.569678, 48.216912, 19.578965, 48.230519, 19.595434, 48.242719, 19.613465, 48.251418, 19.628635, 48.252697, 19.637086, 48.246498, 19.641544, 48.240829, 19.6479, 48.240608, 19.65654, 48.242965, 19.665032, 48.238186, 19.672877, 48.230576, 19.673169, 48.222305, 19.674712, 48.215871, 19.679482, 48.205845, 19.695666, 48.203392, 19.707119, 48.204277, 19.71794, 48.209213, 19.725933, 48.216618, 19.733691, 48.218387, 19.742596, 48.217072, 19.754347, 48.212434, 19.763051, 48.206975, 19.770597, 48.203358, 19.779589, 48.195477, 19.787725, 48.195725, 19.79518, 48.194187, 19.800832, 48.188298, 19.803406, 48.184163, 19.801507, 48.173385, 19.788126, 48.168533, 19.784742, 48.162671, 19.783554, 48.15804, 19.789241, 48.155838, 19.798888, 48.157315, 19.805284, 48.165287, 19.809912, 48.170586, 19.816638, 48.169433, 19.825825, 48.165034, 19.831013, 48.164524, 19.839284, 48.176052, 19.848954, 48.17762, 19.853733, 48.173672, 19.856384, 48.169971, 19.861255, 48.171765, 19.868598, 48.171045, 19.875581, 48.165894, 19.881331, 48.165447, 19.894819, 48.16222222222222, 19.9, 47.873333333333335, 19.578055555555554, 48.08694444444445, 19.391666666666666 ]
    };

    var budapest_tma9 = {
        color: new Cesium.Color(0, 0, 1, 0.4),
        lower: 610,
        upper: 5944,
        poslist: [ 47.200833333333335, 19.998055555555556, 47.10166666666667, 19.458055555555553, 47.0675, 19.275, 47.044444444444444, 20.074444444444445, 47.200833333333335, 19.998055555555556 ]
    };

    addAirspace(lhr1, primitives);
    addAirspace(lhr1a, primitives);
    addAirspace(lhbp_ctr, primitives);
    addAirspace(budapest_tma1, primitives);
    addAirspace(budapest_tma2, primitives);
    addAirspace(budapest_tma3, primitives);
    addAirspace(budapest_tma4, primitives);
    addAirspace(budapest_tma5, primitives);
    addAirspace(budapest_tma6, primitives);
    addAirspace(budapest_tma7, primitives);
    addAirspace(budapest_tma8, primitives);
    addAirspace(budapest_tma9, primitives);


    // put a sphere at the edge of our space
    var west = 18.93888888888889;
    var east = 18.965555555555554;
    var north = 47.531666666666666;
    var south = 47.5225;

    var upper = 1066;

    /*
    addPoint(east, south, upper);
    addPoint(east, north, upper);
    addPoint(west, north, upper);
    addPoint(west, south, upper);

    addPoint(east, north, lower);
    addPoint(west, north, lower);
    addPoint(west, south, lower)
    addPoint(east, south, lower);
    */


    // look at our polygon
    var extent = new Cesium.Extent(Cesium.Math.toRadians(west),
                                   Cesium.Math.toRadians(south),
                                   Cesium.Math.toRadians(east),
                                   Cesium.Math.toRadians(north));
    var cc = scene.getCamera().controller;
    cc.viewExtent(extent, ellipsoid);
    cc.moveBackward(1000);
    cc.moveDown(4000);
    cc.lookUp(Math.PI / 2.5);

  </script>
</body>
</html>
